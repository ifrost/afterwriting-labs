/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!

 handlebars v1.3.0

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

/*!
 * js-logger - http://github.com/jonnyreeves/js-logger 
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license. 
 */

/*! jQuery v1.11.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/** @preserve jsPDF 0.9.0rc2 ( ${buildDate} ${commitID} )
Copyright (c) 2010-2012 James Hall, james@snapshotmedia.co.uk, https://github.com/MrRio/jsPDF
Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
MIT license.
*/

/*
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */

/**  @preserve
            -----------------------------------------------------------------------------------------------
            JavaScript PubSub library
            2012 (c) ddotsenko@willowsystems.com
            based on Peter Higgins (dante@dojotoolkit.org)
            Loosely based on Dojo publish/subscribe API, limited in scope. Rewritten blindly.
            Original is (c) Dojo Foundation 2004-2010. Released under either AFL or new BSD, see:
            http://dojofoundation.org/license for more information.
            -----------------------------------------------------------------------------------------------
            */

// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("libs/almond",function(){});var Handlebars=function(){var e=function(){function t(e){this.string=e}var e;return t.prototype.toString=function(){return""+this.string},e=t,e}(),t=function(e){function o(e){return r[e]||"&amp;"}function u(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function c(e){return e instanceof n?e.toString():!e&&e!==0?"":(e=""+e,s.test(e)?e.replace(i,o):e)}function h(e){return!e&&e!==0?!0:l(e)&&e.length===0?!0:!1}var t={},n=e,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,s=/[&<>"'`]/;t.extend=u;var a=Object.prototype.toString;t.toString=a;var f=function(e){return typeof e=="function"};f(/x/)&&(f=function(e){return typeof e=="function"&&a.call(e)==="[object Function]"});var f;t.isFunction=f;var l=Array.isArray||function(e){return e&&typeof e=="object"?a.call(e)==="[object Array]":!1};return t.isArray=l,t.escapeExpression=c,t.isEmpty=h,t}(e),n=function(){function n(e,n){var r;n&&n.firstLine&&(r=n.firstLine,e+=" - "+r+":"+n.firstColumn);var i=Error.prototype.constructor.call(this,e);for(var s=0;s<t.length;s++)this[t[s]]=i[t[s]];r&&(this.lineNumber=r,this.column=n.firstColumn)}var e,t=["description","fileName","lineNumber","message","name","number","stack"];return n.prototype=new Error,e=n,e}(),r=function(e,t){function h(e,t){this.helpers=e||{},this.partials=t||{},p(this)}function p(e){e.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new i("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var r=n.inverse||function(){},i=n.fn;return f(t)&&(t=t.call(this)),t===!0?i(this):t===!1||t==null?r(this):a(t)?t.length>0?e.helpers.each(t,n):r(this):i(t)}),e.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i=0,s="",o;f(e)&&(e=e.call(this)),t.data&&(o=m(t.data));if(e&&typeof e=="object")if(a(e))for(var u=e.length;i<u;i++)o&&(o.index=i,o.first=i===0,o.last=i===e.length-1),s+=n(e[i],{data:o});else for(var l in e)e.hasOwnProperty(l)&&(o&&(o.key=l,o.index=i,o.first=i===0),s+=n(e[l],{data:o}),i++);return i===0&&(s=r(this)),s}),e.registerHelper("if",function(e,t){return f(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){f(e)&&(e=e.call(this));if(!r.isEmpty(e))return t.fn(e)}),e.registerHelper("log",function(t,n){var r=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;e.log(r,t)})}function v(e,t){d.log(e,t)}var n={},r=e,i=t,s="1.3.0";n.VERSION=s;var o=4;n.COMPILER_REVISION=o;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};n.REVISION_CHANGES=u;var a=r.isArray,f=r.isFunction,l=r.toString,c="[object Object]";n.HandlebarsEnvironment=h,h.prototype={constructor:h,logger:d,log:v,registerHelper:function(e,t,n){if(l.call(e)===c){if(n||t)throw new i("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){l.call(e)===c?r.extend(this.partials,e):this.partials[e]=t}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(d.level<=e){var n=d.methodMap[e];typeof console!="undefined"&&console[n]&&console[n].call(console,t)}}};n.logger=d,n.log=v;var m=function(e){var t={};return r.extend(t,e),t};return n.createFrame=m,n}(t,n),i=function(e,t,n){function a(e){var t=e&&e[0]||1,n=o;if(t!==n){if(t<n){var r=u[n],i=u[t];throw new s("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+i+").")}throw new s("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function f(e,t){if(!t)throw new s("No environment passed to template");var n=function(e,n,r,i,o,u){var a=t.VM.invokePartial.apply(this,arguments);if(a!=null)return a;if(t.compile){var f={helpers:i,partials:o,data:u};return o[n]=t.compile(e,{data:u!==undefined},t),o[n](r,f)}throw new s("The partial "+n+" could not be compiled when running in runtime-only mode")},r={escapeExpression:i.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var r=this.programs[e];return n?r=c(e,t,n):r||(r=this.programs[e]=c(e,t)),r},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},i.extend(n,t),i.extend(n,e)),n},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(n,i){i=i||{};var s=i.partial?i:t,o,u;i.partial||(o=i.helpers,u=i.partials);var a=e.call(r,s,n,o,u,i.data);return i.partial||t.VM.checkRevision(r.compilerInfo),a}}function l(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i}function c(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r}function h(e,t,n,r,i,o){var u={partial:!0,helpers:r,partials:i,data:o};if(e===undefined)throw new s("The partial "+t+" could not be found");if(e instanceof Function)return e(n,u)}function p(){return""}var r={},i=e,s=t,o=n.COMPILER_REVISION,u=n.REVISION_CHANGES;return r.checkRevision=a,r.template=f,r.programWithDepth=l,r.program=c,r.invokePartial=h,r.noop=p,r}(t,n,r),s=function(e,t,n,r,i){var s,o=e,u=t,a=n,f=r,l=i,c=function(){var e=new o.HandlebarsEnvironment;return f.extend(e,o),e.SafeString=u,e.Exception=a,e.Utils=f,e.VM=l,e.template=function(t){return l.template(t,e)},e},h=c();return h.create=c,s=h,s}(r,e,n,t,i),o=function(e){function r(e){e=e||{},this.firstLine=e.first_line,this.firstColumn=e.first_column,this.lastColumn=e.last_column,this.lastLine=e.last_line}var t,n=e,i={ProgramNode:function(e,t,n,s){var o,u;arguments.length===3?(s=n,n=null):arguments.length===2&&(s=t,t=null),r.call(this,s),this.type="program",this.statements=e,this.strip={},n?(u=n[0],u?(o={first_line:u.firstLine,last_line:u.lastLine,last_column:u.lastColumn,first_column:u.firstColumn},this.inverse=new i.ProgramNode(n,t,o)):this.inverse=new i.ProgramNode(n,t),this.strip.right=t.left):t&&(this.strip.left=t.right)},MustacheNode:function(e,t,n,s,o){r.call(this,o),this.type="mustache",this.strip=s;if(n!=null&&n.charAt){var u=n.charAt(3)||n.charAt(2);this.escaped=u!=="{"&&u!=="&"}else this.escaped=!!n;e instanceof i.SexprNode?this.sexpr=e:this.sexpr=new i.SexprNode(e,t),this.sexpr.isRoot=!0,this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(e,t,n){r.call(this,n),this.type="sexpr",this.hash=t;var i=this.id=e[0],s=this.params=e.slice(1),o=this.eligibleHelper=i.isSimple;this.isHelper=o&&(s.length||t)},PartialNode:function(e,t,n,i){r.call(this,i),this.type="partial",this.partialName=e,this.context=t,this.strip=n},BlockNode:function(e,t,i,s,o){r.call(this,o);if(e.sexpr.id.original!==s.path.original)throw new n(e.sexpr.id.original+" doesn't match "+s.path.original,this);this.type="block",this.mustache=e,this.program=t,this.inverse=i,this.strip={left:e.strip.left,right:s.strip.right},(t||i).strip.left=e.strip.right,(i||t).strip.right=s.strip.left,i&&!t&&(this.isInverse=!0)},ContentNode:function(e,t){r.call(this,t),this.type="content",this.string=e},HashNode:function(e,t){r.call(this,t),this.type="hash",this.pairs=e},IdNode:function(e,t){r.call(this,t),this.type="ID";var i="",s=[],o=0;for(var u=0,a=e.length;u<a;u++){var f=e[u].part;i+=(e[u].separator||"")+f;if(f===".."||f==="."||f==="this"){if(s.length>0)throw new n("Invalid path: "+i,this);f===".."?o++:this.isScoped=!0}else s.push(f)}this.original=i,this.parts=s,this.string=s.join("."),this.depth=o,this.isSimple=e.length===1&&!this.isScoped&&o===0,this.stringModeValue=this.string},PartialNameNode:function(e,t){r.call(this,t),this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e,t){r.call(this,t),this.type="DATA",this.id=e},StringNode:function(e,t){r.call(this,t),this.type="STRING",this.original=this.string=this.stringModeValue=e},IntegerNode:function(e,t){r.call(this,t),this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},BooleanNode:function(e,t){r.call(this,t),this.type="BOOLEAN",this.bool=e,this.stringModeValue=e==="true"},CommentNode:function(e,t){r.call(this,t),this.type="comment",this.comment=e}};return t=i,t}(n),u=function(){var e,t=function(){function t(e,t){return{left:e.charAt(2)==="~",right:t.charAt(0)==="~"||t.charAt(1)==="~"}}function r(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,sexpr:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,sexpr_repetition0:28,sexpr_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,OPEN_SEXPR:35,CLOSE_SEXPR:36,hash:37,hash_repetition_plus0:38,hashSegment:39,ID:40,EQUALS:41,DATA:42,pathSegments:43,SEP:44,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],performAction:function(n,r,i,s,o,u,a){var f=u.length-1;switch(o){case 1:return new s.ProgramNode(u[f-1],this._$);case 2:return new s.ProgramNode([],this._$);case 3:this.$=new s.ProgramNode([],u[f-1],u[f],this._$);break;case 4:this.$=new s.ProgramNode(u[f-2],u[f-1],u[f],this._$);break;case 5:this.$=new s.ProgramNode(u[f-1],u[f],[],this._$);break;case 6:this.$=new s.ProgramNode(u[f],this._$);break;case 7:this.$=new s.ProgramNode([],this._$);break;case 8:this.$=new s.ProgramNode([],this._$);break;case 9:this.$=[u[f]];break;case 10:u[f-1].push(u[f]),this.$=u[f-1];break;case 11:this.$=new s.BlockNode(u[f-2],u[f-1].inverse,u[f-1],u[f],this._$);break;case 12:this.$=new s.BlockNode(u[f-2],u[f-1],u[f-1].inverse,u[f],this._$);break;case 13:this.$=u[f];break;case 14:this.$=u[f];break;case 15:this.$=new s.ContentNode(u[f],this._$);break;case 16:this.$=new s.CommentNode(u[f],this._$);break;case 17:this.$=new s.MustacheNode(u[f-1],null,u[f-2],t(u[f-2],u[f]),this._$);break;case 18:this.$=new s.MustacheNode(u[f-1],null,u[f-2],t(u[f-2],u[f]),this._$);break;case 19:this.$={path:u[f-1],strip:t(u[f-2],u[f])};break;case 20:this.$=new s.MustacheNode(u[f-1],null,u[f-2],t(u[f-2],u[f]),this._$);break;case 21:this.$=new s.MustacheNode(u[f-1],null,u[f-2],t(u[f-2],u[f]),this._$);break;case 22:this.$=new s.PartialNode(u[f-2],u[f-1],t(u[f-3],u[f]),this._$);break;case 23:this.$=t(u[f-1],u[f]);break;case 24:this.$=new s.SexprNode([u[f-2]].concat(u[f-1]),u[f],this._$);break;case 25:this.$=new s.SexprNode([u[f]],null,this._$);break;case 26:this.$=u[f];break;case 27:this.$=new s.StringNode(u[f],this._$);break;case 28:this.$=new s.IntegerNode(u[f],this._$);break;case 29:this.$=new s.BooleanNode(u[f],this._$);break;case 30:this.$=u[f];break;case 31:u[f-1].isHelper=!0,this.$=u[f-1];break;case 32:this.$=new s.HashNode(u[f],this._$);break;case 33:this.$=[u[f-2],u[f]];break;case 34:this.$=new s.PartialNameNode(u[f],this._$);break;case 35:this.$=new s.PartialNameNode(new s.StringNode(u[f],this._$),this._$);break;case 36:this.$=new s.PartialNameNode(new s.IntegerNode(u[f],this._$));break;case 37:this.$=new s.DataNode(u[f],this._$);break;case 38:this.$=new s.IdNode(u[f],this._$);break;case 39:u[f-2].push({part:u[f],separator:u[f-1]}),this.$=u[f-2];break;case 40:this.$=[{part:u[f]}];break;case 43:this.$=[];break;case 44:u[f-1].push(u[f]);break;case 47:this.$=[u[f]];break;case 48:u[f-1].push(u[f])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],defaultActions:{3:[2,2],16:[2,1],50:[2,42]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){function s(e,t){return n.yytext=n.yytext.substr(e,n.yyleng-t)}var o=i;switch(r){case 0:n.yytext.slice(-2)==="\\\\"?(s(0,1),this.begin("mu")):n.yytext.slice(-1)==="\\"?(s(0,1),this.begin("emu")):this.begin("mu");if(n.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return s(0,4),this.popState(),15;case 4:return 35;case 5:return 36;case 6:return 25;case 7:return 16;case 8:return 20;case 9:return 19;case 10:return 19;case 11:return 23;case 12:return 22;case 13:this.popState(),this.begin("com");break;case 14:return s(3,5),this.popState(),15;case 15:return 22;case 16:return 41;case 17:return 40;case 18:return 40;case 19:return 44;case 20:break;case 21:return this.popState(),24;case 22:return this.popState(),18;case 23:return n.yytext=s(1,2).replace(/\\"/g,'"'),32;case 24:return n.yytext=s(1,2).replace(/\\'/g,"'"),32;case 25:return 42;case 26:return 34;case 27:return 34;case 28:return 33;case 29:return 40;case 30:return n.yytext=s(1,2),40;case 31:return"INVALID";case 32:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},e}();return e.lexer=n,r.prototype=e,e.Parser=r,new r}();return e=t,e}(),a=function(e,t){function s(e){return e.constructor===i.ProgramNode?e:(r.yy=i,r.parse(e))}var n={},r=e,i=t;return n.parser=r,n.parse=s,n}(u,o),f=function(e){function r(){}function i(e,t,r){if(e==null||typeof e!="string"&&e.constructor!==r.AST.ProgramNode)throw new n("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var i=r.parse(e),s=(new r.Compiler).compile(i,t);return(new r.JavaScriptCompiler).compile(s,t)}function s(e,t,r){function s(){var n=r.parse(e),i=(new r.Compiler).compile(n,t),s=(new r.JavaScriptCompiler).compile(i,t,undefined,!0);return r.template(s)}if(e==null||typeof e!="string"&&e.constructor!==r.AST.ProgramNode)throw new n("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var i;return function(e,t){return i||(i=s()),i.call(this,e,t)}}var t={},n=e;return t.Compiler=r,r.prototype={compiler:r,disassemble:function(){var e=this.opcodes,t,n=[],r,i;for(var s=0,o=e.length;s<o;s++){t=e[s];if(t.opcode==="DECLARE")n.push("DECLARE "+t.name+"="+t.value);else{r=[];for(var u=0;u<t.args.length;u++)i=t.args[u],typeof i=="string"&&(i='"'+i.replace("\n","\\n")+'"'),r.push(i);n.push(t.opcode+" "+r.join(" "))}}return n.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||r.args.length!==i.args.length)return!1;for(var s=0;s<r.args.length;s++)if(r.args[s]!==i.args[s])return!1}t=this.children.length;if(e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.accept(e)},accept:function(e){var t=e.strip||{},n;return t.left&&this.opcode("strip"),n=this[e.type](e),t.right&&this.opcode("strip"),n},program:function(e){var t=e.statements;for(var n=0,r=t.length;n<r;n++)this.accept(t[n]);return this.isSimple=r===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++,r;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var i=0,s=t.depths.list.length;i<s;i++){r=t.depths.list[i];if(r<2)continue;this.addDepth(r-1)}return n},block:function(e){var t=e.mustache,n=e.program,r=e.inverse;n&&(n=this.compileProgram(n)),r&&(r=this.compileProgram(r));var i=t.sexpr,s=this.classifySexpr(i);s==="helper"?this.helperSexpr(i,n,r):s==="simple"?(this.simpleSexpr(i),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousSexpr(i,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("pushHash");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.options.stringParams?(r.depth&&this.addDepth(r.depth),this.opcode("getContext",r.depth||0),this.opcode("pushStringParam",r.stringModeValue,r.type),r.type==="sexpr"&&this.sexpr(r)):this.accept(r),this.opcode("assignToHash",n[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){this.sexpr(e.sexpr),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(e,t,n){var r=e.id,i=r.parts[0],s=t!=null||n!=null;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",i,s)},simpleSexpr:function(e){var t=e.id;t.type==="DATA"?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,r){var i=this.setupFullMustacheParams(e,t,r),s=e.id.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",i.length,s);else{if(this.options.knownHelpersOnly)throw new n("You specified knownHelpersOnly, but used the unknown helper "+s,e);this.opcode("invokeHelper",i.length,s,e.isRoot)}},sexpr:function(e){var t=this.classifySexpr(e);t==="simple"?this.simpleSexpr(e):t==="helper"?this.helperSexpr(e):this.ambiguousSexpr(e)},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,r=e.parts.length;n<r;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){this.options.data=!0;if(e.id.isScoped||e.id.depth)throw new n("Scoped data references are not supported: "+e.original,e);this.opcode("lookupData");var t=e.id.parts;for(var r=0,i=t.length;r<i;r++)this.opcode("lookup",t[r])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},classifySexpr:function(e){var t=e.isHelper,n=e.eligibleHelper,r=this.options;if(n&&!t){var i=e.id.parts[0];r.knownHelpers[i]?t=!0:r.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type),n.type==="sexpr"&&this.sexpr(n)):this[n.type](n)},setupFullMustacheParams:function(e,t,n){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),r}},t.precompile=i,t.compile=s,t}(n),l=function(e,t){function u(e){this.value=e}function a(){}var n,r=e.COMPILER_REVISION,i=e.REVISION_CHANGES,s=e.log,o=t;a.prototype={nameLookup:function(e,t){var n,r;return e.indexOf("depth")===0&&(n=!0),/^[0-9]+$/.test(t)?r=e+"["+t+"]":a.isValidJavaScriptVariableName(t)?r=e+"."+t:r=e+"['"+t+"']",n?"("+e+" && "+r+")":r},compilerInfo:function(){var e=r,t=i[e];return"this.compilerInfo = ["+e+",'"+t+"'];\n"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},s("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var i=e.opcodes,u;this.i=0;for(var a=i.length;this.i<a;this.i++)u=i[this.i],u.opcode==="DECLARE"?this[u.name]=u.value:this[u.opcode].apply(this,u.args),u.opcode!==this.stripNext&&(this.stripNext=!1);this.pushSource("");if(this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new o("Compile completed with content left on stack");return this.createFunctionContext(r)},preamble:function(){var e=[];if(!this.isChild){var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild)for(var n in this.context.aliases)this.context.aliases.hasOwnProperty(n)&&(this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");var r=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,o=this.environment.depths.list.length;i<o;i++)r.push("depth"+this.environment.depths.list[i]);var u=this.mergeSource();this.isChild||(u=this.compilerInfo()+u);if(e)return r.push(u),Function.apply(this,r);var a="function "+(this.name||"")+"("+r.join(",")+") {\n  "+u+"}";return s("debug",a+"\n\n"),a},mergeSource:function(){var e="",t;for(var n=0,r=this.source.length;n<r;n++){var i=this.source[n];i.appendToBuffer?t?t=t+"\n    + "+i.content:t=i.content:(t&&(e+="buffer += "+t+";\n  ",t=undefined),e+=i+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.pushStackLiteral("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),t!=="sexpr"&&(typeof e=="string"?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.options.stringParams&&(this.push("{"+e.contexts.join(",")+"}"),this.push("{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){this.context.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var r=this.lastHelper=this.setupHelper(e,t,!0),i=this.nameLookup("depth"+this.lastContext,t,"context"),s="helper = "+r.name+" || "+i;r.paramsInit&&(s+=","+r.paramsInit),this.push("("+s+",helper "+"? helper.call("+r.callParams+") "+": helperMissing.call("+r.helperMissingParams+"))"),n||this.flushInline()},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.useRegister("helper"),this.emptyHash();var n=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),i=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();n.paramsInit&&this.pushSource(n.paramsInit),this.pushSource("if (helper = "+r+") { "+s+" = helper.call("+n.callParams+"); }"),this.pushSource("else { helper = "+i+"; "+s+" = typeof helper === functionType ? helper.call("+n.callParams+") : helper; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t=this.popStack(),n,r;this.options.stringParams&&(r=this.popStack(),n=this.popStack());var i=this.hash;n&&i.contexts.push("'"+e+"': "+n),r&&i.types.push("'"+e+"': "+r),i.values.push("'"+e+"': ("+t+")")},compiler:a,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler;var u=this.matchExistingProgram(r);u==null?(this.context.programs.push(""),u=this.context.programs.length,r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context),this.context.environments[u]=r):(r.index=u,r.name="program"+u)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return t}},programExpression:function(e){this.context.aliases.self="this";if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r,i=[t.index,t.name,"data"];for(var s=0,o=n.length;s<o;s++)r=n[s],r===1?i.push("depth0"):i.push("depth"+(r-1));return(n.length===0?"self.program(":"self.programWithDepth(")+i.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new u(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=undefined),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t="",n=this.isInline(),r,i,s;if(n){var o=this.popStack(!0);if(o instanceof u)r=o.value,s=!0;else{i=!this.stackSlot;var a=i?this.incrStack():this.topStackName();t="("+this.push(a)+" = "+o+"),",r=this.topStack()}}else r=this.topStack();var f=e.call(this,r);return n?(s||this.popStack(),i&&this.stackSlot--,this.push("("+t+f+")")):(/^stack/.test(r)||(r=this.nextStack()),this.pushSource(r+" = ("+t+f+");")),r},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];r instanceof u?this.compileStack.push(r):this.pushStack(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof u)return n.value;if(!t){if(!this.stackSlot)throw new o("Invalid stack pop");this.stackSlot--}return n},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof u?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var r=[],i=this.setupParams(e,r,n),s=this.nameLookup("helpers",t,"helper");return{params:r,paramsInit:i,name:s,callParams:["depth0"].concat(r).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(r).join(", ")}},setupOptions:function(e,t){var n=[],r=[],i=[],s,o,u;n.push("hash:"+this.popStack()),this.options.stringParams&&(n.push("hashTypes:"+this.popStack()),n.push("hashContexts:"+this.popStack())),o=this.popStack(),u=this.popStack();if(u||o)u||(this.context.aliases.self="this",u="self.noop"),o||(this.context.aliases.self="this",o="self.noop"),n.push("inverse:"+o),n.push("fn:"+u);for(var a=0;a<e;a++)s=this.popStack(),t.push(s),this.options.stringParams&&(i.push(this.popStack()),r.push(this.popStack()));return this.options.stringParams&&(n.push("contexts:["+r.join(",")+"]"),n.push("types:["+i.join(",")+"]")),this.options.data&&n.push("data:data"),n},setupParams:function(e,t,n){var r="{"+this.setupOptions(e,t).join(",")+"}";return n?(this.useRegister("options"),t.push("options"),"options="+r):(t.push(r),"")}};var f="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),l=a.RESERVED_WORDS={};for(var c=0,h=f.length;c<h;c++)l[f[c]]=!0;return a.isValidJavaScriptVariableName=function(e){return!a.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)?!0:!1},n=a,n}(r,n),c=function(e,t,n,r,i){var s,o=e,u=t,a=n.parser,f=n.parse,l=r.Compiler,c=r.compile,h=r.precompile,p=i,d=o.create,v=function(){var e=d();return e.compile=function(t,n){return c(t,n,e)},e.precompile=function(t,n){return h(t,n,e)},e.AST=u,e.Compiler=l,e.JavaScriptCompiler=p,e.Parser=a,e.parse=f,e};return o=v(),o.create=v,s=o,s}(s,o,a,f,l);return c}();define("handlebars",function(e){return function(){var t,n;return t||e.Handlebars}}(this)),define("templates",["handlebars"],function(e){return this.JST=this.JST||{},this.JST["templates/layout.hbs"]=e.template(function(e,t,n,r,i){function c(e,t){var r="",i;r+=" ",i=n["if"].call(e,e&&e.view,{hash:{},inverse:l.noop,fn:l.program(2,h,t),data:t});if(i||i===0)r+=i;return r}function h(e,t){var r="",i,s;return r+='\r\n		<li class="menu-item ',(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+" ",(s=n["class"])?i=s.call(e,{hash:{},data:t}):(s=e&&e["class"],i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'" plugin="',(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'">\r\n			<img src="',(s=n.static_path)?i=s.call(e,{hash:{},data:t}):(s=e&&e.static_path,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+"gfx/icons/",(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'.svg" />\r\n			<span>',(s=n.title)?i=s.call(e,{hash:{},data:t}):(s=e&&e.title,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+"</span>\r\n		</li>",r}function p(e,t){var r;return r=n["if"].call(e,e&&e.view,{hash:{},inverse:l.noop,fn:l.program(5,d,t),data:t}),r||r===0?r:""}function d(e,t){var r="",i,s;return r+='\r\n		<img class="tool ',(s=n["class"])?i=s.call(e,{hash:{},data:t}):(s=e&&e["class"],i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'" src="',(s=n.static_path)?i=s.call(e,{hash:{},data:t}):(s=e&&e.static_path,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+"gfx/icons/",(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'.svg" plugin="',(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'" />\r\n		',r}function v(e,t){var r="",i,s;r+='<div class="plugin-content" plugin="',(s=n.name)?i=s.call(e,{hash:{},data:t}):(s=e&&e.name,i=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(i)+'">',(s=n.view)?i=s.call(e,{hash:{},data:t}):(s=e&&e.view,i=typeof s===a?s.call(e,{hash:{},data:t}):s);if(i||i===0)r+=i;return r+="</div>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<!--- top logo -->\r\n<p class="logo">\r\n	<span class="apostrophe">&rsquo;</span><span class="after">after</span><span class="writing">writing</span>\r\n</p>\r\n<!--- main menu -->\r\n<div class="menu" style="display:none">\r\n	<ul class="selector">\r\n		',o=n.each.call(t,t&&t.plugins,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+='</ul>\r\n</div>\r\n<div class="footer"></div>\r\n<!--- plugin content -->\r\n<div class="content" style="display:none">\r\n	<div class="top-bar">\r\n		',o=n.each.call(t,t&&t.plugins,{hash:{},inverse:l.noop,fn:l.program(4,p,i),data:i});if(o||o===0)s+=o;s+='\r\n		<img class="close-content" src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/close.svg" />\r\n	</div>\r\n	<div class="plugin-contents">\r\n		',o=n.each.call(t,t&&t.plugins,{hash:{},inverse:l.noop,fn:l.program(7,v,i),data:i});if(o||o===0)s+=o;return s+='</div>\r\n</div>\r\n<div id="tooltip"></div>',s}),this.JST["templates/plugins/dev/fquerysandbox.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"..."}),this.JST["templates/plugins/dev/test.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"<h1>Performance test</h1>\r\n<p>Parse\r\n	<input id=\"test-parse-times\" type=\"input\" value=\"10\"/>times:\r\n	<button id=\"test-parse-perform\">perform</button>\r\n</p>\r\n<ul id=\"test-parse-results\"></ul>\r\n<script>\r\n	require(['plugins/dev/test', 'jquery'], function(test, $) {\r\n\r\n			$('#test-parse-perform').click(function() {\r\n				var result = test.parse_times(parseInt($('#test-parse-times').val()));\r\n				$('#test-parse-results').empty();\r\n				result.forEach(function(r) {\r\n					$('#test-parse-results').append('<li>' + r.action + ': ' + r.avg);\r\n				});\r\n			});\r\n\r\n		});\r\n</script>"}),this.JST["templates/plugins/editor.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<h1>Editor\r\n	<span class="info-icon" section="editor-info" />\r\n</h1>\r\n<p class="info-content" section="editor-info">Just a basic editor. Use Ctrl-Space for a simple autocompletion.</p>\r\n<textarea id="editor-textarea" placeholder="Code goes here..." class="to-the-bottom"></textarea>\r\n<!-- scripts -->\r\n<script>\r\n	require([\'jquery\', \'plugins/editor\', \'utils/layout\'], function($, editor, layout) {\r\n		var cm = editor.create_editor($(\'#editor-textarea\').get(0));\r\n\r\n		var editor_content = $(\'.plugin-content[plugin="editor"]\');\r\n\r\n		var resize = function() {\r\n\r\n			if (layout.small) {\r\n				editor.set_size("auto", editor_content.height() - 70);\r\n			} else {\r\n				editor.set_size("700px", editor_content.height() - 100);\r\n			}\r\n		};\r\n		\r\n		resize();\r\n		$(window).resize(resize);\r\n	});\r\n</script>'}),this.JST["templates/plugins/facts.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"<style>\r\n	.plugin-content[plugin=\"facts\"] li span {\r\n		font-weight: bold;\r\n	}\r\n	\r\n</style>\r\n<h1>Facts</h1>\r\n<ul>\r\n	<li>Title:\r\n		<span id=\"facts-title\"></span>\r\n	</li>\r\n	<li>Pages:\r\n		<span id=\"facts-pages\"></span>\r\n	</li>\r\n	<li>Time:\r\n		<span id=\"facts-time\"></span>\r\n	</li>\r\n	<li>Scenes:\r\n		<span id=\"facts-scenes\"></span>\r\n	</li>\r\n	<li>Action time:\r\n		<span id=\"facts-action-time\"></span>\r\n	</li>\r\n	<li>Dialogue time:\r\n		<span id=\"facts-dialogue-time\"></span>\r\n	</li>\r\n</ul>\r\n<h2>Time of speaking</h2>\r\n<span class=\"content-expander expand-dialogue show-all-dialogues\" style=\"margin-left: 20px\">Top 10 characters shown. Click here to show all&nbsp;\r\n	<span class=\"nof-dialogues\"></span>.</span>\r\n<span class=\"content-expander expand-dialogue show-top-dialogues\" style=\"display:none; margin-left: 20px\">All&nbsp;\r\n	<span class=\"nof-dialogues\"></span>&nbsp;characters shown. Click here to show Top 10 only.</span>\r\n<ol id=\"facts-characters\"></ol>\r\n<h2>Locations</h2>\r\n<span class=\"content-expander expand-locations show-all-locations\" style=\"margin-left: 20px\">Top 10 locations shown. Click here to show all&nbsp;\r\n	<span class=\"nof-locations\"></span>.</span>\r\n<span class=\"content-expander expand-locations show-top-locations\" style=\"display:none; margin-left: 20px\">All\r\n	<span class=\"nof-locations\"></span>locations shown. Click here to show Top 10 only.</span>\r\n<ol id=\"facts-locations\"></ol>\r\n<!-- scripts -->\r\n<script>\r\n	require(['jquery', 'plugins/facts', 'utils/helper'], function($, facts, helper) {\r\n		facts.activate.add(function() {\r\n			var facts_data = facts.data.facts;\r\n			$('#facts-title').html(facts_data.title.replace(/\\*/g, '').replace(/_/g, '').replace(/\\n/g, ' / '));\r\n			$('#facts-pages').html(facts_data.pages.toFixed(2));\r\n			$('#facts-time').html(helper.format_time(facts_data.pages));\r\n			$('#facts-scenes').html(facts_data.scenes);\r\n			$('#facts-action-time').html(helper.format_time(facts_data.action_time));\r\n			$('#facts-dialogue-time').html(helper.format_time(facts_data.dialogue_time));\r\n\r\n			$('#facts-characters').empty();\r\n			for (var i = 0; i < facts_data.characters.length; i++) {\r\n				$('#facts-characters').append('<li class=\"' + (i >= 10 ? 'expandable' : '') + '\">' + facts_data.characters[i].name + ' (' + helper.format_time(facts_data.characters[i].time) + ')</li>');\r\n			}\r\n\r\n			$('#facts-locations').empty();\r\n			for (var i = 0; i < facts_data.locations.length; i++) {\r\n				$('#facts-locations').append('<li class=\"' + (i >= 10 ? 'expandable' : '') + '\">' + facts_data.locations[i].name + ' (' + facts_data.locations[i].count + ')</li>');\r\n			}\r\n			$('.nof-dialogues').html(facts_data.characters.length);\r\n			$('.nof-locations').html(facts_data.locations.length);\r\n\r\n\r\n			if (facts_data.characters.length > 10) {\r\n				$('.show-all-dialogues').show();\r\n				$('.show-top-dialogues').hide();\r\n				$('#facts-characters li.expandable').hide();\r\n				$('.expand-dialogue').click(function() {\r\n					if ($(this).hasClass('show-all-dialogues')) {\r\n						$('.show-all-dialogues').hide();\r\n						$('.show-top-dialogues').show();\r\n					} else {\r\n						$('.show-all-dialogues').show();\r\n						$('.show-top-dialogues').hide();\r\n					}\r\n					$('#facts-characters li.expandable').slideToggle({\r\n						duration: 200\r\n					});\r\n				});\r\n			} else {\r\n				$('.expand-dialogue').hide();\r\n			}\r\n\r\n			if (facts_data.locations.length > 10) {\r\n				$('.show-all-locations').show();\r\n				$('.show-top-locations').hide();\r\n				$('#facts-locations li.expandable').hide();\r\n				$('.expand-locations').click(function() {\r\n					if ($(this).hasClass('show-all-locations')) {\r\n						$('.show-all-locations').hide();\r\n						$('.show-top-locations').show();\r\n					} else {\r\n						$('.show-all-locations').show();\r\n						$('.show-top-locations').hide();\r\n					}\r\n					$('#facts-locations li.expandable').slideToggle({\r\n						duration: 200\r\n					});\r\n				});\r\n			} else {\r\n				$('.expand-locations').hide();\r\n			}\r\n\r\n		});\r\n\r\n	});\r\n</script>"}),this.JST["templates/plugins/info.hbs"]=e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression;return s+='<h1>About</h1>\r\n<p>\r\n	<em>\'afterwritings labs</em>&nbsp;is a place where you can play around with some tools for screenplays. You can use screenplays written in <a href="http://fountain.io/" target="_blank"><strong>Fountain format</strong></a> or <a href="http://www.finaldraft.com/" target="_blank"><strong>Final Draft</strong></a> (itl will be converted to fountain). You can aske use one of the\r\n	<a class="switch" href="#" plugin="open">samples</a>.</p>\r\n<p>You can use it offline as well (sorry, no Dropbox support for offline version). Just download this\r\n	<a href="afterwriting.zip">file</a>, unzip and double click on index.html.</p>\r\n<p>\r\n	<em>Warning: this product may contain nuts and bugs!</em>\r\n</p>\r\n<h1>What\'s inside?</h1>\r\n<p>Available plugins:</p>\r\n<ul>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/open.svg" />&nbsp;/&nbsp;\r\n		<img src="gfx/icons/save.svg" />&nbsp;\r\n		<em>Open / Save</em>&nbsp;- open a .fountain file from disk, Dropbox or use a sample, save as .fountain or as PDF.</li>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/settings.svg" />\r\n		<em>Settings</em>&nbsp;- change paper size, print layout, etc.</li>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/editor.svg" />\r\n		<em>Editor</em>&nbsp;- a basic editor for\r\n		<a href="http://fountain.io/" target="_blank">.fountain files</a>\r\n	</li>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/preview.svg" />\r\n		<em>Preview</em>&nbsp;- PDF preview (a browser plugin required)</li>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/facts.svg" />\r\n		<em>Facts</em>&nbsp;- facts about your screenplay (number of pages, scenes, characters, etc.)</li>\r\n	<li>\r\n		<img src="',(u=n.static_path)?o=u.call(t,{hash:{},data:i}):(u=t&&t.static_path,o=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(o)+'gfx/icons/stats.svg" />\r\n		<em>Useless Stats</em>&nbsp;- some statistics, don\'t take them too seriously!</li>\r\n</ul>\r\n<h1>What\'s next?</h1>\r\n<p>More useful/useless tools to come. Stay tuned and follow\r\n	<a href="http://blog.afterwriting.com" target="_blank">afterwriting blog</a>&nbsp;and\r\n	<a href="http://twitter.com/afterwriting" target="_blank">@afterwriting</a>!</p>\r\n<h1>Contact</h1>\r\n<p>E-mail:\r\n	<a href="mailto:contact@afterwriting.com">contact@afterwriting.com</a>.</p>\r\n<h1>Thanks</h1>\r\n<p>\r\n	<ul>\r\n		<li>Icons from\r\n			<a href="http://www.freepik.com" alt="Freepik.com" title="Freepik.com" target="_blank">Freepik</a>&nbsp;(Daniel Bruce, Icomoon, Yannick, Appzgear)</li>\r\n		<li>Sample scripts:\r\n			<ul>\r\n				<li>\r\n					<em>Brick & Steel</em>&nbsp;by\r\n					<a href="http://prolost.com/about/" target="_blank">Stu Maschwitz</a>\r\n				</li>\r\n				<li>\r\n					<em>My Living Memory</em>&nbsp;&amp;&nbsp;<em>Priting Trouble</em>&nbsp;by\r\n					<a href="http://www.webring.org/l/rd?ring=indepfilm;id=59;url=http%3A%2F%2Fwww%2Ecvisual%2Ecom%2F" target="_blank">Dan Rahmel</a>\r\n				</li>				\r\n			</ul>\r\n		</li>\r\n		<li>DayRoman font by\r\n			<a href="http://apostrophiclab.pedroreina.net/" target="_blank">Apostrophic Laboratories</a>\r\n		</li>\r\n		<li>JS libs:\r\n			<ul>\r\n				<li>\r\n					<a href="https://github.com/mattdaly/Fountain.js" target="_blank">Fountain.js</a>\r\n				</li>\r\n				<li>\r\n					<a href="https://github.com/eligrey/FileSaver.js" target="_blank">FileSaver.js</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://github.com/jonnyreeves/js-logger" target="_blank">js-logger</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://parall.ax/products/jspdf" target="_blank">jsPDF</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://codemirror.net/" target="_blank">CodeMirror</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://jquery.com/" target="_blank">jQuery</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://d3js.org/" target="_blank">d3.js</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://handlebarsjs.com/" target="_blank">Handlebars</a>\r\n				</li>\r\n				<li>\r\n					<a href="https://github.com/jrburke/almond" target="_blank">Almond</a>\r\n				</li>\r\n				<li>\r\n					<a href="http://requirejs.org/" target="_blank">RequireJS</a>\r\n				</li>\r\n			</ul>\r\n		</li>\r\n	</ul>\r\n</p>',s}),this.JST["templates/plugins/open.hbs"]=e.template(function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\r\n<h1>Last opened</h1>\r\n<ul>\r\n	<li>\r\n		<a href="#" open-action="last">'+a((r=(r=e&&e.last_used,r==null||r===!1?r:r.title),typeof r===u?r.apply(e):r))+"</a>&nbsp;("+a((r=(r=e&&e.last_used,r==null||r===!1?r:r.date),typeof r===u?r.apply(e):r))+")</li>\r\n</ul>",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<h1>Open (Fountain or FinalDraft .fdx)</h1>\r\n<ul>\r\n	<li>\r\n		<a href="#" open-action="open">Load from disk</a>\r\n	</li>\r\n	<li>\r\n		<a href="#" open-action="dropbox">Open from Dropbox</a>\r\n	</li>\r\n	<li>\r\n		<a href="#" open-action="new">...or create new</a>\r\n	</li>\r\n</ul>',o=n["if"].call(t,(o=t&&t.last_used,o==null||o===!1?o:o.date),{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\r\n<h1>Samples</h1>\r\n<ul>\r\n	<li>\r\n		<a href="#" open-action="sample" value="brick_and_steel">\r\n			<i>Brick & Steel</i>\r\n		</a>&nbsp;by Stu Maschwitz</li>\r\n	<li>\r\n		<a href="#" open-action="sample" value="my_living_memory">\r\n			<i>My Living Memory</i>\r\n		</a>&nbsp;by Dan Rahmel</li>\r\n	<li>\r\n		<a href="#" open-action="sample" value="printing_trouble">\r\n			<i>Printing Trouble</i>\r\n		</a>&nbsp;by Dan Rahmel</li>\r\n</ul>\r\n<div id="open-file-wrapper"></div>\r\n<!-- interactions -->\r\n<script>\r\n	require([\'jquery\', \'plugins/open\'], function($, open) {\r\n		var reset_file_input = function() {\r\n			$(\'#open-file-wrapper\').empty();\r\n			$(\'#open-file-wrapper\').html(\'<input id="open-file" type="file" style="display:none" />\');\r\n			$("#open-file").change(function() {\r\n				var selected_file = $(\'#open-file\').get(0).files[0];\r\n				open.open_file(selected_file);\r\n				reset_file_input();\r\n			});\r\n		}\r\n\r\n		$(\'a[open-action="open"]\').click(function() {\r\n			open.open_file_dialog()\r\n		});\r\n\r\n		$(\'a[open-action="new"]\').click(open.create_new);\r\n		$(\'a[open-action="sample"]\').click(function() {\r\n			var name = $(this).attr(\'value\');\r\n			open.open_sample(name);\r\n		});\r\n		$(\'a[open-action="last"]\').click(open.open_last_used);\r\n\r\n		if (open.is_dropbox_available()) {\r\n			$(\'a[open-action="dropbox"]\').click(open.open_from_dropbox);\r\n		} else {\r\n			$(\'a[open-action="dropbox"]\').parent().hide();\r\n		}\r\n\r\n		open.open_file_dialog.add(function() {\r\n			$("#open-file").click();\r\n		});\r\n		\r\n		reset_file_input();\r\n\r\n	});\r\n</script>',s}),this.JST["templates/plugins/preview.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<h1>Preview <span class="info-icon" section="preview-info"/></h1>\r\n<p class="info-content" section="preview-info">Can\'t see anything? You need a PDF plugin in your browser.</p>\r\n<div id="pdf-preview-iframe-container"></div>\r\n<!-- scripts -->\r\n<script>\r\n	require([\'jquery\', \'plugins/preview\'], function($, preview) {\r\n		preview.activate.add(function() {\r\n			$(\'#pdf-preview-iframe-container\').html(\'<iframe id="pdf-preview-iframe" class="to-the-bottom" style="width: 100%"></iframe>\');\r\n			$("#pdf-preview-iframe").attr(\'src\', preview.data.pdf.output("datauristring"));\r\n		});\r\n		preview.deactivate.add(function() {\r\n			$("#pdf-preview-iframe").remove();\r\n		});\r\n	});\r\n</script>'}),this.JST["templates/plugins/save.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<h1>Save</h1>\r\n<ul>\r\n	<li>filename:\r\n		<input id="save-filename" />.*</li>\r\n	<li>as .fountain:\r\n		<a href="#" action="save-fountain">download</a>\r\n		<span>&nbsp;|&nbsp;\r\n			<a href="#" action="save-dropbox-fountain">send to Dropbox</a>\r\n		</span>\r\n	</li>\r\n	<li>as .pdf:\r\n		<a href="#" action="save-pdf">download</a>\r\n		<span>&nbsp;|&nbsp;\r\n			<a href="#" action="save-dropbox-pdf">send to Dropbox</a>\r\n		</span>\r\n	</li>\r\n</ul>\r\n<!--- script -->\r\n<script>\r\n	require([\'jquery\', \'plugins/save\'], function($, save) {\r\n		$(document).ready(function() {\r\n			$(\'a[action="save-fountain"]\').click(save.save_as_fountain);\r\n			$(\'a[action="save-dropbox-fountain"]\').click(save.dropbox_fountain);\r\n\r\n			$(\'a[action="save-pdf"]\').click(save.save_as_pdf);\r\n			$(\'a[action="save-dropbox-pdf"]\').click(save.dropbox_pdf);\r\n\r\n			$(\'#save-filename\').keyup(function() {\r\n				save.data.filename = $(this).val();\r\n			});\r\n\r\n			if (!save.is_dropbox_available()) {\r\n				$(\'a[action="save-dropbox-pdf"], a[action="save-dropbox-fountain"]\').parent().hide();\r\n			}\r\n\r\n			save.activate.add(function() {\r\n				$(\'#save-filename\').val(save.data.filename);\r\n			});\r\n		});\r\n	});\r\n</script>'}),this.JST["templates/plugins/settings.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<style>\r\n	.plugin-content[plugin="settings"] .buttons {\r\n		float: right;\r\n	}\r\n	.plugin-content[plugin="settings"] .buttons p {\r\n		margin: 0;\r\n	}\r\n	.plugin-content[plugin="settings"] table {\r\n		margin: auto;\r\n		width: 100%;\r\n	}\r\n	.plugin-content[plugin="settings"] tr td:nth-child(1) {\r\n		text-align: right;\r\n		border-right: 0;\r\n	}\r\n	.plugin-content[plugin="settings"] tr td:nth-child(2) {\r\n		text-align: left;\r\n		width: 50%;\r\n		border-left-width: 0;\r\n	}\r\n	.settings-panel {\r\n		width: 90%;\r\n		margin: auto;\r\n	}\r\n	\r\n</style>\r\n<h1>Settings\r\n	<span class="info-icon" section="settings-info" />\r\n</h1>\r\n<p class="info-content" section="settings-info">You can change configuration here. Some settings (e.g. page size, double space between scenes) may affect statistics which are based on assumption that 1 page = 1 minute of a movie .</p>\r\n<div class="settings-panel">\r\n	<p class="buttons">\r\n		<a href="#" class="settings-save inactive button">save settings</a>\r\n		<a href="#" class="settings-reset button">reset settings</a>\r\n	</p>\r\n	<table>\r\n		<tbody>\r\n			<tr>\r\n				<th colspan="2">Print</th>\r\n			</tr>\r\n			<tr>\r\n				<td>Page size:</td>\r\n				<td>\r\n					<select setting="print_profile">\r\n						<option value="a4">A4</option>\r\n						<option value="usletter">US letter</option>\r\n					</select>\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Print title page:</td>\r\n				<td>\r\n					<input setting="print_title_page" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Print sections:</td>\r\n				<td>\r\n					<input setting="print_sections" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Print synopsis:</td>\r\n				<td>\r\n					<input setting="print_synopsis" type="checkbox">\r\n				</td>\r\n			</tr>			\r\n			<tr>\r\n				<th colspan="2">Layout</th>\r\n			</tr>\r\n			<tr>\r\n				<td>Split dialogue between pages:</td>\r\n				<td>\r\n					<input setting="split_dialogue" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Accept dual dialogue:</td>\r\n				<td>\r\n					<input setting="use_dual_dialogue" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Double space between scenes:</td>\r\n				<td>\r\n					<input setting="double_space_between_scenes" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Prefix sections with numbers:</td>\r\n				<td>\r\n					<input setting="number_sections" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Embolden scene headers:</td>\r\n				<td>\r\n					<input setting="embolden_scene_headers" type="checkbox">\r\n				</td>\r\n			</tr>			\r\n			<tr>\r\n				<th colspan="2">Miscellaneous</th>\r\n			</tr>\r\n			<tr>\r\n				<td>Show background image:</td>\r\n				<td>\r\n					<input setting="show_background_image" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Load last opened on startup:</td>\r\n				<td>\r\n					<input setting="load_last_opened" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<th colspan="2">Statistics</th>\r\n			</tr>\r\n			<tr>\r\n				<td>Keep last scene slugline time (DAY,NIGHT):</td>\r\n				<td>\r\n					<input setting="stats_keep_last_scene_time" type="checkbox">\r\n				</td>\r\n			</tr>\r\n			<tr>\r\n				<td>Who with who max characters:</td>\r\n				<td>\r\n					<input setting="stats_who_with_who_max" type="input" style="width: 50px">\r\n				</td>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n	<p class="buttons">\r\n		<a href="#" class="settings-save inactive button">save settings</a>\r\n		<a href="#" class="settings-reset button">reset settings</a>\r\n	</p>\r\n</div>\r\n<script>\r\n	require([\'plugins/settings\'], function(settings) {\r\n\r\n		var data_to_components = function() {\r\n			var c = settings.get_config();\r\n			$(\'*[setting="show_background_image"]\').prop(\'checked\', c.show_background_image);\r\n			$(\'*[setting="print_title_page"]\').prop(\'checked\', c.print_title_page);\r\n			$(\'*[setting="embolden_scene_headers"]\').prop(\'checked\', c.embolden_scene_headers);\r\n			$(\'*[setting="load_last_opened"]\').prop(\'checked\', c.load_last_opened);\r\n			$(\'*[setting="double_space_between_scenes"]\').prop(\'checked\', c.double_space_between_scenes);\r\n			$(\'*[setting="split_dialogue"]\').prop(\'checked\', c.split_dialogue);\r\n			$(\'*[setting="print_sections"]\').prop(\'checked\', c.print_sections);\r\n			$(\'*[setting="print_synopsis"]\').prop(\'checked\', c.print_synopsis);\r\n			$(\'*[setting="number_sections"]\').prop(\'checked\', c.number_sections);\r\n			$(\'*[setting="use_dual_dialogue"]\').prop(\'checked\', c.use_dual_dialogue);\r\n			$(\'*[setting="stats_keep_last_scene_time"]\').prop(\'checked\', c.stats_keep_last_scene_time);\r\n			$(\'*[setting="print_profile"]\').val(c.print_profile);\r\n			$(\'*[setting="stats_who_with_who_max"]\').val(c.stats_who_with_who_max);\r\n		};\r\n\r\n		var components_to_data = function() {\r\n			var c = settings.get_config();\r\n			c.show_background_image = $(\'*[setting="show_background_image"]\').is(\':checked\');\r\n			c.print_title_page = $(\'*[setting="print_title_page"]\').is(\':checked\');\r\n			c.embolden_scene_headers = $(\'*[setting="embolden_scene_headers"]\').is(\':checked\');\r\n			c.load_last_opened = $(\'*[setting="load_last_opened"]\').is(\':checked\');\r\n			c.double_space_between_scenes = $(\'*[setting="double_space_between_scenes"]\').is(\':checked\');\r\n			c.split_dialogue = $(\'*[setting="split_dialogue"]\').is(\':checked\');\r\n			c.print_sections = $(\'*[setting="print_sections"]\').is(\':checked\');\r\n			c.print_synopsis = $(\'*[setting="print_synopsis"]\').is(\':checked\');\r\n			c.number_sections = $(\'*[setting="number_sections"]\').is(\':checked\');\r\n			c.use_dual_dialogue = $(\'*[setting="use_dual_dialogue"]\').is(\':checked\');\r\n			c.stats_keep_last_scene_time = $(\'*[setting="stats_keep_last_scene_time"]\').is(\':checked\');\r\n			c.stats_who_with_who_max = parseInt($(\'*[setting="stats_who_with_who_max"]\').val());\r\n			c.print_profile = $(\'*[setting="print_profile"]\').val();\r\n			settings.save();\r\n		};\r\n\r\n		$(\'.plugin-content[plugin="settings"]\').select(\'input, option\').on(\'change keyup\', function() {\r\n			$(\'.settings-save\').removeClass(\'inactive\');\r\n		});\r\n\r\n		$(\'.settings-reset\').click(function() {\r\n			if ($(this).hasClass(\'inactive\')) {\r\n				return;\r\n			}\r\n			settings.reset();\r\n			data_to_components();\r\n			$(\'.settings-save\').addClass(\'inactive\');\r\n		});\r\n\r\n		$(\'.settings-save\').click(function() {\r\n			if ($(this).hasClass(\'inactive\')) {\r\n				return;\r\n			}\r\n			components_to_data();\r\n			$(\'.settings-save\').addClass(\'inactive\');\r\n		});\r\n\r\n		settings.activate.add(function() {\r\n			data_to_components();\r\n		});\r\n\r\n	});\r\n</script>'}),this.JST["templates/plugins/stats.hbs"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"<style>\r\n	.plugin-content[plugin=\"stats\"] svg {\r\n		margin: 20px 0 20px 0;\r\n	}\r\n	\r\n</style>\r\n<h1>\"Useless\" Stats</h1>\r\n<p>Some \"useless\" statistics about your screenplay. Do you have an idea for a chart? Let me know at\r\n	<a href=\"mailto:contact@afterwriting.com?Subject=Stats%20idea\">contact@afterwriting.com</a>!</p>\r\n\r\n<h2 style=\"margin-top: 30px; margin-left: 0\">Who talks with who (by number of scenes)\r\n	<div class=\"info-icon\" section=\"stats-who\" />\r\n</h2>\r\n<p class=\"info-content\" section=\"stats-who\">Each character is represented by a circle (max. 10 characters). If characters are connected with a line that means they are talking in the same scene. Thicker the line - more scenes together. Hover the mouse cursor over a character circle to see how many dialogues scenes that character have with other characters.</p>\r\n<div id=\"who-with-who\" style=\"text-align: center\"></div>\r\n\r\n<h2 style=\"margin-top: 30px; margin-left: 0\">Script pulse\r\n	<div class=\"info-icon\" section=\"stats-tempo\" />\r\n</h2>\r\n<p class=\"info-content\" section=\"stats-tempo\">Short scenes and short action/dialogue blocks bump the tempo up. Long scenes and long blocks set it back.</p>\r\n<div id=\"stats-tempo\"></div>\r\n\r\n<h2 style=\"margin-top: 30px; margin-left: 0\">Scene length\r\n	<div class=\"info-icon\" section=\"stats-scene-length\" />\r\n</h2>\r\n<p class=\"info-content\" section=\"stats-scene-length\">Each bar represent one scene (white bars for day scenes, black bars for night scenes). Hover the mouse cursor over a bar to see estimated time of a scene. You can click on a bar to jump to selected scene in the editor.</p>\r\n<div id=\"stats-scene-length\" width=\"100%\"></div>\r\n\r\n<h2 style=\"margin-top: 30px; margin-left: 0\">Page balance\r\n	<div class=\"info-icon\" section=\"stats-page-balance\" />\r\n</h2>\r\n<p class=\"info-content\" section=\"stats-page-balance\">Shows balance between action time and dialogue time on each page. Click on a page to jump to the editor.</p>\r\n<div id=\"stats-page-balance\"></div>\r\n<h2 style=\"margin-top: 30px; margin-left: 0\">Days and nights\r\n	<div class=\"info-icon\" section=\"stats-days-nights\" />\r\n</h2>\r\n<p class=\"info-content\" section=\"stats-days-nights\">Pie chart representing day vs night scenes breakdown. Hover over sections to see number of day/night scenes.</p>\r\n<div id=\"stats-days-and-nights\" style=\"text-align: center\"></div>\r\n<!--- scripts -->\r\n<script>\r\n	require(['jquery', 'd3', 'plugins/stats', 'utils/layout', 'utils/helper', 'modules/charts',\r\n	], function($, d3, stats, layout, helper, charts) {\r\n\r\n		stats.activate.add(function() {\r\n			charts.spider_chart.render('#who-with-who', stats.data.who_with_who.characters, stats.data.who_with_who.links, {\r\n				label: 'name'\r\n			});\r\n\r\n			charts.bar_chart.render('#stats-scene-length', stats.data.scenes, {\r\n				tooltip: function(d) {\r\n					return d.header + ' (time: ' + helper.format_time(helper.lines_to_minutes(d.length)) + ')'\r\n				},\r\n				value: 'length',\r\n				color: function(d) {\r\n					if (d.type == 'day') {\r\n						return '#ffffff';\r\n					} else if (d.type == 'night') {\r\n						return '#222222';\r\n					} else {\r\n						return '#777777';\r\n					}\r\n				},\r\n				bar_click: function(d) {\r\n					if (!layout.small) {\r\n						stats.goto(d.token.line);\r\n					}\r\n				}\r\n			});\r\n\r\n			charts.pie_chart.render('#stats-days-and-nights', stats.data.days_and_nights, {\r\n				tooltip: function(d) {\r\n					return d.data.label + ': ' + d.data.value + (d.data.value == 1 ? ' scene' : ' scenes')\r\n				},\r\n				value: 'value',\r\n				color: function(d) {\r\n					if (d.data.label == 'DAY') {\r\n						return '#ffffff';\r\n					} else if (d.data.label == 'NIGHT') {\r\n						return '#222222';\r\n					} else if (d.data.label == 'DAWN') {\r\n						return '#777777';\r\n					} else if (d.data.label == 'DUSK') {\r\n						return '#444444';\r\n					} else {\r\n						return '#aaaaaa';\r\n					}\r\n				}\r\n			});\r\n\r\n			charts.page_balance_chart.render('#stats-page-balance', stats.data.page_balance, {\r\n				page_click: function(d) {\r\n					if (!layout.small) {\r\n						stats.goto(d.first_line.token.line);\r\n					}\r\n				}\r\n			});\r\n\r\n			charts.line_chart.render('#stats-tempo', stats.data.tempo, {\r\n				value: 'tempo',\r\n				tooltip: function(d, i) {\r\n					if (i === stats.data.tempo.length - 1) {\r\n						return '';\r\n					}\r\n					return d.scene + '<br />...' + d.line + '... ';\r\n				},\r\n				click: function(d) {\r\n					if (!layout.small) {\r\n						stats.goto(d.line_no);\r\n					}\r\n				}\r\n			});\r\n\r\n		});\r\n	});\r\n</script>"}),this.JST["templates/samples/big_fish.fountain"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Title: Big Fish\nCredit: written by\nAuthor: John August\nSource: based on the novel by Daniel Wallace\nNotes:	\n	FINAL PRODUCTION DRAFT\n	includes post-production dialogue \n	and omitted scenes\nCopyright: (c) 2003 Columbia Pictures\n\nThis is a Southern story, full of lies and fabrications, but truer for their inclusion.\n\n====\n\n**FADE IN:**\n\nA RIVER.\n\nWe're underwater, watching a fat catfish swim along.  \n\nThis is The Beast.\n\nEDWARD (V.O.)\nThere are some fish that cannot be caught.  It's not that they're faster or stronger than other fish.  They're just touched by something extra.  Call it luck.  Call it grace.  One such fish was The Beast.  \n\nThe Beast's journey takes it past a dangling fish hook, baited with worms.  Past a tempting lure, sparkling in the sun.  Past a swiping bear claw.  The Beast isn't worried.\n\nEDWARD (V.O.)(CONT'D)\nBy the time I was born, he was already a legend.  He'd taken more hundred-dollar lures than any fish in Alabama. Some said that fish was the ghost of Henry Walls, a thief who'd drowned in that river 60 years before.   Others claimed he was a lesser dinosaur, left over from the Cretaceous period.\n\nINT.  WILL'S BEDROOM - NIGHT (1973)\n\nWILL BLOOM, AGE 3, listens wide-eyed as his father EDWARD BLOOM, 40's and handsome, tells the story.  In every gesture, Edward is bigger than life, describing each detail with absolute conviction.\n\nEDWARD\nI didn't put any stock into such speculation or superstition.  All I knew was I'd been trying to catch that fish since I was a boy no bigger than you.  \n(closer)\nAnd on the day you were born, that was the day I finally caught him.\n\nEXT.  CAMPFIRE - NIGHT (1977)\n\nA few years later, and Will sits with the other INDIAN GUIDES as Edward continues telling the story to the tribe.  \n\nEDWARD\nNow, I'd tried everything on it:  worms, lures, peanut butter, peanut butter-and-cheese.  But on that day I had a revelation:  if that fish was the ghost of a thief, the usual bait wasn't going to work.  I would have to use something he truly desired. \n\nEdward points to his wedding band, glinting in the firelight.\n\nLITTLE BRAVE\n(confused)\nYour finger?\n\nEdward slips his ring off.\n\nEDWARD\nGold.\n\nWhile the other boys are rapt with attention, Will looks bored.  He's heard this story before.\n\nEDWARD\nI tied my ring to the strongest line they made -- strong enough to hold up a bridge, they said, if just for a few minutes -- and I cast upriver.\n\nINT.  BLOOM FRONT HALL - NIGHT (1987)\n\nEdward is chatting up Will's pretty DATE to the homecoming dance.  She is enjoying the story, but also the force of Edward's charisma.  He's hypnotizing.\n\nEDWARD (CONT'D)\nThe Beast jumped up and grabbed it before the ring even hit the water.  And just as fast, he snapped clean through that line.\n\nWILL, now 17 with braces, is fuming and ready to leave.  His mother SANDRA -- from whom he gets his good looks and practicality -- stands with him at the door.\n\nEDWARD\nYou can see my predicament.  My wedding ring, the symbol of fidelity to my wife, soon to be the mother of my child, was now lost in the gut of an uncatchable fish.\n\nON WILL AND SANDRA\n\nWILL\n(low but insistent)\nMake him stop.\n\nHis mother pats him sympathetically, then adjusts his tie.\n\nWILL'S DATE\nWhat did you do?\n\nEDWARD\nI followed that fish up-river and down-river for three days and three nights, until I finally had him boxed in.\n\nWill regards his father with exasperated contempt.\n\nEDWARD\nWith these two hands, I reached in and snatched that fish out of the river.  I looked him straight in the eye.  And I made a remarkable discovery. \n\nINT.  TINY PARIS RESTAURANT (LA RUE 14) - NIGHT (1998)\n\nWILL, now 28, sits with his gorgeous bride JOSEPHINE.  This is their wedding reception, crowded with their friends and family.  They should be joyful, but Will is furious.\n\nEdward has the floor, ostensibly for a toast.  The room is cozy and drunk.\n\nEDWARD\nThis fish, the Beast.  The whole time we were calling it a him, when in fact it was a her.  It was fat with eggs, and was going to lay them any day.\n\nOver near the doorway, we spot Sandra, just returned from the restrooms.  She looks gorgeous.  She couldn't be any happier if this were her own wedding.\n\nEDWARD\nNow, I was in a situation.  I could gut that fish and get my ring back, but doing so I would be killing the smartest catfish in the Ashton River, soon to be mother of a hundred others.  \n\nWill can't take any more.  Josephine tries to hold him back, but he gets up and leaves.  Edward doesn't even notice.\n\nEDWARD (CONT'D)\nDid I want to deprive my soon-to-be-born son the chance to catch a fish like this of his own?  This lady fish and I, well, we had the same destiny.\n\nAs he leaves, Will mutters in perfect unison with his father--\n\nEDWARD AND WILL\nWe were part of the same equation.\n\nWill reaches the door, where his mother intercepts him.\n\nSANDRA\nHoney, it's still your night.\n\nWill can't articulate his anger.  He just leaves.\n\nEDWARD\nNow, you may well ask, since this lady fish wasn't the ghost of a thief, why did it strike so quick on gold when nothing else would attract it?\n(closer; he holds up his ring)\nThat was the lesson I learned that day, the day my son was born.  \n\nHe focuses his words on Sandra.  This story is -- and has always been -- about her more than anyone.\n\nEDWARD\nSometimes, the only way to catch an uncatchable woman is to offer her a wedding ring.\n\nA LAUGH from the crowd.  \n\nEdward motions for Sandra to get up here with him.  As she crosses, we can see that thirty years of marriage has not lessened their affection for each other.  \n\nAs they kiss, Edward tweaks her chin a special little way.  The crowd APPLAUDS.\n\nEdward toasts the happy couple.  Josephine covers well for her absent husband, a smile as warm as summer.\n\nEdward downs his champagne in a gulp.\n\nEXT.  OUTSIDE LA RUE 14 - NIGHT\n\nWe come into the middle of an argument on the sidewalk.  Occasional PASSERSBY take notice, especially as it gets more heated.  Both men are a little drunk.\n\nEDWARD\nWhat, a father's not allowed to talk about his son?\n\nWILL\n(disbelieving)\nI am a footnote in that story.  I am the context for your great adventure.  Which never happened!  Incidentally!  You were selling novelty products in Wichita the day I was born.  \n\nEDWARD\n(shaking his head)\nJesus Christ.\n\nWILL\nFriend of yours?  Did you help him out of a bind?\n\nEDWARD\nCome on, Will.  Everyone likes that story.\n\nWILL\nNo Dad, they don't.  _I_ do not like the story.  Not anymore, not after a _thousand_ _times_.  I know all the punchlines, Dad.  I can tell them as well as you can.\n(closer)\nFor one night, one night in your entire life, the universe does not revolve around Edward Bloom.  It revolves around me and my wife.  How can you not understand that?\n\nA long beat, then...\n\nEDWARD\n(low)\nSorry to embarrass you.\n\nWill won't let him get the last word.\n\nWILL\nYou're embarrassing yourself, Dad.  You just don't see it.\n\nANGLE ON Edward.  Fine.  A hand to wave, enough of you. \n\nHe walks away.\n\nANGLE ON Will, still fuming with righteous anger.  It's then we FREEZE FRAME.\n\nWILL (V.O.)(CONT'D)\nAfter that night, I didn't speak to my father again for three years.  \n\nINT.  A.P. NEWSROOM (PARIS) - DAY  \n\nA typically busy day.  On hold with the phone cradled under an ear, Will sorts through a bundle of mail dropped on his desk.\n\nWILL (ON PHONE)\n(without pauses)\nWilliam Bloom with the Associated Press if I could just...\n\nHe's put back on hold.  Returning to the mail, he finds a hand-addressed envelope.  Rips it open.\n\nWILL (V.O.)(CONT'D)\nWe communicated indirectly I guess.  In her letters and Christmas cards, my mother would write for both of them.\n\nINT.  BLOOM HOUSE KITCHEN - DAY\n\nAt the table, Sandra talks on the phone while Edward fixes a sandwich.\n\nWILL (V.O.)\nWhen I'd call, Mom would say that Dad was out driving.  Or swimming in the pool.\n\nEdward takes a seat, starting to eat his sandwich.\n\nWILL (V.O.) (CONT'D)\nTrue to form, we never talked about our not talking.\n\nINT.  BLOOM HOUSE MASTER BEDROOM - NIGHT\n\nSandra stands by the window, watching as...\n\nEXT.  BLOOM BACK YARD - NIGHT [CONTINUOUS]\n\nEdward swims laps in the family pool.  He's born to the water.\n\nWILL (V.O.)\nThe truth is, I didn't see anything of myself in my father, and I don't think he saw anything of himself in me.  We were like strangers who knew each other very well.\n\nEXT.  RIVER - DAY\n\nEdward stares intently into the water, a lion in wait.\n\nWILL (V.O.)\nIn telling the story of my father's life, it's impossible to separate the fact from the fiction, the man from the myth.  The best I can do is to tell it the way he told me.\n\nWe LOOK DOWN at the river, where Edward's reflection is caught in the dark water.  As the water ripples past, something changes.  \n\nSure enough, as we LOOK UP again, it's a younger EDWARD BLOOM, 20's, staring into the water.  He's not just handsome, not just charming.  It's as if all the forces of the natural world had conspired to create him.\n\nWILL (V.O.) (CONT'D)\nIt doesn't always make sense, and most of it never happened.\n\nSuddenly, this Edward thrusts both hands into the water, grabbing hold of\n\nTHE BEAST.\n\nHe brings the catfish up to his face.  Looks it right in the eye.  A beat, then the Beast spits out Edward's gold ring.\n\nWILL (V.O.) (CONT'D)\nBut that's what kind of story this is.\n\nSmiling, Edward takes the ring, then throws the Beast back into the water with a splash.\n\nTITLE OVER:\n\n> _BIG FISH_ <\n\nINT.  HOSPITAL ROOM - DAY  \n\nYoung Dr. Bennett stands between the Wife's legs.  She's flustered and sweating, but the doctor has a comforting bedside manner...\n\nYOUNG DR. BENNETT\nNow, Mrs. Bloom, I'll need you to give me one good push.  On three.  One... \n\nSuddenly, we hear a POP as a slimy mass of human being rockets into the doctor's unprepared hands.  Bennett tries to hold tight, but the infant is slippery like a fish.  It shoots up into air.\n\nThe NURSES and the Husband try to grab the baby, but no one can hold it.  As the newborn sails upward TOWARDS CAMERA, we can see a GIGGLING SMILE on its face.\n\nAs it falls, the newborn knocks over a tray, which provides it a ramp to slide right out of the room.  Everyone races after it.\n\nINT.  HOSPITAL HALLWAY - DAY  \n\nBursting through the doors --\n\nYOUNG DR. BENNETT\nGrab that baby!\n\nA NURSE finally scoops up the slippery baby.  Everyone lets out a collective sigh of relief.\n\nWILL (V.O.)\nMy father's birth would set the pace for his unlikely life.  No longer than most men's, but larger.  And as strange as his stories got, the endings were always the most surprising of all.\n\nINT.  HALF-DARK PARIS APARTMENT - (PRESENT) DAY\n\nOver the sound of rain, a phone RINGS on a chair.  By the tone of the ring, we know we're not in the U.S. -- it has that insistent European sound.  \n\nAs it keeps RINGING, we look to see the apartment is mostly empty, just a few half-unpacked boxes.  A cradle is still in its carton.\n\nKEYS in the lock.  LAUGHTER in the hallway.  The door swings open to reveal a drenched Will (29) carrying four sacks of groceries, the bottoms collapsing from the rain.  His wife Josephine (28) pushes past him to get the phone.  \n\nJOSEPHINE\nAllo oui?\n\nWill begins stripping out of his wet clothes, each layer unleashing a new drizzle.  He plays it up, trying to get a reaction out of Josephine.\n\nJOSEPHINE (CONT'D)\n(on phone)\nYes, he's here.\n\nShe hands the phone to Will, concerned.\n\nJOSEPHINE (CONT'D)\nIt's your mother.\n\nHalf-stripped, Will takes the phone.  This won't be good news.\n\nWILL\n(on phone)\nHi.  Uh-huh.  Uh-huh.\n\nAs Josephine takes off her rain coat, we see she is very, very pregnant.  She listens carefully to Will's side of the conversation, trying to gauge how bad the news is.\n\nWILL (CONT'D)\nWhat does Dr. Bennett say?  Okay.  No, sure, let me talk to him.   I'll wait.\n\nHe covers the mouthpiece.  Looks over to Josephine.\n\nJOSEPHINE\nIt's bad.\n\nWILL\nIt's more than they thought.  They're going to stop chemo.\n\nJOSEPHINE\nYou need to go.\n\nWILL\nProbably tonight.\n\nA beat.\n\nJOSEPHINE\nI'm going with you.\n\nWILL\nYou don't have to.\n\nJOSEPHINE\n(a simple fact)\nI'm going with you.\n\nINT.  AIR FRANCE 747 - NIGHT\n\nAs the plane continues boarding, a STEWARDESS recites the welcome spiel in French.  Will has a window seat in coach.  Josephine sits beside him, putting on hand lotion.  \n\nTaking his hands, she rubs the excess into him.  There's an effortless intimacy between them.  She can pinpoint what he's feeling before he can.\n\nINT.  747 / FLYING - NIGHT\n\nHours later, and the lights are dimmed.  Most of the PASSENGERS are asleep, including Josephine.  Her head is propped against Will's shoulder, her hands tucked under her belly. \n\nWill watches her sleep, brushing back her hair.  A beat, then he notices a BORED BOY in the next row over.  \n\nOff the glow of the reading light, the boy is using his hands to cast shadows on the seat back.   The kid is pretty good, making a convincing bird, a passable monkey, and finally a dog.\n\nWe PUSH IN on the silhouettes.\n\nEDWARD (O.S., PRELAP)\nSo which one's it gonna be?  The Monkey in the Barn, the Dog in the Road?\n\nFocusing on the final shadow, we...\n\nMATCH CUT TO:\n\nINT.  BLOOM HOUSE - NIGHT  \n\n...come to find Edward making the shapes. \n\nWill (6) sits in his pajamas on the floor next to him.  The endtable lamp lies between them, its shade off to cast big shadows on the wall.\n\nWILL\nThe one about the witch.\n\nEDWARD\nYour mom says I can't tell you that one anymore.  You get nightmares.\n\nWILL\nI'm not scared.\n\nEdward looks around for a beat, seeing if his wife is in earshot.  He then leans in, complicitous.\n\nEDWARD\nNeither was I.  At first.\n\nWill smiles, excited to hear the forbidden story.\n\nEDWARD (CONT'D)\nThis all happened in the swamp outside of Ashton.  Kids weren't supposed to go out in the swamp, on account of the snakes and spiders and quicksand that would swallow you up before you could even scream.  But there were five of us out there that night:  Me, Ruthie, Wilbur Freely, and the Price Brothers, Don and Zacky.\n\nEdward holds up his hand, counting the names on his fingers.  \n\nEDWARD (CONT'D)\nNot a one of us knew what was in store.\n\nAs his hand moves past the light, we\n\nCOME TO:\n\nA flashlight SWEEPS past.  We are...\n\nEXT.  FIELD AT THE SWAMP EDGE - NIGHT\n\nThe night is WHIRRING and BREATHING, alive.  The moon hangs low, casting long shadows.  \n\nFive kids walk past in silhouette.  Four have flashlights on.  The fifth keeps tripping, crashing into YOUNG EDWARD (10).\n\nEDWARD\nZacky, turn your flashlight on!\n\nZACKY\nI don't got any batteries!\n\nRed-headed ZACKY PRICE is 10.  His brother DON PRICE is 12, and a lot bigger than the others.\n\nDON PRICE\nThen why'd you bring it?\n\nZACKY\nI don't want to be in the swamp with a witch and no flashlight.\n\nWILBUR FREELY, also 10, is the black asthmatic son of a sharecropper.  Redheaded RUTHIE MACKLIN, 8, is happy just to be there.\n\nEDWARD\nIs it true she got a glass eye?\n\nWILBUR FREELY\nI heard she got it from Gypsies.\n\nEDWARD\nWhat's a Gypsy?\n\nZACKY\nYour momma's a Gypsy.\n\nDON PRICE\nYour momma's a bitch.\n\nRUTHIE\nYou shouldn't swear.  There's ladies present.\n\nDON PRICE\nShit.\n\nZACKY\nDamn.\n\nWILBUR FREELY\nScrew.  \n\nEDWARD\n(whispering)\nTurn off your flashlights!  She'll see 'em.\n\nMOVING UP behind the kids, we find ourselves at the gates of...\n\nEXT.  A CREEPY OLD HOUSE - NIGHT  \n\nADULT EDWARD (V.O.)\nNow, it's common knowledge that most towns of a certain size have a witch, if only to eat misbehaving children and the occasional puppy who wanders into her yard.  Witches use those bones to cast spells and curses that make the land infertile.\n\nWe PULL BACK, and BACK, revealing more of the Gothically creepy house:  its broken windows, strangling vines, and eerie gargoyles half-buried in the dirt.  Even bats are afraid to fly over it.  \n\nIn the moonlight, the house is especially sinister.  Who knows what is lurking in the shadows?\n\nADULT EDWARD (V.O.)(CONT'D)\nYet of the all the witches in Alabama, there was one who was the most feared.  For she had one glass eye, which was said to contain mystical powers.\n\nWe finally come to the kids, staring in through the gate.\n\nWILBUR FREELY\nI hear if you look right at it, you can see how you're gonna die.\n\nEDWARD\nThat's bull-s-h-i-t, that is.  She's not even a real witch.\n\nDON PRICE\nYou're so sure, why don't you go in and get that eye?  I heard she keeps it in a box on her nighttable.\n\nEdward looks back at the spooky house.\n\nDON PRICE (CONT'D)\nOr are you too scared?\n\nEDWARD\nI'll go in right now and get that eye.\n\nDON PRICE\nThen do it.\n\nEDWARD\nFine, I will.\n\nDON PRICE\nFine, you do it.\n\nEDWARD\nFine, I'm doing it.\n\nHe hands Zacky his flashlight, then starts climbing the gate.\n\nRUTHIE\nEdward, don't!\n\nWILBUR FREELY\nShe'll make soap out of you!\n(to Ruthie)\nThat's what she does, she makes soap out of people.\n\nEdward drops down on the far side of the gate.  Truth be told, Edward is scared, but he forges ahead anyway.  \n\nWilbur looks to Ruthie, and they're in complete agreement.  They get the hell out of there.  Zacky would run too, but Don holds him by the collar.\n\nEXT. APPROACHING THE HOUSE\n\nEdward curves around the tall bushes that hide the front door.  Anything could jump out of them. \n\nHe steps on the porch.  The boards SQUEAL and CREAK, but he continues on.  A cat SCREAMS OUT from a broken wicker rocker.  Catching his breath, Edward reaches the front door.\n\nThe doorknob is ancient brass, two projections that look like horns.  Yet Edward extends his hand, reaching closer and closer before he finally\n\nRINGS THE DOORBELL.\n\nImpossibly fast, the door opens, revealing an OLD WOMAN with a patch over her left eye.  She looks like she's been dead for years, but too stubborn to lie down.\n\nEDWARD\n(calm and straightforward)\nMa'am, my name is Edward Bloom, and there's some folks'd like to see your eye.\n\nEXT. BACK AT THE GATE - NIGHT  \n\nZacky and Don Price wait for Edward, each moment more convinced he's already dead.  But suddenly, he's back at the gate.\n\nDON PRICE\nYou get the eye?\n\nEDWARD\nI brought it.\n\nDON PRICE\n(dubious)\nLet's see it.\n\nThe Old Woman steps out of the shadows behind Edward, flipping up her eye patch.  When their flashlight beam hits her left eye, it shines with a hellish glow.\n\nWe RUSH IN on Zacky, who is paralyzed by what he sees.  \n\nCUT TO:\n\nEXT.  FRONT PORCH OF HOUSE - DAY\n\nAn OLD MAN -- Zacky -- stands on a wobbly stepladder, changing a lightbulb.  Suddenly, the ladder gives way and he falls.  Dead.\n\nEXT.  AT THE GATE - NIGHT  \n\nWe RUSH IN on Don Price.\n\nCUT TO:\n\nINT.  FRATERNITY HOUSE BATHROOM - DAY\n\nTwenty-year old Don Price falls face-forward on the tile, face mushed in the grout.  Very much dead.\n\nEXT.  AT THE GATE - NIGHT  \n\nDon and Zacky both tremble with fear.  The latter has tears in his eyes.\n\nZACKY\nI saw how I was gonna die.  I was old, and I fell.\n\nDON PRICE\nI wasn't old at all.\n\nThe brothers suddenly bolt.  Still standing next to the Old Woman, Edward smiles.\n\nEXT.  AT THE OLD WOMAN'S DOOR - NIGHT\n\nEdward helps her back inside.  He could leave now, but curiosity gets the better of him.\n\nEDWARD\nI was thinking about death and all.  About seeing how you're gonna die.\n\nThe Old Woman turns to him slightly, still not facing him.\n\nEDWARD (CONT'D)\nI mean, on one hand, if dying was all you thought about, it could kind of screw you up.  But it could kind of help you, couldn't it?  Because you'd know that everything else you can survive.\n\nThe Old Woman smiles a little, a crooked grin of broken teeth.\n\nEDWARD (CONT'D)\nI guess I'm saying, I'd like to know.\n\nThe Old Woman turns leaning her face right in front of his.  And on a silent count of one, two, three -- Edward looks into The Eye.\n\nThis time we don't cut.  Instead, we HOLD ON Edward as he witnesses his death.  He stares transfixed, perplexed and amused.  Whatever he sees, it's not as dire as the other boys.  His future has something strange in store.\n\nEDWARD (CONT'D)\nHuh.  That's how I go?\n\nThe Old Woman nods.  Still a little overwhelmed, Edward turns and leaves.\n\nADULT EDWARD (V.O.)\nFrom that moment on, I no longer feared death.  And for that, I was as good as immortal.\n\nAs Edward leaves, the door swings SHUT on its own.\n\nMATCH CUT TO:\n\nINT./EXT.  BLOOM HOUSE - (PRESENT) DAY\n\nThe front door opens to reveal Will and Josephine on the porch with their bags.  REVERSE to Will's mother Sandra (53), surprised and a little annoyed. \n\nSANDRA\nHow did you get here?\n\nWILL\nWe swam.  The Atlantic, it's not that big really.\n\nSANDRA\nRuth McHibbon offered to pick you up at the airport.\n\nWILL\nWe rented a car.\n\nSANDRA\n(simply)\nYou didn't need to do that.  You just didn't.\n\nA beat.  Starting over...\n\nWILL\nHi, Mom.\n\nHe leans in and hugs her.  She surrenders, squeezing her son tight.  Will and his mother are cut from the same cloth -- strong-willed but practical.  They've always been close.\n\nSANDRA\nI'm so glad you're here.\n\nThat hug finished, Sandra pushes past her son to her daughter-in-law.  Seeing the size of her belly --\n\nSANDRA\nYou shouldn't have flown.  But...\n\nThey hug.  \n\nJOSEPHINE\nIt's good to see you.  You look beautiful.\n\nIt's not flattery.  It's the truth.\n\nSANDRA\nThank you.  I'll bet you need to --\n\nJOSEPHINE\nYes.\n\nSANDRA\nDown the hall on the right.  The door sticks.  You have to really pull it.\n\nJosephine squeezes past, a smile to her husband -- be nice.  Will heads back to the rental car to retrieve luggage.  Sandra follows him.\n\nComing down the driveway, we get to see the house for the first time:  an older suburban home, three bedrooms, big for the neighborhood, and nicely grown into the lot.  KIDS are playing on the street.\n\nWILL\nIs that Dr. Bennett's car?\n\nSANDRA\nHe's up with your father.\n\nHeading back to the house...\n\nWILL\nHow is he?\n\nSANDRA\nHe's impossible.  He won't eat.   And because he won't eat, he gets weaker.  And because he's weaker, he doesn't want to eat.\n\nWILL\nHow much time does he have left?\n\nSANDRA\nYou don't talk about those things.  Not yet.\n\nINT.  KITCHEN - DAY\n\nSandra is pouring iced tea for Will and Josephine.\n\nDR. JULIUS BENNETT (85) enters from the foyer, still winded from coming down the stairs.  He was the town's first Black physician.  He's still the town's best physician.\n\nDR. BENNETT\nWill.\n\nWILL\nDr. Bennett.  It's good to see you.\n(they shake)\nMy wife, Josephine.\n\nDR. BENNETT\nA pleasure.\n\nHe judges her belly.\n\nDR. BENNETT (CONT'D)\nYou're seven months.\n\nJOSEPHINE\n(impressed)\nTo the day.\n\nHe leans close to her, whispering in her ear...\n\nDR. BENNETT\nIt's a boy.\n\nShe smiles, surprised but not doubting.  Will looks over -- what did he say?  Josephine shakes her head.\n\nBack to the main subject...\n\nSANDRA\nYou don't think he looks any worse.\n\nDR. BENNETT\nNo.  I would say he's the same.\n\nAnd in the silence that follows, a lot is said.  It wasn't the upbeat reply Sandra was hoping for.\n\nWILL\nCan I see him?\n\nDR. BENNETT\nAbsolutely.  Be good for you to talk to him.\n\nA moment of awkwardness -- everyone here knows they haven't spoken in years.\n\nSandra hands Will a squat can of Ensure from the case on the counter.\n\nSANDRA\nGet him to drink one of these.  He won't, but tell him he has to.\n\nINT.  FOYER - DAY\n\nComing out from the kitchen, Will slowly climbs the stairs.  They CREAK with every step.\n\nThe wall is filled with family photos, happier times.  Most of the pictures are of Will, starting when he was an infant and ending at his wedding.  As he climbs the stairs, we can see him growing up with every step.\n\nINT.  UPSTAIRS HALLWAY - DAY\n\nA crack of sunlight spills around the half-open door at the end of the hallway.  Will walks towards it, running a hand along the wallpaper.\n\nAlmost at the door, he stops for a beat.  Gets his breath.  Then goes inside.\n\nINT.  GUEST ROOM - DAY\n\nEdward Bloom, 61, lies asleep on the bed.  Although he's not the vibrant man we've seen before, it's not as bad we feared.  The illness has been quick, and left him largely intact.\n\nThere are no I.V.'s, no monitors, nothing.\n\nComing up to the bed --\n\nWILL\nDad?\n\nEdward cracks open an eye, a beat before he focuses.  He tries to say something, but no words come out.\n\nHe looks over at a pitcher on the nightstand.  Will pours him a glass of water, helping him hold it to his parched lips.\n\nFinished, Edward sets down the glass by himself.  A very long, tense beat.  Will almost speaks again to fill the silence.  \n\nFinally...\n\nEDWARD\nYou --\n(he points)\n-- are in for a surprise.\n\nWILL\nAm I?\n\nEDWARD\nHaving a kid changes everything.  I mean, there's the diapers and the burping and the midnight feedings...\n\nWILL\nDid you do any of that?\n\nEDWARD\nNo, but I hear it's terrible.  Then you spend years trying to corrupt and mislead this child, fill its head with nonsense and still it turns out perfectly fine.\n\nWILL\nYou think I'm up for it?\n\nEDWARD\nYou learned from the best.\n\nWill doesn't rise to the challenge.  A beat, then he remembers the can of Ensure.  Holds it up.  Edward recoils.\n\nWILL\nJust drink half the can.  I'll tell her you drank the whole thing.  Everyone wins.\n\nA beat, then Edward rolls his eyes.  Fine.  Will cracks open the can, finding a straw on the nightstand.\n\nEDWARD\nPeople needn't worry so much.  It's not my time yet.  This isn't how I go.\n\nWILL\nReally.\n\nEDWARD\nTruly.  I saw it in The Eye.\n\nWILL\nThe Old Lady by the swamp.\n\nEDWARD\nShe was a witch.\n\nWILL\nNo, she was old and probably senile.  Maybe schizophrenic.\n\nEDWARD\nI saw my death in that eye.  And this is not how it happens.\n\nWILL\nSo how does it happen?\n\nEDWARD\nSurprise ending.  Wouldn't want to ruin it for you.\n\nEdward slurps down as much of the Ensure as he can stand, then pushes the can away.  He swallows with difficulty.\n\nEDWARD (CONT'D)\nThere was this panhandler who used to stop me every morning when I came out of this coffee shop near the office.\n\nWILL\nOkay.\n\nEDWARD\nAnd every day I gave him a quarter.  Every day.  Then I got sick and was out for a couple of weeks.  And when I went back there, you know what he said?\n\nWILL\nWhat did he say?\n\nEDWARD\nYou owe me three-fifty.\n\nWILL\nReally.\n\nEDWARD\nTrue story.\n\nA beat.\n\nWILL\nWhen did you ever work in an office?\n\nEDWARD\nThere's a lot you don't know about me.\n\nWILL\nYou're right.\n\nEdward gives a wry smile.  He walked into that.\n\nEDWARD\nYour mother was worried we wouldn't talk again.  And look at us.  We're talking fine.  We're storytellers, both of us.  I speak mine out, you write yours down.  Same thing.\n\nWill won't commit to Edward's assessment.\n\nWILL\nDad, I'm hoping we can talk about some things while I'm here.\n\nEDWARD\nYou mean, while _I'm_ here.\n\nWILL\nI'd just like to know the true versions of things.  Events.  Stories.  You.\n\nEdward LAUGHS a little, which becomes a COUGH.  The HACKING escalates until another drink of water gets it under control.  It's not clear whether any of this was an act to keep from talking.\n\nEDWARD\nYour mother hasn't been keeping up the pool.  If you wanted to you could...\n\nWILL\nI will.\n\nEDWARD\nYou know where the chemicals are?\n\nWILL\nI used to do it when you were gone, remember?  I used to do it a lot.\n\nHe didn't mean for that to sound so pointed.  Taking the half-empty Ensure, Will gets up to go.  He's at the door when...\n\nEDWARD\nI was never much for being at home, Will.  It's too confining.  And this, here.  Being stuck in bed.  Dying is the worst thing that ever happened to me.\n\nHe smiles at his joke.\n\nWILL\nI thought you weren't dying.\n\nEDWARD\nI said this isn't how I go.  The last part is much more unusual.  Trust me on that.\n\nINT.  UPSTAIRS HALLWAY - DAY\n\nShutting the door behind himself, Will drinks the rest of the Ensure himself.  Edward was right.  It tastes horrible.\n\nHeading for the stairs, Will walks past an open door.  As he leaves frame, we STAY BEHIND to look inside...\n\nINT.  WILL'S BEDROOM - DAY  [FLASHBACK]\n\n...where an eight-year old Will is propped up in bed, his face covered with chicken pox and pink calamine lotion.  He's showing Edward how many bumps there are on his arm.\n\nYOUNG WILL\nDr. Bennett says I'm going to have to be home for a week.\n\nEDWARD\nThat's nothing.  I once had to stay in bed for three years.\n\nYOUNG WILL\nDid you have chicken pox?\n\nEDWARD\nI wish.\n\nCUT TO:\n\nINT.  TINY CHURCH - DAY  \n\nWearing a white shirt and tie, YOUNG EDWARD -- still about 10 -- sings \"Down to the River My Lord\" along with the CONGREGATION.  His voice is high and thin, but he gives it his all.\n\nSuddenly, his voice CRACKS and DROPS a half-octave.  And then another.  His friends Wilbur Freeley and Ruthie look over, wondering what's wrong.  Embarrassed, Edward just keeps SINGING, trying to follow along with the baritone part.\n\nHe pulls at his collar.  Then pulls again, his face getting red.  Starting to panic, he loosens his tie.  He's starting to undo the collar button when it POPS off by itself.  Two more buttons fly off.  One hits a CHUBBY WOMAN in the neck.\n\nON HIS SHOES\n\nAs we watch, Edward's pant cuffs rise inch by inch -- that's how fast he's growing.\n\nEDWARD (V.O.)\nTruth is, no one quite knew what was wrong.  Most times, a person grows up gradually.  I found myself in a hurry.\n\nINT.  YOUNG EDWARD'S BEDROOM - DAY  \n\nYoung Edward lies in bed, his limbs connected to various pulleys and levers to support his weight.  He has a dozen encyclopedias around him, and another dozen on the floor.\n\nEDWARD (V.O.)\nMy muscles couldn't keep up with my bones, and my bones couldn't keep up with my body's ambition.  So I spent the better part of three years confined to my bed, with the World Book Encyclopedia being my only means of exploration.  I had made it all the way to the \"G's,\" hoping to find an answer to my gigantificationism, when I uncovered an article about the common goldfish.\n\nINSERT:  The encyclopedia article, complete with drawings.\n\nYOUNG EDWARD\n(reading)\n\"Kept in a small bowl, the goldfish will remain small.  With more space, the fish can grow double, triple, or quadruple its size.\"\n\nYoung Edward thinks this through.\n\nEDWARD (V.O.)\nIt occurred to me then, that perhaps the reason for my growth was that I was intended for larger things.  After all, a giant man can't have an ordinary-sized life.\n\nEXT.  BASEBALL FIELD - DAY  \n\nThe CRACK of a bat announces the game-winning home run.  The crowd CHEERS the swing, and especially the batter as he rounds the bases.\n\nAlthough we've seen him briefly before, this is our first real exposure to GROWN-UP EDWARD, who we'll follow from roughly the ages of 18 to 30.  \n\nEDWARD (V.0.)\nAs soon as my bones had settled in their adult configuration, I set upon my plan to make a bigger place for myself in Ashton.\n\nEXT.  SCHOOL FIELDS - DAY  \n\nSINGLE SHOTS:  Football hero Edward leads his team to victory.  On the sidelines, a PRETTY GIRL admits the name of her secret love:\n\nGIRL\nEdward Bloom!\n\nThe other GIRLS SQUEAL in agreement.  Don Price looks over, glowers.\n\nEXT.  NEIGHBORHOOD - DAY  \n\nSINGLE SHOT:  A lawnmower ROARS along the grass.  We LOOK UP to see who's pushing it, but it's not Edward.  It's one of his teenage EMPLOYEES.\n\nEdward is back at the truck, which is painted to read, \"Bloom Landscaping.\"  He has workers on every lawn.  \n\nHe signs an autograph for an ADMIRING CUB SCOUT.\n\nINT.  BASKETBALL COURT - DAY  \n\nEdward takes an impossible shot at the buzzer from the other end of the court.  Naturally, he makes it, winning the game.\n\nAs the crowd goes wild for Edward, Don Price is the only teammate who doesn't mob him.\n\nEXT.  TOWN - DAY  \n\nEdward carries a dog out of a burning house.\n\nINT.  SCIENCE FAIR - DAY\n\nEdward wins a blue ribbon for his invention, a machine labelled \"Perpetual Motion.\"  He and the JUDGE pose for a photograph.  A FLASH.\n\nPissed, Don Price throws his crappy lima bean plants in the trash.\n\nINT.  HIGH SCHOOL STAGE - DAY\n\nA dashingly handsome Edward leads the CAST out for a curtain call.  He's the star of the show.  Off to the side, we see Don Price is the ass-end of a horse costume.\n\nEdward soaks in his applause, smiling and gracious.\n\nEXT.  GRADUATION STAGE - DAY  \n\nEdward accepts his diploma.  The PRINCIPAL hugs him tight.\n\nEDWARD (V.O.)\nI was the biggest thing Ashton had ever seen.  Until one day, a stranger arrived.\n\nEXT.  FARM - DAY\n\nAs two FARMERS shake their heads, we REVERSE to a show a massive hole punched through the side of a barn.  It's roughly the shape of man, but no human could be that large.\n\nEXT.  SHEEP PEN - DAY\n\nTwo fat ewes look up, a shadow falling across them.  They BLEAT in panic as \n\nTWO OVERSIZED HANDS\n\nreach in and scoop them up.  Their protests continue as they're carried away, one under each arm.  We still haven't seen the full stranger.\n\nEXT.  COURT HOUSE - DAY\n\nA MOB of about 50 have gathered, many of them with shotguns.  Amid the crowd we see Don Price.\n\nSHARECROPPER\nHe ate an entire cornfield!\n\nLITTLE GIRL\nHe ate my dog!\n\nHOT-BLOODED SHOTGUN TOTER\nIf you ain't gonna stop him Mayor, we will!\n\nMAYOR\nI won't have mob violence in this town.  Now, has someone tried talking to him?\n\nSOME FARMER\nYou can't reason with 'im!\n\nSHEPHARD\nHe's a monster!\n\nAgreement from the crowd.  And then...\n\nA VOICE (O.S.)\nI'll do it.\n\nEveryone turns to see who said that.  The crowd parts to reveal none other than Edward Bloom.  Don Price glowers.\n\nEDWARD\nI'll talk to him.  See if I can get him to move on.\n\nMAYOR\nSon, that creature could crush you without trying.\n\nEDWARD\nTrust me, he'll have to try.\n\nEXT.  HILL OUTSIDE ASHTON - DAY\n\nEdward climbs up the last bit of the steep hillside, reaching the mouth of a cave.  Outside, buzzards squabble over the remains of the giant's feast:  broken barrels, bones picked clean.\n\nIn his most serious voice, Edward calls out:\n\nEDWARD\nHello!\n\nThere's no answer.\n\nEDWARD  (CONT'D)\nMy name is Edward Bloom!  I want to talk to you!\n\nFrom deep in a cave, a thunderous voice:\n\nVOICE (O.S.)\nGO AWAY!\n\nThe giant's voice has such force, it blows Edward's hair back.\n\nEDWARD\nI'm not going anywhere until you show yourself.  \n\nA beat, then we hear a RUMBLE, like a train coming.  Edward braces himself, fists ready for a fight, if that's what it's going to take.\n\nAs the RUMBLE gets louder, the ground starts to shake.  Even Edward starts to worry.  Just how big is this guy?  \n\nEDWARD (V.O.)(CONT'D)\nArmed with the foreknowledge of my own death, I knew the giant couldn't kill me.  All the same, I preferred to keep my bones unbroken.\n\nEdward picks up a stone, ready to play David to Goliath.\n\nThen suddenly, the giant bursts forth.  Hunched over, he slams into a stunned Edward, knocking him halfway down the hill.\n\nKARL THE GIANT is bigger than any man you've ever seen.  Not just tall, but massive.  He's completely feral, with a beard to his elbow and skin scratched and blistered.  What remains of his clothes are ragged and muddy.  God knows what's living in his matted hair.\n\nKarl leans over Edward, blocking the sun.  Edward throws his rock, but it just bounces off.  The giant didn't even notice it.\n\nKARL\nWhy are you here?\n\nEdward ponders the best response, settling on...\n\nEDWARD\nSo you can eat me.  The town decided to send a human sacrifice, and I volunteered. \n\nKarl's eyes narrow, confused.  Edward stands up.\n\nEDWARD (CONT'D)\nMy arms are a little stringy, but there's some good eating on my legs.  I mean, I'd be tempted to eat them myself.\n(beat)\nSo I guess, just, if you could get it over with quick.  Because I'm not much for pain, really.\n\nEdward closes his eyes, hands at his side, ready to be eaten.  Karl just stares at him, not sure what to do.\n\nAfter a beat, Edward opens his eyes a tiny bit, just to see what the giant is doing.  Relieved to see he's not licking his chops --\n\nEDWARD (CONT'D)\nLook, I can't go back.  I'm a human sacrifice.  If I go back, everyone will think I'm a coward.  And I'd rather be dinner than a coward.\n\nKarl sits down with a BOOM, dejected.\n\nEDWARD (CONT'D)\nHere, start with my hand.  It'll be an appetizer.\n\nReaching up, Edward shoves his hand into Karl's mouth.  But the giant spits it back out.\n\nKARL\nI don't want to eat you.  I don't want to eat anybody.  It's just I get so hungry.  I'm too big.\n\nAnd that's the sad truth.  Karl is less a monster than a freak -- a giant man, but in the end, just a man.\n\nEdward takes a seat beside him.\n\nEDWARD\nDid you ever think maybe you're not too big?  Maybe this town's just too small.  I mean, look at it.\n\nCircling behind them, we look down at Ashton -- a tiny town in a tiny valley.\n\nEDWARD (CONT'D)\nHardly two stories in the whole place.  Now I've heard in real cities, they've got buildings so tall you can't even see the tops of 'em.\n\nKARL\nReally?\n\nEDWARD\nWouldn't lie to you.  And they've got all-you-can-eat buffets.  You can eat a lot, can't you?\n\nKARL\nI can.\n\nEDWARD\nSo why are you wasting your time in a small town?  You're a big man.  You should be in the big city.\n\nKarl smiles, but then it fades.  A certain sad suspicion --\n\nKARL\nYou're just trying to get me to leave, aren't you?  That's why they sent you here.\n\nEDWARD\nWhat's your name, Giant?\n\nKARL\nKarl.\n\nEDWARD\nMine's Edward.  And truthfully, I do want you to leave, Karl.  But I want to leave with you.  \n(closer)\nYou think this town is too small for you, well, it's too small for a man of my ambition.  I can't see staying here a day longer.  \n\nKARL\nYou don't like it?\n\nEDWARD\nI love every square inch of it.  But I can feel the edges closing in on me.  A man's life can only grow to a certain size in a place like this.\n(beat)\nSo what do you say?  Join me?\n\nKarl thinks a moment.  Then --\n\nKARL\nOkay.\n\nEDWARD\nOkay.\n\nThey shake on it.\n\nEDWARD (CONT'D)\nNow first, we gotta get you ready for the city.\n\nEXT.  RIVER - DAY\n\nIN A SINGLE SHOT, Karl cuts his hair with hedge clippers, while Edward cuts up a surplus army tent to make him a shirt.\n\nEXT.  MAIN STREET OF ASHTON - DAY\n\nSpirits buoyed by the high school MARCHING BAND, all the good CITIZENS of Ashton are gathered to see off Edward and Karl.  There's a few tears amid the familiar faces.\n\nMAYOR\n(loudly, for the crowd)\nEdward Bloom, first son of Ashton, it's with a heavy heart we see you go.  But take with you this Key to the City, and know that any time you want to come back, all our doors are open to you.\n\nEdward ducks a bit so the Mayor can put the key around his neck.  The crowd CHEERS.  And with that, Edward and Karl start walking, waving as they go.\n\nOnly DON PRICE, smoking on the corner, isn't sad to see Edward go.  He crushes his cigarette under his heel.  He wishes he could crush Edward.\n\nMany of the townfolk come onto the street to hug Edward or shake his hand.  \n\nEDWARD (V.O.)\nThat afternoon as I left Ashton, everyone seemed to have advice.\n\nVARIOUS TOWNFOLK\nFind yourself a nice girl!  Don't trust anyone in Kentucky!  Watch your pride, Edward Bloom!\n\nEDWARD (V.O.)\nBut there was one person whose counsel I held above all others. \n\nAs the crowd parts, he finds himself face to face with \n\nTHE OLD WOMAN. \n\nThe ruckus slows and quiets, as if a strange spell has been cast.  She motions for Edward to lean down, so she can whisper something to him.  Although we're VERY CLOSE, we can't hear her voice.\n\nEDWARD (V.O.) (CONT'D)\nShe said that the biggest fish in the river gets that way by never being caught.\n\nThe advice only succeeds in confusing Edward.\n\nEDWARD (CONT'D)\n(to the Old Woman)\nOkay.  Thanks.\n\nEdward and Karl keep walking.  The Old Woman shuffles off, somehow knowing her advice will go unheeded.\n\nKARL\nWhat did she say?\n\nEDWARD\nBeats me.\n\nEXT.  ROAD - DAY\n\nWe TILT UP from the road to reveal Edward and Karl walking out of Ashton.  Each wears a backpack with all his earthly possessions.\n\nEDWARD (V.O.)\nThere were two roads out of Ashton, a new one which was paved, and an older one that wasn't.  People didn't use the old road anymore, and it had developed the reputation of being haunted.\n\nEdward and Karl come to a bend, where the paved road veers left and an overgrown dirt road runs straight.  The old road is blocked with signs and warnings of danger.\n\nEDWARD (V.O.) (CONT'D)\nSince I had no intention of ever returning to Ashton, this seemed as good a time as any to find out what lay down that old road.\n\nKarl looks at the dirt road, wary.\n\nKARL\nYou know anyone's who's taken it?\n\nEDWARD\nThat poet, Norther Winslow did.  He was going to Paris, France.  He must have liked it, because no one ever heard from him again.\n(beat)\nTell you what.  You take the other way and I'll cut through here.  Meet you on the far side.\n\nA little paranoid...\n\nKARL\nYou're not trying to run away?\n\nEDWARD\nJust to be sure, you can take my pack.  \n\nKarl perks up, even though it means more for him to carry.\n\nEXT.  DIRT ROAD - DAY \n\nThe road is overgrown, but not altogether creepy.  The sun is still shining, and the birds still CHIRPING.\n\nSpinning the Key to the City, Edward WHISTLES, because it's a day meant for whistling.  \n\nEXT. FURTHER ALONG - ROUGH PATH\n\nThe road has narrowed to a rough path.  Spikes of sunlight break through the thick canopy, catching particles in the air.  Still, Edward WHISTLES.\n\nComing around a bend, his PITCH DROPS as he sees thick, thorny vines growing across the path.  He stops.  For the first time, he realizes the birds have stopped singing.  The forest is dead quiet.\n\nHe looks back the way he came.  It's tempting to go back.  It would be easier to go back.  But Edward presses on.\n\nHe carefully steps through the thorns.  His trouser legs catch on the barbs.  We can hear the fabric TEAR.\n\nFURTHER ALONG \n\nA scratched and sweaty Edward waves off various STINGING BUGS flying at him, finally whipping off his hat to swat at them.  Just then a CAWING crow swoops down and grabs the hat right out of his hands.\n\nEDWARD\nYou stupid sonofa...\n\nHe stops his swearing, but grabs a rock and throws it.  The stone ricochets off a tree and into a BEE'S NEST.  The swarm roars out.\n\nEdward high-tails it, each step still precarious.\n\nEXT.  THE DARK FOREST - DAY [LATER]\n\nEdward is bruised, battered and bee-stung.  \n\nA half-broken sign lies in the road.  Edward picks it up.  Reads it:\n\nWARNING!  \n\nJUMPING SPIDERS!\n\nSure enough, up ahead he sees the path is overgrown with thick cobwebs, heavy from the rain.\n\nEDWARD (V.O.)\nThere comes a point where a reasonable man will swallow his pride and admit he's made a terrible mistake.  The truth is, I was never a reasonable man.  \n\nEdward tosses the sign and forges ahead, into the spiderwebs.\n\nEDWARD (CONT'D)\nAnd what I recalled of Sunday School was that the more difficult something became, the more rewarding it was in the end.\n\nEXT.  CLEARING / THE ROAD - DAY  \n\nEdward emerges from the forest, brushing the last cobwebs off and shaking the spiders from his shirt.  One is stuck in his sleeve, and he has to dance to get it out.  Even then, he still keeps twitching, convinced another one is left behind.\n\nAt his feet, the gravel road has returned, smooth and dusty and comforting. \n\nAhead lies a tiny one-street town -- smaller even than Ashton -- with powerlines emerging from the woods to feed it.  Dangling from the line above he sees two dozen pairs of shoes, their laces tied together.\n\nHe passes a sign that reads \"Welcome To Spectre!\"\n\nEXT.  THE TOWN OF SPECTRE   - DAY\n\nIt's a main street with stores on each side:  Cole's Pharmacy, Talbot's Five and Dime, Al's Country Store.  Everything is old, but this isn't a ghost town.  In fact, there's a group of about 20 CITIZENS spilling out to see Edward approach.  Most are smiling.  There are even a few tears of joy.\n\nWhat's more, all of these people are barefoot.\n\nMAN'S VOICE\nFriend!\n\nA forty-year old man named BEAMEN comes out of the seed store to greet Edward.  Friendly but a little drunk, he's the closest thing the town has to a mayor.  He's carrying a clipboard.\n\nBEAMEN\nWelcome to ya.  What's your name?\n\nEDWARD\nEdward Bloom.\n\nBeamen checks the clipboard.  Not finding the name, he flips forward a few pages.  Still looking...\n\nBEAMEN\nBloom like a flower?\n\nEDWARD\nYes.\n\nBEAMEN\nOh.  Here!  Right here.  Edward Bloom.  We weren't expecting you yet.\n\nStill confused...\n\nEDWARD\nYou were expecting me?\n\nBEAMEN\nNot yet.\n\nA helpful woman named MILDRED chimes in:\n\nMILDRED\nYou must have taken a shortcut.\n\nEDWARD\nI did.  It nearly killed me.\n\nBEAMEN\nMmm-hmm.  Life'll do that to you.  And truthfully, the long way _is_ easier, but it's longer.\n\nMILDRED\nMuch longer.\n\nBEAMEN\nAnd you're here now, and that's what matters.\n\nBeamen's daughter JENNY (8) hides behind her father, peering around to look at the handsome stranger.\n\nEDWARD\nWhat is this place?\n\nBEAMEN\nThe town of Spectre.  Best kept secret in Alabama.   Says here you're from Ashton, right?  Last person we had from Ashton was Norther Winslow.\n\nEDWARD\nThe poet?  What ever happened to him?\n\nBEAMEN\nHe's still here.  Let me buy you a drink.  I'll tell you all about it.  Hell, I'll have him tell you.\n\nEDWARD\nNo.  I've gotta meet somebody.  I'm already running late.\n\nHe didn't mean it as a joke, but for some reason, everyone's laughing.\n\nBEAMEN\nSon, I already told you.  You're early.\n\nINT.   BEAMEN'S HOUSE - DAY\n\nSitting at the kitchen table, Edward takes a second slice of apple pie.  He and Beamen are joined by NORTHER WINSLOW (30), who fancies himself a cultured artist, though he's never left the state.\n\nBEAMEN\nNow tell me if that isn't the best pie you ever ate.\n\nEDWARD\nIt truly is.\n\nUNDER THE TABLE\n\nYoung Jenny is stealthily untying the laces on Edward's shoes.\n\nNORTHER WINSLOW\nEverything here tastes better.  Even the water is sweet.  Never gets too hot, too cold, too humid.  At night the wind goes through the trees and you'd swear there was a whole symphony out there, playing just for you.\n\nSuddenly, Jenny YANKS OFF Edward's shoes.  She races for the door.\n\nEDWARD\nHey!\n\nHe chases after her.\n\nEXT.  TOWN / MAIN STREET - DAY  \n\nAs she runs, Jenny ties Edward's laces together.  Reaching the edge of town, she tosses the shoes up and around the power line -- a perfect throw.  There's no way he's ever getting them down.\n\nThe gathered citizens of Spectre CHEER for Edward, who is confused and overwhelmed.  The women hug him.  Men shake his hand.\n\nStill focused on his shoes...\n\nEDWARD\nWait!  I need those!\n\nNORTHER WINSLOW\nThere is no softer ground than town.\n\nMILDRED\nThat rhymes!\n\nBEAMEN\nHe is our poet laureate.\n\nThe townsfolk continue to congratulate Edward...\n\nEDWARD (V.O.)\nSometimes in a dream, you'll visit places that seem instantly familiar, filled with friends you've never met.  \n\nEXT.  UNDER A TREE - DUSK  \n\nEdward sits with Norther Winslow.  The fireflies are out.  Thousands of them.\n\nEDWARD (V.O.)\nA man might travel his entire life and never find a place so inviting.  My journey had scarcely begun, and I had arrived.\n\nNorther hands him his noteboook.\n\nNORTHER WINSLOW\nI've been working on this poem for 12 years.\n\nEDWARD\nReally.\n\nNORTHER WINSLOW\nThere's a lot of expectation.  I don't want to disappoint my fans.\n\nA beat.\n\nEDWARD\nIt's only three lines long.\n\nNorther grabs his notebook back.\n\nNORTHER WINSLOW\nThis is why you don't show work in progress.\n\nEDWARD\nNorther, do you ever regret not making it to Paris?\n\nNORTHER WINSLOW\nI can't imagine any place better than here.\n\nEDWARD\nYou're a poet.  You oughta be able to.  And maybe if you'd seen more, you could.\n\nNorther doesn't answer.  Just goes back to his notebook.\n\nEXT.  BY THE RIVER - NIGHT\n\nBy the light of the full moon, Edward soaks his feet in the water, trying to make sense of it all.  The Key to the City dangles around his neck.  \n\nHe stares at himself in the reflection.  He smiles.\n\nIt's then that a WOMAN emerges at the far side of the river.  No telling where she came from -- she must have been swimming underwater.  We never see her face.\n\nShe stands in the river with her bare back to Edward, squeezing the water out of her golden hair, oblivious to his presence.  Edward is breathless.  It's the first woman he's seen in her natural state, and he doesn't dare move lest he frighten her away.\n\nThen he sees the snake.\n\nIt's a cottonmouth, has to be.  It leaves a break in the water, its small reptilian head aiming for her flesh.  There's no decision to be made.  On pure instinct, Edward dives in.  He swims as hard as can, \n\nGRABBING THE SNAKE\n\njust as it's about to strike.\n\nThe woman dives back underwater, understandably terrified that a man is coming at her.  \n\nEDWARD\nNo, it's okay!  I got it.  I got the snake.\n\nAs the splashing subsides, Edward looks at what he holds in his hands.  Which isn't a snake at all, but rather a common stick.  And a non-threatening one at that.\n\nWhile Edward ponders his mistake, he looks around to discover that the Girl in the River is gone.  He never even saw her face.\n\nEDWARD (CONT'D)\nWait!  I'm sorry.  Hello?!\n\nEdward keeps expecting her to surface, somewhere, but she never does.  He stands alone in the river, wondering what tricks his eyes are playing on him.\n\nEXT. BY THE RIVER - NIGHT - CONTINUOUS\n\nA GIRL'S VOICE (O.S.)\nThere's leeches in there!\n\nEdward looks to the bank, where young Jenny Hill is watching him.\n\nEDWARD\nDid you see that woman?\n\nJENNY\nWhat did she look like?\n\nEDWARD\nWell, she...uh...\n\nJENNY\nWas she nekkid?\n\nEmbarrassed to admit it...\n\nEDWARD\nYeah.\n\nJENNY\n(matter-of-fact)\nIt's not a woman, it's a fish.   No one ever catches her.\n\nGiven the day he's had so far, Edward isn't inclined to follow up on the issue.  He starts to wade back to the bank.\n\nJENNY (CONT'D)\nFish looks diff'rent to diff'rent people.  My daddy said it looked like the coon dog he had when he was kid, back from the dead.\n\nEdward climbs up onto the shore, completely drenched.  He pulls up his pant legs to reveal three shiny leeches clinging to his skin.\n\nEDWARD\nShoot.\n\nHe starts to work pulling them off.\n\nEXT.  PATH BACK TO TOWN - NIGHT\n\nEdward and Jenny walk back.\n\nJENNY\nHow old are you?\n\nEDWARD\nEighteen.\n\nJENNY\nI'm eight.  That means when I'm eighteen, you'll be 28.  And when I'm 28, you'll only be 38.  \n\nEDWARD\n(a little wary)\nYou're pretty good at arithmetic.\n\nJENNY\nAnd when I'm 38, you'll be 48.  And that's not much difference at all.\n\nEager to get off this subject...\n\nEDWARD\nSure is a lot now, though, huh?\n\nEXT.  MAIN STREET - NIGHT\n\nAs Edward and Jenny approach Main Street, they find \"downtown\" has been transformed.  Lanterns and streamers hang on cables across the street, and a small stage has been built at one end to hold FIDDLERS.\n\nThe whole town is there in celebration of its newest citizen, Edward Bloom.  Before he can protest, two WOMEN have grabbed him by the arms, pulling him in to dance with them.\n\nThe resulting dance number seems both choreographed and complete chaos.  From FARMER to BAKER'S WIFE, everyone wants to dance with Edward, who finds himself tossed around like a stick caught in a whirlpool.  Still, he's having a blast.\n\nJenny grabs both his hands, and they spin wildly.\n\nBeamen plucks his LAUGHING daughter away to dance with her.   Then Mildred cuts in to dance with Edward.  It's hard to hear over the MUSIC.\n\nMILDRED\nJenny thinks you're quite a catch.  We all do.\n\nEDWARD\n(not hearing)\nWhat?\n\nMILDRED\nI said you're quite a catch!\n\nEdward stops dancing.  A beat, then he heads for the edge of the crowd.  Beamen is there, with Jenny on his shoulders.\n\nEDWARD\nI have to leave.  Tonight.\n\nBEAMEN\nWhy?\n\nEDWARD\nThis town is everything a man could ask for.  And if I were to end up here, I'd consider myself lucky.  But the fact is, I'm not ready to end up anywhere.\n\nBEAMEN\nNo one's ever left.  \n\nJENNY\nHow are you gonna make it without your shoes?\n\nEDWARD\nI suspect it will hurt a lot.\n\nAnd with that, Edward walks down Main Street.  The townspeople stop dancing, disbelieving, some shaking their heads.  \n\nPoor Edward Bloom's gone crazy.\n\nBEAMEN\n(calling after him)\nYou won't find a better place!\n\nEDWARD\nI don't expect to.\n\nJenny runs to him.  She'd tackle him if she could.\n\nJENNY\nPromise me you'll come back.\n\nEDWARD\nI promise.  Someday.  When I'm really supposed to.\n\nIt's not good enough, but it will have to do.  Edward keeps walking.\n\nEXT.  THE DARK FOREST - NIGHT\n\nVARIOUS SHOTS:   Edward negotiates the thorns in his bare feet.  It's horrible.  Almost unendurable.\n\nAnd then it gets worse.\n\nThe trees ahead are moving.  At first, it just seems to be the wind blowing the branches, but as we hear the wood CRACKING and GROANING, there's no mistaking it:  they're trying to block him.\n\nSnake-like WHITE ROOTS shoot out of the ground, grabbing for his ankles.  He leaps up, kicking off one tree trunk to grab another one's branches.  He swings off, lands and rolls.  Now all the trees are moving to block him, their dark shapes towering over him in the flashes of LIGHTNING.\n\nEDWARD (V.O.)\nAs difficult as it was to reach Spectre, I was fated to get there eventually.  After all, no man can avoid reaching the end of his life.\n\nAs he ducks under branches, the chain holding the Key to the City gets caught.  He's almost strangled, but the chain finally breaks.  The silver key disappears into the mud.\n\nScrambling forward, he looks for a way out.  But the trees have encircled him, their spiky crowns bending down to crush him. \n\nHe SCREAMS up at the night, until his breath is gone.\n\nEDWARD (V.O.) (CONT'D)\nAnd then I realized, this wasn't the end of my life.\n\nWith a sudden calm...\n\nEDWARD (CONT'D)\n(aloud)\nThis isn't how I die.\n\nAnother lightning FLASH, and suddenly the trees are back where they've always been.  Edward is lying shoeless and torn in a muddy puddle, staring up at the rain.  And LAUGHING.\n\nEXT.  THE ROAD - DAY\n\nHis bare foot steps onto asphalt.\n\nA DEEP VOICE\nFriend!\n\nEdward turns to see \n\nKARL \n\nto his right, coming down the larger, paved road.\n\nKARL\nWhat happened to your shoes?\n\nEdward looks down at his muddy, bloody feet.\n\nEDWARD\nThey got ahead of me.\n\nWith that, the men start walking down the larger road.  \n\nCROSSFADE TO:\n\nINT.  DINING ROOM - NIGHT \n\nEdward and Will sit at opposite ends of the table, with Sandra and Josephine in the middle.  Although Edward has a small plate of food in front of him, he hasn't touched it.  He's exhausted from the trip downstairs, but determined to maintain the family dinner ritual.\n\nThe other three eat awkwardly, each CLINK and SCRAPE of a knife or fork resonating.  Will finally breaks the silence.\n\nWILL\nI don't know if you've seen it, but Josephine has some photos in the most recent Newsweek.\n\nSANDRA\nReally!  That's wonderful.\n\nJOSEPHINE\nI spent a week in Morocco for the story.  It was incredible.\n\nSANDRA\nWe'll have to pick up a copy.\n\nA beat.  As Will scoops out another serving of potatoes, Edward suddenly speaks:\n\nEDWARD\nI don't know if you're aware of this, Josephine, but African parrots, in their native home of the Congo -- they speak only French.\n\nAll three stop to listen.\n\nJOSEPHINE\n(amused)\nReally.\n\nEDWARD\nYou're lucky to get four words out of them in English.  But if you were to walk through the jungle, you'd hear them speaking the most elaborate French.  Those parrots talk about everything:  politics, movies, fashion -- everything but religion.\n\nTaking the bait...\n\nWILL\nWhy not religion, Dad?\n\nEDWARD\nIt's rude to talk about religion.  You never know who you're going to offend.\n\nA beat.\n\nWILL\nJosephine actually went to the Congo last year.\n\nEDWARD\nOh, so you know.\n\nINT.  GROCERY STORE - NIGHT\n\nWill shakes a shopping cart free from the pile-up while his mother checks her list.\n\nAT THE PRODUCE SECTION\n\nSandra starts to bag string beans.\n\nWILL\nMom, would you say you understand Dad?\n\nSANDRA\nOf course.\n\nWILL\nWhat I mean is, do you really know what's going on in his head?\n\nSANDRA\nYes.\n\nWILL\nHow is that possible?  I mean, you try to ask him a question and suddenly it's another one of his stories.\n(decidedly)\nYou can't honestly say you know him.\n\nSANDRA\nYes, Will, I do.  And don't presume things you don't know.\n\nShe's more amused than annoyed, but Will is entering dangerous territory.\n\nSANDRA (CONT'D)\nWould you say you understand Josephine?\n\nWILL\nYes.  But that's a different...\n\nSANDRA\nNo it's not.  It's exactly the same.  Your father and I met, we dated, and we married -- we chose each other -- because we understood each other on some fundamental level.  Just the same as you two.  \n\nShe moves on to the carrots.\n\nWILL\nJosephine and I have a lot in common.\n\nSANDRA\nYes, you both think William Bloom is a very smart man.\n(beat)\nThe problem is, you only see me as your mother, and not as someone's wife.  And I've been his wife longer than I've been your mother.  You can't discount that.\n\nWILL\nTrue.  But I've known him my whole life, and I don't feel like I know him at all.  Or ever will.\n\nWith a look, Sandra acknowledges the stakes.\n\nSANDRA\nI know it's not easy.  Just remember, he didn't choose to be your father and you didn't choose to be his son.  You just ended up together.  You could pick numbers out of a dark bag and it'd be just the same.  If you ask me, it's a wonder parents and children can stand each other at all.\n\nWILL\nBut I understand you, Mom.  I always have.\n\nSANDRA\nWell, clearly you don't.  But I'm not the mystery you're trying to solve right now.\n\nINT.  AT THE CHECKOUT - NIGHT\n\nReaching the CASHIER, Sandra hands over her coupons.  Will is approaching with a Newsweek magazine.\n\nTwo checkstands over, an ATTRACTIVE BLONDE WOMAN in her 50's is getting her change.  Though she's Sandra's generation, she carries herself like a much younger woman, with blue jeans and sneakers.\n\nShe accidentally makes eye contact with Will as he passes.  We HOLD ON the woman, who tracks Will as he reaches Sandra.  It's hard to read her reaction:  does she recognize him, or just find him attractive? \n\nWill notices the gaze.  The woman turns away.\n\nWill racks his brain -- does he know this woman?\n\nSANDRA\nBefore I forget, your father has papers in the basement I'd like you to go through.  I wouldn't know what's important.\n\nWILL\n(distracted)\nMom, do you know who that is?  Blonde hair.\n\nSandra looks.  After a beat, the Blonde Woman turns again, semi-casually.  Noticing that both Will and Sandra are looking, she smiles a little before taking her cart to leave.\n\nSANDRA\n(no idea)\nWas she one of your teachers?\n\nWILL\nNo.  But it's weird.  She seemed to recognize me.\n\nSANDRA\n(to the cashier)\nDo you know who that is?\n\nThe Cashier turns to look.  He can only get a profile as the woman leaves.\n\nCASHIER\nNever seen her before.  Pretty, though.\n\nINT.  GUEST BEDROOM - NIGHT\n\nA portable fan quietly WHIRRS in the corner.  Turned low, the RADIO on the nightstand is playing a call-in AM sports show, just a wash of background chatter.  Edward lies asleep on his back.  \n\nAt the window, Josephine quietly lowers the shade.  She reaches over Edward to switch off the radio.  He stirs from the silence -- he wasn't fully asleep -- and sees Josephine stretched over him.\n\nEDWARD\n(playfully lecherous)\nHello.\n\nShe smiles.\n\nJOSEPHINE\nHi.  How are you feeling?\n\nEDWARD\nI was dreaming.\n\nJOSEPHINE\nWhat were you dreaming about?\n\nHe tries to recollect, but it's already gone.  Josephine motions, is it okay for her to sit on the bed?  He nods.\n\nEDWARD\nI don't usually remember unless they're especially portentous.  You know what that word means, portentous?\n\nShe shakes her head.\n\nEDWARD (CONT'D)\nMeans when you dream about something that's going to happen.  \n(beat, gathering)\nLike one night, I had a dream where this crow came and told me, \"Your Aunt is going to die.\"  I was so scared I woke up my parents.  They told me it was just a dream, to go back to bed.  But the next morning, my Aunt Stacy was dead.\n\nJOSEPHINE\nThat's terrible.\n\nEDWARD\nTerrible for her, but think about me, young boy with that kind of power.  Wasn't three weeks later that the crow came back to me in a dream and said, \"Your Grampa is going to die.\"  Well, I ran right back to my parents.  My father said, no, Gramps is fine, but I could see there was trepidation.  And true enough, that next morning my Grampa was dead. \n\nHe sits up a bit in bed, his strength returning.\n\nEDWARD (CONT'D)\nFor the next couple weeks, I didn't have another dream.  Until one night the crow came back and said, \"Your Daddy is going to die.\"  \n(beat)\nWell, I didn't know what to do.  But finally I told my father.  And he said not to worry, but I could tell he was rattled.  That next day, he wasn't himself, always looking around, waiting for something to drop on his head.  Because the crow didn't tell how it was going to happen, just those words:  your Daddy is going to die.  Well, he went into town early and was gone for a long time.  And when he finally came back, he looked terrible, like he was waiting for the axe to fall all day.  He said to my mother, \"Good God.  I just had the worst day of my life.\"\n(beat)\n\"You think _you've_ had a bad day,\" she said.  \"This morning the milkman dropped dead on the porch!\"\n\nJosephine smiles, a half-laugh, which gets him smiling too.  \n\nA long beat.  Then, deadpan...\n\nEDWARD (CONT'D)\nBecause see, my mother was banging the milkman.\n\nJOSEPHINE\nNo, I understand.\n\nEDWARD\nHe was slipping her a little extra cream.\n\nShe nods, a bit more of a laugh.\n\nEDWARD (CONT'D)\nHe was filling her basket.  He was making deliveries around back.  \n\nAs Edward continues, she can't help but laugh harder, especially as the metaphors get more vulgar.\n\nEDWARD (CONT'D)\nHe was buttering her rolls.  Pumping her churn.  Splashing milk in her box.\n\nJOSEPHINE\nStop.\n\nEDWARD\nThey were squeezing the cheese.  Clanking the bottles.  Licking the popsicle.\n\nShe's starting to cry from laughing. \n\nEDWARD (CONT'D)\nCracking the eggs and making an omelet.\n\nWith that, he stops.  She regains her composure.\n\nEDWARD (CONT'D)\nSpooning the sherbet.\n\nJOSEPHINE\n(interrupting)\nCan I take your picture? \n\nEDWARD\nYou don't need a picture.  Just look up handsome in the dictionary.\n\nJOSEPHINE\nPlease?\n\nHe rolls his eyes, why not.\n\nJosephine leaves, heading down the hall to get her camera.  We STAY WITH Edward in bed.\n\nJOSEPHINE (O.S.) (CONT'D)\nI have photos from the wedding to show you.  There's a great one of you and my father.  I had an extra print made.\n\nEdward grimaces, a flash of pain.  Around others, he's hiding how much it hurts, but alone we can see how bad it is.\n\nHe controls his breathing, trying to push through it.\n\nJOSEPHINE (O.S.) (CONT'D)\nI want to see pictures of your wedding.  I've never seen any.\n\nShe returns with her camera.  Edward smiles, doing a good job masking the pain.\n\nEDWARD\nThat's because we didn't have a wedding.  Your mother-in-law was never supposed to marry me.  She was engaged to somebody else.\n\nJOSEPHINE\n(loading film)\nI never knew.\n\nEDWARD\nWill never told you that?\n(she shakes her head)\nProbably just as well.  He would have told it wrong anyway.  All the facts and none of the flavor.\n\nJOSEPHINE\nOh, so this is a tall tale?\n\nEDWARD\nWell, it's not a short one.\n\nA devilish smile.  Pushing past Edward, we settle on the whirling fan.\n\nMATCH CUT TO:\n\nA SPINNING PINWHEEL\n\nheld by a LITTLE BOY.  He's slumped over his FATHER's shoulder, being carried towards a big-top tent.  We are...\n\nEXT.  OLYMPIA CIRCUS - NIGHT\n\n...where the second-rate carnival is parked for the moment in an Alabama field.  To the left, we spot Edward, 20-ish, halfway through a bag of peanuts.  He's still carrying the backpack we saw earlier, and scratched up from his trip through Spectre.\n\nEDWARD (V.O.)\nI had just left Ashton, and was on my way to discover my destiny.  Not knowing what that would be exactly, I explored every opportunity that presented itself. \n\nJoining the crowd, he heads into the big-top.\n\nINT.  BIG TOP - NIGHT\n\nA troupe of STILT-WALKING FIREBREATHERS finishes their act to tremendous APPLAUSE.  \n\nAs the performers clear away, the circus' owner-and-ringmaster AMOS CALLOWAY (50) approaches the stands.  He may only be four feet tall, but Amos has a titanic presence.\n\nAMOS\nLadies and Gentlemen, you may think you've seen the _unusual_.  You may think you've seen the _bizarre_.  But I've travelled to the five corners of the world, and let me tell you, I've never seen anything like this.\n\nFrom behind Amos, CARNIES start rolling a massive ball towards the crowd.\n\nAMOS (CONT'D)\nWhen I found this man, he was picking oranges in Florida.  His fellow workers called him El Penumbra -- The Shadow -- because when you were working beside him, he blocked out the daylight.  He could take a whole tree in his hands and shake off the fruit.  I had to pay his crew boss $10,000 just so I could take him with me.\n\nAmos comes up to a MIDDLE-AGED WOMAN in the first row, a quieter moment.\n\nAMOS (CONT'D)\nNot to alarm you, Ma'am.  But if this man wanted to, he could crush your head between his toes.\n(she trembles)\nBut he won't.\n(a long beat)\nHe's not going to hurt her, folks, because he's our own Gentle Giant.  Ladies and Gentlemen, I give you Colossus!\n\nThe carnies back away from the ball as a deep DRUM ROLL begins.  A moment, then the ball starts to bulge from inside.\n\nA foot suddenly bursts out from within.  GASPS from the crowd.  That foot is massive.  In the stands, Edward looks closer.  Intrigued.\n\nAs the drum beat intensifies, a second foot breaks out.  Followed by hands.  Shoulders.  Finally, the head.  This is COLOSSUS.\n\nFrom a very LOW ANGLE, we look up to see just how massive he is.  He seems to fill the Heavens.  With his shaved head and giant club, he seems more ogre than man.   \n\nIn the bandstands, a YOUNG BOY's jaw drops in awe.  Colossus walks down the row, letting the crowd get a better look at him.  Some reach out to touch him, disbelieving.  A tight spotlight follows him, revealing faces in the crowd.  \n\nColossus passes Edward, who seems unimpressed.  He leans with the spotlight, WHISTLING to get the big man's attention.  \n\nHe points to the edge of the stands, where his friend is sitting on the dirt --\n\nKARL THE GIANT\n\nstands up, so big the spotlight has to widen just to hold him.  He's a good foot taller than Colossus.  There's a GASP from the crowd, along with nervous anticipation -- what will happen next?\n\nANGLE ON Amos, stunned, megaphone dangling.\n\nANGLE ON Colossus, realizing the gig is up.  With a resigned shrug, he rests his club on his shoulder and walks away into the shadows.\n\nCUT TO:\n\nINT.  BIG-TOP - NIGHT / LATER\n\nAs the stands empty, Edward and Karl talk to Amos.\n\nAMOS\nWhat's his name?  Does he talk?  It's not important.\n\nKARL\nKarl.\n\nAMOS\nTell me Karl, have you ever heard of the term  \"involuntary servitude?\"\n\nKarl shakes his head.\n\nAMOS (CONT'D)\n\"Unconscionable contract?\"\n\nNope.\n\nAMOS (CONT'D)\nGreat, great.  That's fantastic.\n\nEDWARD (V.O.)\nIt was on that night Karl met his destiny.  And I met mine.  Almost.\n\nINT. BIG TOP - NIGHT - CONTINUOUS\n\nAs Amos pulls Karl aside to give him the hard sell, Edward notices a BEAUTIFUL YOUNG WOMAN (16) leaving with her family.  She's wearing a blue dress and hat.  For no good reason, she looks back at Edward.  \n\nThe two make eye contact.  And as they do, all motion FREEZES.  \n\nA fiery baton remains mid-twirl, flames locked in place.  A spilled box of popcorn hangs in mid-air, each kernel like a snowflake.  Even the elephant is mid-poop.\n\nOnly Edward is free to move, winding his way between the frozen bodies, ducking underneath arms to get closer and closer to this woman.\n\nEDWARD (V.O.)(CONT'D) \nThey say when you meet the love of your life, time stops.  And that's true.  What they don't tell you, is that once time starts again, it moves extra fast to catch up.\n\nSuddenly, everything RUSHES.  The crowd becomes a blur, and the young woman is lost in its wake.  Now it's Edward who's frozen, helpless in time.\n\nEXT.  DIRT PARKING LOT - NIGHT\n\nEdward checks in windows as cars pull out, searching for his fated love.  Not finding her, he becomes more frantic, running down the rows.\n\nCROSSFADE TO:\n\nTHE EMPTY LOT\n\nColossus is thumbing for a ride.  The last pickup truck stops and lets him climb in back.\n\nAs the truck pulls out, it passes a dejected Edward.  He'll never find that girl, the love of his life.\n\nINT.  BIG-TOP - NIGHT\n\nAmos leans over so Karl can sign a contract on his back.  He spots Edward walking back into the tent.\n\nAMOS\nHey kid!  Your friend just made himself a star.\n\nEDWARD\nThat's great.\n\nAmos hands off the contract to a CLOWN.\n\nAMOS\n(introducing)\nMy attorney, Mr. Soggybottom.\n\nEDWARD\nGood to meet you.\n\nMr. Soggybottom HONKS his horn, then waddles off.\n\nAMOS\nWhat's the matter with you, kid?  I haven't seen a customer so depressed since the elephant sat on that farmer's wife.\n(beat)\nGet it?  \"Depressed?\"\n\nKarl chuckles.\n\nAMOS (CONT'D)\nSee!  The big guy likes it.\n\nEDWARD\nI just saw the woman I'm going to marry, I know it.  But then I lost her.\n\nAMOS\nTough break.  Most men have to get married before they lose their wives.\n\nEDWARD\n(with absolute conviction)\nI'm going to spend the rest of my life looking for her.  That or die alone.\n\nAMOS\nJesus, kid.\n(realizing)\nLet me guess.  Real pretty, blonde hair, blue hat?\n\nEDWARD\nYes!\n\nAMOS\nI know her uncle.  Friends of the family.\n\nEDWARD\nWho is she?  Where does she live?\n\nAMOS\nKid.  Don't waste your time.  She's out of your league.\n\nAs Amos starts to walk away, Edward hurries to catch up with him.  Karl follows as well.\n\nEDWARD\nWhat do you mean?  You don't even know me.\n\nAMOS\nSure I do.  You were hot shit back in Hickville, but here in the real world, you got squat. You don't have a plan.  You don't have a job.  You don't have anything but the clothes on your back.\n\nEDWARD\nI've got a whole backpack _full_ of clothes!\n\nHe points to the bleachers, where no backpack is to be found.\n\nEDWARD (CONT'D)\n(realizing)\nSomeone stole my backpack.\n\nAMOS\nKid, you were a big fish in a small pond.  This here is the ocean, and you're drowning.  Take my advice and go back to Puddleville.  You'll be happy there.\n\nGetting in front of Amos, Edward stops him.\n\nEDWARD\nWait.  You said I don't have a plan.  I do.  I'm going to find that girl and marry her and spend the rest of my life with her.  \n\nAmos smiles, amused.\n\nEDWARD (CONT'D)\nI don't have a job, but I would have a job if you gave me one.  And I may not have much, but I have more determination than any man you're ever going to meet.\n\nAMOS\nSorry, kid.  I don't do charity.\n\nEDWARD\nI'll work night and day, and you won't have to pay me.  You just have to tell me who she is.\n\nAmos takes a long look at him.  Ultimately, there's no way he can say no.  He shrugs.  What the hell.\n\nAMOS\nEvery month you work for me, I'll tell you one thing about her.  That's my final offer.\n\nEdward shakes Amos's hand before he can retract the offer.  We move into a MONTAGE:\n\nINT.  BIG TOP CENTER RING - NIGHT\n\nCLOSE ON Edward, smiling nervously.  His head is tilted to the side, and as we PULL BACK, we see why:  he's holding it in a MASSIVE LION's open mouth.  The beast's sharp teeth are just poking his skin.  If the lion so much as flinches, Edward is dead.\n\nThe CROWD applauds, which makes the lion antsy.  Which makes Edward antsier.\n\nEDWARD (V.O.)\nFrom that moment on, I did everything Mr. Calloway asked, and a lot of things he didn't.  I'd go three days without stopping to eat, and four days without sleeping.\n\nEXT.  THE HYDRA - DAY\n\nHis eyes droopy from lack of sleep, Edward mans the whirling amusement park ride.\n\nEDWARD (V.O.)\nThe only thing that kept me going was the promise of meeting the girl who would be my wife.\n\nNodding off, Edward falls backward, into the path of the spinning arms.  One of the Hydra cars hits him square in the gut, throwing him up and away, sailing 200 feet through the air.\n\nEXT.  FIELD - DAY  \n\nEdward chases a costumed pig, tripping over tent cords, falling in the mud.\n\nHis hunt leads him through the back of a tent, where he's unwittingly stepped in front of a line of motorized birds.  To the left, CUSTOMERS are shooting with rifles.  He dodges four SHOTS that knock down the birds around him.\n\nHe catches his breath, lucky.\n\nThen a half-blind OLD WOMAN pulls her trigger, hitting him in the shoulder.\n\nEXT.  BEHIND A TENT - DAY\n\nKarl the Giant bandages Edward's arm as well as he can.  Amos is walking past.\n\nEDWARD\nMr. Calloway!  It's been a month today.\n\nAmos stops, looks at the young man.  Finally...\n\nAMOS\nThis girl, the love of your life.  Her favorite flower is daffodils.\n\nHe walks away.  We PUSH IN on Edward, enraptured by the concept.\n\nEDWARD\nDaffodils.  \n(to Karl)\nDaffodils!\n\nINT.  STABLES - DAY\n\nEdward shovels shit in the nastiest stables you've ever seen.  But all he can think about is...\n\nEDWARD\n(to himself)\nDaffodils!\n\nThe wonder of it.  He goes back to shoveling, a smile on his face.\n\nEDWARD (V.O.)(CONT'D)\nTrue to his word, every month Amos would tell me something new about the woman of my dreams.\n\nINT.  A DARK PLACE - NIGHT  \n\nCLOSE ON Edward, lost in quiet reverie, pondering his latest bit of information.\n\nEDWARD\nCollege!  She's going to college!\n\nA sudden EXPLOSION as Edward is shot...\n\nINT.  BIG TOP - NIGHT [CONTINUOUS]\n\n...out of a giant cannon.\n\nINT.  STABLES - NIGHT\n\nUnder a full moon, Edward feeds the animals.  \n\nEDWARD\n(to himself)\nMusic!  She likes music.  I like music too!\n\nEDWARD (V.O.)\nOver the months, I learned a lot about the woman I was going to marry, but not her name, and not where to find her.  That time had come.  I couldn't wait any longer.\n\nEXT.  AMOS CALLOWAY'S TRAILER - NIGHT\n\nUnder a full moon, Edward walks up to the battered camper, and is about to knock when he notices it's rocking.  A lot.  Not just that, there's MOANING coming from inside.\n\nBut Edward KNOCKS anyway.\n\nEDWARD\nMr. Calloway!  It's Edward Bloom.  I need to talk to you.\n\nSuddenly, the rocking and moaning stop.  A beat, then the door handle begins to RATTLE.  It seems to be stuck.\n\nEdward turns the knob.\n\nSuddenly, the door BURSTS OPEN.  Edward is knocked down by a massive black dog, biggest you've ever seen.  It has green glowing eyes and a lick of fire for a tongue.\n\nEdward wrestles with the beast, its mouth snapping at his throat.  Blocking with an arm, Edward tries to push himself free, but the creature's hands -- it has hands instead of paws -- hold on tight.\n\nEntwined, they roll across the dirt.  The other nearby CARNIES scatter for cover.   Mr. Soggybottom pulls a revolver out of his clown suit.  Loads a silver bullet.\n\nEdward finally succeeds in throwing the beast off.  He rolls to his feet.  \n\nThe hell hound squares back on its haunches, GROWLING, ready for another leap.  Mr. Soggybottom sheds a clown tear, aiming the revolver at the dog.\n\nAt the last moment...\n\nEDWARD (CONT'D)\nNo, wait!\n\nEdward moves just as Mr. Soggybottom FIRES.  The bullet catches Edward in the shoulder, knocking him down.\n\nThe carnies GASP.\n\nLicking its chops, the dog approaches the helpless Edward, who feels the ground around him, looking for some kind of weapon.  He finds only a small stick.  He waves it at the dog, ready to strike it.\n\nLike magic, the dog's whole demeanor changes.  It bounces excitedly, ready to play fetch.\n\nSeeing an opportunity, Edward throws the stick as far as he can.  The dog bounds after it, \n\nSMASHING DOWN THREE CARS.   \n\nIt returns a beat later with the flaming stick, which it drops at Edward's feet.  Its tail whips back and forth.\n\nEDWARD (V.O.) (CONT'D)\nIt was that night I discovered that most things you consider evil or wicked are simply lonely, and lacking in the social niceties.\n\nEdward throws the stick again.  The dog takes off in a new direction.\n\nTRANSITION TO:\n\nEXT.  FIELD - PRE-DAWN\n\nExhausted from playing fetch all night, Edward throws the stick into the woods.  The still-spry dog goes after it.  It's gone for a long time, long enough that Edward becomes concerned.\n\nHe follows it into the woods.\n\nINT.  WOODS - DAWN\n\nAmos Calloway stands up behind a bush, buck naked and hairy.  He still has the stick in his mouth, which he takes out as Edward approaches.\n\nAMOS\nDidn't kill anything, did I?\n\nEDWARD\nA few rabbits, but I think one of them was already dead.\n\nAMOS\nThat would explain the indigestion.\n\nEdward tosses him his jacket to cover his privates.\n\nAMOS (CONT'D)\nI was wrong about you kid.  You may not have much, but what you got, you got a lot of.  You could get any girl.\n\nEDWARD\nThere's only one I want.\n\nA beat.\n\nAMOS\nHer name is Sandra Templeton.  She's going to Auburn.  The semester's almost over, so you better hurry.\n\nEDWARD\nThank you.\n\nAMOS\nGood luck, kid.\n\nEdward walks away.  Then starts running.  He has to get there as soon as possible.\n\nAmos sits down and scratches his ear with his foot.\n\nEXT.  BIG TOP - DAY  \n\nEdward shakes Karl's giant hand.  They hug.\n\nEDWARD (V.O.)\nAfter saying my goodbyes, I hopped three trains to get to Auburn that afternoon.\n\nEXT.  AUBURN UNIVERSITY - DAY\n\nWe DESCEND ON the main quad, to find Edward Bloom dunking his head in the fountain.\n\nHe changes out of his grubby shirt into a new one, just out of the package.  It's the mid-1960's, but by the conservative dress of the passing STUDENTS, it could be any era. \n\nEXT.  SORORITY HOUSE - DAY\n\nEdward stands with a bouquet of daffodils in front of a half-open door.  Through the crack we can see the edge of a YOUNG WOMAN, talking in hushed tones with another girl we can't see. \n\nFinally, a decision is reached.  The door opens to reveal the woman of Edward's dreams, Sandra Kay Templeton.  She's effortlessly beautiful, pure and simple as sunlight.\n\nHe can't believe he's finally reached her.  He half-laughs, nervous.  That makes her laugh, not sure what's going on.\n\nEDWARD\nYou don't know me, but my name is Edward Bloom and I am in love with you.  I've spent the last three years working to find out who you are.  I've been shot and stabbed and trampled a few times, had my ribs broken twice, but it's all worth it to see you here, now, and to finally get to talk to you.  Because I am destined to marry you.  I knew that from the first moment I saw you at the circus.  And I know it now more than ever.\n\nON SANDRA, overwhelmed.  All she can finally think of to say is...\n\nSANDRA\nI'm sorry.\n\nEDWARD\nDon't need to apologize to me.  I mean, I'm the luckiest person you're going to find today...\n\nShe puts her hand on the door frame.  On her left ring finger, we see a diamond.\n\nSANDRA\nNo I'm sorry, I...I'm engaged to be married.\n\nON EDWARD as his heart falls 20 floors.  He tries to suppress the reaction, put on a brave front.\n\nEDWARD\nOh.\n\nSANDRA\nBut you're wrong.  I _do_ know you, at least by reputation.  Edward Bloom from Ashton.  See, I'm actually engaged to a boy from Ashton.  Don Price.  He was a few years older than you.\n\nFLASHCUTS TO:\n\nEXT. CREEPY OLD HOUSE - THE GATE - NIGHT  \n\nYoung Don Price shines his flashlight on Edward.\n\nVARIOUS H.S. ATHLETIC COMPETITIONS\n\nRecapping earlier football, baseball and basketball highlights, we find Edward beats Don every time.\n\nTHE STREET CORNER / ASHTON PARADE\n\nA smoking Don Price crushes his cigarette as Edward leaves town.\n\nBACK TO:\n\nEXT/INT. SORORITY HOUSE - THE DOORWAY\n\nEdward is dumbstruck.  With all the strength he can muster...\n\nEDWARD\nWell.  Congratulations.  I'm sorry to have bothered you.\n\nHe turns and walks down the front steps. \n\nShe stays in the doorway for a few beats, feeling genuinely horrible for what's happened.  But eventually she goes back inside.  We hear GIGGLES from inside as her sorority sisters get to the bottom of this.\n\nSANDRA\nStop it.  It's not funny.  That poor boy.\n\nWe LEAD Edward as he walks away, tears just starting to form.  \n\nEDWARD (V.O.)\nFate has a cruel way of circling around on you.  After all this work to leave Ashton, the girl I loved was now engaged to one of its biggest jerks.\n\nHe EXITS FRAME, leaving only the sorority house in the background.\n\nEDWARD (V.O.) (CONT'D)\nThere's a time when a man needs to fight, and a time when he needs to accept that his destiny is lost, that the ship has sailed, and that only a fool would continue.\n\nA beat.  Edward steps back INTO FRAME, looking at the sorority house.\n\nEDWARD (V.O.) (CONT'D)\nThe truth is, I've always been a fool.\n\nWe CIRCLE as he shouts:\n\nEDWARD (CONT'D)\nSandra Templeton!  I love you!  And I am going to marry you!\n\nINT.  SORORITY HOUSE FOYER - DAY\n\nSandra and her SISTERS peer out through the curtains.  Is this guy crazy?\n\nINT.  LECTURE HALL - DAY\n\nThe tweedy ECONOMICS PROFESSOR continues his explanation.  Sandra isn't paying a lot of attention.\n\nHe switches on the overhead projector without looking at it.  There's a TITTER from the STUDENTS, but he doesn't notice.\n\nA classmate nudges Sandra, who looks up.  Written on the projector is \"I Love Sandra Templeton.\"  She's horrified and excited at the same time.   The professor finally notices what's written there.\n\nEXT.  QUAD - DAY\n\nWalking with her books, Sandra shakes her head, disbelieving.  We look up to the blue sky, where a giant sky-written heart floats in the wind.\n\nINT.  SANDRA'S BEDROOM - [THE NEXT] MORNING\n\nAt her Sisters' prompting, a just-woken Sandra looks out the second-story window to find the lawn filled with \n\nTEN THOUSAND DAFFODILS.\n\nEdward stands amid the sea of flowers.  He's waited there six hours.\n\nEXT.  SORORITY HOUSE - DAY\n\nSandra walks out to him.  She's smiling, confused, joyful and scared.  All down Greek Street, STUDENTS are coming out to see the display.\n\nSANDRA\nDaffodils?\n\nEDWARD\nThey're your favorite flower.\n\nSANDRA\nHow did you get so many?\n\nEDWARD\nI called everywhere in five states and explained this was the only way I could get my wife to marry me.\n\nOut of nowhere, a tear drops down Sandra's cheek.  She wipes it off.\n\nSANDRA\nYou don't even know me.\n\nEDWARD\nI have the rest of my life to find out.\n\nFrom down the street...\n\nA MAN'S VOICE\nSandra!\n\nSANDRA\nIt's Don.  Promise me you won't hurt him.\n\nEDWARD\nIf that's what you want, I swear to it.\n\nThe adult DON PRICE arrives.  He's 230 pounds of football-playing, Skynard-loving, fraternity-proud muscle.  And he's pissed.\n\nA gang of his BROTHERS walk behind him.\n\nDON PRICE\nBloom!\n\nEDWARD\nDon.\n\nDON PRICE\nWhat the hell are you doing?  This is my girl.  Mine!\n\nEDWARD\nI didn't know she belonged to anybody.\n\nDon Price decks him, knocking him down.  Edward gets right back up, but makes no move to defend himself.\n\nUnfazed, Don slugs him again.\n\nSANDRA\nStop it!\n\nDON PRICE\n(ignoring)\nWhat the matter, Bloom?  Too scared to fight back?\n\nEDWARD\nI promised I wouldn't.\n\nA beat.  Don shrugs, fine.  Then proceeds to kick Edward's ass nine ways to Sunday.\n\nEDWARD (V.O.) (CONT'D)\nWhile I took the beating of a lifetime, it was Don Price who was ultimately defeated.\n\nAs the ass-whupping continues, we\n\nINTERCUT WITH:\n\nINT.  FRATERNITY HOUSE BATHROOM - DAY [FLASHFORWARD]\n\nSitting on the can, Don Price pinches a loaf while reading the new Playboy.\n\nEDWARD (V.O.)\nAll the physical activity had worsened a congenital valve defect.  Put simply, his heart wasn't strong enough.\n\nDon Price squeezes down hard, trying to shit the unshittable.  Suddenly, he grasps his chest and collapses face-first on the tile.\n\nMATCH CUT TO:\n\nEXT.  WITCH'S HOUSE / GATE - NIGHT [FLASHBACK]\n\nThe same image of Don's dead face on the tile is reflected in The Eye.  \n\nRETURNING BACK TO:\n\nEXT.  THE SORORITY HOUSE - DAY\n\nThe thrashing continues.   Edward somehow fights his way back to his feet, ready to be knocked down again.\n\nSANDRA\nDon!\n\nDon is about to slug Edward again when he turns.  \n\nSandra pulls off her engagement ring.  There's an audible AHH! from her sisters, and an OHH! from Don's brothers.\n\nSANDRA (CONT'D)\nI will never marry you.\n\nA beat.  Don stands stunned, his mind reeling.\n\nEdward, whose eyes are swollen almost shut, keeps waiting for the next punch.  Where is it?  What's going on?\n\nDON PRICE\nWhat.  You love this guy?\n\nSANDRA\nHe's almost a stranger and I prefer him to you.\n\nShe hands him the ring.  Another beat, then Don storms off.  But not before decking Edward one last time.  \n\nSandra leans over Edward's broken body.  His head lies on the daffodils.\n\nSANDRA (CONT'D)\nHow can I convince you to stop?\n\nEDWARD\nGo out with me.\n\nHe smiles, his teeth bloody.\n\nSANDRA\nOkay.\n\nAs the crowd of students APPLAUDS and CHEERS, we CRANE UP above the flowered battlefield.\n\nEDWARD (V.O.)\nAs it turned out, Sandra was able to keep her same date at the chapel.  Only the groom had changed.\n\nAs the MUSIC reaches a crescendo, we suddenly...\n\nCUT TO:\n\nINT.  GUEST ROOM - NIGHT [PRESENT]\n\nJOSEPHINE\nI thought you said you didn't have a church wedding.\n\nEDWARD\nWell, we were all set to, but there was a complication.\n\nHe reaches for his glass of water, but Josephine already has it for him.  She watches him while he slowly drinks the entire glass, thirstier than he imagined.  While he's drinking, we...\n\nCUT TO:\n\nINT.  UPSTAIRS HALLWAY - NIGHT [CONTINUOUS]\n\nWill, back from the grocery store, reaches the top of the stairs.  He hears voices coming from the bedroom.\n\nJOSEPHINE (O.S.)\nIs it the medicine that's making you thirsty?\n\nEDWARD (O.S.)\nTruth is, I've been thirsty my whole life.  Never really known why.\n\nWill quietly approaches the door, not exactly sneaking, but not exactly announcing his presence.  The door is open a few inches, letting him look in on his father and his wife.\n\nINTERCUT HALLWAY / BEDROOM\n\nEDWARD (CONT'D)\nThere was one time when I was eleven...\n\nJOSEPHINE\n(gently)\nYou were talking about your wedding.\n\nEDWARD\nI didn't forget.  I was just working on a tangent.  See, most men, they'll tell a story straight through, and it won't be complicated, but it won't be interesting either.\n\nJOSEPHINE\nI like your stories.\n\nEDWARD\nAnd I like you.  \n\nHe doesn't let the moment linger with undue sentimentality.  There's a story to be told.\n\nEDWARD (CONT'D)\nNow.  The thing about working for a circus is you don't have a regular address, and after three years I had a lot of undelivered mail. \n\nIn the hallway, Will shifts to a new position, letting himself listen to the story one more time.\n\nEDWARD  (CONT'D)\nDuring the four weeks I was in the hospital, the postmaster finally caught up with me.\n\nINT.  HOSPITAL - DAY\n\nBruised and bandaged, Edward sorts through a big bag of mail with help from Sandra.  He rips open an official-looking letter.  Reading it, his face drops.\n\nFLUTE and DRUM, music rising to a military cadence.\n\nEDWARD (V.O.)\nIt turned out that while my heart belonged to Sandra, the rest of my body belonged to the U.S. Government.\n\nINT.  ARMY AIRPLANE - NIGHT\n\nWith a buzz cut and paratrooper gear, Edward squats with a dozen other SOLDIERS.  The noise of the ENGINES is deafening, but Edward is engrossed in an Asian phrasebook.\n\nEDWARD (V.O.)\nA hitch in the Army was up to three years at that point, and having waited three years just to meet Sandra, I knew I couldn't survive being away from her that long.  So I took every hazardous assignment I could find, with the hope of getting my time down to less than a year.\n\nThe JUMP LEADER yells...\n\nJUMP LEADER\nGO!  GO!  GO!\n\nOne by one the men jump out, their chutes clipped to a main line.  When his time comes, Edward leaps...\n\n...but he's stuck.  His cord is caught up in the assembly.\n\nHe twists and struggles, trying to free himself.  Looking down, he can see the white parachutes disappearing into the darkness.  They're already long gone.\n\nDigging a knife out of his pocket, Edward gets to work cutting through the cable.  It finally POPS.  Edward jumps from the plane.\n\nEXT.  OUTSIDE STAGE - NIGHT\n\nA THOUSAND CHINESE SOLDIERS sit, bored, watching the equivalent of a U.S.O. show.  \n\nA CHINESE VENTRILOQUIST is on stage with his Communist puppet.  We have no idea what they're saying to each other, but every act is fundamentally the same.\n\nThe EMCEE comes on to usher him off the stage before he's finished.  The Ventriloquist protests, but finally gives in.  The Emcee makes a \"shoot him in the neck\" motion to one of the ARMED GUARDS off-stage.\n\nEXT.  HIGH ABOVE THE STAGE - NIGHT\n\nWe LOOK DOWN with Edward, who is drifting right for the stage.  He can't steer.  He's helpless.  \n\nBut then, a BLAST of fireworks from the sides of the stage.  The lights go out as a DRUM ROLL begins.  It's just enough cover for Edward to remain unseen.\n\nHe lands with a CLANG on the lighting catwalk above the stage.  He barely grabs on, disconnecting his chute just as the curtain goes up.  Edward looks out at the sea of excited soldiers.  Every one of them would kill him.  He's the legless cricket left on the anthill.\n\nEXT. ON STAGE\n\nThe curtain rises to reveal PING (27) at a microphone.  She's as gorgeous a woman as you'll ever see.\n\nShe stands with her hips turned in profile.  Her body is a knockout, dress cut to reveal skin.  The soldiers are on their feet, WHISTLING and HOLLERING.\n\nUP ON THE CATWALK, Edward is surprised by an ENEMY SOLDIER.  The two men begin to SCUFFLE.  \n\nMUSIC starts, a vampy torch song.  Ping sings melody while an off-stage voice carries perfect harmony.\n\nPING\n*Sometimes a girl can feel so alone\nWithout a lover to call her own.\nSometimes it's so bad, she wants to explode.\nWants to grab the first man she sees and tear off his clothes.*\n\nA ROAR from the soldiers.  She knows what they want.\n\nStill fighting, Edward jumps for a pole on the far side of the catwalk, sliding down it to end up \n\nBACKSTAGE.\n\nHis determined opponent follows him down.\n\nPING (CONT'D)\n*But she won't.\nNo, she can't.\nShe needs a special **special** different unusual man.\nBecause that girl,\nWho looks like me,\nShe has wants, but she has needs.*\n\nPING  (CONT'D)\n(speaking)\nAny of you got needs?\n\nThe soldiers ROAR LOUDER, STOMPING on the bleachers.\n\nBackstage, the two men are still fighting.\n\nPING  (CONT'D)\n(chorus)\n*I've had twice the adventure,\nCried double the tears.\nTwo times the bad times in half the years.\nI need a strong man, because I've got\nTwice the love to give.*\n\nFor the first time, Ping turns, and now we see why she was standing in profile.  Ping is one-half of \n\nSIAMESE TWINS.\n\nHer identical twin is JING, who's been singing harmony all this time.  They are two separate women who join at the waist, one set of perfect legs beneath them.\n\nEdward sees the twins from behind, does a double-take.  It costs him a punch to the jaw.\n\nPING (CONT'D)\nSay hello, Jing.\n\nJING\nHello Jing.\n\nPING\n(to the crowd)\nI'm Ping.  She's Jing.  She's the good one.\n(closer)\nI'm the bad one.\n\nAs the MUSIC builds towards the climax, Edward finishes the fight, knocking the guard out with a right hook.\n\nAs Ping and Jing reach the last chorus, they strike a final pose in the shape of a heart, their arms forming the arches, their backs forming the curves.  \n\nEdward slips behind curtains, trying to get away.\n\nThe soldiers are SHOUTING for an encore, lighters waving.  The curtain slowly lowers, revealing\n\nEDWARD'S PARACHUTE.\n\nThe APPLAUSE dies, replaced by a concerned RUMBLE.  The Emcee yells for the Guards to search.\n\nON STAGE\n\nPing has no idea what's happening.  Jing reaches into her cleavage to pull out her eyeglasses. \n\nINT.  DRESSING ROOM - NIGHT\n\nAs ARMED GUARDS search the halls below the stage, Ping and Jing shut the door to their dressing room.  At the closet, they start to change outfits.  Off-stage, their personalities become quite apparent:  Ping is brash, bitchy and ambitious, while Jing is quiet, sweet and bookish.\n\n_In Chinese, subtitled..._\n\nPING\nHow could you miss your cue?  You make me look like a fool, out there alone.\n\nJING\nYou weren't alone.\n\nPing HUFFS, turning her back on her sister.\n\nJing reaches deeper into the closet to find a new dress, exposing Edward's hiding place.  She GASPS.  Ping turns to look.\n\nPING\nWho the hell are you?\n\nEDWARD\n(in Chinese)\nI'm not going to hurt you.\n\nPING\nDamn right you're not. \n(yelling)\nGUARD!\n\nJing grabs her, a hand over her mouth, but it's too late.  A rifle-toting GUARD looks in.\n\nPretending to be her bitchy sister --  \n\nJING\nTell your men not to bother us!  And lock that door!\n\nThe guard obeys.  Ping shakes her sister off.  Desperately flipping through his Asian phrasebook, he finds... \n\nEDWARD\nPlease, I need your help.\n\nPING\nWhat makes you think we'll help you?  \n\nEdward pulls a photo out of his flak jacket.  It's Sandra.\n\nCROSSFADE TO:\n\nVARIOUS SHOTS\n\nEDWARD (V.O.)\nOver the next hour, I described my love for Sandra Kay Templeton, and the ordeal that brought me before them.  As it had always been, this love was my salvation.  It was destined to be.\n\nHearing the story, Jing wipes away a tear.  Even Ping is a little affected.\n\nEDWARD (V.O.)(CONT'D)\nWe put together an elaborate plan for escape, involving a whaling ship to Russia, a barge to Cuba and a small, dirty canoe to Miami.  We all knew it would be dangerous.\n\n_Still subtitled:_\n\nPING\nAnd what are we supposed to do when we get to America?\n\nEDWARD\nI can get you bookings.  I know the biggest man in show business.\n\nJING\nBob Hope?\n\nEDWARD\nBigger.\n\nTRANSITION TO:\n\nEXT.  TEMPLETON FAMILY HOUSE - DAY\n\nSandra checks the mail, hoping for a letter from Edward.\n\nEDWARD (V.O.)\nAnd so the twins and I began our arduous journey halfway around the world. Unfortunately, there was no way to send a message back to America. \n\nA black car pulls up.  Two ARMY OFFICERS get out.\n\nEDWARD (V.O.)(CONT'D)\nAnd so it was no surprise that the Army believed I was dead.\n\nHearing the news, Sandra CRIES OUT.  The pain of her shout makes church bells RING.\n\nEXT.  BEHIND THE TEMPLETON HOUSE - DAY\n\nSandra hangs sheets to dry on the clotheslines, forming a tunnel of fabric.\n\nEDWARD (V.O.)\nAfter four months, Sandra had gotten over the worst of the nightmares.  When the phone rang, she didn't think it was somehow me calling her.  When a car drove past, she didn't get up to check out the window.\n\nPulling a dress out of the basket, Sandra looks up to see \n\nA MAN'S SILHOUETTE \n\non the sheet in front of her.  She freezes, watching the shadow ripple across the white fabric, blowing so softly in the breeze.  She knows it can't be him.  He's dead.\n\nShe turns away.  With all the strength she can gather, she hangs up that dress and digs another one out of the basket.\n\nLooking up, she sees not a shadow but Edward himself standing before her.  She GASPS, disbelieving, but his hand is real.   It is destiny.\n\nWithout another moment's hesitation, she kisses him.\n\nCROSSFADE TO:\n\nBRIGHT SUNLIGHT\n\nfilters through soft sheets.  We're under the covers, where a man's hand traces the curves of a woman's bare back.   A beat, then she turns over in bed, revealing her to be \n\nJOSEPHINE.\n\nShe blinks slowly, just waking up.  Will is watching her.  He's been up for a while.  We are actually...\n\nINT.  WILL AND JOSEPHINE'S ROOM - DAY\n\n...where the couple stays cocooned under the sheets, a kind of limbo.  A kiss good morning.  Legs entangling.  Neither wants to get up.\n\nJOSEPHINE\nI talked with your father last night.\n\nWILL\nDid you?\n\nA look to say, should I be worried?\n\nJOSEPHINE\nYou never told me how your parents met.\n\nWILL\nThey met at Auburn.\n\nJOSEPHINE\nWhat about the details?  How they fell in love.  The Circus.  The War.  You never told me any of that.\n\nWILL\nThat's because most of it never happened. \n\nJOSEPHINE\nBut it's romantic.\n\nA beat.\n\nWILL\n(non-committal)\nMmm.\n\nJOSEPHINE\nMmm, what?\n\nWILL\nMmm, what.  I know better than to argue romance with a French woman.\n\nHe moves his head out from under the sheet.  She follows him to the \"outside.\"\n\nJOSEPHINE\nDo you love your father?\n\nWILL\nEveryone loves my father.  He's a very likeable guy.\n\nJOSEPHINE\n(repeating)\nDo you love him?\n\nWill doesn't want to answer yes or no.\n\nWILL\nYou have to understand.  When I was growing up, he was gone more than he was here.  And I started thinking -- maybe he has a second life somewhere else.  With another house, another family.  He leaves us, he goes to them.  Or maybe there is no family.  Maybe he never wanted a family.  But whatever it is, maybe he likes that second life better.  And the reason he tells all those stories is because he can't stand this boring place.\n\nJOSEPHINE\nBut it's not true.\n\nWILL\nWhat is \"true?\"  I've never heard my father say a single true thing.  \n\nOff her silence...\n\nWILL\nLook, I know why you like him.  I know why everyone likes him.  But I need you to tell me I'm not crazy.\n\nJOSEPHINE\nYou're not.\n\nWILL\nI need you on my side.\n\nJOSEPHINE\nI am always on your side.  And I think you should talk to him.\n\nINT.  GUEST ROOM - DAY\n\nThe family finishes eating breakfast off TV trays set up around the bed.  For his part, Edward is looking better.  Certainly not recovered, but there's an optimism to his expression.  And for the first time, he's actually hungry.  \n\nHe watches as Sandra puts the cap back on the syrup.\n\nEDWARD\nDid I ever tell you about how...\n\nWILL\n(interrupting)\nYes.\n\nEdward is startled.\n\nWILL  (CONT'D)\nThe maple tree and the Buick.  We heard it.\n\nEDWARD\n(re:  Josephine)\nI think someone hasn't.\n\nJOSEPHINE\nThe tree fell on the car, spilling the syrup, which attracted the flies, which got stuck to it and flew off with the whole car.\n\nA beat.\n\nEDWARD\n(undeterred)\nBut the real story is how I got the car.  You see...\n\nWILL\n(interrupting)\nDad?\n\nEDWARD\nSon?\n\nWILL\nCan we talk?\n\nSandra SNAPS the cap back on the syrup.  \n\nSANDRA\nI'm going to get started on dishes.\n\nJOSEPHINE\nI'll help you.\n\nBoth women quickly gather plates.  \n\nWill and Edward both smile.  The women clearly want this to happen.  It settles for a beat after they leave.\n\nWILL\nDo you know much about icebergs, Dad?\n\nEDWARD\nDo I?  I saw an iceberg once.  They were hauling it down to Texas for drinking water, only they didn't count on an elephant being frozen inside.  The woolly kind.  A mammoth.\n\nWILL\n(interrupting)\nDad!\n\nEDWARD\nWhat?\n\nWILL\nI'm trying to make a metaphor here.\n\nEDWARD\nThen you shouldn't have started with a question.  Because people want to answer questions.  You should have started with, \"The thing about icebergs is...\"\n\nWILL\n(frustrated)\nThe thing about icebergs is you only see 10 percent of them.  The other 90 percent is below the water where you can't see it.  And that's what it is with you Dad.  I'm only seeing this little bit that sticks above the water.\n\nEDWARD\n(joking)\nWhat, you're seeing down to my nose?  My chin?\n\nWILL\nI have no idea who you are because you have never told me a single fact.\n\nEDWARD\nI've told you a thousand facts.  That's all I do, Will.  I tell stories.\n\nWILL\nYou tell lies, Dad.  You tell amusing lies.  Stories are what you tell a five-year old at bedtime.  They're not elaborate mythologies you maintain when your son is ten and fifteen and twenty and thirty.  And the thing is, I believed you.  I believed your stories so much longer than I should have.  And then when I realized that everything you said was impossible -- everything! -- I felt like such a fool to have trusted you.  You were like Santa Claus and the Easter Bunny combined.  Just as charming and just as fake.\n\nEDWARD\nYou think I'm fake.\n\nWILL\nOnly on the surface.  But that's all I've ever seen.\n\nEdward looks away, angry and disbelieving.  \n\nWILL\nDad, I'm about to have a kid of my own here.  It would kill me if he went through his whole life never understanding me.\n\nEDWARD\nIt would kill you, huh?\n\nFinally --\n\nEDWARD\nWhat do you want, Will?  Who do you want me to be?\n\nWILL\nYourself.  Good, bad, everything.  Just show me who you are for once. \n\nEDWARD\nI have been nothing but myself since the day I was born.  And if you can't see that, it's your failing, not mine.\n\nEXT.  BACKYARD - DAY\n\nWith a skimmer pole, Will cleans the leaves and debris out of the pool, but it's a fool's errand.  The pool has long since gone native, a shiny slick of algae on the surface, slime covering the cemented rocks.  \n\nSuddenly, an underwater shape RIPPLES against the water's surface.  Will is so startled that he drops the pole, which disappears into the murky water.  \n\nA beat.  He looks around, relieved that no one saw that.  He casually walks away.\n\nINT.  BASEMENT STORAGE AREA - DAY\n\nThe doors open to reveal Sandra, Will and Josephine, staring into the mouth of oblivion.  The storeroom is a museum of hasty decisions and half-finished projects:  partially built outboard motors, dead bonsai trees, Frankensteinian lawnmowers.  We also find boxes of products Edward used to sell.\n\nClearing a path, Sandra leads Will to a roll-top desk, its ribs covered in dust.  Two beaten metal file cabinets sit beside it.\n\nSANDRA\nYour father decided he needed to have an office, and it wouldn't do to have it in the house.  You'll know better than me what's important.\n\nWith some effort, Will forces up the desktop.  With a HISS, a neighbor's cat makes a run for it.  Will's getting used to being startled.\n\nINT.  BASEMENT STORAGE AREA - DAY [LATER]\n\nWill, Sandra and Josephine have worked through two trash bags of papers to throw out.  Looking through a new file, Sandra makes a small sound.  A memory.\n\nWILL\nWhat is it?\n\nSandra hands Will a yellowed telegram.  He shares it with Josephine.\n\nSANDRA\nIt was during the war.  Your father went missing.  They thought he was dead.\n\nWill can't believe what he's reading.\n\nWILL\nThat really happened?\n\nSANDRA\nNot everything your father says is a complete fabrication.\n\nA beat, then Sandra stands.\n\nSANDRA\nI'm going to check on him.\n\nJOSEPHINE\nI need to lie down for a bit.\n\nWILL\nGo.\n\nJosephine kisses him, then follows Sandra.  Will re-reads the telegram, still bewildered.\n\nLooking for a place to put it, he tucks it into a strange mechanical hand on the desk.  It clamps down automatically.\n\nWill smiles, a memory.  He hasn't thought about this device in years.  We slowly PUSH IN on the telegram, held in the hand.\n\nEdward's VOICE begins as a memory...\n\nEDWARD (V.O.)\nAfter the war, the sons of Alabama returned home, looking for work.  Each had an advantage over me.  They were alive, while I was -- officially -- deceased.\n\nINT.  DOWNTOWN OFFICE - DAY [STORY]\n\nEdward shakes hands with his new boss, a TOUPEED MAN.  The company is called \"Confederated Products.\"  The OFFICE LADIES all love Edward.\n\nEDWARD (V.O.)\nWith my prospects few, I took a job as a travelling salesman.  It suited me. If there's one thing you can say about Edward Bloom, it's that I am a social person.\n\nEXT.  COUNTY FAIR - DAY  [STORY] \n\nOn a low platform, Edward pitches a brilliant new product to the crowd.\n\nEDWARD\nI've travelled from Tennessee to Timbuktu, and if there's one thing people have in common, is we could all use a hand around the house.\n\nEdward sets down a contraption, which looks something like a metal lava lamp.  Like a flower, it unfolds to reveal five fingers and a thumb.  This is the Hand Around the House.(TM)\n\nEDWARD\nWhy, with this product you can...\n\nQUICK MONTAGE as he demonstrates:\n\nEDWARD\nOpen a jar.  Open a letter.  Scratch yourself while wearing mittens.  Hold a book.  Hold a baby.  Hold the dog away from kittens.  It's strong enough, you can do a handstand with no hands at all.\n\nIndeed, a remarkably agile Edward is able to support his entire weight on it.  The crowd APPLAUDS.\n\nEDWARD\nYou can use it to point out important information.  Or dangers.  Or beautiful women.\n\nThe hand points a finger at an HEAVYSET MAN IN OVERALLS.  \n\nEDWARD\nWe're still working on that one.\n\nThe crowd LAUGHS.\n\nEXT.  A COUNTRY ROAD - DAY\n\nEdward drives, his hand out in the wind.\n\nEDWARD (V.O.)\nSoon I added other products, and other cities, until my territory stretched from the coast to western Texas.\n\nEXT.  TRAILER PARK - DAY  \n\nEdward kisses his pregnant wife goodbye, as much in love as ever.\n\nEDWARD (V.O.)\nI could be gone for weeks at a time.  But every other Friday, I'd put all the money I'd made into an account set aside for a proper house with a white picket fence.\n\nEXT.  HORIZON SAVINGS & LOAN - DAY \n\nEstablishing this Texas institution, we come...\n\nINT.  HORIZON SAVINGS & LOAN - DAY \n\nThe bank is busy with the lunch-hour crowd.  Taking his place in line, Edward fills out a deposit slip.  \n\nAs the line snakes around through the ropes, the man in front of him gets a look at Edward.\n\nTHE MAN\nEdward?  Edward Bloom?\n\nThe man is none other than...\n\nNORTHER WINSLOW\nIt's me.  Norther Winslow.\n\nEDWARD (V.O.)\nI was astonished to see the greatest poet of both Ashton and Spectre all the way out in Texas.\n\nThe men shake, disbelieving this lucky coincidence.\n\nEDWARD (CONT'D)\nI don't believe it!\n\nNORTHER WINSLOW\nI want you to know, when you left Spectre it opened my eyes.  There was a whole life out there that I was not living.  So I travelled.  I saw France, and Africa, half of South America.  Every day a new adventure, that's my motto.\n\nEDWARD\nThat's great, Norther.  I'm happy for you.  I can't believe I helped.\n\nHe's genuinely proud.\n\nEDWARD (CONT'D)\nSo what are you up to now?\n\nNORTHER WINSLOW\nI'm robbing this place.\n\nReaching the front of the line, Norther pulls two pistols out of his coat, FIRING both into the ceiling.\n\nSCREAMS all around.  The skinny SECURITY GUARD makes a half-hearted reach for his gun, but Norther waves him off.  The guard takes out his gun and slides it over.\n\nNORTHER WINSLOW (CONT'D)\n(to Edward)\nWould you mind grabbing that?\n\nThere's nothing threatening about his delivery -- he might as well be asking for a Budweiser.  Still, Edward senses it would be best to do as he says.  He takes the guard's gun.\n\nNORTHER WINSLOW (CONT'D)\n(to the crowd)\nNow, I want all of you to lie down.  I'm gonna be cleaning out the cash drawers, and my associate here is going to handle the vault.\n(pointing to a Teller Woman)\nYou help my friend, okay?\n\nThe TELLER WOMAN nods.\n\nANGLE ON Edward, not sure what to do.  He has a gun, but he truly doesn't want to shoot Norther.  The Teller Woman is already waving him to the back.\n\nHe decides he better go.\n\nINT.  AT THE VAULT - DAY \n\nThe Teller Woman is crying as she works the combination.  Edward feels horrible.\n\nEDWARD\nLook, I'm really sorry.  I just don't want anybody to get hurt.\n\nTELLER WOMAN\nIt's not that, it's just...\n\nShe pulls open the vault door.\n\nINT.  THE VAULT - DAY  \n\nThe inner sanctum of the Horizon Savings and Loan holds exactly one folding chair.  Nothing else.\n\nTELLER WOMAN\n...there's no money.  We're completely bankrupt. \n\nEDWARD (V.O.)\nIt turned out the savings and loan had already been robbed -- not by armed bandits, but by speculators in Texas real estate.\n\nTELLER WOMAN\n(dead serious)\nYou gotta promise you won't tell anybody.\n\nCUT TO:\n\nINT.  EDWARD'S CAR - DAY  \n\nEdward drives the getaway car, though truthfully they're going just a little over the speed limit.  No one's following them.  It's an empty country road for miles.\n\nNorther HOLLERS with body-tingling joy as he counts the money.\n\nNORTHER WINSLOW\nSixty.  Eighty.  Four hundred dollars!   Not bad for just the drawers.  Let's see what you got from the vault.\n\nEdward winces, but doesn't say anything yet.  Digging through the vault bag, Norther is surprised to find only a single deposit envelope.  He rips it open, revealing just a little cash inside.  Even some dimes and pennies.\n\nNORTHER WINSLOW (CONT'D)\nThis is it?  The whole vault.\n\nEDWARD\n'Fraid so.\n\nNORTHER WINSLOW\nEdward, it's got your deposit slip on it.\n\nCaught, Edward has to confess...\n\nEDWARD\nLook, I just didn't want you to go empty-handed.  There's something you should know, Norther.  You see, the reason why...\n\nEdward continues his narration...\n\nEDWARD (V.O.)\nI told Norther about the vagaries of Texas oil money and its effect on real estate prices, and how lax enforcement of fiduciary process had made savings and loans particularly vulnerable.  Hearing this news, Norther was left with one conclusion:\n\nEXT.  TEXAS ROAD - DAY \n\nNorther leans in the driver's side window.\n\nNORTHER WINSLOW\nI should go to Wall Street.  That's where all the money is.\n\nEdward looks over at Norther, the reality sinking in.\n\nEDWARD (V.O.)\nI knew then that while my days as a criminal were over, Norther's were just beginning. \n\nThe two men wave at each other as Edward drives off.  At the last moment, Norther calls out:\n\nNORTHER WINSLOW\nEdward, thank you for the hand!\n\nHe's talking about his Hand Around the House.  We HOLD ON Norther for a beat, dreaming of his future.\n\nEDWARD (V.O.)\nWhen Norther made his first million dollars, he sent me a check for ten thousand.  I protested, but he said it was my fee as his career advisor.\n\nEXT.  BLOOM HOUSE [MID/LATE '70'S] - DAY  \n\nSandra is watering the garden.  Will (5) runs past her to greet Edward, just returned from another trip.\n\nEDWARD (V.O.)\nTen thousand dollars is no fortune to most men.  But it was enough to buy my wife a proper house with a white picket fence.\n\nWe reveal the Bloom house, the nicest one in the neighborhood.  Edward kisses his wife.\n\nEDWARD (V.O.)\nAnd for that, it was all the riches a man could ever want.\n\nSandra drops the hose, letting it run on the lawn.\n\nTRANSITION TO:\n\nINT.  BLOOM HOUSE BATHROOM - DAY [PRESENT] \n\nCLOSE ON Edward's hand as he turns knobs.\n\nCLOSE ON water SPLASHING into the claw-foot bathtub, which begins to fill.\n\nStill wearing his pajamas, Edward climbs into the tub.  Carefully lowers himself.\n\nAs the water reaches the third button up on his pajama shirt, Edward suddenly slides \n\nUNDERWATER.\n\nBubbles rise from his nose for a few beats, then stop.  It's quiet, except for the distant SPLASHING of water from the spigot.  Edward's eyes are closed.\n\nA long beat.  Another.  Then the SPLASHING water goes silent.  Edward opens one eye.  The other eye.  He sits up to find \n\nSANDRA \n\nsitting on the edge of the tub.  She doesn't seem particularly worried -- her husband has always done this.\n\nEDWARD\nI was drying out.\n\nSANDRA\nI see.  We need to get you one of those plant misters.  We can spray you like a fern.\n\nHe smiles, then pulls his knees up, making room for her in the tub.  A beat while she considers.\n\nSandra steps out of her sandals and climbs into the tub, facing him.  Her dress is soaked, but she doesn't mind.\n\nHe leans forward and kisses her.  When they separate, she has tears hanging in her eyes.\n\nEDWARD\nCome now.\n\nHe wipes them away.\n\nSANDRA\nI don't think I'll ever dry out.\n\nINT.  BASEMENT STORAGE AREA - DAY\n\nPerched awkwardly on a canoe, Will's made it through another file cabinet.  He goes through the folders page by page, but usually ends up tossing the whole thing in the trash.\n\nHe's about to toss a file when he stops.  Takes another look. Something doesn't make sense.\n\nINT.  BLOOM HOUSE / STAIRS - DAY\n\nWill is headed upstairs when his mother comes around the corner with an armful of laundry, including her wet dress.\n\nWILL\nIs he awake?\n\nSANDRA\nHe just fell asleep.  Josephine's with him.\n\nShe passes him.  He turns.\n\nWILL\nMom?\n\nSANDRA\nYes?\n\nWill quickly debates whether or not to ask her...\n\nWILL\nDid you and Dad have any other property?\n\nSANDRA\n(thinking)\nI suppose your grandmother's house when she passed on.  But we sold that right away.  Your cousin Shirley bought it.\n\nWILL\nSo you never bought any land.\n\nSANDRA\nHeavens no.  We had a hard enough time keeping the mortgage on this place.\n\nWill nods, just curious.  He continues heading up.\n\nINT.  WILL AND JOSEPHINE'S ROOM - DAY\n\nWill changes his shirt.  Takes his keys off the nightstand.\n\nEXT.  COUNTY ROAD - DAY\n\nWill's rental car drives past a sign reading, \"Ashton, 10 miles.\"\n\nINT.  WILL'S CAR - DAY / DRIVING\n\nWill checks the address on one of his father's files.\n\nEXT.  ASHTON GAS - DAY\n\nWill talks to the ATTENDANT, who points him in a direction, then gestures a series of left, right, left, rights.\n\nEXT.  ROAD - DAY\n\nWill drives down a road that seems somewhat familiar.  And then we realize why:  a roadsign reads \"Welcome to Spectre!\"\n\nEXT.  A LONE HOUSE - DAY\n\nSitting at the edge of a swamp, the little two-story feels lonely, set deep in its lot.  Dapples of light break through the trees, a light breeze swaying the branches.\n\nAs Will walks from the car, the WHIRR of cicadas grows.  He checks the number:  33.  This is the house.  It is surrounded by a white square-picket fence, identical to his mother's.  Will notices this.\n\nReaching the porch, we hear a PIANO playing inside.  Badly.\n\nRe-checking the number on a form he's carrying, Will KNOCKS.  The piano stops.\n\nWOMAN'S VOICE (O.S.)\nGo back to the start.  Right hand only.\n\nThe piano starts again.  FOOTSTEPS.\n\nThe door opens to reveal a blonde woman in her 50's -- the woman from the grocery store.  Her name is Jenny Hill.\n\nShe and Will are startled to see each other.\n\nJENNY\nOh.  Oh.\n\nWILL\nHello.\n\nJENNY\nI wasn't expecting you.\n\nConfused, Will checks the name on the form.\n\nWILL\nAre you Jenny Hill?\n\nJENNY\nI am.  And you're Will.  I've seen your picture, that's how I recognize you.  I almost said something at the store, but it would have been awkward.\n(a beat)\nLike this.\n\nThe PIANO STUDENT, a black boy of eight, has stopped.  He's watching the conversation at the door.  Speaking of awkward...\n\nJENNY (CONT'D)\n(to the student)\nListen, Kenny.  Why don't we skip the lesson today?  We can go again next week.\n\nShe hands him five dollars out of her pocket.\n\nSTUDENT\nDo I have to give it back to my Mom?\n\nJENNY\nI won't tell her if you won't.\n\nYou don't have to tell him twice.  He's out the door in a flash.\n\nINT.  JENNY'S KITCHEN - DAY\n\nWhile Will sips his iced tea, Jenny flips through a form she never expected to see again.  She hands it back to Will. \n\nWILL\nHow did you know my father?\n\nJENNY\nThis was on his sales route, so he was through here all the time.  Everyone in town knew him.\n\nA beat.  Not flinching...\n\nWILL\nWere you and my father having an affair?\n\nJENNY\n(taken aback)\nWow.  Wow, you just said it.  I was expecting to dance around this for another half hour.\n\nWILL\nI've seen him with women.  He flirts.  He always has.  On some level, I presumed he was cheating on my mother.  I just never had proof.\n\nShe moves, trying to get out of the corner he's boxed her into.  Once she's finally free...\n\nJENNY\nCan I ask you a question?  Why did you come here today?  If you found this deed, why didn't you just ask Eddie?\n\nWILL\nBecause he's dying.\n\nA long beat.  Jenny is taken back by the suddenness of it.  She's a tangle of conflicting emotions.\n\nJENNY\nLook, I don't know how much you want to know about any of this.  You have one image of your father and it would be wrong for me to go and change it.  Especially this late in the game.\n\nWILL\nMy father talked about a lot of things he never did, and I'm sure he did a lot of things he never talked about.  I'm just trying to reconcile the two.\n\nFair enough.  Jenny takes a seat across from him at the table.\n\nJENNY\nThe first thing you have to understand, is that your father never meant to end up here.  And yet he did, twice.  The first time, he was early.  The second time, he was late.\n\nINT.  EDWARD'S CAR / DRIVING - NIGHT \n\nIt's late, and Edward is pensive. \n\nJENNY (V.O.)\nThose days, your father was working for himself.  If there was one thing you could say about Edward Bloom, it's that he was a social person, and people took a liking to him.  One night he was returning from three weeks on the road, when he hit a thunderstorm unlike any in his life.\n\nThe first raindrops hit the windshield.  Edward turns on the wipers. \n\nINT. EDWARD'S CAR - NIGHT - [THE STORM]\n\nSuddenly, a deluge descends.  It's not even rain anymore -- there's no space between the drops.  It's like being caught in a waterfall.  It's that loud.\n\nNo choice, Edward stops the car.  Puts on the handbrake.  Just as suddenly, the sound changes -- no longer pounding, but softly SPLASHING.  The world is close and echoing, because --\n\nEXT.  EDWARD'S CAR - NIGHT \n\n-- the car is underwater.  The tires are still on the road, but where there used to be air is water.\n\nThree catfish swim in front of his headlights.\n\nINT.  THE CAR - NIGHT \n\nRealizing his plight, Edward tries to remain calm.  Water is trickling in through the crack between the window and the door, but very slowly.  For now, he's fine.\n\nThat's when he sees her -- The Girl in the River.  \n\nShe's swimming outside the car.  While we never see her face exactly, she remains just as beautiful, just as mysterious, as the first time we saw her.\n\nShe puts her hand to the windshield.  He puts his up to meet hers.  And smiles.\n\nFLASH CUT TO:\n\nEXT.  FIELD BY DIRT ROAD - DAY\n\nIt's morning, and the sun shines brightly.  Birds CHIRP.  Trees drip and the grass shines, still wet from last night's rain.\n\nEdward gathers the clothes that have spilled out of his suitcase, which broke open when he dropped it from \n\nHIS CAR,\n\nwhich balances precariously ten feet up in an elm tree.  As Edward gathers his last pair of socks, he notices a shiny piece of metal sticking out of the dirt.  He pulls it out, rubs it off.\n\nIt's a key.  It's the Key to the City he lost years ago.\n\nJENNY (V.O.)\nFate has a way of circling back on a man, and taking him by surprise.  \n\nEXT.  ROAD - DAY\n\nCarrying his busted suitcase, a tired Edward walks toward a one-street town in the distance.  We pass a rusty sign...\n\n\"Welcome to Spectre.\"\n\nEXT.  MAIN STREET - DAY\n\nAmazed and disbelieving, Edward walks down the center of the road, no cars coming from either direction.  He looks up to find his faded shoes still dangling from the power line, along with the rest of the town's.\n\nJENNY (V.O.)\nA man sees things differently at different times in his life.  This town didn't seem the same now that he was older.  \n\nEXT. TOWN OF SPECTRE - VARIOUS SHOTS\n\nWe look around the town, on and off Main Street.   There are \"FOR SALE\" signs in many of the windows\n\nJENNY (V.O.)\nA new road had brought the outside world to Spectre, and with it, banks, liens and debt.  Almost everywhere you looked, people were bankrupt.  \n\nEXT.  SPECTRE - DAY\n\nWe slowly MOVE THROUGH a foreclosure auction to find Edward watching.  Two very corporate MEN IN SUITS, stick out among the bidders.\n\nJENNY (V.O.)\nTwo different corporations were looking at buying the town, if they could get the price low enough.   One wanted to open a chicken processing plant.  The other, a municipal dump.  Either way, Spectre would be destroyed.\n\nEdward raises his hand.\n\nEDWARD\nFifty-thousand!\n\nEveryone turns to look at this new bidder.\n\nJENNY (V.O.)\nAnd so Edward Bloom decided to buy the town, in order to save it.\n\nINT.  NORTHER WINSLOW'S MANHATTAN - DAY  \n\nEdward pitches his plan to Norther.\n\nJENNY (V.O.)\nHe was never a wealthy man, but he had made other men rich, and now he asked for their favors.\n\nINT./EXT.  VARIOUS LOCATIONS - DAY  \n\nVARIOUS SHOTS:  Expressive and passionate as always, Edward talks to Ping, Jing and Amos Calloway.\n\nJENNY (V.O.)\nMost of them had never seen Spectre -- they only had Edward's words to describe it.  That's all they needed.  He sold them on the dream.  \n\nJING\nYou can structure it as a historical trust.  But you'll need every contiguous piece of property.  It's all or nothing.\n\nAs Edward takes notes...\n\nJENNY (V.O.)\nSo first he bought the farms.  Then he bought the houses.  Then he bought the stores.\n\nINT.  AL'S COUNTRY - DAY\n\nFinishing up with AL, Edward shakes hands.\n\nJENNY (V.O.)\nWhatever he bought, the people were not asked to leave or pay rent or anything.  They were just asked to keep doing as they were doing.  In that way, he could make sure the town would never die.\n\nEXT.  ROAD IN THE SWAMP - DAY\n\nEdward climbs out of his car, the road having literally stopped.  The sun is shining, but it can barely penetrate the trees' thick canopy.  \n\nJENNY (V.O.)\nWithin six months, his trust had purchased the entire town.  With one exception.\n\nIn the distance, he sees a shack, so old it's nearly fallen.  He walks toward it, the marshy ground SQUISHING up around his feet, soaking the hems of his trousers.\n\nWe hear a PIANO playing from inside the shack.  Edward KNOCKS on the half-hung door, which swings open by itself.\n\nINT.  SHACK - DAY\n\nThe inside is nicer than you'd think, a real home.  A fire burns in the stove, and curtains hang in the windows.\n\nWith her back turned to him, Jenny Hill plays the piano.  Edward doesn't recognize her as the little girl who used to have a crush on him.  Without turning, she says...\n\nJENNY\nYou must be Edward Bloom.\n\nEDWARD\nHow did you know?\n\nShe keeps PLAYING.\n\nJENNY\nNo one would come out here unless they had business.  And no one would have business with me except for you.  You're buying the town.\n\nEDWARD\nApparently I've overlooked this one piece of it, and I'd like to remedy that.  You see, in order for the town to be preserved, the trust must own it in its entirety.  \n\nJENNY\nSo I've heard.\n\nEDWARD\nI'll offer you more than it's worth.  And you know you won't have to move.  Nothing will change except the name on the deed, you have my word.\n\nJenny stops playing, her piece not quite finished.  She turns to face him.  Edward still doesn't recognize her.\n\nJENNY\nNow let me get this straight.  You'll buy the swamp from me, but I'll stay in it.  You'll own the house, but it'll still be mine.  I'll be here, and you'll come and go as you please to one place or another.  Do I have that right?\n\nStrange to hear it put that way, but --\n\nEDWARD\nIn so many words, yes.\n\nJENNY\nThen I don't think so Mr. Bloom.  If nothing is going to change, I'd just as soon it not change in the way it hasn't been changing all this time.\n\nEDWARD\nIt's not like you're going to lose anything.  You can ask anyone in town.  I've been nothing if not generous.  I want the best for everyone.\n\nA long beat.  \n\nJENNY\nMr. Bloom, why are you buying this land?  Some sort of midlife crisis?  Instead of buying a convertible, you buy a town?\n\nHe looks at her, puzzled and surprised.  No one has really asked before.\n\nEDWARD\nHelping people makes me happy.\n\nJENNY\nI'm not convinced you should be happy.\n\nEDWARD\nI'm sorry.  Have I offended you?\n\nShe finally turns to face him.\n\nJENNY\nNo, you did exactly what you promised.  You came back.  I was just expecting you sooner.\n\nFLASHBACK TO:\n\nEXT.  SPECTRE - NIGHT\n\nYoung Jenny Hill watches barefoot Edward leave Spectre for the first time.\n\nBACK TO:\n\nINT.  SHACK - DAY  \n\nFinally realizing who this woman is...\n\nEDWARD\nYou're Beamen's daughter.  Your last name is different.\n(realizing)\nYou married.\n\nJENNY\nI was 18.  He was 28.  Turns out that was a big difference.\n\nBefore he can say anything more...\n\nJENNY (CONT'D)\nI won't be selling you this house, Mr. Bloom.\n\nEDWARD\nI see.  I thank you for your time.\n\nA bit bewildered, Edward tips his hat to her as he leaves.\n\nEXT/INT.  SWAMP SHACK - DAY\n\nEdward pulls the door shut behind him as he leaves, but it breaks off in his hands.  It's not the clean exit he was hoping for.\n\nInside Jenny looks out, surprised and annoyed.\n\nEdward tries to lift the door back on the hinges, but they SNAP off.  The door frame buckles and the whole shack CREAKS.\n\nEDWARD\nI'm sorry.\n\nHe tries to lean the door against the frame, but it keeps slipping.\n\nJENNY\nIt's okay, just leave it.\n\nEDWARD\nI can get it.  I can just...\n\nHe leans the door a different way.  It holds for a beat then falls in, SMASHING a small table.\n\nEDWARD (CONT'D)\nLord, I'm sorry I...\n\nJENNY\nPlease.  Go.  Just go.\n\nEDWARD\nI'll...\n\nJENNY\nGo.\n\nShe's dead serious.  Weighing the scales of chivalry, he finally backs away.  Turns and heads back towards his car.\n\nWe STAY ON Jenny, watching him go.  She's furious, but there's something more in her feelings for him.  Something softer.\n\nJENNY (V.O.) (CONT'D)\nMost men in that situation would accept their failure and move on.  But Edward was not like most men.\n\nEXT.  SWAMP SHACK ROAD - ANOTHER DAY\n\nWith Karl the Giant's help, Edward unloads a brand new door from a pickup truck.  \n\nEXT.  SHACK - DAY\n\nWhile Jenny watches, half-annoyed, half-amused, Edward tries to set the door square.  Karl pushes against the side of the house until it fits.\n\nINT.  SHACK - ANOTHER DAY\n\nHolding nails between his lips, Edward puts in new windows himself.  Jenny is making soup, laughing at the story he's telling.\n\nJENNY (V.O.)\nAs the months passed, he found more and more things to fix, until the shack no longer resembled itself.\n\nEXT.  SWAMP - ANOTHER DAY\n\nEdward and Karl cut down a tree, letting in a flood of light.  Through the golden pollen hanging in the air, we RISE UP to see the shack is now \n\nTHE LOVELY HOUSE\n\nwe saw before.  It's tiny and white, with black shutters and a steep roof.  A white picket fence.  In every detail it is impossibly charming.\n\nINT.  JENNY'S HOUSE - DAY\n\nEdward is screwing a hat rack into the wall in the foyer.  Jenny leans against the doorframe listening to his story.  And watching him with deepest affection.\n\nEDWARD\nOf course, the best part was creating new material.  By the time the twins and I got to Havana, we had a whole new routine worked out for them, with just a ukulele and a harmonica.\n\nFinished with his work, he takes his hat off the chair and hangs it on the rack.  Perfect.\n\nA beat.  A look between them.  With that last job done, there's no reason for him to be staying any longer.\n\nEDWARD (CONT'D)\nI suppose I should...\n\nHe takes his hat off the rack.\n\nJENNY\nYou can leave it there.\n\nA beat.  Does she really mean it?  \n\nShe comes closer.  Edward holds his ground.  She takes his hand, lifting his hat up to the peg.  She's very close -- just a half-inch from kissing him when --\n\n-- Edward gently holds her back.\n\nEDWARD\nNo.\n\nShe freezes, stunned and humiliated.  She pulls away.\n\nEDWARD  (CONT'D)\nDon't.  Don't be embarrassed.  I should never have let you think that...\n(beat)\nI am in love with my wife.\n\nJENNY\nI know.\n\nEDWARD\nAnd from the moment I saw her until the moment I die, she's the only one.  \n\nJENNY\nLucky girl.\n\nEDWARD\nI'm sorry, Jenny.  I am.\n\nWith that, he begins to leaves.\n\nJENNY\nWait!  Edward!\n\nShe finds a pen and hastily signs the deed to the house.  Hands it to him.  With a look, he thanks her.  Then goes.\n\nEXT.  SPECTRE - MAGIC HOUR\n\nEdward takes a final look at this perfect little town.\n\nJENNY (V.O.)\nOne day, Edward Bloom left, and never returned to the town he'd saved.\n\nHe climbs in his car and starts the engine.\n\nEXT.  JENNY HILL'S HOUSE - DAY TO NIGHT\n\nAs we watch, the swamp begins to overtake the house, swallowing it in a tangle of vines and mossy branches.  Shoots burst up through the planks in the porch.  Snakes slither through the marsh.\n\nDay becomes night.\n\nJENNY (V.O.)(CONT'D)\nAs for the girl, the common belief was that she'd become a witch, and crazy at that.  She became something of a legend herself.\n\nWe REVERSE to find FOUR KIDS looking in through the rusty iron gate with flashlights.  A beat, then they run away.\n\nJENNY (V.O.)(CONT'D)\nAnd the story ended where it began.\n\nINT.  JENNY HILL'S KITCHEN - PRESENT DAY\n\nWill and Jenny are still sitting at her table, a pitcher of iced tea between them.\n\nWILL\nLogically, you couldn't be the Witch, because she was old back when he was young.\n\nJENNY\nNo, it's logical if you think like your father.  See, to him, there's only two women:  your mother and everyone else.\n\nWILL\nYou didn't become crazy.\n\nJENNY\nWell, therapy.  And one day I realized I was in love with a man who could never love me back.  I was living in a fairy tale.  \n\nWill smiles to hear it called that.\n\nJENNY (CONT'D)\nPeople aren't like they are in stories.  They hurt each other without meaning to.  They are kind and unbelievably cruel at the same moment.  Like me, now.  I'm not sure I should have told you any of this.\n\nHer composure is starting to break.\n\nWILL\nNo, I wanted to know.  I'm glad I know. \n\nA long beat, both staring at their iced tea.  Jenny is working herself into more of a state by not talking.\n\nJENNY\nI wanted to meet you for the longest time.  I did.\n(a smile)\nI envied you so much.  The way Eddie would talk about you when you were at Missouri, that award you won.  Congratulations, incidentally.  And when you got the job at the A.P., everything, he was so proud of you.  I mean, that's the thing.  Every moment he loved you.  \n\nShe's fighting tears, not the first ones she's shed over this.\n\nJENNY (CONT'D)\nAnd as brightly as the sun would shine when he was with me, every time he left it disappeared.  I wanted to be as important to him as you were, and I was never going to be.  I was make-believe and his other life, you, were real. \n\nANGLE ON Will, sorting through his swirling thoughts.\n\nJENNY (CONT'D)\nYou knew that, didn't you?\n\nCUT TO:\n\nINT.  WILL'S CAR - DAY / DRIVING\n\nWill skips through the stations on the radio, but ultimately turns it off.  He's trying to think.\n\nEXT.  BLOOM HOUSE - DUSK\n\nWill walks up the front steps.  There's a subtle change to his expression, a dark cloud lifted.  He unlocks the door.\n\nINT.  BLOOM HOUSE FOYER - DUSK\n\nIt's half-dark and quiet in the house, no talking, no TV.  Will sets his keys on the table.\n\nINT.  KITCHEN - DUSK\n\nWill looks in.  Empty.\n\nWILL\n(calling out)\nHello?  Mom?  Dad?\n\nINT.  UPSTAIRS HALLWAY - DUSK\n\nWe follow Will, looking into his and Josephine's room.  He aims for the guest room at the end of the hall.\n\nINT.  GUEST ROOM - DUSK\n\nLooking over his shoulder, we see his father's bed is empty.  The sheets are in a tangle on the floor.\n\nA beat, then Will half-runs back down the hall.  Back down the stairs.\n\nINT.  FOYER - DUSK\n\nHeaded out, Will grabs his keys off the table.  We LOOK RIGHT, where the \"MESSAGE\" light blinks on the answering machine.\n\nINT.  HOSPITAL ENTRANCE - NIGHT\n\nThe hospital is so new, it's not even finished -- thick plastic hangs from exposed framing.  There's no one at the information desk, so Will forges ahead.\n\nINT.  HOSPITAL HALLWAY - NIGHT\n\nWill reads a directory board, trying to decide the best place to start.  Then, behind him --\n\nJOSEPHINE (O.S.)\nWill!\n\nHe turns to see his wife at a payphone.  She hangs up.  She was calling him.\n\nWILL\nWhat happened?\n\nJOSEPHINE\nYour father had a stroke.  He's upstairs with your mom and Dr. Bennett.\n\nWILL\nIs he going to be okay?\n\nA beat.  How can she answer?\n\nHe half-smiles, realizing the idiocy of his question.  Of course his father's not going to be okay.\n\nWILL (CONT'D)\nWhat I mean is, will he get back to the way he was when...\n\nShe cuts him off --\n\nJOSEPHINE\nNo.  He won't.  I'm sorry.\n\nAnd like that, it's done.  We HOLD ON Will, reeling from the news.\n\nINT.  HOSPITAL ROOM - NIGHT  \n\nEdward sleeps peacefully, just an oxygen tube under his nose.  There are no beeping monitors, no blinking lights.  It's mercifully quiet.\n\nSandra squeezes Will's hand tightly.  She's holding herself together, but it's been a tough day.  \n\nDr. Bennett has just gone through the details for the third time.\n\nSANDRA\nI don't suppose one of us could stay with him.  In case he...\n(beat)\nIn case he wakes up, one of us should be there.\n\nWILL\nI'll stay.  Why don't you go home with Josephine and I'll stay tonight.\n\nSANDRA\n(to Dr. Bennett)\nThat's okay?\n\nDR. BENNETT\nIt's fine.\n\nSANDRA\n(to Will)\nYou'll call if...\n\nWILL\nI will.  I'll call.\n\nA beat.\n\nWILL\nMom, do you want some time with Dad?\n\nSANDRA\nYes.  Thank you.\n\nA nod, then Will holds the door for Dr. Bennett and Josephine as they leave.  Sandra is alone in the room with her husband.\n\nShe neatens his hair.  Holds his hand.  As she kisses his fingers, she tweaks her chin with them -- his signature move.\n\nTRANSITION TO:\n\nINT.  HOSPITAL HALLWAY - NIGHT  \n\nSandra waits outside the women's restroom.  Her face is a study in strained composure -- acknowledging the inevitable but refusing to surrender to it.\n\nJosephine emerges.\n\nJOSEPHINE\nI'm sorry.  It seems every hour I have to...\n\nSANDRA\nI know.  It was the same when I was carrying Will.  Like clockwork.\n\nThe two women start to walk, no hurry.\n\nSANDRA\nDo you like it, being pregnant?\n\nJOSEPHINE\nI do.\n\nSANDRA\nI loved it.  It sounds peculiar, but I loved every minute of it.  I did.  Eddie was travelling a lot, so he was gone, but I felt like I always had a piece of him with me.  A little part of  his soul inside me.  I could feel it.  It was alive and kicking.\n\nSandra has accidentally evoked a storm of emotion.  She struggles to keep it in check.  Almost a whisper...\n\nSANDRA\nI really miss that.\n\nWith a few breaths, Sandra tries to hold on.  Hold back.\n\nJOSEPHINE\nDon't stop.  Don't.\n\nA beat, then Sandra finally melts.  Josephine holds her.  The two women stand together in the hallway, letting the moment be.\n\nINT.  HOSPITAL ROOM - NIGHT\n\nWill sits in a chair beside the bed, working through the crossword puzzle.  A KNOCK as Dr. Bennett enters with his overcoat and bag, ready to leave for the night.  \n\nDR. BENNETT\nGlad to see you're not trying to have a heartfelt talk.  It's one of my greatest annoyances, when people talk to those who can't hear them.\n\nWILL\nMy father and I have an advantage.  We never talk.\n\nDr. Bennett smiles as he checks Edward's chart.\n\nWILL  (CONT'D)\nHow long have you known my father?\n\nDR. BENNETT\nThirty years.  Maybe more.\n\nWILL\nHow would you describe him?\n\nDR. BENNETT\n(re: chart)\nFive-eleven.  One-eighty.  Regulated hypertension.\n(beat)\nHow would his son describe him?\n\nTables turned, Will searches for an answer.   He doesn't have one.\n\nDr. Bennett hangs the chart back on the bed.  \n\nDR. BENNETT (CONT'D)\nDid your father ever tell you about the day you were born?\n\nWILL\nA thousand times.  He caught an uncatchable fish.\n\nDR. BENNETT\nNot that one.  The real story.  Did he ever tell you that?\n\nWILL\n(suddenly interested)\nNo.\n\nDR. BENNETT\nYour mother came in about three in the afternoon.  Her neighbor drove her, on account of your father was on business in Wichita.  You were born a week early, but there were no complications.  It was a perfect delivery.  Now, your father was sorry to miss it, but it wasn't the custom for the men to be in the room for deliveries then, so I can't see as it would have been much different had he been there.  And that's the real story of how you were born.\n\nA long silence, just the sounds of the hospital, doctors being paged.\n\nDR. BENNETT (CONT'D)\nNot very exciting, is it?  And I suppose if I had to choose between the true version and an elaborate one involving a fish and a wedding ring, I might choose the fancy version.  But that's just me.\n\nWill half-smiles.\n\nPatting Will's shoulder, Dr. Bennett leaves.  We STAY ON Will and his father for a long time, then Will takes his pen and starts making a list.\n\nINT. HOSPITAL ROOM - VARIOUS SHOTS\n\nWill flips to a new page.  The list keeps getting longer.\n\nHe smiles, remembering something.  On his fourth page, he looks up at his motionless father.   A beat, then we slowly\n\nCROSSFADE TO:\n\nINT.  HOSPITAL ROOM - PRE-DAWN  \n\nIt's very early morning, and the first blue light of day is glowing through the vertical blinds.  Still in his chair, Will wakes up a bit at a time.  The notepad is on his lap, the pen in his hand.  \n\nHe cracks his neck, crooked from sleeping on it wrong.  What woke him up?\n\nHe looks to his right.  Holds his gaze for a breath.\n\nWILL\nDad?\n\nHis father is awake, silently GASPING for breath.  His eyes are open, scared and confused.\n\nWILL (CONT'D)\nDad!  Do you want me to get a nurse?\n\nEdward shakes his head unambiguously.  Will already has his finger on the orange \"nurse call\" button, but doesn't push it.  \n\nWILL (CONT'D)\nWhat can I do?  Can I help?  Can I get you something?  Water?\n\nEdward nods.  Will pours a glass from the pitcher on the nightstand.  He holds it to his father's lips, but Edward won't drink.  He pushes it away.  He wanted something else.\n\nEDWARD\n(whispering)\nThe river.\n\nWILL\nThe river?\n\nIt takes Edward all his strength to put together each thought.  It's like he's only half-there, fighting to hang on to this world.\n\nEDWARD\nTell me how it happens.\n\nWILL\nHow what happens?\n\nEDWARD\nHow I go.\n\nON WILL, realizing...\n\nWILL\nYou mean what you saw in The Eye?\n\nEdward nods.  Yes, that's what he was trying to say.\n\nA long beat.\n\nWILL  (CONT'D)\nI don't know that story, Dad.  You never told me that one.\n\nWill pushes his fingers under his father's heavy hand, and holds it.  There's nothing else to do.\n\nEdward looks around, confused and increasingly scared.  He sees the end approaching, but doesn't know exactly what's coming.  Without the story, he's lost.\n\nFighting the urge to panic --\n\nWILL (CONT'D)\nI can try, Dad.  If you help.  Just tell me how it starts.\n\nEDWARD\nLike this.\n\nWILL\nOkay.  Okay.\n\nWill looks around the room, increasingly desperate.  He looks to the nurse call button.  He really wants to press it.  \n\nON EDWARD, waiting for Will to begin.\n\nWILL  (CONT'D)\nOkay.  It's morning, and you and I are in the hospital.  I'd fallen asleep in the chair.  I wake up and I see you, and...\n\nCUT TO:\n\nINT.  HOSPITAL ROOM - DAY [STORY VERSION]\n\nWILL\nDad?\n\nIt's dawn, and the first golden glow is shining through the vertical blinds. \n\nWILL (CONT'D)\n(louder and concerned)\nDad?\n\nWe LOOK OVER to find a nimble Edward sitting up in bed, combing his hair.  \n\nEDWARD\nLet's get out of here.\n\nWILL (V.O.)\nSomehow, you're better.  Different.  You're getting ready to go.  And I say...\n\nWILL\nDad, you're in no condition to...\n\nBut Edward throws back the covers.\n\nEDWARD\nThere's a fold-up wheelchair in the bathroom.  Wrap a blanket around me.  As soon as we get off this floor, we'll be in the clear.\n\nWill heads for the bathroom.  Sure enough, the wheelchair is there.\n\nEDWARD (CONT'D)\nHurry!  We don't have much time.\n\nINT.  HOSPITAL HALLWAY - DAY\n\nWith the blanket draped over his head like a ghost, Edward points for his son to steer the wheelchair thataway.\n\nEDWARD\nFaster!\n\nThey pass a HEAVYSET NURSE, who turns to look.\n\nRounding a corner, they nearly crash into Dr. Bennett.\n\nDR. BENNETT\nWill!  I...What are you doing?\n\nBefore he can answer, Will spots Edward rolling the chair himself, pumping both arms.  Will dashes to catch up with him.\n\nThe Heavyset Nurse leans out of Edward's hospital room.\n\nNURSE\nSecurity!  Stop them!\n\nDOWN THE HALL\n\nAt the elevators, Sandra and Josephine step out to find Will and Edward barreling straight at them.\n\nEDWARD\nNo time to explain!  Follow us!\n\nSeeing SECURITY GUARDS heading their way, a quick-thinking Sandra shoves a nearby cart into them, bowling them down.\n\nINT.  ELEVATOR - DAY\n\nWill brakes hard, sliding with both feet.  The chair nearly crashes into the back wall as the doors close.\n\nEXT.  PARKING LOT - DAY\n\nWill races Edward down the row, finally reaching the Chevrolet.\n\nAT THE CAR\n\nWill lifts his father out of the chair.  \n\nWILL (V.O.)\nI pick you up and you hardly weigh anything.  I can't explain it.\n\nWill sets him in the passenger seat.\n\nEDWARD\nWater.  I need water.\n\nScrambling in back, Will finds a liter of Arrowhead.  Hands it off.  Edward unscrews the cap, but instead of drinking it, he douses himself.  Soaks the blanket.\n\nWill pops the trunk.  Starts to fold up the wheelchair.\n\nEDWARD (CONT'D)\nLeave it!  We won't need it.\n\nTIRES SMOKE as the car peals out.\n\nBACK TO:\n\nINT.  HOSPITAL ROOM - DAY [REALITY]\n\nTIGHT ON Will, trying to hold back tears as he talks.\n\nWILL\nAnd we have to take Glenville to avoid all the church traffic, because those damn church people drive too slow.\n\nTIGHT ON Edward, enjoying that detail.  He's focused completely on Will's story.\n\nWILL (CONT'D)\nI ask...\n\nBACK TO:\n\nEXT.  GLENVILLE BLVD. - DAY [STORY VERSION]\n\nThe Chevy slaloms through the Sunday-morning traffic.\n\nWILL (O.S.)\nWhere are we headed?\n\nWILL (V.O.)\nYou say...\n\nINT.  CHEVY - DAY\n\nEDWARD\nThe River!\n\nWill stops short, the traffic backed up.  He HONKS, trying to get around the jam.  But it's no use.\n\nThen, up ahead, the cars start moving, shoved aside by massive hands.  It's Karl the Giant, clearing a path by brute force.\n\nEdward leans out the window and waves.  Karl waves back.\n\nEXT.  ASHTON RIVER - DAY\n\nThe same stretch of the river where it all began.  A CROWD of more than 100 waiting.  \n\nWILL (V.O.)\nAs we get closer to the river, we see everybody's already there.  And I mean everybody.\n\nAmos Calloway is here with the circus folk, including Mr. Soggybottom.  We also find Edward's Mother and Father, the Mayor, and many others from along the way.  No one has aged a day since we saw them last.\n\nWhile Ping scans the horizon, Jing nuzzles with her boyfriend, Norther Winslow.  It's Ping who first spots the Chevrolet.\n\nPING\nHe's here!\n\nThe crowd CHEERS.  The Ashton marching band PLAYS.  Jenny Hill smiles.  So does the Old Woman.\n\nWe PUSH IN on the Old Woman's glass eye, where we see...\n\nYOUNG EDWARD\n\nreflected.  This is what he saw.\n\nINT.  THE CHEVROLET - DAY\n\nAmazed, Will turns to his father.\n\nWILL\nIt's unbelievable.\n\nEDWARD\nStory of my life.\n\nEXT.  RIVERSIDE - DAY\n\nWill gets out of the Chevrolet, overwhelmed by the crowd.  Behind him, Sandra, Josephine and Dr. Bennett pull up.  Karl comes just after that.\n\nCrossing to the passenger side, Will lifts his father out.  Strangely, he's gotten even lighter.  Will carries him easily.\n\nEdward pulls off his shoes, tying the laces together.  He hands them to Josephine.  She throws them up at the powerline.  They loop over.  APPLAUSE and CHEERS.\n\nThe crowd parts to let Will and Edward get to the river.  As he passes, Edward shakes some hands, pats some people on the cheek, and gives others a good poke in the ribs.\n\nWILL (V.O.)\nAnd the strange thing is, there's not a sad face to be found.  Everyone's just so glad to see you, and send you off right.\n\nWill walks into the river, up to his knees.  He turns back so his father can face the crowd.  Edward waves.\n\nEDWARD\nGoodbye everybody!  Farewell!  Adieu!\n\nTHE CROWD (VARIOUS)\nGoodbye Edward! / See ya! / We'll miss you!\n\nBut one face is missing from the crowd -- Sandra.  Will turns to see she's already standing in the river beside them.\n\nThe reflection of the light off the water gives Sandra an unearthly glow.  She's more tranquil and more beautiful than we've ever seen her.\n\nEDWARD\nMy girl in the river.\n\nShe kisses him.  He tweaks her chin.  The crowd HOLLERS in approval, but their moment remains strangely private.  Only Will is there to witness.\n\nAs the kiss ends, Edward tries to pull off his wedding ring.  But it's stuck.  Finally, he sucks on it, pulling it free with his teeth.\n\nA look to Will, a smile with a glint of gold.  Will takes the ring out of his mouth.\n\nEdward suddenly drops out of Will's arms with a SPLASH.  For he's no longer a man, but rather\n\nA FAT CATFISH\n\nswimming at his feet.\n\nWe watch as the catfish circles, then heads for deeper water, disappearing.\n\nWill and his mother stand knee-deep in the water, watching Edward Bloom swim away into the sunlight.  Josephine is back on the shore, along with the entire crowd.\n\nMUSIC BUILDS to a climax, then...\n\nDown the river, a GIANT FISH suddenly jumps out of the water, cutting a beautiful arc across the sunset.  It then dives back under with a SPLASH.\n\nCROSSFADE BACK TO:\n\nINT.  HOSPITAL ROOM - DAY\n\nWill has tears hanging in the corners of his eyes.\n\nWILL\nYou become what you always were.  A very big fish.  \n(he smiles)\nAnd that's the way it happens.\n\nEDWARD\n(a whisper)\nYes.  Exactly.\n\nEdward smiles, proud of both of them.   His eyes are so pale and so open, we can almost see his soul.  In every atom of his body, in every thought, Edward Bloom is entirely happy.  \n\nAnd this is how he goes.\n\nINT.  HOSPITAL HALLWAY - DAY\n\nWill shuts the door to his father's room behind him.  The walk to the payphones seems to take a lifetime.\n\nHe finds a quarter, starts to dial.  He has to squint to see through the water in his eyes.   It's ringing.  And ringing.  The other end answers.\n\nWILL\n(voice cracking)\nHi.\n\nThat's all he can get out before the dam breaks inside him.  He presses closer to the phone, trying to shield himself.\n\nMUSIC begins that will carry us through the next passage.\n\nINT.  HOSPITAL RECEPTION - DAY\n\nWill waits at reception as Sandra and Josephine come off the elevator.\n\nINT.  GUEST ROOM - DAY\n\nJosephine opens the curtains, letting white sunlight in.  She strips the bed.\n\nINT.  BEDROOM - DAY\n\nWill and his mother pick out one of Edward's ties, for Will to wear at the funeral.  Will tries to button the cuffs on the shirt he borrowed, but they're the kind that need links.\n\nHe goes through the top drawer of the dresser, trying to find a matching pair.  Further down, he finds a ribbon tied to \n\nTHE KEY TO THE CITY.\n\nHe smiles, disbelieving.  It's a real thing.\n\nEXT.  CEMETERY / ROAD - DAY\n\nWill helps his mother out of a black sedan.  She's well-composed, not nearly the wreck we might have expected.  \n\nJosephine hugs Dr. Bennett and shakes hands with his WIFE.  The service is crowded, more than 200 people, many more than expected.  \n\nAs his mother talks to a WELL-WISHER, Will looks left to see an Oldsmobile parking.\n\nCLOSE ON the license plates.  Missouri.\n\nThe passenger side opens, but the man who steps out is barely visible over the door.  He shuts it to reveal himself to be 70.\n\nIt's Amos Calloway.  Will doesn't recognize him.\n\nThe Driver climbs out, a size 15 foot on the gravel.  We TILT UP to see this man is huge.\n\nThis man is KARL, now 55.  He's not 12 feet tall, but at least six-eight.\n\nCLOSE ON Will, bewildered to see that this man really exists. \n\nEXT.  CEMETERY / GRAVESIDE - DAY\n\nAs the service gets ready to begin, Will guides his mother to a seat near the grave.\n\nSitting beside Will, Josephine spots a stunning ASIAN WOMAN (50) behind them.  A beat later, an identical face with glasses peers out -- the woman's twin sister.  \n\nIt's PING and JING.\n\nJosephine almost GASPS.  She elbows Will, who turns to look.  From this angle, the sisters seem conjoined, but then Jing steps forward.  They're really two separate people.\n\nA sea of familiar faces, all of them aged through the years:  BEAMEN, NORTHER WINSLOW, the MAYOR, and ZACKY PRICE.\n\nEXT.  CEMETERY - DAY [LATER]\n\nAfter the service, we see the crowd gathered in small groups.  By the LAUGHTER and hand gestures, we can see they're telling stories.  They're telling Edward's stories.\n\nWe find Will watching them.\n\nWILL (V.O.)\nHave you ever heard a joke so many times you've forgotten why it's funny?  But then you hear it again and suddenly it's new.  You remember why you loved it in the first place.\n\nWill joins in, laughing.\n\nWe slowly CIRCLE BEHIND a monument, letting it black out the screen.  \n\nTRANSITION TO:\n\nEXT.  BLOOM HOUSE BACKYARD - DAY [SUMMER]\n\nWill sits on the porch with Sandra and Josephine, watching his SON play in the pool with two NEIGHBOR KIDS.\n\nSON\n(to the other boys)\nSo he said he'd fight the giant who was fifteen feet tall.\n\nKID\nNo way.\n\nSON\n(calling over)\nDad, that's right, isn't it?\n\nWILL\nSomething like that.\n\nSON\nSee.  So he was a giant but my grampa was going to fight him because he wasn't afraid of anything because he'd seen how he was going to die in this old lady's glass eye...\n\nWill smiles as his son continues the tale, which FADES.  Sandra takes Will's hand in hers, just listening.\n\nWILL (V.O.)\nThat was my father's final joke I guess.  A man tells his stories so many times that he becomes the stories.  They live on after him.\n\nCROSSFADE TO:\n\nEXT.  RIVER / UNDERWATER - DAY\n\nA fat and happy catfish swims towards us.\n\nWILL (V.O.)\nAnd in that way, he becomes immortal.\n\nThe fish passes us with a SPLASH.\n\nCUT TO BLACK.\n\n> _**THE END**_ <"}),this.JST["templates/samples/brick_and_steel.fountain"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Title:\r\n	_**BRICK & STEEL**_\r\n	_**FULL RETIRED**_\r\nCredit: Written by\r\nAuthor: Stu Maschwitz\r\nSource: Story by KTM\r\nDraft date: 1/27/2012\r\nContact:\r\n	Next Level Productions\r\n	1588 Mission Dr.\r\n	Solvang, CA 93463\r\n\r\nEXT. BRICK'S PATIO - DAY\r\n\r\nA gorgeous day.  The sun is shining.  But BRICK BRADDOCK, retired police detective, is sitting quietly, contemplating -- something.\r\n\r\nThe SCREEN DOOR slides open and DICK STEEL, his former partner and fellow retiree, emerges with two cold beers.\r\n\r\nSTEEL\r\nBeer's ready!\r\n\r\nBRICK\r\nAre they cold?\r\n\r\nSTEEL\r\nDoes a bear crap in the woods?\r\n\r\nSteel sits.  They laugh at the dumb joke.\r\n\r\nSTEEL\r\n(beer raised)\r\nTo retirement.\r\n\r\nBRICK\r\nTo retirement.\r\n\r\nThey drink long and well from the beers.\r\n\r\nAnd then there's a long beat.\r\nLonger than is funny.\r\nLong enough to be depressing.\r\n\r\nThe men look at each other.\r\n\r\nSTEEL\r\nScrew retirement.\r\n\r\nBRICK ^\r\nScrew retirement.\r\n\r\nSMASH CUT TO:\r\n\r\nINT. TRAILER HOME - DAY\r\n\r\nThis is the home of THE BOY BAND, AKA DAN and JACK.  They too are drinking beer, and counting the take from their last smash-and-grab.  Money, drugs, and ridiculous props are strewn about the table.\r\n\r\n			JACK\r\n		(in Vietnamese, subtitled)\r\n	*Did you know Brick and Steel are retired?*\r\n\r\n			DAN\r\n	Then let's retire them.\r\n	_Permanently_.\r\n\r\nJack begins to argue vociferously in Vietnamese (?), But mercifully we...\r\n\r\n				CUT TO:\r\n\r\nEXT. BRICK'S POOL - DAY\r\n\r\nSteel, in the middle of a heated phone call:\r\n\r\nSTEEL\r\nThey're coming out of the woodwork!\r\n(pause)\r\nNo, everybody we've put away!\r\n(pause)\r\nPoint Blank Sniper?\r\n\r\n.SNIPER SCOPE POV\r\n\r\nFrom what seems like only INCHES AWAY.  _Steel's face FILLS the *Leupold Mark 4* scope_.\r\n\r\nSTEEL\r\nThe man's a myth!\r\n\r\nSteel turns and looks straight into the cross-hairs.\r\n\r\nSTEEL\r\n(oh crap)\r\nHello...\r\n\r\nCUT TO:\r\n\r\n.OPENING TITLES\r\n\r\n> BRICK BRADDOCK <\r\n> & DICK STEEL IN <\r\n\r\n> BRICK & STEEL <\r\n> FULL RETIRED <\r\n\r\nSMASH CUT TO:\r\n\r\nEXT. WOODEN SHACK - DAY\r\n\r\nCOGNITO, the criminal mastermind, is SLAMMED against the wall.\r\n\r\nCOGNITO\r\nWoah woah woah, Brick and Steel!\r\n\r\nSure enough, it's Brick and Steel, roughing up their favorite usual suspect.\r\n\r\nCOGNITO\r\nWhat is it you want with me, DICK?\r\n\r\nSteel SMACKS him.\r\n\r\nSTEEL\r\nWho's coming after us?\r\n\r\nCOGNITO\r\nEveryone's coming after you mate!  Scorpio, The Boy Band, Sparrow, Point Blank Sniper...\r\n\r\nAs he rattles off the long list, Brick and Steel share a look.  This is going to be BAD.\r\n\r\nCUT TO:\r\n\r\nINT. GARAGE - DAY\r\n\r\nBRICK and STEEL get into Mom's PORSCHE, Steel at the wheel.  They pause for a beat, the gravity of the situation catching up with them.\r\n\r\nBRICK\r\nThis is everybody we've ever put away.\r\n\r\nSTEEL\r\n(starting the engine)\r\nSo much for retirement!\r\n\r\nThey speed off.  To destiny!\r\n\r\nCUT TO:\r\n\r\nEXT. PALATIAL MANSION - DAY\r\n\r\nAn EXTREMELY HANDSOME MAN drinks a beer.  Shirtless, unfortunately.\r\n\r\nHis minion approaches offscreen:\r\n\r\nMINION\r\nWe found Brick and Steel!\r\n\r\nHANDSOME MAN\r\nI want them dead.  DEAD!\r\n\r\nBeer flies.\r\n\r\n> BURN TO PINK.\r\n\r\n> THE END <\r\n"}),this.JST["templates/samples/my_living_memory.fountain"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"title: My Living Memory \r\ncredit: by \r\nauthor: Dan Rahmel\r\ncopyright: (c) Copyright Dan Rahmel 2006\r\n\r\nFADE IN:\r\n \r\nINT. MATTHEW'S BEDROOM - DAY\r\n\r\nThe small bedroom is painted sky blue and has toys scattered all around. JOE sits on the floor with his 7 year-old son, MATTHEW. In cheap black shoes, a work shirt with his name on the patch, and oil-stained pants, Joe is dressed for work. \r\n\r\nThey play together. Assembling a puzzle. Matthew loads cargo with a small crane made with an erector set. Legos are used to create a fierce dinosaur. Occasionally Joe's wife, KATE, looks in on them. \r\n\r\nINT. MAIN ROOM - DAY\r\n\r\nClosing the door to his son's bedroom, Joe walks into the living room. The small house has a main room that combines the living room and dining area, along with an attached convenience kitchen off to the right. In the kitchen, Kate stands peeling potatoes.  \r\n\r\nJOE\r\nHe's down for his nap.\r\n\r\nKATE\r\nHe didn't argue?\r\n\r\nJOE\r\n(smiles)\r\nWhat do you think?\r\n\r\nKate looks at Joe skeptically.\r\n\r\nKATE\r\nI think you had to bribe him.\r\n\r\nJOE\r\nWe just had a man-to-man talk and he decided to lie down.\r\n\r\nKATE\r\nAnd?\r\n\r\nJOE\r\nAnd we both agreed that it'd be best if we went out for ice cream later. \r\n\r\nKate smiles to herself and returns to her peeling.\r\n\r\nKATE\r\nI wish you didn't have to go to work today. It is a Sunday. \r\n\r\nJOE\r\nBernard's short a driver. With everyone traveling over the holiday weekend... \r\n\r\nKATE\r\nI know. I just thought it would be nice if the three of us could go to the park together. \r\n\r\nJoe walks up behind Kate and embraces her.\r\n\r\nJOE\r\nNext weekend, I promise.\r\n\r\nHe kisses her cheek and heads for the door.\r\n\r\nJOE (CONT'D)\r\nI should be home by four.\r\n\r\nKATE\r\nWe'll be at the park most of the day.\r\n\r\nJOE\r\nCould you take some pictures?\r\n\r\nJoe points to a table in the living room that holds a digital camera and a photo printer. \r\n\r\nKATE\r\nSure.\r\n\r\nJOE\r\nAt least I won't miss the whole day.\r\n\r\nJoe turns at the door.\r\n\r\nJOE (CONT'D)\r\nI love you.\r\n\r\nKATE\r\nI know that, silly.\r\n\r\nEXT. PARK PLAYGROUND - DAY\r\n\r\nThe park playground is awash with children. Slipping down the slides, climbing the jungle gym, playing in the sandbox. Kate watches Matthew play and takes pictures of him with the camera. Although there are many other kids around, whenever Kate takes a picture, Matthew is playing alone in the frame.  \r\n\r\nINT. LIVING ROOM - DAY\r\n\r\nMATTHEW\r\nI'm tired, mommy.\r\n\r\nKATE\r\nThen go lie down. \r\n\r\nMatthew begins to dash for his room.\r\n\r\nKATE (CONT'D)\r\nDon't forget to wash up first.\r\n\r\nMatthew freezes, his face drops, and he sulks toward the bathroom. \r\n\r\nAt the printer table, Kate plugs in the digital camera. After she starts it printing the day's pictures, she walks to the answering machine on the kitchen counter. \r\n\r\nThe answering machine display shows three messages. She hits\r\nthe play button.\r\n\r\nMESSAGE MACHINE\r\n(serious)\r\nHello, this is Detective Burton and I'm calling for Mrs. Randolph. Please call me back at 555-1332 as soon as possible. \r\n\r\nLooking perplexed, Kate writes down the number. The next message begins. \r\n\r\nMESSAGE MACHINE (CONT'D)\r\n(urgent)\r\nMrs. Randolph, it's urgent that I speak to you. Please call me at 555-1332 or on my cell phone at 555-2312. \r\n\r\nKate writes down the cell number and begins to show signs of alarm. \r\n\r\nMESSAGE MACHINE (CONT'D)\r\n(resigned)\r\nMrs. Randolph, please call me as soon as you get this message. My cell phone number is 555-2312. \r\n\r\nShe grabs the phone and dials the cell phone number.\r\n\r\nBURTON\r\nHello?\r\n\r\nKATE\r\nHello? This is Kate Randolph. You left several messages on my machine. \r\n\r\nBURTON\r\nMrs. Randolph, I've been trying to reach you since this morning. \r\n\r\nKATE\r\nWhat's this about?\r\n\r\nBURTON\r\nYou're husband's been in an accident.\r\n\r\nKATE\r\nWhat?\r\n\r\nBURTON\r\nOn the freeway. I'm afraid a speeding car struck your husband while he was hooking up a tow. \r\n\r\nKATE\r\nWhere is Joe?\r\n\r\nBURTON\r\nMrs. Randolph, I'm sorry to have to be the one to tell you... there's never an easy way to break this... Mrs. Randolph your husband died at Washington Hospital this morning. \r\n\r\nKATE\r\n(shaking)\r\nThat's impossible. I just saw him a few hours ago. \r\n\r\nBURTON\r\nHe was taken to the hospital after the accident. He'd been alive when they left the scene, but by the time-- \r\n\r\nKATE\r\nI'm sorry, I can't talk right now.\r\n\r\nKate hangs up the phone violently and stands staring at the phone. She puts her hand to her mouth. A wound opens deep within her. She begins sobbing as she slowly slides to the kitchen floor. \r\n\r\nDISSOLVE TO:\r\n\r\nINT. LIVING ROOM - DAY\r\n\r\nThe front door opens and Kate, wearing all black, somberly enters the living room. Matthew has on a little suit and grasps her hand tightly. Behind Kate, her friend BETTY walks into the living room and closes the door. \r\n\r\nMATTHEW\r\nCan I go play with my toys?\r\n\r\nKATE\r\nGo on.\r\n\r\nShe gives him a tender little push.\r\n\r\nMATTHEW\r\nDo I have to wash up first?\r\n\r\nKATE\r\nNo, sweetie. Not today.\r\n\r\nHe runs for his room.\r\n\r\nBETTY\r\nHow are you holding up?\r\n\r\nKATE\r\nOh, I'm OK. Can I make you a cup of coffee? \r\n\r\nBETTY\r\nThanks, that would be nice.\r\n\r\nKate walks into the kitchen and starts the coffee machine.\r\n\r\nBETTY (CONT'D)\r\nYou know that Bob would have come if he'd been in the country. \r\n\r\nKATE\r\nI know. I'm just glad you were there.\r\n\r\nBETTY\r\nHow are you and Matthew set for money? If you need any help... \r\n\r\nKATE\r\nI haven't really even thought about that yet. It's been tight since Joe lost his trucking company. He'd just started driving the tow truck to pay the mortgage. I told him we should sell some of this stuff--\r\n(waves her hand at the TV, stereo, digital camera)\r\n-- but he wouldn't even talk about it. He let the life insurance lapse because he never thought... \r\n\r\nKate begins crying and Betty starts toward the kitchen.\r\n\r\nKATE (CONT'D)\r\n(motioning stop with her hand)\r\nNo, I'm all right. I'm all right. The coffee 'll be done in a minute. I'm going to check on Matthew. \r\n\r\nKate leaves the kitchen and goes into Matthew's bedroom. While waiting for Kate's return, Betty casually strolls around the living room. Off the mantle, she picks up a picture of Joe and Kate smiling into the camera. Another of Joe, Kate, and Matthew at Disneyland. \r\n\r\nBetty moves to the table that holds the digital camera and the printer. She picks up the pictures in the printer tray and begins to look through them. \r\n\r\nReturning from Matthew's room, Kate pours two cups of coffee. She brings the cups to the dinner table and sets them on coasters. \r\n\r\nKATE (CONT'D)\r\nMatthew still asks when his Daddy's coming home. \r\n\r\nBetty sits down across from her, looking through the pictures.\r\n\r\nBETTY\r\nAre these the last pictures of Joe and Matthew together?\r\n\r\nKATE\r\nWhat do you mean?\r\n\r\nBetty hands the pictures to Kate. When Kate sees the first picture, her face drains of blood and she drops her coffee cup to the floor. \r\n\r\nBETTY\r\nWhat is it?\r\n\r\nThe top picture, originally taken in the park with only Matthew, shows Joe standing directly behind him with a hand on Matthew's shoulder. His other hand points off into the distance. \r\n\r\nKate stares at the picture in horror, not knowing what to make of it. She looks through several of the others. They all show Joe in the frame standing next to Matthew. \r\n\r\nKATE\r\nI don't understand this.\r\n\r\nBETTY\r\nWhat's wrong?\r\n\r\nKATE\r\nJoe wasn't there the morning these were taken.\r\n\r\nBETTY\r\nWhat do you mean?\r\n\r\nKATE\r\nI mean that Joe wasn't in the park that day.\r\n\r\nBetty takes back some of the pictures and looks at them closely. \r\n\r\nBETTY\r\nCould you be mistaken? Maybe these pictures were left in the camera? Maybe you took them some other day? \r\n\r\nKATE\r\nNo, I cleared the camera before I left. Besides, Joe's never been to this park. \r\n\r\nKate drops the photo she's holding and her mind tries to find an explanation where there is none. Betty scrutinizes the picture she holds. \r\n\r\nBETTY\r\nWhy is he wearing those strange clothes? \r\n\r\nKate is barely able to break out of her catatonia to speak.\r\n\r\nKATE\r\nWhat do you mean?\r\n\r\nBETTY\r\nI never remember Joe with sideburns.\r\n\r\nKATE\r\nI don't think--\r\n\r\nBETTY\r\nI've never seen him wear clothes like this either.\r\n\r\nKate tentatively picks up one of the pictures and examines it. \r\n\r\nKATE\r\nThose aren't Joe's clothes.\r\n(startled)\r\nThat's not Joe.\r\n\r\nBETTY\r\nWhat do you mean?\r\n\r\nWith a suddenness that makes Betty jump, Kate rushes into another room. When she returns, she's carrying an old photo album. She sets the album on the table and feverishly looks through it until she comes to a particular page. \r\n\r\nKATE\r\nOh my God...\r\n\r\nBetty turns the album so she can see it. In an old photo stands the man from the pictures. Same clothes. Same sideburns. \r\n\r\nBETTY\r\nWho is that?\r\n\r\nKATE\r\nThat's Joe's father.\r\n\r\nBetty takes the photo album and begins paging through it.\r\n\r\nBETTY\r\nHe was a soldier.\r\n\r\nKATE\r\nA marine. He served two tours in Vietnam. His name was Harry. Oh God, I don't think I can handle this right now. \r\n\r\nBETTY\r\nWhy do you think he's appeared in these pictures? Tell me about him. \r\n\r\nKATE\r\nJoe never really knew him. He died when Joe was very young. \r\n\r\nBETTY\r\nHow did he die?\r\n\r\nKate stares forward in a daze.\r\n\r\nKATE\r\nHe'd just come back from Vietnam. He flew in to the airport and was supposed to be on the midnight train home that night. They found his body the next day. \r\n\r\nBetty pauses and looks down.\r\n\r\nBETTY\r\nSuicide?\r\n\r\nKate shakes her head.\r\n\r\nKATE\r\nNo. No. The policeman told Joe's mother that some men tried to mug him. Steal his things. Harry fought them off and got away, but he'd been stabbed. The early shift conductor found him behind the station. \r\n\r\nBETTY\r\nWhat happened to Joe and his mother?\r\n\r\nKATE\r\nThe military stepped in and took care of them. His father's benefits even paid for Joe's business college. Joe always wanted to know about his father. A few years ago, he went to see some of the men Harry served with when he was in Vietnam. They said he'd been wounded saving a whole platoon of men on his last tour. That's how he got the Silver Star. Those stories of his father, they meant so much to Joe... \r\n\r\nThe memory of Joe's loss breaks through again and she can\r\nbarely finish the story.\r\n\r\nKATE (CONT'D)\r\nI can't tell you how much Joe regretted that he never knew his father. Now Matthew will have the same rift in his life. \r\n\r\nBetty comes around the table and hugs Kate. Slowly Kate's tears subside. \r\n\r\nKATE (CONT'D)\r\nBut what is he doing in these pictures?\r\n\r\nBetty retakes her seat and picks up some of the pictures.\r\n\r\nBETTY\r\nMaybe he's trying to tell you something about Joe. \r\n\r\nKate looks more closely at the photos.\r\n\r\nKATE\r\nWhere is he pointing?\r\n\r\nBetty pages through several of the pictures.\r\n\r\nBETTY\r\nI don't know. Somewhere outside the photo.\r\n\r\nKATE\r\nHe's always pointing in the same direction.\r\n\r\nBETTY\r\nI think you're right.\r\n\r\nResolutely, Kate gets up from the table.\r\n\r\nKATE\r\nI need you to stay here a while.\r\n\r\nBETTY\r\nWhat?\r\n\r\nRushing around the room, Kate grabs her coat and unplugs the camera from the printer. \r\n\r\nKATE\r\nI need you to watch Matthew for a while.\r\n\r\nBETTY\r\nWhere are you going?\r\n\r\nKATE\r\nBack to the park. I need to see if I can understand what he's trying to tell me. \r\n\r\nBETTY\r\nDo you think this is a good idea? Maybe you should--\r\n\r\nKate looks Betty in the eye.\r\n\r\nKATE\r\nBetty, I've lost so much already. I need to know what this is about.\r\n\r\nBETTY\r\nGo on.\r\n\r\nKATE\r\nI'll be back as soon as I can.\r\n\r\nEXT. PARK PLAYGROUND - DAY\r\n\r\nOn the playground, Kate tries to position herself where she originally took the pictures. The viewfinder on the back of the camera shows nothing unusual. She moves to another place. Nothing. \r\n\r\nKate becomes increasingly frantic. She can't see anything but the normal slides, swing set, and sand box. She tries zooming in. She changes the exposure.\r\n\r\nShe adjusts every camera setting and still nothing. Finally, she takes a picture with the camera. She presses the retrieve button to display it. \r\n\r\nStanding in the frame, a man dead more than 30 years smiles back at her. She nearly drops the camera when the image appears. Shaking but regaining control of herself, Kate takes another picture. \r\n\r\nHarry points away from the playground off to the east. Kate follows the direction his finger is pointing and sees a hilltop. She takes a picture of the hill. \r\n\r\nWhen she displays the picture, Harry appears on top of the hill pointing down the other side. She breaks into a run. \r\n\r\nEXT. HILLTOP - DAY\r\n\r\nWhen Kate reaches the top of the hill, she looks down on the other side. \r\n\r\nKate takes a step backward when she sees that stretching below her is a train station. Gathering up her courage, she begins to walk toward it. \r\n\r\nEXT. TRAIN STATION - DAY\r\n\r\nThe train station is very modern. Passengers bustle around the platform. Trains come and go. The actual depot looks like a piece of modern art. Kate hesitatingly walks toward the station and looks around confused. \r\n\r\nAn older conductor approaches her.\r\n\r\nCONDUCTOR\r\nYou look a bit lost. Maybe I can be of help? \r\n\r\nKate motions around the train station.\r\n\r\nKATE\r\nThis is all new.\r\n\r\nThe conductor looks around the station with pride.\r\n\r\nCONDUCTOR\r\nIt was refurbished just two years ago. It does look good as new. \r\n\r\nKATE\r\nWhat's left over?\r\n\r\nCONDUCTOR\r\nExcuse me?\r\n\r\nKATE\r\nBefore it was refurbished. What's left of the original station? \r\n\r\nCONDUCTOR\r\nWell, it looked pretty much like this before they redid it. \r\n\r\nKATE\r\nThe design of the station. It doesn't look like something from the 1960s. \r\n\r\nCONDUCTOR\r\n(grins knowingly)\r\nAre you one of those architecture students from the university? \r\n\r\nKATE\r\nNo, I just wanted to know.\r\n\r\nCONDUCTOR\r\nIt doesn't look like it's from the 60s because this station's only been here for 15 years. \r\n\r\nKATE\r\nAnd before that?\r\n\r\nCONDUCTOR\r\nThe old train station?\r\n\r\nKATE\r\nIt was knocked down?\r\n\r\nCONDUCTOR\r\nNo, they just rerouted the track. The old station still sits next to the old track. They talked about making it a landmark at one time but-- \r\n\r\nKATE\r\nWhere is it?\r\n\r\nCONDUCTOR\r\nIt's down the hill there about a quarter mile.\r\n\r\nKATE\r\nThank you.\r\n\r\nCONDUCTOR\r\nYou're welcome--\r\n\r\nKate doesn't even let the conductor finish before she dashes\r\noff.\r\n\r\nEXT. OLD TRAIN STATION\r\n\r\nFrom the top of the hill, Kate stares down at a little station standing adjacent to some dead track. Once colored bright red, the paint has faded, although it still looks in good condition. The windows on the station have been boarded up. \r\n\r\nKate takes another picture. When she displays it, Harry stands pointing at the back of the station. \r\n\r\nSlowly, Kate walks down the hill, not really wanting to go any farther. Her stuttering progress indicates she fears the unknown she's about to confront. Is she walking into a graveyard? \r\n\r\nWhen she reaches the back of the station, she raises the camera and takes another picture. Harry kneels next to the lowest siding board of the building. \r\n\r\nKate moves closer to examine the board. A few of the nails are missing on the left side. She hesitantly reaches down and grabs hold of the board. With a little pressure, it bends backward. \r\n\r\nStartled, she jumps back when something falls out and lands on the ground. Kate carefully picks up an old envelope and turns it over in her hands. It's an old letter addressed to Catherine Randolph. \r\n\r\nThe gum used to hold the envelope flap closed is long gone. Kate raises the flap and takes out the papers inside. A letter is on top. She unfolds it and begins reading. \r\n\r\nHARRY (V.O.)\r\nMy dearest Catherine, I'm writing you this letter because as much as I want to, I don't think I'll be making it back. Things are crazy over here. We're preparing for an offensive that nobody except the top brass thinks we can win. I hope you'll forgive me for breaking my promise of returning home. \r\n\r\nKate stops reading for a moment as a single tear runs down her cheek. She sits on the ground and begins again. \r\n\r\nHARRY (V.O.) (CONT'D)\r\nI spend all of my time thinking about you and the boy. I know I haven't been able to provide you with everything I wanted to. My CO was a stockbroker before he came over to this insane place. He helped me invest all of the extra money I could scrounge together from my last few of paychecks. Maybe this can help pay for Joe's education. \r\n\r\nKate pulls aside the letter and gasps at the papers underneath. A stock certificate says IBM in large bold letters, 800 shares. Below the corporation name, the certificate is dated 1969. \r\n\r\nHARRY (CONT'D)\r\nI don't think I told you often enough how much I love you. I wish I could be there to help you raise our son. \r\n\r\nMary feels her heart melt.\r\n\r\nHARRY (CONT'D)\r\nI know Joe will grow up to become a good man. \r\n\r\nKATE\r\n(crying)\r\nHe did. He did become a good man, Harry.\r\n\r\nHARRY (V.O.)\r\nTell him that I love him. I'm sure he'll know, but tell him anyway. Wherever I am then, I'll be watching over you two. I love you with all my heart. Harry. \r\n\r\nThe camera sitting on the ground next to her activates itself and takes a picture. Kate picks up the camera and loads the photo. On it, Harry waves goodbye. As Kate watches, his image fades from the photo. \r\n\r\nKATE\r\nGoodbye Harry and thank you. Tell Joe that I'll try to raise Matthew to be as good of person as he was. \r\n\r\nAs Kate finishes speaking, the camera moves to an overhead POV. Slowly the camera pulls back. Kate's image grows smaller and smaller as the POV ascends into the sky. \r\n\r\n> FADE OUT."}),this.JST["templates/samples/printing_trouble.fountain"]=e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Title: Printing Trouble\r\nCredit: written by\r\nAuthor: Dan Rahmel\r\nCopyright: (c) Copyright Dan Rahmel 2006\r\n\r\nFADE IN:\r\n\r\nEXT. SKYSCRAPER - NIGHT\r\n\r\nIn the dark early morning, a glass and steel skyscraper towers over the empty downtown streets. A single lighted window resembles a cyclops eye looking out from the sleeping structure. \r\n\r\nINT. COPY ROOM - NIGHT\r\n\r\nThe single red light on the copier machine shines in the dark room. The button reads STANDBY. A LARGE HAND reaches in and strikes the green ACTIVATE button and a deep whirring sound begins as the copier wakes to life. \r\n\r\nINT. HALLWAY - NIGHT\r\n\r\nThe large hand is attached to an even larger man, MIKE. He shambles down the hallway toward the light that shines from a single office.\r\n\r\nINT. OFFICE - NIGHT\r\n\r\nFootball memorabilia and paperwork dominate the office. Game balls, a framed jersey with a blood stain on the shoulder, various trophies, and so on. Surfaces not covered by football junk or general office dreck hold a vast array of empty and semi-empty coffee cups.\r\n\r\nPerched on the edge of the vast oak desk is a weathered LASER PRINTER. It looks like it's seen as much time on the field as any football player.\r\n\r\nMike enters the room and pitches a folder atop a pile of folders next to a desk clock. The clock face reads 4:32.\r\n\r\nMIKE drops into the leather chair behind his desk. Sighing, he leans forward and grabs a sheet from the printer output tray. He carefully places the page into an open 3-ring binder that sits in the middle of the desk. He snaps the three rings of the binder closed with a CLACK. \r\n\r\nMIKE\r\nAll 623 pages.\r\n\r\nMike turns to the computer and bumps his coffee mug -- almost knocking it to the floor. He wearily pushes the mug into a less dangerous position and enters the final numbers with the computer keypad. \r\n\r\nMIKE (CONT'D)\r\nNow just gotta print the summary.\r\n\r\nHe works the mouse--\r\n\r\nMIKE (CONT'D)\r\nPrint this... \r\n\r\nChecks the printer status light--\r\n\r\nMIKE (CONT'D)\r\n...drop it off... \r\n\r\nHits the Ready button--\r\n\r\nMIKE (CONT'D)\r\n...go home... \r\n\r\nFlips out the paper output catch--\r\n\r\nMIKE (CONT'D)\r\n...take the day off... \r\n\r\nReturns his attention to the mouse and display--\r\n\r\nMIKE (CONT'D)\r\nsleep...\r\n\r\nMike looks at the wall clock that reads 4:50 AM.\r\n\r\nMIKE (CONT'D)\r\nGuess it's already Monday. The means Madden tonight. \r\n\r\nDramatically he hits two keys to begin printing. The printer warms up. He fidgets with the debris on his desk. \r\n\r\nHe twiddles his fingers and watches the screen display a variety of status bars such as 'Processing...', 'Spooling...' 'Preparing to print...'. \r\n\r\nMIKE (CONT'D)\r\n(whispering)\r\nJust this once, work right you bastard... I know you've printed all night...just this last page... \r\n\r\nThe printer beeps. Mike scans the printer status lights.\r\n\r\nMIKE (CONT'D)\r\nOut of paper. Crap!\r\n\r\nMike lurches out of his chair and heads out of the room. \r\n\r\nAs soon as Mike steps through the doorway, the printer audibly snickers behind him. \r\n\r\nPTEW! Printer spits out the cable in back.\r\n\r\nMike returns with a fresh ream of paper. He yanks the paper tray out of the printer. Surprisingly, there are still a few sheets in the tray. \r\n\r\nMIKE (CONT'D)\r\nI thought you said paper out.\r\n\r\nMike shoves the paper tray home and the Paper Out indicator is still lit. He pulls the paper tray again. \r\n\r\nHe tears open the new ream and shoves a stack of new paper into the tray. \r\n\r\nWhile Mike fixes the paper in the tray, the lights on the printer shimmer in a strange pattern. When he glances at the panel, the lights show the steady Paper Out indicator. \r\n\r\nTenderly, he slides the cartridge back into place.\r\n\r\nMIKE (CONT'D)\r\nThere ya go. Now print...please.\r\n\r\nWhirring sounds as the printer warms up again. Mike drops into his chair. \r\n\r\nFlashing on the computer screen.\r\n\r\nMIKE (CONT'D)\r\n(reads)\r\n'Printer not connected.' I just printed 600 pages?!? \r\n\r\nExamining the printer, Mike sees the end of the printer cable. \r\n\r\nMIKE (CONT'D)\r\nHow'd that happen...\r\n\r\nHe plugs the printer back in. \r\n\r\nMIKE (CONT'D)\r\nMaybe you're the only known victim of the Y2K bug. \r\n\r\nMike waits. Drinks from a mug sitting next to the monitor. The cold brackish coffee makes him wince and he slams the cup on the desk. (pause) With resignation, he picks up the cup and drinks again. He taps on his desk, waiting. \r\n\r\nThe page begins feeding through the printer. Mike's face brightens with elation. KRUMF. The printer eats the rest of the page. \r\n\r\nMIKE (CONT'D)\r\nWhat now?\r\n\r\nMike opens the printer, clears the jam. \r\n\r\nMIKE (CONT'D)\r\n(word-by-word)\r\nGive me my damn page!\r\n\r\nHe hits print again. A page starts printing. \r\n\r\nMIKE (CONT'D)\r\nOK...OK...\r\n\r\nMike sits with his eyes closed, praying for the right output. The page feeds perfectly out of the printer. Mike opens his eyes. \r\n\r\nMIKE (CONT'D)\r\nYes!\r\n\r\nHe grabs the sheet that was spit out. When he glances at it, the smudged page reads: \"Error: Offending Command. Please try to print again.\" \r\n\r\nMike steams for a moment, crumples the paper and throws it aside. He sharply exhales. He puts his hands together as if praying. \r\n\r\nMIKE (CONT'D)\r\nOh God of Printers, I'm begging you. I just need this page. I'll buy you one of the fancy gold-plated cables if you'll grant this humble request. \r\n\r\nHe hits print again. Half the page feeds. Mikes does 'come on' hand signals as he silently urges the paper out of the machine. \r\n\r\nThe page jams and crumples.\r\n\r\nMike sighs. He opens up the front feed door and hits print again. \r\n\r\nMIKE (CONT'D)\r\nMaybe if I oil the rollers...\r\n\r\n> FADE TO:\r\n\r\nINT. OFFICE\r\n\r\nClock reads 5:42\r\n\r\nSound of paper crumpling.\r\n\r\n> FADE TO:\r\n\r\nINT. OFFICE\r\n\r\nClock reads 6:37\r\n\r\n(O.C.) Mike shouts and curses the printer.\r\n\r\n> FADE TO:\r\n\r\nINT. OFFICE - DAY\r\n\r\nClock reads 7:05\r\n\r\nMike stares into space, his hair disheveled. Covered in toner he sits in a room filled with sheets of crumpled, half printed paper. \r\n\r\nThe INTERCOM on the phone buzzes.\r\n\r\nMike stares at the phone in horror. He glances up at the clock. He straightens his tie poorly. \r\n\r\nHesitantly, he hits the button to pick up. A voice booms from the intercom speaker. \r\n\r\nINTERCOM\r\nHow ya doing Mike?\r\n\r\nMIKE\r\nGood morning, sir.\r\n\r\nINTERCOM\r\nGood morning? Try fantastic morning! I can almost hear the birds chirping outside my window. They're telling me to roll up my sleeves and dig in. That's why we're here, isn't it? \r\n\r\nMIKE\r\nYes, I--\r\n\r\nINTERCOM\r\nI have to be honest with you, Mike...I've got a problem. The Willard report...supposed to be on my desk at 7... It's... already 7:05. Is there some issue I should know about? \r\n\r\nMIKE\r\nWell, the printer--\r\n\r\nINTERCOM\r\nMy old work horse? I loved that printer. Put PASSION behind every sheet of paper it fed. Do you know what I mean by doing your job with some PASSION, Mike? \r\n\r\nMIKE\r\nYes, I--\r\n\r\nINTERCOM\r\nIf only people would show that kind of passion -- Mike. So what's the problem? \r\n\r\nMIKE\r\n(beat)\r\nThere is no problem.\r\n\r\nINTERCOM\r\nNow that's what I want to here! So I can expect two copies of that report on my desk in...say...twenty minutes? \r\n\r\nMIKE\r\nI'll bring it over.\r\n\r\nINTERCOM\r\nKnew I could count on you, Mike.\r\n\r\nMike mimics 'Knew I could count on you.' He looks down at the printer, stares at the wall a moment, and then reaches for a pen and paper. \r\n\r\n> FADE TO:\r\n\r\nINT. OFFICE\r\n\r\nWe see a page with a hand written grid of numbers on lined paper. It's the first page of a report folder that Mike holds. Sweat beads on his upper lip. Mike slowly closes the report and makes the sign of the cross. \r\n\r\nHe turns to stare at the printer and his gaze is deadly.\r\n\r\nMIKE\r\nThat was the final straw.\r\n\r\n> CUT TO:\r\n\r\nEXT. STREET\r\n\r\nCar idles by the curb.\r\n\r\nINT. CAR\r\n\r\nMike engages in elaborate driving preparation. He pulls on a pair of leather racing gloves, checks all the car gauges, smooths down his hair, and revs the engine. The smile in his eyes spreads to his lips. \r\n\r\nHe puts the car into gear and hits the gas.\r\n\r\nEXT. STREET\r\n\r\nThe car barrels down the street.\r\n\r\nEXT. STREET\r\n\r\nThe printer sits in the middle of the street lane.\r\n\r\nEXT. STREET\r\n\r\nCar revs and gains speed.\r\n\r\nEXT. STREET\r\n\r\nThe printer sits.\r\n\r\nINT. CAR\r\n\r\nMike speeds up and laughs manically.\r\n\r\nEXT. STREET\r\n\r\nPRINTER\r\nUh-oh.\r\n\r\nINT. CAR\r\n\r\nMike's joy disappears. He gasps at what he sees through the windshield. \r\n\r\nEXT. STREET\r\n\r\nThe printer magically takes a short hop toward the other\r\nlane. It hops again.\r\n\r\nINT. CAR\r\n\r\nMIKE\r\nWhat the fu...\r\n\r\nMike floors it.\r\n\r\nEXT. STREET\r\n\r\nPrinter makes several hops and gets out of the way.\r\n\r\nEXT. STREET\r\n\r\nThe car goes by the spot previously occupied by the printer. Mike slams on the brakes. \r\n\r\nINT. CAR\r\n\r\nMIKE\r\nYou're not getting off that easy.\r\n\r\nEXT. CAR\r\n\r\nMike turns the car around for another pass. The car sprints toward the printer. \r\n\r\nINT. CAR\r\n\r\nMike focuses intently on the road ahead.\r\n\r\nEXT. STREET\r\n\r\nThe printer again hops out of the way and leaps onto the\r\ncurb.\r\n\r\nEXT. STREET\r\n\r\nThe car pulls to the curb. Mike pops the trunk and gets out of the car. He walks around to the back and grabs a large, heavy crowbar. \r\n\r\nMIKE\r\nEscape this you toner-sucking bastard.\r\n\r\nEXT. SIDEWALK\r\n\r\nMike walks menacingly toward the printer. In the gutter next to the printer is a glass bottle. Testing, Mike swings the end of the bar down on it. The bottle shatters easily. \r\n\r\nHe hefts the weight of the crowbar and smiles. He turns toward the printer. As he lifts the crowbar over his head, the printer mewls. \r\n\r\nMike looks confused.\r\n\r\nPrinter mewls again.\r\n\r\nMike slowly lowers the crowbar. He shakes the bar over the printer. \r\n\r\nMIKE\r\nWhat am I gonna do with you?\r\n\r\nMike sighs.\r\n\r\nEXT. SIDEWALK\r\n\r\nMike sits on the sidewalk next to the printer. He disgustedly throws the crowbar into the street. \r\n\r\nMIKE\r\nI need a new printer or I need a new boss... \r\n\r\nMINA walks up and a shadow falls across Mike.\r\n\r\nMINA\r\nIs anything wrong?\r\n\r\nMIKE\r\nNo...just trying to murder my printer.\r\n\r\nMINA\r\nOhhh....\r\n\r\nMIKE\r\nDon't worry about me. \r\n(whispering to Mina)\r\nGonna make it look like a suicide.\r\n\r\nMINA\r\nUmm... OK... well... you have a nice day.\r\n\r\nMIKE\r\nYeah... see you later.\r\n\r\nMike shakes his head.\r\n\r\nThe printer makes a noise like it's warming up. A sheet feeds into the output tray. Mike grabs the paper. It's a cartoon picture of Mina standing by the curb. \r\n\r\nA second picture prints of cartoon Mina bending over. Mike looks puzzled. \r\n\r\nA third picture prints and when Mike looks at it, he flinches. He looks again and flinches again. \r\n\r\nMIKE (CONT'D)\r\nYou must have been bored silly printing my stuff. \r\n\r\nA light bulb goes off in Mike's head. He smiles and glances at the printer. \r\n\r\nINT. OFFICE\r\n\r\nBehind his desk, Mike pats the printer happily as it spits out pages. Two folders sit closed in front of him. \r\n\r\nThe intercom buzzes. The voice on the intercom is grumpy.\r\n\r\n\r\nINTERCOM\r\nMike, do you have the Southworth report ready?\r\n\r\nMIKE\r\nSure do.\r\n\r\nINTERCOM\r\nI hope we won't have a repeat of our last problem.\r\n\r\nMIKE\r\nNope. Took me a little time to understand how you treated your old printer. \r\n\r\nMike looks at his computer screen that shows a web page for 'Horny Virgin Sluts.' \r\n\r\nMIKE (CONT'D)\r\nOnce I figured that out, I've dealt with it like you did and it hums right along. \r\n\r\nINTERCOM\r\nWhat do you mean by that?\r\n\r\nIgnoring the voice, Mike picks up the two folders.\r\n\r\nMIKE\r\nI've got the Southworth report in front of me. I'll bring it right over. \r\n\r\nINTERCOM\r\nDon't bother. I'll send Donna over to pick all three copies. \r\n\r\nMIKE\r\nThree copies...\r\n\r\nMike looks down and the intercom light is already off.\r\n\r\nMIKE (CONT'D)\r\nIt was supposed to be two copies, you dick... \r\n\r\nMike sighs, opens a drawer, and takes out an empty folder. Mike grabs all of three folders and heads for the copy room. \r\n\r\nAfter a few moments, a knock at the half open door.\r\n\r\nDONNA\r\nMike? Hello?\r\n\r\nDonna walks into the room. She spots the stack of paper in the printer. \r\n\r\nDONNA (CONT'D)\r\nThis must be it...\r\n\r\nShe reaches for it.\r\n\r\n> FADE TO BLACK.\r\n\r\nDONNA (V.O.) (CONT'D)\r\nThat's disgusting.\r\n\r\n> FADE OUT.\r\n"}),this.JST}),function(e){var t={};t.VERSION="0.9.13";var n,r={},i=function(e,t){return function(){return t.apply(e,arguments)}},s=function(){var e=arguments,t=e[0],n,r;for(r=1;r<e.length;r++)for(n in e[r])!(n in t)&&e[r].hasOwnProperty(n)&&(t[n]=e[r][n]);return t},o=function(e,t){return{value:e,name:t}};t.DEBUG=o(1,"DEBUG"),t.INFO=o(2,"INFO"),t.WARN=o(4,"WARN"),t.ERROR=o(8,"ERROR"),t.OFF=o(99,"OFF");var u=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};u.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(t.DEBUG,arguments)},info:function(){this.invoke(t.INFO,arguments)},warn:function(){this.invoke(t.WARN,arguments)},error:function(){this.invoke(t.ERROR,arguments)},invoke:function(e,t){}};var a=new u({filterLevel:t.OFF});(function(){var e=t;e.enabledFor=i(a,a.enabledFor),e.debug=i(a,a.debug),e.info=i(a,a.info),e.warn=i(a,a.warn),e.error=i(a,a.error),e.log=e.info})(),t.setHandler=function(e){n=e},t.setLevel=function(e){a.setLevel(e);for(var t in r)r.hasOwnProperty(t)&&r[t].setLevel(e)},t.get=function(e){return r[e]||(r[e]=new u(s({name:e},a.context)))},t.useDefaults=function(e){if(!console)return;t.setLevel(e||t.DEBUG),t.setHandler(function(e,n){var r=console.log;if(t.disabled||t.filter&&t.filter.indexOf(n.name)==-1)return;n.name&&(e[0]="["+n.level.name+"] ["+(new Date).toTimeString().split(" ")[0]+"] ["+n.name+"] "+e[0]),n.level===t.WARN&&console.warn?r=console.warn:n.level===t.ERROR&&console.error?r=console.error:n.level===t.INFO&&console.info&&(r=console.info),Function.prototype.apply.call(r,console,e)})},typeof define=="function"&&define.amd?define("logger",t):typeof module!="undefined"&&module.exports?module.exports=t:(t._prevLogger=e.Logger,t.noConflict=function(){return e.Logger=t._prevLogger,t},e.Logger=t)}(this),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function g(e){var t=e.length,n=h.type(e);return"function"===n||h.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function S(e,t,n){if(h.isFunction(t))return h.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return h.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(E.test(t))return h.filter(t,e,n);t=h.filter(t,e)}return h.grep(e,function(e){return h.inArray(e,t)>=0!==n})}function A(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function _(e){var t=M[e]={};return h.each(e.match(O)||[],function(e,n){t[n]=!0}),t}function P(){T.addEventListener?(T.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(T.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))}function H(){(T.addEventListener||"load"===event.type||"complete"===T.readyState)&&(P(),h.ready())}function q(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(I,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:F.test(n)?h.parseJSON(n):n}catch(i){}h.data(e,t,n)}else n=void 0}return n}function R(e){var t;for(t in e)if(("data"!==t||!h.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function U(e,t,r,i){if(h.acceptData(e)){var s,o,u=h.expando,a=e.nodeType,f=a?h.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||void 0!==r||"string"!=typeof t)return l||(l=a?e[u]=n.pop()||h.guid++:u),f[l]||(f[l]=a?{}:{toJSON:h.noop}),("object"==typeof t||"function"==typeof t)&&(i?f[l]=h.extend(f[l],t):f[l].data=h.extend(f[l].data,t)),o=f[l],i||(o.data||(o.data={}),o=o.data),void 0!==r&&(o[h.camelCase(t)]=r),"string"==typeof t?(s=o[t],null==s&&(s=o[h.camelCase(t)])):s=o,s}}function z(e,t,n){if(h.acceptData(e)){var r,i,s=e.nodeType,o=s?h.cache:e,u=s?e[h.expando]:h.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){h.isArray(t)?t=t.concat(h.map(t,h.camelCase)):t in r?t=[t]:(t=h.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!R(r):!h.isEmptyObject(r))return}(n||(delete o[u].data,R(o[u])))&&(s?h.cleanData([e],!0):l.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function et(){return!0}function tt(){return!1}function nt(){try{return T.activeElement}catch(e){}}function rt(e){var t=it.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function wt(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==B?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==B?e.querySelectorAll(t||"*"):void 0;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[i]);i++)!t||h.nodeName(r,t)?s.push(r):h.merge(s,wt(r,t));return void 0===t||t&&h.nodeName(e,t)?h.merge([e],s):s}function Et(e){J.test(e.type)&&(e.defaultChecked=e.checked)}function St(e,t){return h.nodeName(e,"table")&&h.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function xt(e){return e.type=(null!==h.find.attr(e,"type"))+"/"+e.type,e}function Tt(e){var t=vt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Nt(e,t){for(var n,r=0;null!=(n=e[r]);r++)h._data(n,"globalEval",!t||h._data(t[r],"globalEval"))}function Ct(e,t){if(1===t.nodeType&&h.hasData(e)){var n,r,i,s=h._data(e),o=h._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)h.event.add(t,n,u[n][r])}o.data&&(o.data=h.extend({},o.data))}}function kt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!l.noCloneEvent&&t[h.expando]){i=h._data(t);for(r in i.events)h.removeEvent(t,r,i.handle);t.removeAttribute(h.expando)}"script"===n&&t.text!==e.text?(xt(t).text=e.text,Tt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),l.html5Clone&&e.innerHTML&&!h.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&J.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Ot(t,n){var r,i=h(n.createElement(t)).appendTo(n.body),s=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(i[0]))?r.display:h.css(i[0],"display");return i.detach(),s}function Mt(e){var t=T,n=At[e];return n||(n=Ot(e,t),"none"!==n&&n||(Lt=(Lt||h("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Lt[0].contentWindow||Lt[0].contentDocument).document,t.write(),t.close(),n=Ot(e,t),Lt.detach()),At[e]=n),n}function jt(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function Vt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Xt.length;while(i--)if(t=Xt[i]+n,t in e)return t;return r}function $t(e,t){for(var n,r,i,s=[],o=0,u=e.length;u>o;o++)r=e[o],r.style&&(s[o]=h._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&V(r)&&(s[o]=h._data(r,"olddisplay",Mt(r.nodeName)))):(i=V(r),(n&&"none"!==n||!i)&&h._data(r,"olddisplay",i?n:h.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function Jt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Kt(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;4>s;s+=2)"margin"===n&&(o+=h.css(e,n+X[s],!0,i)),r?("content"===n&&(o-=h.css(e,"padding"+X[s],!0,i)),"margin"!==n&&(o-=h.css(e,"border"+X[s]+"Width",!0,i))):(o+=h.css(e,"padding"+X[s],!0,i),"padding"!==n&&(o+=h.css(e,"border"+X[s]+"Width",!0,i)));return o}function Qt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=Pt(e),o=l.boxSizing&&"border-box"===h.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Ht(e,t,s),(0>i||null==i)&&(i=e.style[t]),Dt.test(i))return i;r=o&&(l.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Kt(e,t,n||(o?"border":"content"),r,s)+"px"}function Gt(e,t,n,r,i){return new Gt.prototype.init(e,t,n,r,i)}function on(){return setTimeout(function(){Yt=void 0}),Yt=h.now()}function un(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=X[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function an(e,t,n){for(var r,i=(sn[t]||[]).concat(sn["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function fn(e,t,n){var r,i,s,o,u,a,f,c,p=this,d={},v=e.style,m=e.nodeType&&V(e),g=h._data(e,"fxshow");n.queue||(u=h._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,p.always(function(){p.always(function(){u.unqueued--,h.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=h.css(e,"display"),c="none"===f?h._data(e,"olddisplay")||Mt(e.nodeName):f,"inline"===c&&"none"===h.css(e,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Mt(e.nodeName)?v.zoom=1:v.display="inline-block")),n.overflow&&(v.overflow="hidden",l.shrinkWrapBlocks()||p.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],en.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[r])continue;m=!0}d[r]=g&&g[r]||h.style(e,r)}else f=void 0;if(h.isEmptyObject(d))"inline"===("none"===f?Mt(e.nodeName):f)&&(v.display=f);else{g?"hidden"in g&&(m=g.hidden):g=h._data(e,"fxshow",{}),s&&(g.hidden=!m),m?h(e).show():p.done(function(){h(e).hide()}),p.done(function(){var t;h._removeData(e,"fxshow");for(t in d)h.style(e,t,d[t])});for(r in d)o=an(m?g[r]:0,r,p),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function ln(e,t){var n,r,i,s,o;for(n in e)if(r=h.camelCase(n),i=t[r],s=e[n],h.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=h.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function cn(e,t,n){var r,i,s=0,o=rn.length,u=h.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;for(var t=Yt||on(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:h.extend({},t),opts:h.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||on(),duration:n.duration,tweens:[],createTween:function(t,n){var r=h.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(ln(l,f.opts.specialEasing);o>s;s++)if(r=rn[s].call(f,e,l,f.opts))return r;return h.map(l,an,f),h.isFunction(f.opts.start)&&f.opts.start.call(e,f),h.fx.timer(h.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Fn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(O)||[];if(h.isFunction(n))while(r=s[i++])"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function In(e,t,n,r){function o(u){var a;return i[u]=!0,h.each(e[u]||[],function(e,u){var f=u(t,n,r);return"string"!=typeof f||s||i[f]?s?!(a=f):void 0:(t.dataTypes.unshift(f),o(f),!1)}),a}var i={},s=e===Hn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function qn(e,t){var n,r,i=h.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&h.extend(!0,e,n),e}function Rn(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function Un(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Jn(e,t,n,r){var i;if(h.isArray(t))h.each(t,function(t,i){n||Wn.test(e)?r(e,i):Jn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==h.type(t))r(e,t);else for(i in t)Jn(e+"["+i+"]",t[i],n,r)}function Yn(){try{return new e.XMLHttpRequest}catch(t){}}function Zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function ir(e){return h.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l={},c="1.11.1",h=function(e,t){return new h.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,d=/^-ms-/,v=/-([\da-z])/gi,m=function(e,t){return t.toUpperCase()};h.fn=h.prototype={jquery:c,constructor:h,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=h.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return h.each(this,e,t)},map:function(e){return this.pushStack(h.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},h.extend=h.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;for("boolean"==typeof o&&(f=o,o=arguments[u]||{},u++),"object"==typeof o||h.isFunction(o)||(o={}),u===a&&(o=this,u--);a>u;u++)if(null!=(i=arguments[u]))for(r in i)e=o[r],n=i[r],o!==n&&(f&&n&&(h.isPlainObject(n)||(t=h.isArray(n)))?(t?(t=!1,s=e&&h.isArray(e)?e:[]):s=e&&h.isPlainObject(e)?e:{},o[r]=h.extend(f,s,n)):void 0!==n&&(o[r]=n));return o},h.extend({expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===h.type(e)},isArray:Array.isArray||function(e){return"array"===h.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!h.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==h.type(e)||e.nodeType||h.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(l.ownLast)for(t in e)return f.call(e,t);for(t in e);return void 0===t||f.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&h.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(d,"ms-").replace(v,m)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=g(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(g(Object(e))?h.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(n>r)e[i++]=t[r++];if(n!==n)while(void 0!==t[r])e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=g(e),a=[];if(u)for(;o>s;s++)r=t(e[s],s,n),null!=r&&a.push(r);else for(s in e)r=t(e[s],s,n),null!=r&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return"string"==typeof t&&(s=e[t],t=e,e=s),h.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||h.guid++,i):void 0},now:function(){return+(new Date)},support:l}),h.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var y=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(l=t.nodeType)&&9!==l)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+mt(d[c]);S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",")}if(x)try{return P.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function ut(e){return e[w]=!0,e}function at(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(e){return e&&typeof e.getElementsByTagName!==L&&e}function vt(){}function mt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n){for(var r=0,i=t.length;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>a;a++)if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&St(e.slice(a,i)),s>i&&St(e=e.slice(i)),s>i&&mt(e))}h.push(n)}return yt(h)}function xt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=_.call(a));y=wt(y)}P.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(a)}return l&&(S=E,f=b),g};return n?ut(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function(e,t){return e===t&&(c=!0),0},L="undefined",A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;return i!==p&&9===i.nodeType&&i.documentElement?(p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h()},!1):o.attachEvent&&o.attachEvent("onunload",function(){h()})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==L?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==L&&v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(i.querySelectorAll))&&(at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked")}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},i):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=B.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ht(t);return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt,o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):N(e,a).slice(0)},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=St(t[n]),s[w]?r.push(s):i.push(s);s=C(e,xt(i,r)),s.selector=e}return s},a=st.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&mt(f),!e)return P.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),at(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ft("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ft("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),at(function(e){return null==e.getAttribute("disabled")})||ft(j,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),st}(e);h.find=y,h.expr=y.selectors,h.expr[":"]=h.expr.pseudos,h.unique=y.uniqueSort,h.text=y.getText,h.isXMLDoc=y.isXML,h.contains=y.contains;var b=h.expr.match.needsContext,w=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^.[^:#\[\.,]*$/;h.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?h.find.matchesSelector(r,e)?[r]:[]:h.find.matches(e,h.grep(t,function(e){return 1===e.nodeType}))},h.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(h(e).filter(function(){for(t=0;i>t;t++)if(h.contains(r[t],this))return!0}));for(t=0;i>t;t++)h.find(e,r[t],n);return n=this.pushStack(i>1?h.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(S(this,e||[],!1))},not:function(e){return this.pushStack(S(this,e||[],!0))},is:function(e){return!!S(this,"string"==typeof e&&b.test(e)?h(e):e||[],!1).length}});var x,T=e.document,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=h.fn.init=function(e,t){var n,r;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||x).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof h?t[0]:t,h.merge(this,h.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:T,!0)),w.test(n[1])&&h.isPlainObject(t))for(n in t)h.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(r=T.getElementById(n[2]),r&&r.parentNode){if(r.id!==n[2])return x.find(e);this.length=1,this[0]=r}return this.context=T,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):h.isFunction(e)?"undefined"!=typeof x.ready?x.ready(e):e(h):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),h.makeArray(e,this))};C.prototype=h.fn,x=h(T);var k=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};h.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&9!==i.nodeType&&(void 0===n||1!==i.nodeType||!h(i).is(n)))1===i.nodeType&&r.push(i),i=i[t];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),h.fn.extend({has:function(e){var t,n=h(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(h.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,s=[],o=b.test(e)||"string"!=typeof e?h(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&h.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?h.unique(s):s)},index:function(e){return e?"string"==typeof e?h.inArray(this[0],h(e)):h.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(h.unique(h.merge(this.get(),h(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),h.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h.dir(e,"parentNode")},parentsUntil:function(e,t,n){return h.dir(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return h.dir(e,"nextSibling")},prevAll:function(e){return h.dir(e,"previousSibling")},nextUntil:function(e,t,n){return h.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return h.dir(e,"previousSibling",n)},siblings:function(e){return h.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return h.sibling(e.firstChild)},contents:function(e){return h.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:h.merge([],e.childNodes)}},function(e,t){h.fn[e]=function(n,r){var i=h.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=h.filter(r,i)),this.length>1&&(L[e]||(i=h.unique(i)),k.test(e)&&(i=i.reverse())),this.pushStack(i)}});var O=/\S+/g,M={};h.Callbacks=function(e){e="string"==typeof e?M[e]||_(e):h.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){for(n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;u&&i>s;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;!function s(t){h.each(t,function(t,n){var r=h.type(n);"function"===r?e.unique&&l.has(n)||u.push(n):n&&n.length&&"string"!==r&&s(n)})}(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&h.each(arguments,function(e,n){var r;while((r=h.inArray(n,u,r))>-1)u.splice(r,1),t&&(i>=r&&i--,s>=r&&s--)}),this},has:function(e){return e?h.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=void 0,this},disabled:function(){return!u},lock:function(){return a=void 0,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return!u||r&&!a||(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},h.extend({Deferred:function(e){var t=[["resolve","done",h.Callbacks("once memory"),"resolved"],["reject","fail",h.Callbacks("once memory"),"rejected"],["notify","progress",h.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return h.Deferred(function(n){h.each(t,function(t,s){var o=h.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&h.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?h.extend(e,r):r}},i={};return r.pipe=r.then,h.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=1!==i||e&&h.isFunction(e.promise)?i:0,o=1===s?e:h.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)n[t]&&h.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,n),o.promise()}});var D;h.fn.ready=function(e){return h.ready.promise().done(e),this},h.extend({isReady:!1,readyWait:1,holdReady:function(e){e?h.readyWait++:h.ready(!0)},ready:function(e){if(e===!0?!--h.readyWait:!h.isReady){if(!T.body)return setTimeout(h.ready);h.isReady=!0,e!==!0&&--h.readyWait>0||(D.resolveWith(T,[h]),h.fn.triggerHandler&&(h(T).triggerHandler("ready"),h(T).off("ready")))}}}),h.ready.promise=function(t){if(!D)if(D=h.Deferred(),"complete"===T.readyState)setTimeout(h.ready);else if(T.addEventListener)T.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{T.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var n=!1;try{n=null==e.frameElement&&T.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!h.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}P(),h.ready()}}()}return D.promise(t)};var B="undefined",j;for(j in h(l))break;l.ownLast="0"!==j,l.inlineBlockNeedsLayout=!1,h(function(){var e,t,n,r;n=T.getElementsByTagName("body")[0],n&&n.style&&(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(r))}),function(){var e=T.createElement("div");if(null==l.deleteExpando){l.deleteExpando=!0;try{delete e.test}catch(t){l.deleteExpando=!1}}e=null}(),h.acceptData=function(e){var t=h.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var F=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,I=/([A-Z])/g;h.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?h.cache[e[h.expando]]:e[h.expando],!!e&&!R(e)},data:function(e,t,n){return U(e,t,n)},removeData:function(e,t){return z(e,t)},_data:function(e,t,n){return U(e,t,n,!0)},_removeData:function(e,t){return z(e,t,!0)}}),h.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(i=h.data(s),1===s.nodeType&&!h._data(s,"parsedAttrs"))){n=o.length;while(n--)o[n]&&(r=o[n].name,0===r.indexOf("data-")&&(r=h.camelCase(r.slice(5)),q(s,r,i[r])));h._data(s,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){h.data(this,e)}):arguments.length>1?this.each(function(){h.data(this,e,t)}):s?q(s,e,h.data(s,e)):void 0},removeData:function(e){return this.each(function(){h.removeData(this,e)})}}),h.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=h._data(e,t),n&&(!r||h.isArray(n)?r=h._data(e,t,h.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=h.queue(e,t),r=n.length,i=n.shift(),s=h._queueHooks(e,t),o=function(){h.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return h._data(e,n)||h._data(e,n,{empty:h.Callbacks("once memory").add(function(){h._removeData(e,t+"queue"),h._removeData(e,n)})})}}),h.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?h.queue(this[0],e):void 0===t?this:this.each(function(){var n=h.queue(this,e,t);h._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&h.dequeue(this,e)})},dequeue:function(e){return this.each(function(){h.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=h.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(o--)n=h._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var W=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,X=["Top","Right","Bottom","Left"],V=function(e,t){return e=t||e,"none"===h.css(e,"display")||!h.contains(e.ownerDocument,e)},$=h.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=null==n;if("object"===h.type(n)){i=!0;for(u in n)h.access(e,t,u,n[u],!0,s,o)}else if(void 0!==r&&(i=!0,h.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(h(e),n)})),t))for(;a>u;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)));return i?e:f?t.call(e):a?t(e[0],n):s},J=/^(?:checkbox|radio)$/i;!function(){var e=T.createElement("input"),t=T.createElement("div"),n=T.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===t.firstChild.nodeType,l.tbody=!t.getElementsByTagName("tbody").length,l.htmlSerialize=!!t.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==T.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,n.appendChild(e),l.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){l.noCloneEvent=!1}),t.cloneNode(!0).click()),null==l.deleteExpando){l.deleteExpando=!0;try{delete t.test}catch(r){l.deleteExpando=!1}}}(),function(){var t,n,r=T.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(l[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),l[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var K=/^(?:input|select|textarea)$/i,Q=/^key/,G=/^(?:mouse|pointer|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=/^([^.]*)(?:\.(.+)|)$/;h.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h._data(e);if(g){n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=h.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof h===B||e&&h.event.triggered===e.type?void 0:h.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(O)||[""],u=t.length;while(u--)s=Z.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort(),d&&(f=h.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=h.event.special[d]||{},c=h.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&h.expr.match.needsContext.test(i),namespace:v.join(".")},a),(p=o[d])||(p=o[d]=[],p.delegateCount=0,f.setup&&f.setup.call(e,r,v,l)!==!1||(e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l))),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),h.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,p,d,v,m,g=h.hasData(e)&&h._data(e);if(g&&(l=g.events)){t=(t||"").match(O)||[""],f=t.length;while(f--)if(u=Z.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort(),d){c=h.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,p=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=p.length;while(s--)o=p[s],!i&&m!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(p.splice(s,1),o.selector&&p.delegateCount--,c.remove&&c.remove.call(e,o));a&&!p.length&&(c.teardown&&c.teardown.call(e,v,g.handle)!==!1||h.removeEvent(e,d,g.handle),delete l[d])}else for(d in l)h.event.remove(e,d+t[f],n,r,!0);h.isEmptyObject(l)&&(delete g.handle,h._removeData(e,"events"))}},trigger:function(t,n,r,i){var s,o,u,a,l,c,p,d=[r||T],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];if(u=c=r=r||T,3!==r.nodeType&&8!==r.nodeType&&!Y.test(v+h.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[h.expando]?t:new h.Event(v,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:h.makeArray(n,[t]),l=h.event.special[v]||{},i||!l.trigger||l.trigger.apply(r,n)!==!1)){if(!i&&!l.noBubble&&!h.isWindow(r)){for(a=l.delegateType||v,Y.test(a+v)||(u=u.parentNode);u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||T)&&d.push(c.defaultView||c.parentWindow||e)}p=0;while((u=d[p++])&&!t.isPropagationStopped())t.type=p>1?a:l.bindType||v,s=(h._data(u,"events")||{})[t.type]&&h._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&h.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());if(t.type=v,!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&h.acceptData(r)&&o&&r[v]&&!h.isWindow(r)){c=r[o],c&&(r[o]=null),h.event.triggered=v;try{r[v]()}catch(g){}h.event.triggered=void 0,c&&(r[o]=c)}return t.result}},dispatch:function(e){e=h.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(h._data(this,"events")||{})[e.type]||[],l=h.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=h.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((h.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||"click"!==e.type))for(;a!=this;a=a.parentNode||this)if(1===a.nodeType&&(a.disabled!==!0||"click"!==e.type)){for(i=[],s=0;u>s;s++)r=t[s],n=r.selector+" ",void 0===i[n]&&(i[n]=r.needsContext?h(n,this).index(a)>=0:h.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[h.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=G.test(i)?this.mouseHooks:Q.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new h.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||T),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||T,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==nt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===nt()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return h.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return h.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=h.extend(new h.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?h.event.trigger(i,null,t):h.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},h.removeEvent=T.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===B&&(e[r]=null),e.detachEvent(r,n))},h.Event=function(e,t){return this instanceof h.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?et:tt):this.type=e,t&&h.extend(this,t),this.timeStamp=e&&e.timeStamp||h.now(),void (this[h.expando]=!0)):new h.Event(e,t)},h.Event.prototype={isDefaultPrevented:tt,isPropagationStopped:tt,isImmediatePropagationStopped:tt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=et,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=et,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=et,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},h.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){h.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!h.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),l.submitBubbles||(h.event.special.submit={setup:function(){return h.nodeName(this,"form")?!1:void h.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=h.nodeName(t,"input")||h.nodeName(t,"button")?t.form:void 0;n&&!h._data(n,"submitBubbles")&&(h.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),h._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&h.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return h.nodeName(this,"form")?!1:void h.event.remove(this,"._submit")}}),l.changeBubbles||(h.event.special.change={setup:function(){return K.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(h.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),h.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),h.event.simulate("change",this,e,!0)})),!1):void h.event.add(this,"beforeactivate._change",function(e){var t=e.target;K.test(t.nodeName)&&!h._data(t,"changeBubbles")&&(h.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||h.event.simulate("change",this.parentNode,e,!0)}),h._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return h.event.remove(this,"._change"),!K.test(this.nodeName)}}),l.focusinBubbles||h.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){h.event.simulate(t,e.target,h.event.fix(e),!0)};h.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=h._data(r,t);i||r.addEventListener(e,n,!0),h._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=h._data(r,t)-1;i?h._data(r,t,i):(r.removeEventListener(e,n,!0),h._removeData(r,t))}}}),h.fn.extend({on:function(e,t,n,r,i){var s,o;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=void 0):null==r&&("string"==typeof t?(r=n,n=void 0):(r=n,n=t,t=void 0)),r===!1)r=tt;else if(!r)return this;return 1===i&&(o=r,r=function(e){return h().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=h.guid++)),this.each(function(){h.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,h(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=tt),this.each(function(){h.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){h.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?h.event.trigger(e,t,n,!0):void 0}});var it="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",st=/ jQuery\d+="(?:null|\d+)"/g,ot=new RegExp("<(?:"+it+")[\\s/>]","i"),ut=/^\s+/,at=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ft=/<([\w:]+)/,lt=/<tbody/i,ct=/<|&#?\w+;/,ht=/<(?:script|style|link)/i,pt=/checked\s*(?:[^=]|=\s*.checked.)/i,dt=/^$|\/(?:java|ecma)script/i,vt=/^true\/(.*)/,mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},yt=rt(T),bt=yt.appendChild(T.createElement("div"));gt.optgroup=gt.option,gt.tbody=gt.tfoot=gt.colgroup=gt.caption=gt.thead,gt.th=gt.td,h.extend({clone:function(e,t,n){var r,i,s,o,u,a=h.contains(e.ownerDocument,e);if(l.html5Clone||h.isXMLDoc(e)||!ot.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(bt.innerHTML=e.outerHTML,bt.removeChild(s=bt.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||h.isXMLDoc(e)))for(r=wt(s),u=wt(e),o=0;null!=(i=u[o]);++o)r[o]&&kt(i,r[o]);if(t)if(n)for(u=u||wt(e),r=r||wt(s),o=0;null!=(i=u[o]);o++)Ct(i,r[o]);else Ct(e,s);return r=wt(s,"script"),r.length>0&&Nt(r,!a&&wt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){for(var i,s,o,u,a,f,c,p=e.length,d=rt(t),v=[],m=0;p>m;m++)if(s=e[m],s||0===s)if("object"===h.type(s))h.merge(v,s.nodeType?[s]:s);else if(ct.test(s)){u=u||d.appendChild(t.createElement("div")),a=(ft.exec(s)||["",""])[1].toLowerCase(),c=gt[a]||gt._default,u.innerHTML=c[1]+s.replace(at,"<$1></$2>")+c[2],i=c[0];while(i--)u=u.lastChild;if(!l.leadingWhitespace&&ut.test(s)&&v.push(t.createTextNode(ut.exec(s)[0])),!l.tbody){s="table"!==a||lt.test(s)?"<table>"!==c[1]||lt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)h.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}h.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}else v.push(t.createTextNode(s));u&&d.removeChild(u),l.appendChecked||h.grep(wt(v,"input"),Et),m=0;while(s=v[m++])if((!r||-1===h.inArray(s,r))&&(o=h.contains(s.ownerDocument,s),u=wt(d.appendChild(s),"script"),o&&Nt(u),n)){i=0;while(s=u[i++])dt.test(s.type||"")&&n.push(s)}return u=null,d},cleanData:function(e,t){for(var r,i,s,o,u=0,a=h.expando,f=h.cache,c=l.deleteExpando,p=h.event.special;null!=(r=e[u]);u++)if((t||h.acceptData(r))&&(s=r[a],o=s&&f[s])){if(o.events)for(i in o.events)p[i]?h.event.remove(r,i):h.removeEvent(r,i,o.handle);f[s]&&(delete f[s],c?delete r[a]:typeof r.removeAttribute!==B?r.removeAttribute(a):r[a]=null,n.push(s))}}}),h.fn.extend({text:function(e){return $(this,function(e){return void 0===e?h.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=St(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=St(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?h.filter(e,this):this,i=0;null!=(n=r[i]);i++)t||1!==n.nodeType||h.cleanData(wt(n)),n.parentNode&&(t&&h.contains(n.ownerDocument,n)&&Nt(wt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&h.cleanData(wt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&h.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return h.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(st,""):void 0;if(!("string"!=typeof e||ht.test(e)||!l.htmlSerialize&&ot.test(e)||!l.leadingWhitespace&&ut.test(e)||gt[(ft.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(at,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(h.cleanData(wt(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,h.cleanData(wt(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,c=this.length,p=this,d=c-1,v=e[0],m=h.isFunction(v);if(m||c>1&&"string"==typeof v&&!l.checkClone&&pt.test(v))return this.each(function(n){var r=p.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(c&&(a=h.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(o=h.map(wt(a,"script"),xt),s=o.length;c>f;f++)r=a,f!==d&&(r=h.clone(r,!0,!0),s&&h.merge(o,wt(r,"script"))),t.call(this[f],r,f);if(s)for(u=o[o.length-1].ownerDocument,h.map(o,Tt),f=0;s>f;f++)r=o[f],dt.test(r.type||"")&&!h._data(r,"globalEval")&&h.contains(u,r)&&(r.src?h._evalUrl&&h._evalUrl(r.src):h.globalEval((r.text||r.textContent||r.innerHTML||"").replace(mt,"")));a=n=null}return this}}),h.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){h.fn[e]=function(e){for(var n,r=0,i=[],o=h(e),u=o.length-1;u>=r;r++)n=r===u?this:this.clone(!0),h(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var Lt,At={};!function(){var e;l.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,r;return n=T.getElementsByTagName("body")[0],n&&n.style?(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),typeof t.style.zoom!==B&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(T.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(r),e):void 0}}();var _t=/^margin/,Dt=new RegExp("^("+W+")(?!px)[a-z%]+$","i"),Pt,Ht,Bt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Pt=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==o||h.contains(e.ownerDocument,e)||(o=h.style(e,t)),Dt.test(o)&&_t.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),void 0===o?o:o+""}):T.documentElement.currentStyle&&(Pt=function(e){return e.currentStyle},Ht=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Pt(e),o=n?n[t]:void 0,null==o&&u&&u[t]&&(o=u[t]),Dt.test(o)&&!Bt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left="fontSize"===t?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),void 0===o?o:o+""||"auto"}),!function(){var t,n,r,i,s,o,u;if(t=T.createElement("div"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=r&&r.style){n.cssText="float:left;opacity:.5",l.opacity="0.5"===n.opacity,l.cssFloat=!!n.cssFloat,t.style.backgroundClip="content-box",t.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===t.style.backgroundClip,l.boxSizing=""===n.boxSizing||""===n.MozBoxSizing||""===n.WebkitBoxSizing,h.extend(l,{reliableHiddenOffsets:function(){return null==o&&a(),o},boxSizingReliable:function(){return null==s&&a(),s},pixelPosition:function(){return null==i&&a(),i},reliableMarginRight:function(){return null==u&&a(),u}});function a(){var t,n,r,a;n=T.getElementsByTagName("body")[0],n&&n.style&&(t=T.createElement("div"),r=T.createElement("div"),r.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(r).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",i=s=!1,u=!0,e.getComputedStyle&&(i="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,a=t.appendChild(T.createElement("div")),a.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",a.style.marginRight=a.style.width="0",t.style.width="1px",u=!parseFloat((e.getComputedStyle(a,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=t.getElementsByTagName("td"),a[0].style.cssText="margin:0;border:0;padding:0;display:none",o=0===a[0].offsetHeight,o&&(a[0].style.display="",a[1].style.display="none",o=0===a[0].offsetHeight),n.removeChild(r))}}}(),h.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var Ft=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,qt=/^(none|table(?!-c[ea]).+)/,Rt=new RegExp("^("+W+")(.*)$","i"),Ut=new RegExp("^([+-])=("+W+")","i"),zt={position:"absolute",visibility:"hidden",display:"block"},Wt={letterSpacing:"0",fontWeight:"400"},Xt=["Webkit","O","Moz","ms"];h.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ht(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,o,u=h.camelCase(t),a=e.style;if(t=h.cssProps[u]||(h.cssProps[u]=Vt(a,u)),o=h.cssHooks[t]||h.cssHooks[u],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:a[t];if(s=typeof n,"string"===s&&(i=Ut.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(h.css(e,t)),s="number"),null!=n&&n===n&&("number"!==s||h.cssNumber[u]||(n+="px"),l.clearCloneStyle||""!==n||0!==t.indexOf("background")||(a[t]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(e,n,r)))))try{a[t]=n}catch(f){}}},css:function(e,t,n,r){var i,s,o,u=h.camelCase(t);return t=h.cssProps[u]||(h.cssProps[u]=Vt(e.style,u)),o=h.cssHooks[t]||h.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),void 0===s&&(s=Ht(e,t,r)),"normal"===s&&t in Wt&&(s=Wt[t]),""===n||n?(i=parseFloat(s),n===!0||h.isNumeric(i)?i||0:s):s}}),h.each(["height","width"],function(e,t){h.cssHooks[t]={get:function(e,n,r){return n?qt.test(h.css(e,"display"))&&0===e.offsetWidth?h.swap(e,zt,function(){return Qt(e,t,r)}):Qt(e,t,r):void 0},set:function(e,n,r){var i=r&&Pt(e);return Jt(e,n,r?Kt(e,t,r,l.boxSizing&&"border-box"===h.css(e,"boxSizing",!1,i),i):0)}}}),l.opacity||(h.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=h.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===h.trim(s.replace(Ft,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ft.test(s)?s.replace(Ft,i):s+" "+i)}}),h.cssHooks.marginRight=jt(l.reliableMarginRight,function(e,t){return t?h.swap(e,{display:"inline-block"},Ht,[e,"marginRight"]):void 0}),h.each({margin:"",padding:"",border:"Width"},function(e,t){h.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+X[r]+t]=s[r]||s[r-2]||s[0];return i}},_t.test(e)||(h.cssHooks[e+t].set=Jt)}),h.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,s={},o=0;if(h.isArray(t)){for(r=Pt(e),i=t.length;i>o;o++)s[t[o]]=h.css(e,t[o],!1,r);return s}return void 0!==n?h.style(e,t,n):h.css(e,t)},e,t,arguments.length>1)},show:function(){return $t(this,!0)},hide:function(){return $t(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){V(this)?h(this).show():h(this).hide()})}}),h.Tween=Gt,Gt.prototype={constructor:Gt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(h.cssNumber[n]?"":"px")},cur:function(){var e=Gt.propHooks[this.prop];return e&&e.get?e.get(this):Gt.propHooks._default.get(this)},run:function(e){var t,n=Gt.propHooks[this.prop];return this.pos=t=this.options.duration?h.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Gt.propHooks._default.set(this),this}},Gt.prototype.init.prototype=Gt.prototype,Gt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=h.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){h.fx.step[e.prop]?h.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[h.cssProps[e.prop]]||h.cssHooks[e.prop])?h.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Gt.propHooks.scrollTop=Gt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},h.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},h.fx=Gt.prototype.init,h.fx.step={};var Yt,Zt,en=/^(?:toggle|show|hide)$/,tn=new RegExp("^(?:([+-])=|)("+W+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[fn],sn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=tn.exec(t),s=i&&i[3]||(h.cssNumber[e]?"":"px"),o=(h.cssNumber[e]||"px"!==s&&+r)&&tn.exec(h.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,h.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};h.Animation=h.extend(cn,{tweener:function(e,t){h.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],sn[n]=sn[n]||[],sn[n].unshift(t)},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}}),h.speed=function(e,t,n){var r=e&&"object"==typeof e?h.extend({},e):{complete:n||!n&&t||h.isFunction(e)&&e,duration:e,easing:n&&t||t&&!h.isFunction(t)&&t};return r.duration=h.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in h.fx.speeds?h.fx.speeds[r.duration]:h.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){h.isFunction(r.old)&&r.old.call(this),r.queue&&h.dequeue(this,r.queue)},r},h.fn.extend({fadeTo:function(e,t,n,r){return this.filter(V).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=h.isEmptyObject(e),s=h.speed(t,n,r),o=function(){var t=cn(this,h.extend({},e),s);(i||h._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",s=h.timers,o=h._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&nn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&h.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=h._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=h.timers,o=r?r.length:0;for(n.finish=!0,h.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),h.each(["toggle","show","hide"],function(e,t){var n=h.fn[t];h.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(un(t,!0),e,r,i)}}),h.each({slideDown:un("show"),slideUp:un("hide"),slideToggle:un("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){h.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),h.timers=[],h.fx.tick=function(){var e,t=h.timers,n=0;for(Yt=h.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||h.fx.stop(),Yt=void 0},h.fx.timer=function(e){h.timers.push(e),e()?h.fx.start():h.timers.pop()},h.fx.interval=13,h.fx.start=function(){Zt||(Zt=setInterval(h.fx.tick,h.fx.interval))},h.fx.stop=function(){clearInterval(Zt),Zt=null},h.fx.speeds={slow:600,fast:200,_default:400},h.fn.delay=function(e,t){return e=h.fx?h.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i;t=T.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=t.getElementsByTagName("a")[0],n=T.createElement("select"),i=n.appendChild(T.createElement("option")),e=t.getElementsByTagName("input")[0],r.style.cssText="top:1px",l.getSetAttribute="t"!==t.className,l.style=/top/.test(r.getAttribute("style")),l.hrefNormalized="/a"===r.getAttribute("href"),l.checkOn=!!e.value,l.optSelected=i.selected,l.enctype=!!T.createElement("form").enctype,n.disabled=!0,l.optDisabled=!i.disabled,e=T.createElement("input"),e.setAttribute("value",""),l.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),l.radioValue="t"===e.value}();var hn=/\r/g;h.fn.extend({val:function(e){var t,n,r,i=this[0];if(arguments.length)return r=h.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,h(this).val()):e,null==i?i="":"number"==typeof i?i+="":h.isArray(i)&&(i=h.map(i,function(e){return null==e?"":e+""})),t=h.valHooks[this.type]||h.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=h.valHooks[i.type]||h.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(hn,""):null==n?"":n)}}),h.extend({valHooks:{option:{get:function(e){var t=h.find.attr(e,"value");return null!=t?t:h.trim(h.text(e))}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(l.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&h.nodeName(n.parentNode,"optgroup"))){if(t=h(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=h.makeArray(t),o=i.length;while(o--)if(r=i[o],h.inArray(h.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),i}}}}),h.each(["radio","checkbox"],function(){h.valHooks[this]={set:function(e,t){return h.isArray(t)?e.checked=h.inArray(h(e).val(),t)>=0:void 0}},l.checkOn||(h.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var pn,dn,vn=h.expr.attrHandle,mn=/^(?:checked|selected)$/i,gn=l.getSetAttribute,yn=l.input;h.fn.extend({attr:function(e,t){return $(this,h.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){h.removeAttr(this,e)})}}),h.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===B?h.prop(e,t,n):(1===s&&h.isXMLDoc(e)||(t=t.toLowerCase(),r=h.attrHooks[t]||(h.expr.match.bool.test(t)?dn:pn)),void 0===n?r&&"get"in r&&null!==(i=r.get(e,t))?i:(i=h.find.attr(e,t),null==i?void 0:i):null!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):void h.removeAttr(e,t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(O);if(s&&1===e.nodeType)while(n=s[i++])r=h.propFix[n]||n,h.expr.match.bool.test(n)?yn&&gn||!mn.test(n)?e[r]=!1:e[h.camelCase("default-"+n)]=e[r]=!1:h.attr(e,n,""),e.removeAttribute(gn?n:r)},attrHooks:{type:{set:function(e,t){if(!l.radioValue&&"radio"===t&&h.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),dn={set:function(e,t,n){return t===!1?h.removeAttr(e,n):yn&&gn||!mn.test(n)?e.setAttribute(!gn&&h.propFix[n]||n,n):e[h.camelCase("default-"+n)]=e[n]=!0,n}},h.each(h.expr.match.bool.source.match(/\w+/g),function(e,t){var n=vn[t]||h.find.attr;vn[t]=yn&&gn||!mn.test(t)?function(e,t,r){var i,s;return r||(s=vn[t],vn[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,vn[t]=s),i}:function(e,t,n){return n?void 0:e[h.camelCase("default-"+t)]?t.toLowerCase():null}}),yn&&gn||(h.attrHooks.value={set:function(e,t,n){return h.nodeName(e,"input")?void (e.defaultValue=t):pn&&pn.set(e,t,n)}}),gn||(pn={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},vn.id=vn.name=vn.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},h.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:pn.set},h.attrHooks.contenteditable={set:function(e,t,n){pn.set(e,""===t?!1:t,n)}},h.each(["width","height"],function(e,t){h.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),l.style||(h.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var bn=/^(?:input|select|textarea|button|object)$/i,wn=/^(?:a|area)$/i;h.fn.extend({prop:function(e,t){return $(this,h.prop,e,t,arguments.length>1)},removeProp:function(e){return e=h.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),h.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return s=1!==o||!h.isXMLDoc(e),s&&(t=h.propFix[t]||t,i=h.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=h.find.attr(e,"tabindex");return t?parseInt(t,10):bn.test(e.nodeName)||wn.test(e.nodeName)&&e.href?0:-1}}}}),l.hrefNormalized||h.each(["href","src"],function(e,t){h.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),l.optSelected||(h.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),h.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){h.propFix[this.toLowerCase()]=this}),l.enctype||(h.propFix.enctype="encoding");var En=/[\t\r\n\f]/g;h.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f="string"==typeof e&&e;if(h.isFunction(e))return this.each(function(t){h(this).addClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(O)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(En," "):" ")){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=h.trim(r),n.className!==o&&(n.className=o)}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=0===arguments.length||"string"==typeof e&&e;if(h.isFunction(e))return this.each(function(t){h(this).removeClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(O)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(En," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?h.trim(r):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(h.isFunction(e)?function(n){h(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n){var t,r=0,i=h(this),s=e.match(O)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else(n===B||"boolean"===n)&&(this.className&&h._data(this,"__className__",this.className),this.className=this.className||e===!1?"":h._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(En," ").indexOf(t)>=0)return!0;return!1}}),h.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){h.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),h.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var Sn=h.now(),xn=/\?/,Tn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;h.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=h.trim(t+"");return i&&!h.trim(i.replace(Tn,function(e,t,i,s){return n&&t&&(r=0),0===r?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():h.error("Invalid JSON: "+t)},h.parseXML=function(t){var n,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||h.error("Invalid XML: "+t),n};var Nn,Cn,kn=/#.*$/,Ln=/([?&])_=[^&]*/,An=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,On=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mn=/^(?:GET|HEAD)$/,_n=/^\/\//,Dn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Pn={},Hn={},Bn="*/".concat("*");try{Cn=location.href}catch(jn){Cn=T.createElement("a"),Cn.href="",Cn=Cn.href}Nn=Dn.exec(Cn.toLowerCase())||[],h.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Cn,type:"GET",isLocal:On.test(Nn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Bn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":h.parseJSON,"text xml":h.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?qn(qn(e,h.ajaxSettings),t):qn(h.ajaxSettings,e)},ajaxPrefilter:Fn(Pn),ajaxTransport:Fn(Hn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;2!==b&&(b=2,o&&clearTimeout(o),a=void 0,s=r||"",E.readyState=e>0?4:0,f=e>=200&&300>e||304===e,n&&(w=Rn(l,E,n)),w=Un(l,w,E,f),f?(l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(h.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(h.etag[i]=S)),204===e||"HEAD"===l.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=void 0,u&&p.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(p.trigger("ajaxComplete",[E,l]),--h.active||h.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,i,s,o,u,a,f,l=h.ajaxSetup({},t),c=l.context||l,p=l.context&&(c.nodeType||c.jquery)?h(c):h.event,d=h.Deferred(),v=h.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!f){f={};while(t=An.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};if(d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||Cn)+"").replace(kn,"").replace(_n,Nn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=h.trim(l.dataType||"*").toLowerCase().match(O)||[""],null==l.crossDomain&&(n=Dn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Nn[1]&&n[2]===Nn[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Nn[3]||("http:"===Nn[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=h.param(l.data,l.traditional)),In(Pn,l,t,E),2===b)return E;u=l.global,u&&0===h.active++&&h.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Mn.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(xn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ln.test(i)?i.replace(Ln,"$1_="+Sn++):i+(xn.test(i)?"&":"?")+"_="+Sn++)),l.ifModified&&(h.lastModified[i]&&E.setRequestHeader("If-Modified-Since",h.lastModified[i]),h.etag[i]&&E.setRequestHeader("If-None-Match",h.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Bn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&2!==b){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);if(a=In(Hn,l,t,E)){E.readyState=1,u&&p.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(2>b))throw S;x(-1,S)}}else x(-1,"No Transport");return E}return E.abort()},getJSON:function(e,t,n){return h.get(e,t,n,"json")},getScript:function(e,t){return h.get(e,void 0,t,"script")}}),h.each(["get","post"],function(e,t){h[t]=function(e,n,r,i){return h.isFunction(n)&&(i=i||r,r=n,n=void 0),h.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),h.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){h.fn[t]=function(e){return this.on(t,e)}}),h._evalUrl=function(e){return h.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},h.fn.extend({wrapAll:function(e){if(h.isFunction(e))return this.each(function(t){h(this).wrapAll(e.call(this,t))});if(this[0]){var t=h(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(h.isFunction(e)?function(t){h(this).wrapInner(e.call(this,t))}:function(){var t=h(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=h.isFunction(e);return this.each(function(n){h(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){h.nodeName(this,"body")||h(this).replaceWith(this.childNodes)}).end()}}),h.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!l.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||h.css(e,"display"))},h.expr.filters.visible=function(e){return!h.expr.filters.hidden(e)};var zn=/%20/g,Wn=/\[\]$/,Xn=/\r?\n/g,Vn=/^(?:submit|button|image|reset|file)$/i,$n=/^(?:input|select|textarea|keygen)/i;h.param=function(e,t){var n,r=[],i=function(e,t){t=h.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=h.ajaxSettings&&h.ajaxSettings.traditional),h.isArray(e)||e.jquery&&!h.isPlainObject(e))h.each(e,function(){i(this.name,this.value)});else for(n in e)Jn(n,e[n],t,i);return r.join("&").replace(zn,"+")},h.fn.extend({serialize:function(){return h.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=h.prop(this,"elements");return e?h.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!h(this).is(":disabled")&&$n.test(this.nodeName)&&!Vn.test(e)&&(this.checked||!J.test(e))}).map(function(e,t){var n=h(this).val();return null==n?null:h.isArray(n)?h.map(n,function(e){return{name:t.name,value:e.replace(Xn,"\r\n")}}):{name:t.name,value:n.replace(Xn,"\r\n")}}).get()}}),h.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Yn()||Zn()}:Yn;var Kn=0,Qn={},Gn=h.ajaxSettings.xhr();e.ActiveXObject&&h(e).on("unload",function(){for(var e in Qn)Qn[e](void 0,!0)}),l.cors=!!Gn&&"withCredentials"in Gn,Gn=l.ajax=!!Gn,Gn&&h.ajaxTransport(function(e){if(!e.crossDomain||l.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Kn;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)void 0!==n[i]&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||4===s.readyState))if(delete Qn[o],t=void 0,s.onreadystatechange=h.noop,i)4!==s.readyState&&s.abort();else{f={},u=s.status,"string"==typeof s.responseText&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}u||!e.isLocal||e.crossDomain?1223===u&&(u=204):u=f.text?200:404}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?4===s.readyState?setTimeout(t):s.onreadystatechange=Qn[o]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),h.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return h.globalEval(e),e}}}),h.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),h.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=T.head||h("head")[0]||T.documentElement;return{send:function(r,i){t=T.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var er=[],tr=/(=)\?(?=&|$)|\?\?/;h.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=er.pop()||h.expando+"_"+Sn++;return this[e]=!0,e}}),h.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(tr.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tr.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=h.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(tr,"$1"+i):t.jsonp!==!1&&(t.url+=(xn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||h.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,er.push(i)),o&&h.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),h.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||T;var r=w.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=h.buildFragment([e],t,i),i&&i.length&&h(i).remove(),h.merge([],r.childNodes))};var nr=h.fn.load;h.fn.load=function(e,t,n){if("string"!=typeof e&&nr)return nr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=h.trim(e.slice(u,e.length)),e=e.slice(0,u)),h.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&h.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?h("<div>").append(h.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},h.expr.filters.animated=function(e){return h.grep(h.timers,function(t){return e===t.elem}).length};var rr=e.document.documentElement;h.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=h.css(e,"position"),c=h(e),p={};"static"===l&&(e.style.position="relative"),u=c.offset(),s=h.css(e,"top"),a=h.css(e,"left"),f=("absolute"===l||"fixed"===l)&&h.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),h.isFunction(t)&&(t=t.call(e,n,u)),null!=t.top&&(p.top=t.top-u.top+o),null!=t.left&&(p.left=t.left-u.left+i),"using"in t?t.using.call(e,p):c.css(p)}},h.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){h.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(s)return t=s.documentElement,h.contains(t,i)?(typeof i.getBoundingClientRect!==B&&(r=i.getBoundingClientRect()),n=ir(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===h.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),h.nodeName(e[0],"html")||(n=e.offset()),n.top+=h.css(e[0],"borderTopWidth",!0),n.left+=h.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-h.css(r,"marginTop",!0),left:t.left-n.left-h.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||rr;while(e&&!h.nodeName(e,"html")&&"static"===h.css(e,"position"))e=e.offsetParent;return e||rr})}}),h.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);h.fn[e]=function(r){return $(this,function(e,r,i){var s=ir(e);return void 0===i?s?t in s?s[t]:s.document.documentElement[r]:e[r]:void (s?s.scrollTo(n?h(s).scrollLeft():i,n?i:h(s).scrollTop()):e[r]=i)},e,r,arguments.length,null)}}),h.each(["top","left"],function(e,t){h.cssHooks[t]=jt(l.pixelPosition,function(e,n){return n?(n=Ht(e,t),Dt.test(n)?h(e).position()[t]+"px":n):void 0})}),h.each({Height:"height",Width:"width"},function(e,t){h.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){h.fn[r]=function(r,i){var s=arguments.length&&(n||"boolean"!=typeof r),o=n||(r===!0||i===!0?"margin":"border");return $(this,function(t,n,r){var i;return h.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?h.css(t,n,o):h.style(t,n,r,o)},t,s?r:void 0,s,null)}})}),h.fn.size=function(){return this.length},h.fn.andSelf=h.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return h});var sr=e.jQuery,or=e.$;return h.noConflict=function(t){return e.$===h&&(e.$=or),t&&e.jQuery===h&&(e.jQuery=sr),h},typeof t===B&&(e.jQuery=e.$=h),h}),window.Modernizr=function(e,t,n){function r(e){d.cssText=e}function i(e,t){return r(prefixes.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}var a="2.8.3",f={},l=!0,c=t.documentElement,h="modernizr",p=t.createElement(h),d=p.style,v,m={}.toString,g={},y={},b={},w=[],E=w.slice,S,x={}.hasOwnProperty,T;!s(x,"undefined")&&!s(x.call,"undefined")?T=function(e,t){return x.call(e,t)}:T=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=E.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(E.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(E.call(arguments)))};return r}),g.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(e){return!1}};for(var N in g)T(g,N)&&(S=N.toLowerCase(),f[S]=g[N](),w.push((f[S]?"":"no-")+S));return f.addTest=function(e,t){if(typeof e=="object")for(var r in e)T(e,r)&&f.addTest(r,e[r]);else{e=e.toLowerCase();if(f[e]!==n)return f;t=typeof t=="function"?t():t,typeof l!="undefined"&&l&&(c.className+=" "+(t?"":"no-")+e),f[e]=t}return f},r(""),p=v=null,function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=y.elements;return typeof e=="string"?e.split(" "):e}function i(e){var t=m[e[d]];return t||(t={},v++,e[d]=v,m[v]=t),t}function s(e,n,r){n||(n=t);if(g)return n.createElement(e);r||(r=i(n));var s;return r.cache[e]?s=r.cache[e].cloneNode():h.test(e)?s=(r.cache[e]=r.createElem(e)).cloneNode():s=r.createElem(e),s.canHaveChildren&&!c.test(e)&&!s.tagUrn?r.frag.appendChild(s):s}function o(e,n){e||(e=t);if(g)return e.createDocumentFragment();n=n||i(e);var s=n.frag.cloneNode(),o=0,u=r(),a=u.length;for(;o<a;o++)s.createElement(u[o]);return s}function u(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return y.shivMethods?s(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(y,t.frag)}function a(e){e||(e=t);var r=i(e);return y.shivCSS&&!p&&!r.hasCSS&&(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),g||u(e,r),e}var f="3.7.0",l=e.html5||{},c=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,h=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p,d="_html5shiv",v=0,m={},g;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",p="hidden"in e,g=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){p=!0,g=!0}})();var y={elements:l.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:f,shivCSS:l.shivCSS!==!1,supportsUnknownElements:g,shivMethods:l.shivMethods!==!1,type:"default",shivDocument:a,createElement:s,createDocumentFragment:o};e.html5=y,a(t)}(this,t),f._version=a,c.className=c.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(l?" js "+w.join(" "):""),f}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==d.call(e)}function i(e){return"string"==typeof e}function s(){}function o(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function u(){var e=v.shift();m=1,e?e.t?h(function(){("c"==e.t?k.injectCss:k.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),u()):m=0}function a(e,n,r,i,s,a,f){function l(t){if(!d&&o(c.readyState)&&(w.r=d=1,!m&&u(),c.onload=c.onreadystatechange=null,t)){"img"!=e&&h(function(){b.removeChild(c)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var f=f||k.errorTimeout,c=t.createElement(e),d=0,g=0,w={t:r,s:n,e:s,a:a,x:f};1===T[n]&&(g=1,T[n]=[]),"object"==e?c.data=n:(c.src=n,c.type=e),c.width=c.height="0",c.onerror=c.onload=c.onreadystatechange=function(){l.call(this,g)},v.splice(i,0,w),"img"!=e&&(g||2===T[n]?(b.insertBefore(c,y?null:p),h(l,f)):T[n].push(c))}function f(e,t,n,r,s){return m=0,t=t||"j",i(e)?a("c"==t?E:w,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),1==v.length&&u()),this}function l(){var e=k;return e.loader={load:f,i:0},e}var c=t.documentElement,h=e.setTimeout,p=t.getElementsByTagName("script")[0],d={}.toString,v=[],m=0,g="MozAppearance"in c.style,y=g&&!!t.createRange().compareNode,b=y?c:p.parentNode,c=e.opera&&"[object Opera]"==d.call(e.opera),c=!!t.attachEvent&&!c,w=g?"object":c?"script":"img",E=c?"script":w,S=Array.isArray||function(e){return"[object Array]"==d.call(e)},x=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},C,k;k=function(e){function t(e){var e=e.split("!"),t=x.length,n=e.pop(),r=e.length,n={url:n,origUrl:n,prefixes:e},i,s,o;for(s=0;s<r;s++)o=e[s].split("="),(i=N[o.shift()])&&(n=i(n,o));for(s=0;s<t;s++)n=x[s](n);return n}function o(e,i,s,o,u){var a=t(e),f=a.autoCallback;a.url.split(".").pop().split("?").shift(),a.bypass||(i&&(i=r(i)?i:i[e]||i[o]||i[e.split("/").pop().split("?")[0]]),a.instead?a.instead(e,i,s,o,u):(T[a.url]?a.noexec=!0:T[a.url]=1,s.load(a.url,a.forceCSS||!a.forceJS&&"css"==a.url.split(".").pop().split("?").shift()?"c":n,a.noexec,a.attrs,a.timeout),(r(i)||r(f))&&s.load(function(){l(),i&&i(a.origUrl,u,o),f&&f(a.origUrl,u,o),T[a.url]=2})))}function u(e,t){function n(e,n){if(e){if(i(e))n||(f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),o(e,f,t,0,u);else if(Object(e)===e)for(p in h=function(){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}(),e)e.hasOwnProperty(p)&&(!n&&!--h&&(r(f)?f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:f[p]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),c()}}(l[p])),o(e[p],f,t,p,u))}else!n&&c()}var u=!!e.test,a=e.load||e.both,f=e.callback||s,l=f,c=e.complete||s,h,p;n(u?e.yep:e.nope,!!a),a&&n(a)}var a,f,c=this.yepnope.loader;if(i(e))o(e,0,c,0);else if(S(e))for(a=0;a<e.length;a++)f=e[a],i(f)?o(f,0,c,0):S(f)?k(f):Object(f)===f&&u(f,c);else Object(e)===e&&u(e,c)},k.addPrefix=function(e,t){N[e]=t},k.addFilter=function(e){x.push(e)},k.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",C=function(){t.removeEventListener("DOMContentLoaded",C,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=u,e.yepnope.injectJs=function(e,n,r,i,a,f){var l=t.createElement("script"),c,d,i=i||k.errorTimeout;l.src=e;for(d in r)l.setAttribute(d,r[d]);n=f?u:n||s,l.onreadystatechange=l.onload=function(){!c&&o(l.readyState)&&(c=1,n(),l.onload=l.onreadystatechange=null)},h(function(){c||(c=1,n(1))},i),a?l.onload():p.parentNode.insertBefore(l,p)},e.yepnope.injectCss=function(e,n,r,i,o,a){var i=t.createElement("link"),f,n=a?u:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(f in r)i.setAttribute(f,r[f]);o||(p.parentNode.insertBefore(i,p),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},define("modernizr",function(e){return function(){var t,n;return t||e.Modernizr}}(this)),define("utils/fountain/helpers",[],function(){var e={},t={operators:e};e.is=function(){var e=Array.prototype.slice.call(arguments);return e.indexOf(this.type)!=-1},e.is_dialogue=function(){return this.is("character","parenthetical","dialogue")},e.name=function(){var e=this.text,t=e.indexOf("(");return t!=-1&&(e=e.substring(0,t)),e=e.trim(),e},e.location=function(){var e=this.text.trim();e=e.replace(/^(INT.?\/.EXT\.?)|(I\/E)|(INT\.?)|(EXT\.?)/,"");var t=e.lastIndexOf(" - ");return t!=-1&&(e=e.substring(0,t)),e.trim()},e.has_scene_time=function(e){var t=this.text.substring(this.text.indexOf(" - "));return this.is("scene_heading")&&t.indexOf(e)!==-1};var n=function(t){for(var n in e)t[n]=e[n];return t},r=function(e,t){return function(){return e.token?e.token[t].apply(e.token,arguments):null}},i=function(e){return function(){var t=arguments;return function(n){return n[e].apply(n,t)}}};t.fq={};for(var s in e)t.fq[s]=i(s);var o=function(t){for(var n in e)t[n]=r(t,n);return t};return t.first_text=function(e,t,n){for(var r=0;r<t.length;r++)if(t[r].type===e)return t[r].text;return n},t.create_line=function(e){return e.text=e.text||"",e.type=e.type||"unknown",e.start=e.start||0,e.end=e.end||0,e.token=e.token||t.create_token({type:e.type}),e.token.lines=e.token.lines||[e],o(e)},t.create_token=function(e){return e.text=e.text||"",e.type=e.type||"unknown",e.start=e.start||0,e.end=e.end||0,e.lines=e.lines||[],n(e)},t}),define("utils/fountain/parser",["require","utils/fountain/helpers"],function(e){var t=e("utils/fountain/helpers"),n={},r={title_page:/(title|credit|author[s]?|source|notes|draft date|date|contact|copyright)\:.*/i,section:/^(#+)(?: *)(.*)/,synopsis:/^(?:\=(?!\=+) *)(.*)/,scene_heading:/^((?:\*{0,3}_?)?(?:(?:int|ext|est|i\/e)[. ]).+)|^(?:\.(?!\.+))(.+)/i,scene_number:/( *#(.+)# *)/,transition:/^((?:FADE (?:TO BLACK|OUT)|CUT TO BLACK)\.|.+ TO\:)|^(?:> *)(.+)/,dialogue:/^([A-Z*_]+[0-9A-Z (._\-')]*)(\^?)?(?:\n(?!\n+))([\s\S]+)/,character:/^([A-Z*_]+[0-9A-Z (._\-')]*)\^?$/,parenthetical:/^(\(.+\))$/,action:/^(.+)/g,centered:/^(?:> *)(.+)(?: *<)(\n.+)*/g,page_break:/^\={3,}$/,line_break:/^ {2}$/};return n.parse=function(e,n){var i={title_page:[],tokens:[]};if(!e)return i;var s=e.match(/\r\n/)?2:1,o=e.split(/\r\n|\r|\n/),u=function(e,n,r){return t.create_token({text:e.trim(),start:n,end:n+e.length-1+s,line:r})},a=o.length,f=0,l,c,p,d,v=!1,m="none",g,y,b="title_page",w=!1;for(var E=0;E<a;E++){c=o[E],d=u(c,f,E),f=d.end+1;if(c.length===0){if(!v){b="normal",y=!1,d.type="separator",v=!0,i.tokens.push(d);continue}continue}m="script";if(b==="title_page"){if(r.title_page.test(d.text)){var S=d.text.split(":");d.type=S[0].toLowerCase(),d.text=S[1]||"",p=d,i.title_page.push(d),w=!0;continue}if(w){p.text+=(p.text?"\n":"")+d.text;continue}b="normal"}if(b==="normal")if(d.text.match(r.line_break))m="none";else if(d.text.match(r.centered))d.type="centered",d.text=d.text.replace(/>|</g,"").trim();else if(d.text.match(r.transition))d.text=d.text.replace(/> ?/,""),d.type="transition";else if(l=d.text.match(r.synopsis)){if(!n.print_synopsis)continue;d.text=l[1],d.type="synopsis"}else if(l=d.text.match(r.section)){if(!n.print_sections)continue;d.level=l[1].length,d.text=l[2],d.type="section"}else if(d.text.match(r.scene_heading)){d.text=d.text.replace(/^\./,"");if(n.double_space_between_scenes){var x=t.create_token({text:"",start:d.start,end:d.end,lines:[""],type:"separator"});i.tokens.push(x)}d.type="scene_heading"}else if(d.text.match(r.character))if(E===a||E===a-1||o[E+1].length===0)d.type="shot";else{b="dialogue",d.type="character";if(d.text[d.text.length-1]==="^"){if(n.use_dual_dialogue){var T=["dialogue","character","parenthetical"];while(T.indexOf(i.tokens[g].type)!=-1)i.tokens[g].dual="left",g++;d.dual="right",y=!0}d.text=d.text.replace("^","")}g=i.tokens.length}else d.text.match(r.page_break)?(d.text="",d.type="page_break"):d.type="action";else d.text.match(r.parenthetical)?d.type="parenthetical":d.type="dialogue",y&&(d.dual="right");v=!1,m==="script"&&i.tokens.push(d)}return i},n}),define("utils/fountain/liner",["require","utils/fountain/parser","utils/fountain/helpers"],function(e){var t=e("utils/fountain/parser"),n=e("utils/fountain/helpers"),r={},i="normal",s=function(e,t,r,i){if(e.length<=t)return[n.create_line({type:i.type,token:i,text:e,start:r,end:r+e.length-1})];var o=e.substr(0,t+1).lastIndexOf(" ");return o===-1&&(o=t-1),[n.create_line({type:i.type,token:i,text:e.substr(0,o),start:r,end:r+o})].concat(s(e.substr(o+1),t,r+o,i))},o=function(e,t){e.lines=s(e.text||"",t,e.start,e)},u=function(e,t,r){var i=r.text.continued||"(CONT'D)",s=r.text.more||"(MORE)";for(var o=e-1;o&&!t[o].text;o--);for(var u=e+1;u<t.length&&!t[u].text;u++);var a=t[e],f=t[u],l=t[o];if(a.is("scene_heading")&&!f.is("scene_heading"))return!1;if(r.split_dialogue&&a.is("dialogue")&&f&&f.is("dialogue")&&l.is("dialogue")&&!a.dual){for(var c=o;t[c].type!="character";c--);return t.splice(e,0,n.create_line({type:"parenthetical",text:s}),n.create_line({type:"character",text:t[c].text.trim()+" "+(t[c].text.indexOf(i)!==-1?"":i)})),!0}return t[e].is_dialogue()!=-1&&t[u]&&t[u].is("dialogue","parenthetical")?!1:!0},a=function(e,t,r,i){while(e.length&&!e[0].text)e.shift();var s=t,o,u=0;for(var f=0;f<e.length&&f<t;f++)e[f].type=="page_break"&&(u=f);if(!u){if(e.length<=t)return e;do{for(o=s-1;o&&!e[o].text;o--);s=o}while(!r(o,e,i))}else o=u-1;var l=e.slice(0,o+1);l.push(n.create_line({type:"page_break"}));var c=a(e.slice(o+1),t,r,i);return l.concat(c)},f=function(e){var t=!0,n=function(){for(var t=0;t<e.length;t++)if(e[t].token&&e[t].token.type==="character"&&e[t].token.dual==="left"&&e[t].right_column===undefined)return t;return-1},r=function(t){for(var n=t;n<e.length;n++)if(e[n].token&&e[n].token.type==="character"&&e[n].token.dual==="right")return n;return-1},i=function(t){var n=0;while(e[t]&&e[t].is_dialogue())n++,t++;return n},s=function(t,n){var r=i(n),s=e.splice(n,r);e[t].right_column=s};while(t){var o=n(),u=o===-1?-1:r(o);t=o!=-1&&u!=-1,t&&s(o,u)}};return r.line=function(e,t){var n=[];return i="normal",e.forEach(function(e){var r=(t.print()[e.type]||{}).max||99999;e.dual&&(r*=t.print().dual_max_factor),o(e,r),e.lines.forEach(function(e){n.push(e)})}),f(n),n=a(n,t.print().lines_per_page,t.lines_breaker||u,t),n},r}),define("utils/decorator",[],function(){var e=function(e){var t=[],n,r=function(){var i=this,s;return s=Array.prototype.slice.call(arguments,0),n=e.apply(i,s),r.lock?r.lock=!1:t.forEach(function(e){n instanceof Function&&n.add?n.add(e):e.apply(i,[n,s])}),n};return r.add=function(e){t.push(e)},r.decorated=!0,r};return e.signal=function(){return e(function(e){return e})},e.property=function(){var t,n=e(function(e){return arguments.length===0?(n.lock=!0,t):(t=e,t)});return n},e}),define("modules/data",["require","modernizr","utils/fountain/parser","utils/fountain/liner","utils/decorator"],function(e){var t=e("modernizr"),n=e("utils/fountain/parser"),r=e("utils/fountain/liner"),i=e("utils/decorator"),s={},o={};s.data=function(e,n){if(t.localstorage){if(arguments.length===1)return window.localStorage.getItem("com.afterwriting.labs.local-storage."+e);window.localStorage.setItem("com.afterwriting.labs.local-storage."+e,n)}else{if(arguments.length===1)return o[e];o[e]=n}},s.script=i.property(),s.parse=i(function(){s.parsed=n.parse(s.script(),s.config),s.parsed.lines=r.line(s.parsed.tokens,s.config)}),s.get_title_page_token=function(e){var t=null;return s.parsed&&s.parsed.title_page&&s.parsed.title_page.forEach(function(n){n.is(e)&&(t=n)}),t};var u={a4:{paper_size:"a4",lines_per_page:58,top_margin:1,page_width:8.27,left_margin:1.5,right_margin:1,font_width:.1,font_height:.1667,line_spacing:1,page_number_top_margin:.5,dual_max_factor:.75,title_page:{top_start:3.5,draft_date:{x:5.3,y:8.2},date:{x:5.3,y:8.2},contact:{x:5.3,y:8.5},notes:{x:1.5,y:8.5}},scene_heading:{feed:1.5,max:58},action:{feed:1.5,max:58},character:{feed:3.7,max:33},parenthetical:{feed:3.1,max:35},dialogue:{feed:2.5,max:33},transition:{feed:0,max:58},centered:{feed:1.5,style:"center",max:58},synopsis:{feed:.5,max:58,italic:!0,color:"#888888",padding:0,feed_with_last_section:!0},section:{feed:.5,max:58,color:"#555555",level_indent:.2}}};u.usletter=JSON.parse(JSON.stringify(u.a4));var a=u.usletter;return a.paper_size="letter",a.lines_per_page=54,a.page_width=8.5,a.scene_heading.max=60,a.action.max=60,a.character.max=35,a.parenthetical.max=38,a.dialogue.max=35,a.transition.max=60,a.centered.max=60,a.synopsis.max=60,a.section.max=60,s.default_config={show_background_image:!0,embolden_scene_headers:!1,show_page_numbers:!0,split_dialogue:!0,print_title_page:!0,text:{},print_profile:"a4",load_last_opened:!1,double_space_between_scenes:!1,print_sections:!1,print_synopsis:!1,number_sections:!1,use_dual_dialogue:!0,stats_keep_last_scene_time:!0,stats_who_with_who_max:10},s.default_config.print=function(){return u[s.config.print_profile]},s.save_config=function(){s.data("config",JSON.stringify(s.config))},s.reset_config=function(){s.data("config",JSON.stringify({})),s.load_config()},s.load_config=function(){s.config=Object.create(s.default_config);var e;try{e=JSON.parse(s.data("config"))}catch(t){e={}}for(var n in e)s.config[n]=e[n]},s.prepare=function(){s.load_config()},s}),define("utils/pluginmanager",["require","logger","modules/data","utils/decorator"],function(e){var t=e("logger"),n=e("modules/data"),r=e("utils/decorator"),i=t.get("pluginmanager"),s={},o;return s.create_plugin=function(e,t){return{is_plugin:!0,activate:function(){},deactivate:function(){},context:{},init:function(){},data:{},name:e,title:t,"class":"inactive"}},s.switch_to=r(function(e){if(e===o){s.switch_to.lock=!0;return}return i.info("Switching to: "+e.name),o&&o.deactivate(),o=e,n.parse(),o.activate(),o}),s.refresh=function(){o&&(o.deactivate(),o.activate())},s}),define("utils/common",[],function(){return{data:{static_path:"bundle/",footer:'version: <a href="http://www.imdb.com/title/tt1790885/" target="_blank"><span class="version">Zero</span>&nbsp;Dark Thrirty</a>'}}}),define("utils/layout",["jquery","templates","modules/data","handlebars","utils/pluginmanager","utils/common","templates"],function(e,t,n,r,i,s,o){var u={only_active_visible:!0};r.registerHelper("static_path",function(){return s.data.static_path});var a=function(){u.small=e("html").width()<800},f=function(t){t=t||u.small;var n=u.only_active_visible,r=3,i=u.small?70:100,s=u.small?5:15,o={};o.top=u.small?120:150;var a=r*(i+s)+s;o.left=(e("html").width()-a)/2;var f=function(e,t,n){var u=Math.floor(e/r),a=Math.floor(t/r),f=e%r,l=t%r||r,c=e>=t-l,h=c?l:r,p=Math.floor(n/r),d=((r-h)*(i+s)-s)/2,v=a<p?i/3:0,m={top:u*(i+s)+o.top+v,left:s+f*(i+s)+o.left+d};return m};n?e(".menu-item.inactive").hide():e(".menu-item.inactive").show(),e(".menu-item"+(n?".active":"")).each(function(r){var s=e(".menu-item.active").size(),o=e(".menu-item").size(),u=f(r,n?s:o,o);u.opacity=1,u.width=i-40,u.height=i-40,e(this).animate(u,t?0:800)})};return u.close_content=function(t){var n=u.small?0:500,r=t?"offset":"animate";e(".content")[r]({top:-e(".content").height()},{duration:n}).addClass("content-closed")},u.show_tooltip=function(t){e("#tooltip").css("visibility","visible").html(t)},u.move_tooltip=function(t,n){e("#tooltip").css("top",n-10+"px").css("left",t+10+"px")},u.hide_tooltip=function(){e("#tooltip").css("visibility","hidden")},u.show_main=function(){u.close_content(),e(".tool.inactive").fadeIn(),u.only_active_visible=!1,f()},u.set_footer=function(t){e(".footer").html(t)},u.init_layout=function(t){a();var r=7;!u.small&&n.config.show_background_image?e("html").css("background-image","url("+s.data.static_path+"gfx/bg"+Math.floor(Math.random()*r)+".jpg)"):e("html").css("background-color","#111111");var l=o["templates/layout.hbs"],c=l(t);e("body").append(c);var h=0,p=0;t.plugins.forEach(function(e){e.class!=="active"&&h++,p++}),e(".menu-item").hover(function(){e(this).addClass("menu-item-hover")},function(){e(this).removeClass("menu-item-hover")}),e(".tool").hover(function(){e(this).addClass("tool-hover")},function(){e(this).removeClass("tool-hover")});var d=function(){var t=u.small?0:(e("html").width()-e(".content").outerWidth())/2,n=e(document).height();e(".content").height(n).offset({left:t}),e(".plugin-content").height(n-e(".top-bar").height()-(u.small?10:50)),e(".to-the-bottom").height(function(){return n-e(this).offset().top-60})};u.open_content=function(){var t=u.small?0:200;e(".content").removeClass("content-closed").animate({top:0},{duration:t})},e(window).resize(function(){a(),d(),e(".content").hasClass("content-closed")?u.close_content(!0):u.open_content(),f(!0)}),d(),u.close_content(!0),u.switch_to_plugin=function(t){var n=u.small?0:200;e(".plugin-content.active").removeClass("active").fadeOut(n),setTimeout(function(){e('.plugin-content[plugin="'+t+'"]').fadeIn().addClass("active")},n),setTimeout(d,500),e(".tool.active").removeClass("active"),e('.tool[plugin="'+t+'"]').addClass("active")},e(".menu-item, a.switch").click(function(){u.open_content(),u.switch_to_plugin(e(this).attr("plugin"))}),e(".tool").click(function(){e(this).hasClass("active")||u.switch_to_plugin(e(this).attr("plugin"))}),e(".info-content").hide(),e(".info-icon").click(function(){var t=u.small?0:200,n=e(this).attr("section");e('.info-content[section="'+n+'"]').toggle({duration:t,easing:"linear"})}),e(".close-content").click(function(){u.close_content()}),t.plugins.forEach(function(t){e('.tool[plugin="'+t.name+'"], .menu-item[plugin="'+t.name+'"], a.switch[plugin="'+t.name+'"]').click(function(){i.switch_to(t)})}),i.switch_to.add(function(e){u.switch_to_plugin(e.name)}),e(".plugin-contents > div").hide(),e(".menu-item").offset({top:e(window).height()/2,left:e(window).width()/2}),e(".menu-item").css({opacity:0}),e(".tool.inactive").hide(),f(!0),e(".content").css("display","block"),e(".menu").fadeIn();var v=s.data.footer;u.set_footer(v)},u}),!function(){function e(e,t){return t>e?-1:e>t?1:e>=t?0:0/0}function t(e){return null!=e&&!isNaN(e)}function n(e){return{left:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)<0?r=s+1:i=s}return r},right:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)>0?i=s:r=s+1}return r}}}function r(e){return e.length}function i(e){for(var t=1;e*t%1;)t*=10;return t}function s(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function o(){}function u(e){return ou+e in this}function a(e){return e=ou+e,e in this&&delete this[e]}function f(){var e=[];return this.forEach(function(t){e.push(t)}),e}function l(){var e=0;for(var t in this)t.charCodeAt(0)===uu&&++e;return e}function c(){for(var e in this)if(e.charCodeAt(0)===uu)return!1;return!0}function h(){}function p(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function d(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var n=0,r=au.length;r>n;++n){var i=au[n]+t;if(i in e)return i}}function v(){}function m(){}function g(e){function t(){for(var t,r=n,i=-1,s=r.length;++i<s;)(t=r[i].on)&&t.apply(this,arguments);return e}var n=[],r=new o;return t.on=function(t,i){var s,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,s=n.indexOf(o)).concat(n.slice(s+1)),r.remove(t)),i&&n.push(r.set(t,{on:i})),e)},t}function y(){Xo.event.preventDefault()}function b(){for(var e,t=Xo.event;e=t.sourceEvent;)t=e;return t}function w(e){for(var t=new m,n=0,r=arguments.length;++n<r;)t[arguments[n]]=g(t);return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=Xo.event;i.target=e,Xo.event=i,t[i.type].apply(n,r)}finally{Xo.event=s}}},t}function E(e){return lu(e,vu),e}function S(e){return"function"==typeof e?e:function(){return cu(e,this)}}function x(e){return"function"==typeof e?e:function(){return hu(e,this)}}function T(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function s(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function u(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=Xo.ns.qualify(e),null==t?e.local?r:n:"function"==typeof t?e.local?u:o:e.local?s:i}function N(e){return e.trim().replace(/\s+/g," ")}function C(e){return new RegExp("(?:^|\\s+)"+Xo.requote(e)+"(?:\\s+|$)","g")}function k(e){return(e+"").trim().split(/^|\s+/)}function L(e,t){function n(){for(var n=-1;++n<i;)e[n](this,t)}function r(){for(var n=-1,r=t.apply(this,arguments);++n<i;)e[n](this,r)}e=k(e).map(A);var i=e.length;return"function"==typeof t?r:n}function A(e){var t=C(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",N(i+" "+e))):n.setAttribute("class",N(i.replace(t," ")))}}function O(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return null==t?r:"function"==typeof t?s:i}function M(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?i:r}function _(e){return"function"==typeof e?e:(e=Xo.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e)}}function D(e){return{__data__:e}}function P(e){return function(){return du(this,e)}}function H(t){return arguments.length||(t=e),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function B(e,t){for(var n=0,r=e.length;r>n;n++)for(var i,s=e[n],o=0,u=s.length;u>o;o++)(i=s[o])&&t(i,o,n);return e}function j(e){return lu(e,gu),e}function F(e){var t,n;return function(r,i,s){var o,u=e[s].update,a=u.length;for(s!=n&&(n=s,t=0),i>=t&&(t=i+1);!(o=u[t])&&++t<a;);return o}}function I(){var e=this.__transition__;e&&++e.active}function q(e,t,n){function r(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function i(){var i=a(t,$o(arguments));r.call(this),this.addEventListener(e,this[o]=i,i.$=n),i._=t}function s(){var t,n=new RegExp("^__on([^.]+)"+Xo.requote(e)+"$");for(var r in this)if(t=r.match(n)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var o="__on"+e,u=e.indexOf("."),a=R;u>0&&(e=e.substring(0,u));var f=bu.get(e);return f&&(e=f,a=U),u?t?i:r:t?v:s}function R(e,t){return function(n){var r=Xo.event;Xo.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{Xo.event=r}}}function U(e,t){var n=R(e,t);return function(e){var t=this,r=e.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||n.call(t,e)}}function z(){var e=".dragsuppress-"+ ++Eu,t="click"+e,n=Xo.select(Qo).on("touchmove"+e,y).on("dragstart"+e,y).on("selectstart"+e,y);if(wu){var r=Ko.style,i=r[wu];r[wu]="none"}return function(s){function o(){n.on(t,null)}n.on(e,null),wu&&(r[wu]=i),s&&(n.on(t,function(){y(),o()},!0),setTimeout(o,0))}}function W(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(0>Su&&(Qo.scrollX||Qo.scrollY)){n=Xo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var i=n[0][0].getScreenCTM();Su=!i.f&&!i.e,n.remove()}return Su?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function X(){return Xo.event.changedTouches[0].identifier}function V(){return Xo.event.target}function $(){return Qo}function J(e){return e>0?1:0>e?-1:0}function K(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function Q(e){return e>1?0:-1>e?xu:Math.acos(e)}function G(e){return e>1?Nu:-1>e?-Nu:Math.asin(e)}function Y(e){return((e=Math.exp(e))-1/e)/2}function Z(e){return((e=Math.exp(e))+1/e)/2}function et(e){return((e=Math.exp(2*e))-1)/(e+1)}function tt(e){return(e=Math.sin(e/2))*e}function nt(){}function rt(e,t,n){return this instanceof rt?(this.h=+e,this.s=+t,void (this.l=+n)):arguments.length<2?e instanceof rt?new rt(e.h,e.s,e.l):gt(""+e,yt,rt):new rt(e,t,n)}function it(e,t,n){function r(e){return e>360?e-=360:0>e&&(e+=360),60>e?s+(o-s)*e/60:180>e?o:240>e?s+(o-s)*(240-e)/60:s}function i(e){return Math.round(255*r(e))}var s,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,o=.5>=n?n*(1+t):n+t-n*t,s=2*n-o,new pt(i(e+120),i(e),i(e-120))}function st(e,t,n){return this instanceof st?(this.h=+e,this.c=+t,void (this.l=+n)):arguments.length<2?e instanceof st?new st(e.h,e.c,e.l):e instanceof ut?ft(e.l,e.a,e.b):ft((e=bt((e=Xo.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new st(e,t,n)}function ot(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new ut(n,Math.cos(e*=Lu)*t,Math.sin(e)*t)}function ut(e,t,n){return this instanceof ut?(this.l=+e,this.a=+t,void (this.b=+n)):arguments.length<2?e instanceof ut?new ut(e.l,e.a,e.b):e instanceof st?ot(e.l,e.c,e.h):bt((e=pt(e)).r,e.g,e.b):new ut(e,t,n)}function at(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=lt(i)*Iu,r=lt(r)*qu,s=lt(s)*Ru,new pt(ht(3.2404542*i-1.5371385*r-.4985314*s),ht(-0.969266*i+1.8760108*r+.041556*s),ht(.0556434*i-.2040259*r+1.0572252*s))}function ft(e,t,n){return e>0?new st(Math.atan2(n,t)*Au,Math.sqrt(t*t+n*n),e):new st(0/0,0/0,e)}function lt(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function ct(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function ht(e){return Math.round(255*(.00304>=e?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function pt(e,t,n){return this instanceof pt?(this.r=~~e,this.g=~~t,void (this.b=~~n)):arguments.length<2?e instanceof pt?new pt(e.r,e.g,e.b):gt(""+e,pt,it):new pt(e,t,n)}function dt(e){return new pt(e>>16,255&e>>8,255&e)}function vt(e){return dt(e)+""}function mt(e){return 16>e?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function gt(e,t,n){var r,i,s,o=0,u=0,a=0;if(r=/([a-z]+)\((.*)\)/i.exec(e))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Et(i[0]),Et(i[1]),Et(i[2]))}return(s=Wu.get(e))?t(s.r,s.g,s.b):(null==e||"#"!==e.charAt(0)||isNaN(s=parseInt(e.substring(1),16))||(4===e.length?(o=(3840&s)>>4,o=o>>4|o,u=240&s,u=u>>4|u,a=15&s,a=a<<4|a):7===e.length&&(o=(16711680&s)>>16,u=(65280&s)>>8,a=255&s)),t(o,u,a))}function yt(e,t,n){var r,i,s=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),u=o-s,a=(o+s)/2;return u?(i=.5>a?u/(o+s):u/(2-o-s),r=e==o?(t-n)/u+(n>t?6:0):t==o?(n-e)/u+2:(e-t)/u+4,r*=60):(r=0/0,i=a>0&&1>a?0:r),new rt(r,i,a)}function bt(e,t,n){e=wt(e),t=wt(t),n=wt(n);var r=ct((.4124564*e+.3575761*t+.1804375*n)/Iu),i=ct((.2126729*e+.7151522*t+.072175*n)/qu),s=ct((.0193339*e+.119192*t+.9503041*n)/Ru);return ut(116*i-16,500*(r-i),200*(i-s))}function wt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Et(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function St(e){return"function"==typeof e?e:function(){return e}}function xt(e){return e}function Tt(e){return function(t,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),Nt(t,n,e,r)}}function Nt(e,t,n,r){function i(){var e,t=a.status;if(!t&&a.responseText||t>=200&&300>t||304===t){try{e=n.call(s,a)}catch(r){return o.error.call(s,r),void 0}o.load.call(s,e)}else o.error.call(s,a)}var s={},o=Xo.dispatch("beforesend","progress","load","error"),u={},a=new XMLHttpRequest,f=null;return!Qo.XDomainRequest||"withCredentials"in a||!/^(http(s)?:)?\/\//.test(e)||(a=new XDomainRequest),"onload"in a?a.onload=a.onerror=i:a.onreadystatechange=function(){a.readyState>3&&i()},a.onprogress=function(e){var t=Xo.event;Xo.event=e;try{o.progress.call(s,a)}finally{Xo.event=t}},s.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",s)},s.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",s):t},s.responseType=function(e){return arguments.length?(f=e,s):f},s.response=function(e){return n=e,s},["get","post"].forEach(function(e){s[e]=function(){return s.send.apply(s,[e].concat($o(arguments)))}}),s.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),a.open(n,e,!0),null==t||"accept"in u||(u.accept=t+",*/*"),a.setRequestHeader)for(var l in u)a.setRequestHeader(l,u[l]);return null!=t&&a.overrideMimeType&&a.overrideMimeType(t),null!=f&&(a.responseType=f),null!=i&&s.on("error",i).on("load",function(e){i(null,e)}),o.beforesend.call(s,a),a.send(null==r?null:r),s},s.abort=function(){return a.abort(),s},Xo.rebind(s,o,"on"),null==r?s:s.get(Ct(r))}function Ct(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function kt(){var e=Lt(),t=At()-e;t>24?(isFinite(t)&&(clearTimeout(Ju),Ju=setTimeout(kt,t)),$u=0):($u=1,Qu(kt))}function Lt(){var e=Date.now();for(Ku=Xu;Ku;)e>=Ku.t&&(Ku.f=Ku.c(e-Ku.t)),Ku=Ku.n;return e}function At(){for(var e,t=Xu,n=1/0;t;)t.f?t=e?e.n=t.n:Xu=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return Vu=e,n}function Ot(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function Mt(e,t){var n=Math.pow(10,3*su(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function _t(e){var t=e.decimal,n=e.thousands,r=e.grouping,i=e.currency,s=r?function(e){for(var t=e.length,i=[],s=0,o=r[0];t>0&&o>0;)i.push(e.substring(t-=o,t+o)),o=r[s=(s+1)%r.length];return i.reverse().join(n)}:xt;return function(e){var n=Yu.exec(e),r=n[1]||" ",o=n[2]||">",u=n[3]||"",a=n[4]||"",f=n[5],l=+n[6],c=n[7],h=n[8],p=n[9],d=1,v="",m="",g=!1;switch(h&&(h=+h.substring(1)),(f||"0"===r&&"="===o)&&(f=r="0",o="=",c&&(l-=Math.floor((l-1)/4))),p){case"n":c=!0,p="g";break;case"%":d=100,m="%",p="f";break;case"p":d=100,m="%",p="r";break;case"b":case"o":case"x":case"X":"#"===a&&(v="0"+p.toLowerCase());case"c":case"d":g=!0,h=0;break;case"s":d=-1,p="r"}"$"===a&&(v=i[0],m=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):("e"==p||"f"==p)&&(h=Math.max(0,Math.min(20,h)))),p=Zu.get(p)||Dt;var y=f&&c;return function(e){var n=m;if(g&&e%1)return"";var i=0>e||0===e&&0>1/e?(e=-e,"-"):u;if(0>d){var a=Xo.formatPrefix(e,h);e=a.scale(e),n=a.symbol+m}else e*=d;e=p(e,h);var b=e.lastIndexOf("."),w=0>b?e:e.substring(0,b),E=0>b?"":t+e.substring(b+1);!f&&c&&(w=s(w));var S=v.length+w.length+E.length+(y?0:i.length),x=l>S?(new Array(S=l-S+1)).join(r):"";return y&&(w=s(x+w)),i+=v,e=w+E,("<"===o?i+e+x:">"===o?x+i+e:"^"===o?x.substring(0,S>>=1)+i+e+x.substring(S):i+(y?e:x+e))+n}}}function Dt(e){return e+""}function Pt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ht(e,t,n){function r(t){var n=e(t),r=s(n,1);return r-t>t-n?n:r}function i(n){return t(n=e(new ta(n-1)),1),n}function s(e,n){return t(e=new ta(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)for(;r>o;)n(o)%s||u.push(new Date(+o)),t(o,1);else for(;r>o;)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{ta=Pt;var r=new Pt;return r._=e,o(r,t,n)}finally{ta=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=Bt(e);return a.floor=a,a.round=Bt(r),a.ceil=Bt(i),a.offset=Bt(s),a.range=u,e}function Bt(e){return function(t,n){try{ta=Pt;var r=new Pt;return r._=t,e(r,n)._}finally{ta=Date}}}function jt(e){function t(e){function t(t){for(var n,i,s,o=[],u=-1,a=0;++u<r;)37===e.charCodeAt(u)&&(o.push(e.substring(a,u)),null!=(i=ra[n=e.charAt(++u)])&&(n=e.charAt(++u)),(s=L[n])&&(n=s(t,null==i?"e"===n?" ":"0":i)),o.push(n),a=u+1);return o.push(e.substring(a,u)),o.join("")}var r=e.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=n(r,e,t,0);if(i!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var s=null!=r.Z&&ta!==Pt,o=new(s?Pt:ta);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+Math.floor(r.Z/100),r.M+r.Z%100,r.S,r.L),s?o._:o},t.toString=function(){return e},t}function n(e,t,n,r){for(var i,s,o,u=0,a=t.length,f=n.length;a>u;){if(r>=f)return-1;if(i=t.charCodeAt(u++),37===i){if(o=t.charAt(u++),s=A[o in ra?t.charAt(u++):o],!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function r(e,t,n){S.lastIndex=0;var r=S.exec(t.substring(n));return r?(e.w=x.get(r[0].toLowerCase()),n+r[0].length):-1}function i(e,t,n){w.lastIndex=0;var r=w.exec(t.substring(n));return r?(e.w=E.get(r[0].toLowerCase()),n+r[0].length):-1}function s(e,t,n){C.lastIndex=0;var r=C.exec(t.substring(n));return r?(e.m=k.get(r[0].toLowerCase()),n+r[0].length):-1}function o(e,t,n){T.lastIndex=0;var r=T.exec(t.substring(n));return r?(e.m=N.get(r[0].toLowerCase()),n+r[0].length):-1}function u(e,t,r){return n(e,L.c.toString(),t,r)}function a(e,t,r){return n(e,L.x.toString(),t,r)}function f(e,t,r){return n(e,L.X.toString(),t,r)}function l(e,t,n){var r=b.get(t.substring(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}var c=e.dateTime,h=e.date,p=e.time,d=e.periods,v=e.days,m=e.shortDays,g=e.months,y=e.shortMonths;t.utc=function(e){function n(e){try{ta=Pt;var t=new ta;return t._=e,r(t)}finally{ta=Date}}var r=t(e);return n.parse=function(e){try{ta=Pt;var t=r.parse(e);return t&&t._}finally{ta=Date}},n.toString=r.toString,n},t.multi=t.utc.multi=rn;var b=Xo.map(),w=It(v),E=qt(v),S=It(m),x=qt(m),T=It(g),N=qt(g),C=It(y),k=qt(y);d.forEach(function(e,t){b.set(e.toLowerCase(),t)});var L={a:function(e){return m[e.getDay()]},A:function(e){return v[e.getDay()]},b:function(e){return y[e.getMonth()]},B:function(e){return g[e.getMonth()]},c:t(c),d:function(e,t){return Ft(e.getDate(),t,2)},e:function(e,t){return Ft(e.getDate(),t,2)},H:function(e,t){return Ft(e.getHours(),t,2)},I:function(e,t){return Ft(e.getHours()%12||12,t,2)},j:function(e,t){return Ft(1+ea.dayOfYear(e),t,3)},L:function(e,t){return Ft(e.getMilliseconds(),t,3)},m:function(e,t){return Ft(e.getMonth()+1,t,2)},M:function(e,t){return Ft(e.getMinutes(),t,2)},p:function(e){return d[+(e.getHours()>=12)]},S:function(e,t){return Ft(e.getSeconds(),t,2)},U:function(e,t){return Ft(ea.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Ft(ea.mondayOfYear(e),t,2)},x:t(h),X:t(p),y:function(e,t){return Ft(e.getFullYear()%100,t,2)},Y:function(e,t){return Ft(e.getFullYear()%1e4,t,4)},Z:tn,"%":function(){return"%"}},A={a:r,A:i,b:s,B:o,c:u,d:Kt,e:Kt,H:Gt,I:Gt,j:Qt,L:en,m:Jt,M:Yt,p:l,S:Zt,U:Ut,w:Rt,W:zt,x:a,X:f,y:Xt,Y:Wt,Z:Vt,"%":nn};return t}function Ft(e,t,n){var r=0>e?"-":"",i=(r?-e:e)+"",s=i.length;return r+(n>s?(new Array(n-s+1)).join(t)+i:i)}function It(e){return new RegExp("^(?:"+e.map(Xo.requote).join("|")+")","i")}function qt(e){for(var t=new o,n=-1,r=e.length;++n<r;)t.set(e[n].toLowerCase(),n);return t}function Rt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Ut(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n));return r?(e.U=+r[0],n+r[0].length):-1}function zt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n));return r?(e.W=+r[0],n+r[0].length):-1}function Wt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Xt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.y=$t(+r[0]),n+r[0].length):-1}function Vt(e,t,n){return/^[+-]\d{4}$/.test(t=t.substring(n,n+5))?(e.Z=-t,n+5):-1}function $t(e){return e+(e>68?1900:2e3)}function Jt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Kt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Qt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function Gt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Yt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Zt(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function en(e,t,n){ia.lastIndex=0;var r=ia.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function tn(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(su(t)/60),i=su(t)%60;return n+Ft(r,"0",2)+Ft(i,"0",2)}function nn(e,t,n){sa.lastIndex=0;var r=sa.exec(t.substring(n,n+1));return r?n+r[0].length:-1}function rn(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,r=e[n];!r[1](t);)r=e[++n];return r[0](t)}}function sn(){}function on(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i)}function un(e,t){e&&fa.hasOwnProperty(e.type)&&fa[e.type](e,t)}function an(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function fn(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)an(e[n],t,1);t.polygonEnd()}function ln(){function e(e,t){e*=Lu,t=t*Lu/2+xu/4;var n=e-r,o=n>=0?1:-1,u=o*n,a=Math.cos(t),f=Math.sin(t),l=s*f,c=i*a+l*Math.cos(u),h=l*o*Math.sin(u);ca.add(Math.atan2(h,c)),r=e,i=a,s=f}var t,n,r,i,s;ha.point=function(o,u){ha.point=e,r=(t=o)*Lu,i=Math.cos(u=(n=u)*Lu/2+xu/4),s=Math.sin(u)},ha.lineEnd=function(){e(t,n)}}function cn(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function hn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pn(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function dn(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function vn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function mn(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function gn(e){return[Math.atan2(e[1],e[0]),G(e[2])]}function yn(e,t){return su(e[0]-t[0])<Cu&&su(e[1]-t[1])<Cu}function bn(e,t){e*=Lu;var n=Math.cos(t*=Lu);wn(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function wn(e,t,n){++pa,va+=(e-va)/pa,ma+=(t-ma)/pa,ga+=(n-ga)/pa}function En(){function e(e,i){e*=Lu;var s=Math.cos(i*=Lu),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=n*a-r*u)*f+(f=r*o-t*a)*f+(f=t*u-n*o)*f),t*o+n*u+r*a);da+=f,ya+=f*(t+(t=o)),ba+=f*(n+(n=u)),wa+=f*(r+(r=a)),wn(t,n,r)}var t,n,r;Ta.point=function(i,s){i*=Lu;var o=Math.cos(s*=Lu);t=o*Math.cos(i),n=o*Math.sin(i),r=Math.sin(s),Ta.point=e,wn(t,n,r)}}function Sn(){Ta.point=bn}function xn(){function e(e,t){e*=Lu;var n=Math.cos(t*=Lu),o=n*Math.cos(e),u=n*Math.sin(e),a=Math.sin(t),f=i*a-s*u,l=s*o-r*a,c=r*u-i*o,h=Math.sqrt(f*f+l*l+c*c),p=r*o+i*u+s*a,d=h&&-Q(p)/h,v=Math.atan2(h,p);Ea+=d*f,Sa+=d*l,xa+=d*c,da+=v,ya+=v*(r+(r=o)),ba+=v*(i+(i=u)),wa+=v*(s+(s=a)),wn(r,i,s)}var t,n,r,i,s;Ta.point=function(o,u){t=o,n=u,Ta.point=e,o*=Lu;var a=Math.cos(u*=Lu);r=a*Math.cos(o),i=a*Math.sin(o),s=Math.sin(u),wn(r,i,s)},Ta.lineEnd=function(){e(t,n),Ta.lineEnd=Sn,Ta.point=bn}}function Tn(){return!0}function Nn(e,t,n,r,i){var s=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t];if(yn(n,r)){i.lineStart();for(var u=0;t>u;++u)i.point((n=e[u])[0],n[1]);return i.lineEnd(),void 0}var a=new kn(n,e,null,!0),f=new kn(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new kn(r,e,null,!1),f=new kn(r,null,a,!0),a.o=f,s.push(a),o.push(f)}}),o.sort(t),Cn(s),Cn(o),s.length){for(var u=0,a=n,f=o.length;f>u;++u)o[u].e=a=!a;for(var l,c,h=s[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;l=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(var u=0,f=l.length;f>u;++u)i.point((c=l[u])[0],c[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){l=p.p.z;for(var u=l.length-1;u>=0;--u)i.point((c=l[u])[0],c[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,l=p.z,d=!d}while(!p.v);i.lineEnd()}}}function Cn(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function kn(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Ln(e,t,n,r){return function(i,s){function o(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&s.point(t,n)}function u(e,t){var n=i(e,t);m.point(n[0],n[1])}function a(){y.point=u,m.lineStart()}function f(){y.point=o,m.lineEnd()}function l(e,t){v.push([e,t]);var n=i(e,t);w.point(n[0],n[1])}function c(){w.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),w.lineEnd();var e,t=w.clean(),n=b.buffer(),r=n.length;if(v.pop(),d.push(v),v=null,r)if(1&t){e=n[0];var i,r=e.length-1,o=-1;if(r>0){for(E||(s.polygonStart(),E=!0),s.lineStart();++o<r;)s.point((i=e[o])[0],i[1]);s.lineEnd()}}else r>1&&2&t&&n.push(n.pop().concat(n.shift())),p.push(n.filter(An))}var p,d,v,m=t(s),g=i.invert(r[0],r[1]),y={point:o,lineStart:a,lineEnd:f,polygonStart:function(){y.point=l,y.lineStart=c,y.lineEnd=h,p=[],d=[]},polygonEnd:function(){y.point=o,y.lineStart=a,y.lineEnd=f,p=Xo.merge(p);var e=_n(g,d);p.length?(E||(s.polygonStart(),E=!0),Nn(p,Mn,e,n,s)):e&&(E||(s.polygonStart(),E=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),E&&(s.polygonEnd(),E=!1),p=d=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}},b=On(),w=t(b),E=!1;return y}}function An(e){return e.length>1}function On(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:v,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Mn(e,t){return((e=e.x)[0]<0?e[1]-Nu-Cu:Nu-e[1])-((t=t.x)[0]<0?t[1]-Nu-Cu:Nu-t[1])}function _n(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;ca.reset();for(var u=0,a=t.length;a>u;++u){var f=t[u],l=f.length;if(l)for(var c=f[0],h=c[0],p=c[1]/2+xu/4,d=Math.sin(p),v=Math.cos(p),m=1;;){m===l&&(m=0),e=f[m];var g=e[0],y=e[1]/2+xu/4,b=Math.sin(y),w=Math.cos(y),E=g-h,S=E>=0?1:-1,x=S*E,T=x>xu,N=d*b;if(ca.add(Math.atan2(N*S*Math.sin(x),v*w+N*Math.cos(x))),s+=T?E+S*Tu:E,T^h>=n^g>=n){var C=pn(cn(c),cn(e));mn(C);var k=pn(i,C);mn(k);var L=(T^E>=0?-1:1)*G(k[2]);(r>L||r===L&&(C[0]||C[1]))&&(o+=T^E>=0?1:-1)}if(!(m++))break;h=g,d=b,v=w,c=e}}return(-Cu>s||Cu>s&&0>ca)^1&o}function Dn(e){var t,n=0/0,r=0/0,i=0/0;return{lineStart:function(){e.lineStart(),t=1},point:function(s,o){var u=s>0?xu:-xu,a=su(s-n);su(a-xu)<Cu?(e.point(n,r=(r+o)/2>0?Nu:-Nu),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),e.point(s,r),t=0):i!==u&&a>=xu&&(su(n-i)<Cu&&(n-=i*Cu),su(s-u)<Cu&&(s-=u*Cu),r=Pn(n,r,s,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),t=0),e.point(n=s,r=o),i=u},lineEnd:function(){e.lineEnd(),n=r=0/0},clean:function(){return 2-t}}}function Pn(e,t,n,r){var i,s,o=Math.sin(e-n);return su(o)>Cu?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2}function Hn(e,t,n,r){var i;if(null==e)i=n*Nu,r.point(-xu,i),r.point(0,i),r.point(xu,i),r.point(xu,0),r.point(xu,-i),r.point(0,-i),r.point(-xu,-i),r.point(-xu,0),r.point(-xu,i);else if(su(e[0]-t[0])>Cu){var s=e[0]<t[0]?xu:-xu;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function Bn(e){function t(e,t){return Math.cos(e)*Math.cos(t)>s}function n(e){var n,s,a,f,l;return{lineStart:function(){f=a=!1,l=1},point:function(c,h){var p,d=[c,h],v=t(c,h),m=o?v?0:i(c,h):v?i(c+(0>c?xu:-xu),h):0;if(!n&&(f=a=v)&&e.lineStart(),v!==a&&(p=r(n,d),(yn(n,p)||yn(d,p))&&(d[0]+=Cu,d[1]+=Cu,v=t(d[0],d[1]))),v!==a)l=0,v?(e.lineStart(),p=r(d,n),e.point(p[0],p[1])):(p=r(n,d),e.point(p[0],p[1]),e.lineEnd()),n=p;else if(u&&n&&o^v){var g;m&s||!(g=r(d,n,!0))||(l=0,o?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])))}!v||n&&yn(n,d)||e.point(d[0],d[1]),n=d,a=v,s=m},lineEnd:function(){a&&e.lineEnd(),n=null},clean:function(){return l|(f&&a)<<1}}}function r(e,t,n){var r=cn(e),i=cn(t),o=[1,0,0],u=pn(r,i),a=hn(u,u),f=u[0],l=a-f*f;if(!l)return!n&&e;var c=s*a/l,h=-s*f/l,p=pn(o,u),d=vn(o,c),v=vn(u,h);dn(d,v);var m=p,g=hn(d,m),y=hn(m,m),b=g*g-y*(hn(d,d)-1);if(!(0>b)){var w=Math.sqrt(b),E=vn(m,(-g-w)/y);if(dn(E,d),E=gn(E),!n)return E;var S,x=e[0],T=t[0],N=e[1],C=t[1];x>T&&(S=x,x=T,T=S);var k=T-x,L=su(k-xu)<Cu,A=L||Cu>k;if(!L&&N>C&&(S=N,N=C,C=S),A?L?N+C>0^E[1]<(su(E[0]-x)<Cu?N:C):N<=E[1]&&E[1]<=C:k>xu^(x<=E[0]&&E[0]<=T)){var O=vn(m,(-g+w)/y);return dn(O,d),[E,gn(O)]}}}function i(t,n){var r=o?e:xu-e,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i}var s=Math.cos(e),o=s>0,u=su(s)>Cu,a=lr(e,6*Lu);return Ln(t,n,a,o?[0,-e]:[-xu,e-xu])}function jn(e,t,n,r){return function(i){var s,o=i.a,u=i.b,a=o.x,f=o.y,l=u.x,c=u.y,h=0,p=1,d=l-a,v=c-f;if(s=e-a,d||!(s>0)){if(s/=d,0>d){if(h>s)return;p>s&&(p=s)}else if(d>0){if(s>p)return;s>h&&(h=s)}if(s=n-a,d||!(0>s)){if(s/=d,0>d){if(s>p)return;s>h&&(h=s)}else if(d>0){if(h>s)return;p>s&&(p=s)}if(s=t-f,v||!(s>0)){if(s/=v,0>v){if(h>s)return;p>s&&(p=s)}else if(v>0){if(s>p)return;s>h&&(h=s)}if(s=r-f,v||!(0>s)){if(s/=v,0>v){if(s>p)return;s>h&&(h=s)}else if(v>0){if(h>s)return;p>s&&(p=s)}return h>0&&(i.a={x:a+h*d,y:f+h*v}),1>p&&(i.b={x:a+p*d,y:f+p*v}),i}}}}}}function Fn(e,t,n,r){function i(r,i){return su(r[0]-e)<Cu?i>0?0:3:su(r[0]-n)<Cu?i>0?2:1:su(r[1]-t)<Cu?i>0?1:0:i>0?3:2}function s(e,t){return o(e.x,t.x)}function o(e,t){var n=i(e,1),r=i(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(u){function a(e){for(var t=0,n=m.length,r=e[1],i=0;n>i;++i)for(var s,o=1,u=m[i],a=u.length,f=u[0];a>o;++o)s=u[o],f[1]<=r?s[1]>r&&K(f,s,e)>0&&++t:s[1]<=r&&K(f,s,e)<0&&--t,f=s;return 0!==t}function f(s,u,a,f){var l=0,c=0;if(null==s||(l=i(s,a))!==(c=i(u,a))||o(s,u)<0^a>0){do f.point(0===l||3===l?e:n,l>1?r:t);while((l=(l+a+4)%4)!==c)}else f.point(u[0],u[1])}function l(i,s){return i>=e&&n>=i&&s>=t&&r>=s}function c(e,t){l(e,t)&&u.point(e,t)}function h(){A.point=d,m&&m.push(g=[]),T=!0,x=!1,E=S=0/0}function p(){v&&(d(y,b),w&&x&&k.rejoin(),v.push(k.buffer())),A.point=c,x&&u.lineEnd()}function d(e,t){e=Math.max(-Ca,Math.min(Ca,e)),t=Math.max(-Ca,Math.min(Ca,t));var n=l(e,t);if(m&&g.push([e,t]),T)y=e,b=t,w=n,T=!1,n&&(u.lineStart(),u.point(e,t));else if(n&&x)u.point(e,t);else{var r={a:{x:E,y:S},b:{x:e,y:t}};L(r)?(x||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),N=!1):n&&(u.lineStart(),u.point(e,t),N=!1)}E=e,S=t,x=n}var v,m,g,y,b,w,E,S,x,T,N,C=u,k=On(),L=jn(e,t,n,r),A={point:c,lineStart:h,lineEnd:p,polygonStart:function(){u=k,v=[],m=[],N=!0},polygonEnd:function(){u=C,v=Xo.merge(v);var t=a([e,r]),n=N&&t,i=v.length;(n||i)&&(u.polygonStart(),n&&(u.lineStart(),f(null,null,1,u),u.lineEnd()),i&&Nn(v,s,t,f,u),u.polygonEnd()),v=m=g=null}};return A}}function In(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function qn(e){var t=0,n=xu/3,r=nr(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*xu/180,n=e[1]*xu/180):[180*(t/xu),180*(n/xu)]},i}function Rn(e,t){function n(e,t){var n=Math.sqrt(s-2*i*Math.sin(t))/i;return[n*Math.sin(e*=i),o-n*Math.cos(e)]}var r=Math.sin(e),i=(r+Math.sin(t))/2,s=1+r*(2*i-r),o=Math.sqrt(s)/i;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/i,G((s-(e*e+n*n)*i*i)/(2*i))]},n}function Un(){function e(e,t){La+=i*e-r*t,r=e,i=t}var t,n,r,i;Da.point=function(s,o){Da.point=e,t=r=s,n=i=o},Da.lineEnd=function(){e(t,n)}}function zn(e,t){Aa>e&&(Aa=e),e>Ma&&(Ma=e),Oa>t&&(Oa=t),t>_a&&(_a=t)}function Wn(){function e(e,t){o.push("M",e,",",t,s)}function t(e,t){o.push("M",e,",",t),u.point=n}function n(e,t){o.push("L",e,",",t)}function r(){u.point=e}function i(){o.push("Z")}var s=Xn(4.5),o=[],u={point:e,lineStart:function(){u.point=t},lineEnd:r,polygonStart:function(){u.lineEnd=i},polygonEnd:function(){u.lineEnd=r,u.point=e},pointRadius:function(e){return s=Xn(e),u},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return u}function Xn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Vn(e,t){va+=e,ma+=t,++ga}function $n(){function e(e,r){var i=e-t,s=r-n,o=Math.sqrt(i*i+s*s);ya+=o*(t+e)/2,ba+=o*(n+r)/2,wa+=o,Vn(t=e,n=r)}var t,n;Ha.point=function(r,i){Ha.point=e,Vn(t=r,n=i)}}function Jn(){Ha.point=Vn}function Kn(){function e(e,t){var n=e-r,s=t-i,o=Math.sqrt(n*n+s*s);ya+=o*(r+e)/2,ba+=o*(i+t)/2,wa+=o,o=i*e-r*t,Ea+=o*(r+e),Sa+=o*(i+t),xa+=3*o,Vn(r=e,i=t)}var t,n,r,i;Ha.point=function(s,o){Ha.point=e,Vn(t=r=s,n=i=o)},Ha.lineEnd=function(){e(t,n)}}function Qn(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,o,0,Tu)}function n(t,n){e.moveTo(t,n),u.point=r}function r(t,n){e.lineTo(t,n)}function i(){u.point=t}function s(){e.closePath()}var o=4.5,u={point:t,lineStart:function(){u.point=n},lineEnd:i,polygonStart:function(){u.lineEnd=s},polygonEnd:function(){u.lineEnd=i,u.point=t},pointRadius:function(e){return o=e,u},result:v};return u}function Gn(e){function t(e){return(u?r:n)(e)}function n(t){return er(t,function(n,r){n=e(n,r),t.point(n[0],n[1])})}function r(t){function n(n,r){n=e(n,r),t.point(n[0],n[1])}function r(){b=0/0,T.point=s,t.lineStart()}function s(n,r){var s=cn([n,r]),o=e(n,r);i(b,w,y,E,S,x,b=o[0],w=o[1],y=n,E=s[0],S=s[1],x=s[2],u,t),t.point(b,w)}function o(){T.point=n,t.lineEnd()}function a(){r(),T.point=f,T.lineEnd=l}function f(e,t){s(c=e,h=t),p=b,d=w,v=E,m=S,g=x,T.point=s}function l(){i(b,w,y,E,S,x,p,d,c,v,m,g,u,t),T.lineEnd=o,o()}var c,h,p,d,v,m,g,y,b,w,E,S,x,T={point:n,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),T.lineStart=a},polygonEnd:function(){t.polygonEnd(),T.lineStart=r}};return T}function i(t,n,r,u,a,f,l,c,h,p,d,v,m,g){var y=l-t,b=c-n,w=y*y+b*b;if(w>4*s&&m--){var E=u+p,S=a+d,x=f+v,T=Math.sqrt(E*E+S*S+x*x),N=Math.asin(x/=T),C=su(su(x)-1)<Cu||su(r-h)<Cu?(r+h)/2:Math.atan2(S,E),k=e(C,N),L=k[0],A=k[1],O=L-t,M=A-n,_=b*O-y*M;(_*_/w>s||su((y*O+b*M)/w-.5)>.3||o>u*p+a*d+f*v)&&(i(t,n,r,u,a,f,L,A,C,E/=T,S/=T,x,m,g),g.point(L,A),i(L,A,C,E,S,x,l,c,h,p,d,v,m,g))}}var s=.5,o=Math.cos(30*Lu),u=16;return t.precision=function(e){return arguments.length?(u=(s=e*e)>0&&16,t):Math.sqrt(s)},t}function Yn(e){var t=Gn(function(t,n){return e([t*Au,n*Au])});return function(e){return rr(t(e))}}function Zn(e){this.stream=e}function er(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function tr(e){return nr(function(){return e})()}function nr(e){function t(e){return e=u(e[0]*Lu,e[1]*Lu),[e[0]*h+a,f-e[1]*h]}function n(e){return e=u.invert((e[0]-a)/h,(f-e[1])/h),e&&[e[0]*Au,e[1]*Au]}function r(){u=In(o=or(g,y,b),s);var e=s(v,m);return a=p-e[0]*h,f=d+e[1]*h,i()}function i(){return l&&(l.valid=!1,l=null),t}var s,o,u,a,f,l,c=Gn(function(e,t){return e=s(e,t),[e[0]*h+a,f-e[1]*h]}),h=150,p=480,d=250,v=0,m=0,g=0,y=0,b=0,w=Na,E=xt,S=null,x=null;return t.stream=function(e){return l&&(l.valid=!1),l=rr(w(o,c(E(e)))),l.valid=!0,l},t.clipAngle=function(e){return arguments.length?(w=null==e?(S=e,Na):Bn((S=+e)*Lu),i()):S},t.clipExtent=function(e){return arguments.length?(x=e,E=e?Fn(e[0][0],e[0][1],e[1][0],e[1][1]):xt,i()):x},t.scale=function(e){return arguments.length?(h=+e,r()):h},t.translate=function(e){return arguments.length?(p=+e[0],d=+e[1],r()):[p,d]},t.center=function(e){return arguments.length?(v=e[0]%360*Lu,m=e[1]%360*Lu,r()):[v*Au,m*Au]},t.rotate=function(e){return arguments.length?(g=e[0]%360*Lu,y=e[1]%360*Lu,b=e.length>2?e[2]%360*Lu:0,r()):[g*Au,y*Au,b*Au]},Xo.rebind(t,c,"precision"),function(){return s=e.apply(this,arguments),t.invert=s.invert&&n,r()}}function rr(e){return er(e,function(t,n){e.point(t*Lu,n*Lu)})}function ir(e,t){return[e,t]}function sr(e,t){return[e>xu?e-Tu:-xu>e?e+Tu:e,t]}function or(e,t,n){return e?t||n?In(ar(e),fr(t,n)):ar(e):t||n?fr(t,n):sr}function ur(e){return function(t,n){return t+=e,[t>xu?t-Tu:-xu>t?t+Tu:t,n]}}function ar(e){var t=ur(e);return t.invert=ur(-e),t}function fr(e,t){function n(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*r+u*i;return[Math.atan2(a*s-l*o,u*r-f*i),G(l*s+a*o)]}var r=Math.cos(e),i=Math.sin(e),s=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*s-a*o;return[Math.atan2(a*s+f*o,u*r+l*i),G(l*r-u*i)]},n}function lr(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;null!=i?(i=cr(n,i),s=cr(n,s),(o>0?s>i:i>s)&&(i+=o*Tu)):(i=e+o*Tu,s=e-.5*a);for(var f,l=i;o>0?l>s:s>l;l-=a)u.point((f=gn([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1])}}function cr(e,t){var n=cn(t);n[0]-=e,mn(n);var r=Q(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Cu)%(2*Math.PI)}function hr(e,t,n){var r=Xo.range(e,t-Cu,n).concat(t);return function(e){return r.map(function(t){return[e,t]})}}function pr(e,t,n){var r=Xo.range(e,t-Cu,n).concat(t);return function(e){return r.map(function(t){return[t,e]})}}function dr(e){return e.source}function vr(e){return e.target}function mr(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(tt(r-t)+i*o*tt(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*Au,Math.atan2(o,Math.sqrt(r*r+i*i))*Au]}:function(){return[e*Au,t*Au]};return d.distance=h,d}function gr(){function e(e,i){var s=Math.sin(i*=Lu),o=Math.cos(i),u=su((e*=Lu)-t),a=Math.cos(u);Ba+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=r*s-n*o*a)*u),n*s+r*o*a),t=e,n=s,r=o}var t,n,r;ja.point=function(i,s){t=i*Lu,n=Math.sin(s*=Lu),r=Math.cos(s),ja.point=e},ja.lineEnd=function(){ja.point=ja.lineEnd=v}}function yr(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)]},n}function br(e,t){function n(e,t){o>0?-Nu+Cu>t&&(t=-Nu+Cu):t>Nu-Cu&&(t=Nu-Cu);var n=o/Math.pow(i(t),s);return[n*Math.sin(s*e),o-n*Math.cos(s*e)]}var r=Math.cos(e),i=function(e){return Math.tan(xu/4+e/2)},s=e===t?Math.sin(e):Math.log(r/Math.cos(t))/Math.log(i(t)/i(e)),o=r*Math.pow(i(e),s)/s;return s?(n.invert=function(e,t){var n=o-t,r=J(s)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/s,2*Math.atan(Math.pow(o/r,1/s))-Nu]},n):Er}function wr(e,t){function n(e,t){var n=s-t;return[n*Math.sin(i*e),s-n*Math.cos(i*e)]}var r=Math.cos(e),i=e===t?Math.sin(e):(r-Math.cos(t))/(t-e),s=r/i+e;return su(i)<Cu?ir:(n.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/i,s-J(i)*Math.sqrt(e*e+n*n)]},n)}function Er(e,t){return[e,Math.log(Math.tan(xu/4+t/2))]}function Sr(e){var t,n=tr(e),r=n.scale,i=n.translate,s=n.clipExtent;return n.scale=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=s.apply(n,arguments);if(o===n){if(t=null==e){var u=xu*r(),a=i();s([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]])}}else t&&(o=null);return o},n.clipExtent(null)}function xr(e,t){return[Math.log(Math.tan(xu/4+t/2)),-e]}function Tr(e){return e[0]}function Nr(e){return e[1]}function Cr(e){for(var t=e.length,n=[0,1],r=2,i=2;t>i;i++){for(;r>1&&K(e[n[r-2]],e[n[r-1]],e[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}function kr(e,t){return e[0]-t[0]||e[1]-t[1]}function Lr(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Ar(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l]}function Or(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Mr(){Yr(this),this.edge=this.site=this.circle=null}function _r(e){var t=Ka.pop()||new Mr;return t.site=e,t}function Dr(e){zr(e),Va.remove(e),Ka.push(e),Yr(e)}function Pr(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];Dr(e);for(var a=s;a.circle&&su(n-a.circle.x)<Cu&&su(r-a.circle.cy)<Cu;)s=a.P,u.unshift(a),Dr(a),a=s;u.unshift(a),zr(a);for(var f=o;f.circle&&su(n-f.circle.x)<Cu&&su(r-f.circle.cy)<Cu;)o=f.N,u.push(f),Dr(f),f=o;u.push(f),zr(f);var l,c=u.length;for(l=1;c>l;++l)f=u[l],a=u[l-1],Kr(f.edge,a.site,f.site,i);a=u[0],f=u[c-1],f.edge=$r(a.site,f.site,null,i),Ur(a),Ur(f)}function Hr(e){for(var t,n,r,i,s=e.x,o=e.y,u=Va._;u;)if(r=Br(u,o)-s,r>Cu)u=u.L;else{if(i=s-jr(u,o),!(i>Cu)){r>-Cu?(t=u.P,n=u):i>-Cu?(t=u,n=u.N):t=n=u;break}if(!u.R){t=u;break}u=u.R}var a=_r(e);if(Va.insert(t,a),t||n){if(t===n)return zr(t),n=_r(t.site),Va.insert(a,n),a.edge=n.edge=$r(t.site,a.site),Ur(t),Ur(n),void 0;if(!n)return a.edge=$r(t.site,a.site),void 0;zr(t),zr(n);var f=t.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=n.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};Kr(n.edge,f,d,w),a.edge=$r(f,e,null,w),n.edge=$r(e,d,null,w),Ur(t),Ur(n)}}function Br(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-1/0;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2}function jr(e,t){var n=e.N;if(n)return Br(n,t);var r=e.site;return r.y===t?r.x:1/0}function Fr(e){this.site=e,this.edges=[]}function Ir(e){for(var t,n,r,i,s,o,u,a,f,l,c=e[0][0],h=e[1][0],p=e[0][1],d=e[1][1],v=Xa,m=v.length;m--;)if(s=v[m],s&&s.prepare())for(u=s.edges,a=u.length,o=0;a>o;)l=u[o].end(),r=l.x,i=l.y,f=u[++o%a].start(),t=f.x,n=f.y,(su(r-t)>Cu||su(i-n)>Cu)&&(u.splice(o,0,new Qr(Jr(s.site,l,su(r-c)<Cu&&d-i>Cu?{x:c,y:su(t-c)<Cu?n:d}:su(i-d)<Cu&&h-r>Cu?{x:su(n-d)<Cu?t:h,y:d}:su(r-h)<Cu&&i-p>Cu?{x:h,y:su(t-h)<Cu?n:p}:su(i-p)<Cu&&r-c>Cu?{x:su(n-p)<Cu?t:c,y:p}:null),s.site,null)),++a)}function qr(e,t){return t.angle-e.angle}function Rr(){Yr(this),this.x=this.y=this.arc=this.site=this.cy=null}function Ur(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,s=n.site;if(r!==s){var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(!(h>=-ku)){var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=Qa.pop()||new Rr;g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;for(var y=null,b=Ja._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break}b=b.L}else{if(!b.R){y=b;break}b=b.R}Ja.insert(y,g),y||($a=g)}}}}function zr(e){var t=e.circle;t&&(t.P||($a=t.N),Ja.remove(t),Qa.push(t),Yr(t),e.circle=null)}function Wr(e){for(var t,n=Wa,r=jn(e[0][0],e[0][1],e[1][0],e[1][1]),i=n.length;i--;)t=n[i],(!Xr(t,e)||!r(t)||su(t.a.x-t.b.x)<Cu&&su(t.a.y-t.b.y)<Cu)&&(t.a=t.b=null,n.splice(i,1))}function Xr(e,t){var n=e.b;if(n)return!0;var r,i,s=e.a,o=t[0][0],u=t[1][0],a=t[0][1],f=t[1][1],l=e.l,c=e.r,h=l.x,p=l.y,d=c.x,v=c.y,m=(h+d)/2,g=(p+v)/2;if(v===p){if(o>m||m>=u)return;if(h>d){if(s){if(s.y>=f)return}else s={x:m,y:a};n={x:m,y:f}}else{if(s){if(s.y<a)return}else s={x:m,y:f};n={x:m,y:a}}}else if(r=(h-d)/(v-p),i=g-r*m,-1>r||r>1)if(h>d){if(s){if(s.y>=f)return}else s={x:(a-i)/r,y:a};n={x:(f-i)/r,y:f}}else{if(s){if(s.y<a)return}else s={x:(f-i)/r,y:f};n={x:(a-i)/r,y:a}}else if(v>p){if(s){if(s.x>=u)return}else s={x:o,y:r*o+i};n={x:u,y:r*u+i}}else{if(s){if(s.x<o)return}else s={x:u,y:r*u+i};n={x:o,y:r*o+i}}return e.a=s,e.b=n,!0}function Vr(e,t){this.l=e,this.r=t,this.a=this.b=null}function $r(e,t,n,r){var i=new Vr(e,t);return Wa.push(i),n&&Kr(i,e,t,n),r&&Kr(i,t,e,r),Xa[e.i].edges.push(new Qr(i,e,t)),Xa[t.i].edges.push(new Qr(i,t,e)),i}function Jr(e,t,n){var r=new Vr(e,null);return r.a=t,r.b=n,Wa.push(r),r}function Kr(e,t,n,r){e.a||e.b?e.l===n?e.b=r:e.a=r:(e.a=r,e.l=t,e.r=n)}function Qr(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function Gr(){this._=null}function Yr(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Zr(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ei(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ti(e){for(;e.L;)e=e.L;return e}function ni(e,t){var n,r,i,s=e.sort(ri).pop();for(Wa=[],Xa=new Array(e.length),Va=new Gr,Ja=new Gr;;)if(i=$a,s&&(!i||s.y<i.y||s.y===i.y&&s.x<i.x))(s.x!==n||s.y!==r)&&(Xa[s.i]=new Fr(s),Hr(s),n=s.x,r=s.y),s=e.pop();else{if(!i)break;Pr(i.arc)}t&&(Wr(t),Ir(t));var o={cells:Xa,edges:Wa};return Va=Ja=Wa=Xa=null,o}function ri(e,t){return t.y-e.y||t.x-e.x}function ii(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function si(e){return e.x}function oi(e){return e.y}function ui(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function ai(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=.5*(n+i),u=.5*(r+s),a=t.nodes;a[0]&&ai(e,a[0],n,r,o,u),a[1]&&ai(e,a[1],o,r,i,u),a[2]&&ai(e,a[2],n,u,o,s),a[3]&&ai(e,a[3],o,u,i,s)}}function fi(e,t){e=Xo.rgb(e),t=Xo.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+mt(Math.round(n+s*e))+mt(Math.round(r+o*e))+mt(Math.round(i+u*e))}}function li(e,t){var n,r={},i={};for(n in e)n in t?r[n]=pi(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return function(e){for(n in r)i[n]=r[n](e);return i}}function ci(e,t){return t-=e=+e,function(n){return e+t*n}}function hi(e,t){var n,r,i,s=Ya.lastIndex=Za.lastIndex=0,o=-1,u=[],a=[];for(e+="",t+="";(n=Ya.exec(e))&&(r=Za.exec(t));)(i=r.index)>s&&(i=t.substring(s,i),u[o]?u[o]+=i:u[++o]=i),(n=n[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,a.push({i:o,x:ci(n,r)})),s=Za.lastIndex;return s<t.length&&(i=t.substring(s),u[o]?u[o]+=i:u[++o]=i),u.length<2?a[0]?(t=a[0].x,function(e){return t(e)+""}):function(){return t}:(t=a.length,function(e){for(var n,r=0;t>r;++r)u[(n=a[r]).i]=n.x(e);return u.join("")})}function pi(e,t){for(var n,r=Xo.interpolators.length;--r>=0&&!(n=Xo.interpolators[r](e,t)););return n}function di(e,t){var n,r=[],i=[],s=e.length,o=t.length,u=Math.min(e.length,t.length);for(n=0;u>n;++n)r.push(pi(e[n],t[n]));for(;s>n;++n)i[n]=e[n];for(;o>n;++n)i[n]=t[n];return function(e){for(n=0;u>n;++n)i[n]=r[n](e);return i}}function vi(e){return function(t){return 0>=t?0:t>=1?1:e(t)}}function mi(e){return function(t){return 1-e(1-t)}}function gi(e){return function(t){return.5*(.5>t?e(2*t):2-e(2-2*t))}}function yi(e){return e*e}function bi(e){return e*e*e}function wi(e){if(0>=e)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(.5>e?n:3*(e-t)+n-.75)}function Ei(e){return function(t){return Math.pow(t,e)}}function Si(e){return 1-Math.cos(e*Nu)}function xi(e){return Math.pow(2,10*(e-1))}function Ti(e){return 1-Math.sqrt(1-e*e)}function Ni(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/Tu*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*Tu/t)}}function Ci(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function ki(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Li(e,t){e=Xo.hcl(e),t=Xo.hcl(t);var n=e.h,r=e.c,i=e.l,s=t.h-n,o=t.c-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return ot(n+s*e,r+o*e,i+u*e)+""}}function Ai(e,t){e=Xo.hsl(e),t=Xo.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return it(n+s*e,r+o*e,i+u*e)+""}}function Oi(e,t){e=Xo.lab(e),t=Xo.lab(t);var n=e.l,r=e.a,i=e.b,s=t.l-n,o=t.a-r,u=t.b-i;return function(e){return at(n+s*e,r+o*e,i+u*e)+""}}function Mi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function _i(e){var t=[e.a,e.b],n=[e.c,e.d],r=Pi(t),i=Di(t,n),s=Pi(Hi(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*Au,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*Au:0}function Di(e,t){return e[0]*t[0]+e[1]*t[1]}function Pi(e){var t=Math.sqrt(Di(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Hi(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function Bi(e,t){var n,r=[],i=[],s=Xo.transform(e),o=Xo.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:ci(u[0],a[0])},{i:3,x:ci(u[1],a[1])})):a[0]||a[1]?r.push("translate("+a+")"):r.push(""),f!=l?(f-l>180?l+=360:l-f>180&&(f+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:ci(f,l)})):l&&r.push(r.pop()+"rotate("+l+")"),c!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:ci(c,h)}):h&&r.push(r.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:ci(p[0],d[0])},{i:n-2,x:ci(p[1],d[1])})):(1!=d[0]||1!=d[1])&&r.push(r.pop()+"scale("+d+")"),n=i.length,function(e){for(var t,s=-1;++s<n;)r[(t=i[s]).i]=t.x(e);return r.join("")}}function ji(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function Fi(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function Ii(e){for(var t=e.source,n=e.target,r=Ri(t,n),i=[t];t!==r;)t=t.parent,i.push(t);for(var s=i.length;n!==r;)i.splice(s,0,n),n=n.parent;return i}function qi(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function Ri(e,t){if(e===t)return e;for(var n=qi(e),r=qi(t),i=n.pop(),s=r.pop(),o=null;i===s;)o=i,i=n.pop(),s=r.pop();return o}function Ui(e){e.fixed|=2}function zi(e){e.fixed&=-7}function Wi(e){e.fixed|=4,e.px=e.x,e.py=e.y}function Xi(e){e.fixed&=-5}function Vi(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf)for(var s,o=e.nodes,u=o.length,a=-1;++a<u;)s=o[a],null!=s&&(Vi(s,t,n),e.charge+=s.charge,r+=s.charge*s.cx,i+=s.charge*s.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function $i(e,t){return Xo.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=Zi,e}function Ji(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(i=e.children)&&(r=i.length))for(var r,i;--r>=0;)n.push(i[r])}function Ki(e,t){for(var n=[e],r=[];null!=(e=n.pop());)if(r.push(e),(s=e.children)&&(i=s.length))for(var i,s,o=-1;++o<i;)n.push(s[o]);for(;null!=(e=r.pop());)t(e)}function Qi(e){return e.children}function Gi(e){return e.value}function Yi(e,t){return t.value-e.value}function Zi(e){return Xo.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function es(e){return e.x}function ts(e){return e.y}function ns(e,t,n){e.y0=t,e.y=n}function rs(e){return Xo.range(e.length)}function is(e){for(var t=-1,n=e[0].length,r=[];++t<n;)r[t]=0;return r}function ss(e){for(var t,n=1,r=0,i=e[0][1],s=e.length;s>n;++n)(t=e[n][1])>i&&(r=n,i=t);return r}function os(e){return e.reduce(us,0)}function us(e,t){return e+t[1]}function as(e,t){return fs(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function fs(e,t){for(var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];++n<=t;)s[n]=i*n+r;return s}function ls(e){return[Xo.min(e),Xo.max(e)]}function cs(e,t){return e.value-t.value}function hs(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function ps(e,t){e._pack_next=t,t._pack_prev=e}function ds(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return.999*i*i>n*n+r*r}function vs(e){function t(e){l=Math.min(e.x-e.r,l),c=Math.max(e.x+e.r,c),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(f=n.length)){var n,r,i,s,o,u,a,f,l=1/0,c=-1/0,h=1/0,p=-1/0;if(n.forEach(ms),r=n[0],r.x=-r.r,r.y=0,t(r),f>1&&(i=n[1],i.x=i.r,i.y=0,t(i),f>2))for(s=n[2],bs(r,i,s),t(s),hs(r,s),r._pack_prev=s,hs(s,i),i=r._pack_next,o=3;f>o;o++){bs(r,i,s=n[o]);var d=0,v=1,m=1;for(u=i._pack_next;u!==i;u=u._pack_next,v++)if(ds(u,s)){d=1;break}if(1==d)for(a=r._pack_prev;a!==u._pack_prev&&!ds(a,s);a=a._pack_prev,m++);d?(m>v||v==m&&i.r<r.r?ps(r,i=u):ps(r=a,i),o--):(hs(r,s),i=s,t(s))}var g=(l+c)/2,y=(h+p)/2,b=0;for(o=0;f>o;o++)s=n[o],s.x-=g,s.y-=y,b=Math.max(b,s.r+Math.sqrt(s.x*s.x+s.y*s.y));e.r=b,n.forEach(gs)}}function ms(e){e._pack_next=e._pack_prev=e}function gs(e){delete e._pack_next,delete e._pack_prev}function ys(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i)for(var s=-1,o=i.length;++s<o;)ys(i[s],t,n,r)}function bs(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i}else n.x=e.x+r,n.y=e.y}function ws(e,t){return e.parent==t.parent?1:2}function Es(e){var t=e.children;return t.length?t[0]:e.t}function Ss(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function xs(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function Ts(e){for(var t,n=0,r=0,i=e.children,s=i.length;--s>=0;)t=i[s],t.z+=n,t.m+=n,n+=t.s+(r+=t.c)}function Ns(e,t,n){return e.a.parent===t.parent?e.a:n}function Cs(e){return 1+Xo.max(e,function(e){return e.y})}function ks(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Ls(e){var t=e.children;return t&&t.length?Ls(t[0]):e}function As(e){var t,n=e.children;return n&&(t=n.length)?As(n[t-1]):e}function Os(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Ms(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return 0>i&&(n+=i/2,i=0),0>s&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function _s(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function Ds(e){return e.rangeExtent?e.rangeExtent():_s(e.range())}function Ps(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function Hs(e,t){var n,r=0,i=e.length-1,s=e[r],o=e[i];return s>o&&(n=r,r=i,i=n,n=s,s=o,o=n),e[r]=t.floor(s),e[i]=t.ceil(o),e}function Bs(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:cf}function js(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=u;)i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));return function(t){var n=Xo.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function Fs(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?js:Ps,a=r?Fi:ji;return o=i(e,t,a,n),u=i(t,e,a,pi),s}function s(e){return o(e)}var o,u;return s.invert=function(e){return u(e)},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},s.rangeRound=function(e){return s.range(e).interpolate(Mi)},s.clamp=function(e){return arguments.length?(r=e,i()):r},s.interpolate=function(e){return arguments.length?(n=e,i()):n},s.ticks=function(t){return Us(e,t)},s.tickFormat=function(t,n){return zs(e,t,n)},s.nice=function(t){return qs(e,t),i()},s.copy=function(){return Fs(e,t,n,r)},i()}function Is(e,t){return Xo.rebind(e,t,"range","rangeRound","interpolate","clamp")}function qs(e,t){return Hs(e,Bs(Rs(e,t)[2]))}function Rs(e,t){null==t&&(t=10);var n=_s(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return.15>=s?i*=10:.35>=s?i*=5:.75>=s&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function Us(e,t){return Xo.range.apply(Xo,Rs(e,t))}function zs(e,t,n){var r=Rs(e,t);if(n){var i=Yu.exec(n);if(i.shift(),"s"===i[8]){var s=Xo.formatPrefix(Math.max(su(r[0]),su(r[1])));return i[7]||(i[7]="."+Ws(s.scale(r[2]))),i[8]="f",n=Xo.format(i.join("")),function(e){return n(s.scale(e))+s.symbol}}i[7]||(i[7]="."+Xs(i[8],r)),n=i.join("")}else n=",."+Ws(r[2])+"f";return Xo.format(n)}function Ws(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function Xs(e,t){var n=Ws(t[2]);return e in hf?Math.abs(n-Ws(Math.max(su(t[0]),su(t[1]))))+ +("e"!==e):n-2*("%"===e)}function Vs(e,t,n,r){function i(e){return(n?Math.log(0>e?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function s(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(i(t))}return o.invert=function(t){return s(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((r=t.map(Number)).map(i)),o):r},o.base=function(n){return arguments.length?(t=+n,e.domain(r.map(i)),o):t},o.nice=function(){var t=Hs(r.map(i),n?Math:df);return e.domain(t),r=t.map(s),o},o.ticks=function(){var e=_s(r),o=[],u=e[0],a=e[1],f=Math.floor(i(u)),l=Math.ceil(i(a)),c=t%1?2:t;if(isFinite(l-f)){if(n){for(;l>f;f++)for(var h=1;c>h;h++)o.push(s(f)*h);o.push(s(f))}else for(o.push(s(f));f++<l;)for(var h=c-1;h>0;h--)o.push(s(f)*h);for(f=0;o[f]<u;f++);for(l=o.length;o[l-1]>a;l--);o=o.slice(f,l)}return o},o.tickFormat=function(e,t){if(!arguments.length)return pf;arguments.length<2?t=pf:"function"!=typeof t&&(t=Xo.format(t));var r,u=Math.max(.1,e/o.ticks().length),a=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(e){return e/s(a(i(e)+r))<=u?t(e):""}},o.copy=function(){return Vs(e.copy(),t,n,r)},Is(o,e)}function $s(e,t,n){function r(t){return e(i(t))}var i=Js(t),s=Js(1/t);return r.invert=function(t){return s(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(i)),r):n},r.ticks=function(e){return Us(n,e)},r.tickFormat=function(e,t){return zs(n,e,t)},r.nice=function(e){return r.domain(qs(n,e))},r.exponent=function(o){return arguments.length?(i=Js(t=o),s=Js(1/t),e.domain(n.map(i)),r):t},r.copy=function(){return $s(e.copy(),t,n)},Is(r,e)}function Js(e){return function(t){return 0>t?-Math.pow(-t,e):Math.pow(t,e)}}function Ks(e,t){function n(n){return s[((i.get(n)||("range"===t.t?i.set(n,e.push(n)):0/0))-1)%s.length]}function r(t,n){return Xo.range(e.length).map(function(e){return t+n*e})}var i,s,u;return n.domain=function(r){if(!arguments.length)return e;e=[],i=new o;for(var s,u=-1,a=r.length;++u<a;)i.has(s=r[u])||i.set(s,e.push(s));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(s=e,u=0,t={t:"range",a:arguments},n):s},n.rangePoints=function(i,o){arguments.length<2&&(o=0);var a=i[0],f=i[1],l=(f-a)/(Math.max(1,e.length-1)+o);return s=r(e.length<2?(a+f)/2:a+l*o/2,l),u=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(i,o,a){arguments.length<2&&(o=0),arguments.length<3&&(a=o);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=(c-l)/(e.length-o+2*a);return s=r(l+h*a,h),f&&s.reverse(),u=h*(1-o),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(i,o,a){arguments.length<2&&(o=0),arguments.length<3&&(a=o);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=Math.floor((c-l)/(e.length-o+2*a)),p=c-l-(e.length-o)*h;return s=r(l+Math.round(p/2),h),f&&s.reverse(),u=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return u},n.rangeExtent=function(){return _s(t.a[0])},n.copy=function(){return Ks(e,t)},n.domain(e)}function Qs(n,r){function i(){var e=0,t=r.length;for(o=[];++e<t;)o[e-1]=Xo.quantile(n,e/t);return s}function s(e){return isNaN(e=+e)?void 0:r[Xo.bisect(o,e)]}var o;return s.domain=function(r){return arguments.length?(n=r.filter(t).sort(e),i()):n},s.range=function(e){return arguments.length?(r=e,i()):r},s.quantiles=function(){return o},s.invertExtent=function(e){return e=r.indexOf(e),0>e?[0/0,0/0]:[e>0?o[e-1]:n[0],e<o.length?o[e]:n[n.length-1]]},s.copy=function(){return Qs(n,r)},i()}function Gs(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))]}function i(){return s=n.length/(t-e),o=n.length-1,r}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.invertExtent=function(t){return t=n.indexOf(t),t=0>t?0/0:t/s+e,[t,t+1/s]},r.copy=function(){return Gs(e,t,n)},i()}function Ys(e,t){function n(n){return n>=n?t[Xo.bisect(e,n)]:void 0}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return Ys(e,t)},n}function Zs(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return Us(e,t)},t.tickFormat=function(t,n){return zs(e,t,n)},t.copy=function(){return Zs(e)},t}function eo(e){return e.innerRadius}function to(e){return e.outerRadius}function no(e){return e.startAngle}function ro(e){return e.endAngle}function io(e){function t(t){function o(){f.push("M",s(e(l),u))}for(var a,f=[],l=[],c=-1,h=t.length,p=St(n),d=St(r);++c<h;)i.call(this,a=t[c],c)?l.push([+p.call(this,a,c),+d.call(this,a,c)]):l.length&&(o(),l=[]);return l.length&&o(),f.length?f.join(""):null}var n=Tr,r=Nr,i=Tn,s=so,o=s.key,u=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(i=e,t):i},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?s=e:(s=Ef.get(e)||so).key,t):o},t.tension=function(e){return arguments.length?(u=e,t):u},t}function so(e){return e.join("L")}function oo(e){return so(e)+"Z"}function uo(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function ao(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function fo(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function lo(e,t){return e.length<4?so(e):e[1]+po(e.slice(1,e.length-1),vo(e,t))}function co(e,t){return e.length<3?so(e):e[0]+po((e.push(e[0]),e),vo([e[e.length-2]].concat(e,[e[1]]),t))}function ho(e,t){return e.length<3?so(e):e[0]+po(e,vo(e,t))}function po(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return so(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n&&(r+="Q"+(s[0]-2*o[0]/3)+","+(s[1]-2*o[1]/3)+","+s[0]+","+s[1],i=e[1],a=2),t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+2*u[0]/3)+","+(s[1]+2*u[1]/3)+","+l[0]+","+l[1]}return r}function vo(e,t){for(var n,r=[],i=(1-t)/2,s=e[0],o=e[1],u=1,a=e.length;++u<a;)n=s,s=o,o=e[u],r.push([i*(o[0]-n[0]),i*(o[1]-n[1])]);return r}function mo(e){if(e.length<3)return so(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",wo(Tf,o),",",wo(Tf,u)];for(e.push(e[n-1]);++t<=n;)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),Eo(a,o,u);return e.pop(),a.push("L",r),a.join("")}function go(e){if(e.length<4)return so(e);for(var t,n=[],r=-1,i=e.length,s=[0],o=[0];++r<3;)t=e[r],s.push(t[0]),o.push(t[1]);for(n.push(wo(Tf,s)+","+wo(Tf,o)),--r;++r<i;)t=e[r],s.shift(),s.push(t[0]),o.shift(),o.push(t[1]),Eo(n,s,o);return n.join("")}function yo(e){for(var t,n,r=-1,i=e.length,s=i+4,o=[],u=[];++r<4;)n=e[r%i],o.push(n[0]),u.push(n[1]);for(t=[wo(Tf,o),",",wo(Tf,u)],--r;++r<s;)n=e[r%i],o.shift(),o.push(n[0]),u.shift(),u.push(n[1]),Eo(t,o,u);return t.join("")}function bo(e,t){var n=e.length-1;if(n)for(var r,i,s=e[0][0],o=e[0][1],u=e[n][0]-s,a=e[n][1]-o,f=-1;++f<=n;)r=e[f],i=f/n,r[0]=t*r[0]+(1-t)*(s+i*u),r[1]=t*r[1]+(1-t)*(o+i*a);return mo(e)}function wo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Eo(e,t,n){e.push("C",wo(Sf,t),",",wo(Sf,n),",",wo(xf,t),",",wo(xf,n),",",wo(Tf,t),",",wo(Tf,n))}function So(e,t){return(t[1]-e[1])/(t[0]-e[0])}function xo(e){for(var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=So(i,s);++t<n;)r[t]=(o+(o=So(i=s,s=e[t+1])))/2;return r[t]=o,r}function To(e){for(var t,n,r,i,s=[],o=xo(e),u=-1,a=e.length-1;++u<a;)t=So(e[u],e[u+1]),su(t)<Cu?o[u]=o[u+1]=0:(n=o[u]/t,r=o[u+1]/t,i=n*n+r*r,i>9&&(i=3*t/Math.sqrt(i),o[u]=i*n,o[u+1]=i*r));for(u=-1;++u<=a;)i=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),s.push([i||0,o[u]*i||0]);return s}function No(e){return e.length<3?so(e):e[0]+po(e,To(e))}function Co(e){for(var t,n,r,i=-1,s=e.length;++i<s;)t=e[i],n=t[0],r=t[1]+bf,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function ko(e){function t(t){function a(){v.push("M",u(e(g),c),l,f(e(m.reverse()),c),"Z")}for(var h,p,d,v=[],m=[],g=[],y=-1,b=t.length,w=St(n),E=St(i),S=n===r?function(){return p}:St(r),x=i===s?function(){return d}:St(s);++y<b;)o.call(this,h=t[y],y)?(m.push([p=+w.call(this,h,y),d=+E.call(this,h,y)]),g.push([+S.call(this,h,y),+x.call(this,h,y)])):m.length&&(a(),m=[],g=[]);return m.length&&a(),v.length?v.join(""):null}var n=Tr,r=Tr,i=0,s=Nr,o=Tn,u=so,a=u.key,f=u,l="L",c=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(a="function"==typeof e?u=e:(u=Ef.get(e)||so).key,f=u.reverse||u,l=u.closed?"M":"L",t):a},t.tension=function(e){return arguments.length?(c=e,t):c},t}function Lo(e){return e.radius}function Ao(e){return[e.x,e.y]}function Oo(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+bf;return[n*Math.cos(r),n*Math.sin(r)]}}function Mo(){return 64}function _o(){return"circle"}function Do(e){var t=Math.sqrt(e/xu);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Po(e,t){return lu(e,Of),e.id=t,e}function Ho(e,t,n,r){var i=e.id;return B(e,"function"==typeof n?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)))}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n)}))}function Bo(e){return null==e&&(e=""),function(){this.textContent=e}}function jo(e,t,n,r){var i=e.__transition__||(e.__transition__={active:0,count:0}),s=i[n];if(!s){var u=r.time;s=i[n]={tween:new o,time:u,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,Xo.timer(function(r){function o(r){return i.active>n?f():(i.active=n,s.event&&s.event.start.call(e,l,t),s.tween.forEach(function(n,r){(r=r.call(e,l,t))&&v.push(r)}),Xo.timer(function(){return d.c=a(r||1)?Tn:a,1},0,u),void 0)}function a(r){if(i.active!==n)return f();for(var o=r/p,u=c(o),a=v.length;a>0;)v[--a].call(e,u);return o>=1?(s.event&&s.event.end.call(e,l,t),f()):void 0}function f(){return--i.count?delete i[n]:delete e.__transition__,1}var l=e.__data__,c=s.ease,h=s.delay,p=s.duration,d=Ku,v=[];return d.t=h+u,r>=h?o(r-h):(d.c=o,void 0)},0,u)}}function Fo(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function Io(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function qo(e){return e.toISOString()}function Ro(e,t,n){function r(t){return e(t)}function i(e,n){var r=e[1]-e[0],i=r/n,s=Xo.bisect(If,i);return s==If.length?[t.year,Rs(e.map(function(e){return e/31536e6}),n)[2]]:s?t[i/If[s-1]<If[s]/i?s-1:s]:[Uf,Rs(e,n)[2]]}return r.invert=function(t){return Uo(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Uo)},r.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,Uo(+n+1),t).length}var s=r.domain(),o=_s(s),u=null==e?i(o,10):"number"==typeof e&&i(o,e);return u&&(e=u[0],t=u[1]),r.domain(Hs(s,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=Uo(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=Uo(+t+1);return t}}:e))},r.ticks=function(e,t){var n=_s(r.domain()),s=null==e?i(n,10):"number"==typeof e?i(n,e):!e.range&&[{range:e},t];return s&&(e=s[0],t=s[1]),e.range(n[0],Uo(+n[1]+1),1>t?1:t)},r.tickFormat=function(){return n},r.copy=function(){return Ro(e.copy(),t,n)},Is(r,e)}function Uo(e){return new Date(e)}function zo(e){return JSON.parse(e.responseText)}function Wo(e){var t=Jo.createRange();return t.selectNode(Jo.body),t.createContextualFragment(e.responseText)}var Xo={version:"3.4.11"};Date.now||(Date.now=function(){return+(new Date)});var Vo=[].slice,$o=function(e){return Vo.call(e)},Jo=document,Ko=Jo.documentElement,Qo=window;try{$o(Ko.childNodes)[0].nodeType}catch(Go){$o=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}try{Jo.createElement("div").style.setProperty("opacity",0,"")}catch(Yo){var Zo=Qo.Element.prototype,eu=Zo.setAttribute,tu=Zo.setAttributeNS,nu=Qo.CSSStyleDeclaration.prototype,ru=nu.setProperty;Zo.setAttribute=function(e,t){eu.call(this,e,t+"")},Zo.setAttributeNS=function(e,t,n){tu.call(this,e,t,n+"")},nu.setProperty=function(e,t,n){ru.call(this,e,t+"",n)}}Xo.ascending=e,Xo.descending=function(e,t){return e>t?-1:t>e?1:t>=e?0:0/0},Xo.min=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&n>r&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&n>r&&(n=r)}return n},Xo.max=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&r>n&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&r>n&&(n=r)}return n},Xo.extent=function(e,t){var n,r,i,s=-1,o=e.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=i=e[s])&&n>=n);)n=i=void 0;for(;++s<o;)null!=(r=e[s])&&(n>r&&(n=r),r>i&&(i=r))}else{for(;++s<o&&!(null!=(n=i=t.call(e,e[s],s))&&n>=n);)n=void 0;for(;++s<o;)null!=(r=t.call(e,e[s],s))&&(n>r&&(n=r),r>i&&(i=r))}return[n,i]},Xo.sum=function(e,t){var n,r=0,i=e.length,s=-1;if(1===arguments.length)for(;++s<i;)isNaN(n=+e[s])||(r+=n);else for(;++s<i;)isNaN(n=+t.call(e,e[s],s))||(r+=n);return r},Xo.mean=function(e,n){var r,i=0,s=e.length,o=-1,u=s;if(1===arguments.length)for(;++o<s;)t(r=e[o])?i+=r:--u;else for(;++o<s;)t(r=n.call(e,e[o],o))?i+=r:--u;return u?i/u:void 0},Xo.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i},Xo.median=function(n,r){return arguments.length>1&&(n=n.map(r)),n=n.filter(t),n.length?Xo.quantile(n.sort(e),.5):void 0};var iu=n(e);Xo.bisectLeft=iu.left,Xo.bisect=Xo.bisectRight=iu.right,Xo.bisector=function(t){return n(1===t.length?function(n,r){return e(t(n),r)}:t)},Xo.shuffle=function(e){for(var t,n,r=e.length;r;)n=0|Math.random()*r--,t=e[r],e[r]=e[n],e[n]=t;return e},Xo.permute=function(e,t){for(var n=t.length,r=new Array(n);n--;)r[n]=e[t[n]];return r},Xo.pairs=function(e){for(var t,n=0,r=e.length-1,i=e[0],s=new Array(0>r?0:r);r>n;)s[n]=[t=i,i=e[++n]];return s},Xo.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=Xo.min(arguments,r),n=new Array(t);++e<t;)for(var i,s=-1,o=n[e]=new Array(i);++s<i;)o[s]=arguments[s][e];return n},Xo.transpose=function(e){return Xo.zip.apply(Xo,e)},Xo.keys=function(e){var t=[];for(var n in e)t.push(n);return t},Xo.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},Xo.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},Xo.merge=function(e){for(var t,n,r,i=e.length,s=-1,o=0;++s<i;)o+=e[s].length;for(n=new Array(o);--i>=0;)for(r=e[i],t=r.length;--t>=0;)n[--o]=r[t];return n};var su=Math.abs;Xo.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),1/0===(t-e)/n)throw new Error("infinite range");var r,s=[],o=i(su(n)),u=-1;if(e*=o,t*=o,n*=o,0>n)for(;(r=e+n*++u)>t;)s.push(r/o);else for(;(r=e+n*++u)<t;)s.push(r/o);return s},Xo.map=function(e){var t=new o;if(e instanceof o)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t},s(o,{has:u,get:function(e){return this[ou+e]},set:function(e,t){return this[ou+e]=t},remove:a,keys:f,values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},size:l,empty:c,forEach:function(e){for(var t in this)t.charCodeAt(0)===uu&&e.call(this,t.substring(1),this[t])}});var ou="\0",uu=ou.charCodeAt(0);Xo.nest=function(){function e(t,u,a){if(a>=s.length)return r?r.call(i,u):n?u.sort(n):u;for(var f,l,c,h,p=-1,d=u.length,v=s[a++],m=new o;++p<d;)(h=m.get(f=v(l=u[p])))?h.push(l):m.set(f,[l]);return t?(l=t(),c=function(n,r){l.set(n,e(t,r,a))}):(l={},c=function(n,r){l[n]=e(t,r,a)}),m.forEach(c),l}function t(e,n){if(n>=s.length)return e;var r=[],i=u[n++];return e.forEach(function(e,i){r.push({key:e,values:t(i,n)})}),i?r.sort(function(e,t){return i(e.key,t.key)}):r}var n,r,i={},s=[],u=[];return i.map=function(t,n){return e(n,t,0)},i.entries=function(n){return t(e(Xo.map,n,0),0)},i.key=function(e){return s.push(e),i},i.sortKeys=function(e){return u[s.length-1]=e,i},i.sortValues=function(e){return n=e,i},i.rollup=function(e){return r=e,i},i},Xo.set=function(e){var t=new h;if(e)for(var n=0,r=e.length;r>n;++n)t.add(e[n]);return t},s(h,{has:u,add:function(e){return this[ou+e]=!0,e},remove:function(e){return e=ou+e,e in this&&delete this[e]},values:f,size:l,empty:c,forEach:function(e){for(var t in this)t.charCodeAt(0)===uu&&e.call(this,t.substring(1))}}),Xo.behavior={},Xo.rebind=function(e,t){for(var n,r=1,i=arguments.length;++r<i;)e[n=arguments[r]]=p(e,t,t[n]);return e};var au=["webkit","ms","moz","Moz","o","O"];Xo.dispatch=function(){for(var e=new m,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=g(e);return e},m.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>=0&&(r=e.substring(n+1),e=e.substring(0,n)),e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},Xo.event=null,Xo.requote=function(e){return e.replace(fu,"\\$&")};var fu=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,lu={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},cu=function(e,t){return t.querySelector(e)},hu=function(e,t){return t.querySelectorAll(e)},pu=Ko.matches||Ko[d(Ko,"matchesSelector")],du=function(e,t){return pu.call(e,t)};"function"==typeof Sizzle&&(cu=function(e,t){return Sizzle(e,t)[0]||null},hu=Sizzle,du=Sizzle.matchesSelector),Xo.selection=function(){return yu};var vu=Xo.selection.prototype=[];vu.select=function(e){var t,n,r,i,s=[];e=S(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var a=-1,f=r.length;++a<f;)(i=r[a])?(t.push(n=e.call(i,i.__data__,a,o)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null)}return E(s)},vu.selectAll=function(e){var t,n,r=[];e=x(e);for(var i=-1,s=this.length;++i<s;)for(var o=this[i],u=-1,a=o.length;++u<a;)(n=o[u])&&(r.push(t=$o(e.call(n,n.__data__,u,i))),t.parentNode=n);return E(r)};var mu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Xo.ns={prefix:mu,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),mu.hasOwnProperty(n)?{space:mu[n],local:e}:e}},vu.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=Xo.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(T(t,e[t]));return this}return this.each(T(e,t))},vu.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),r=(e=k(e)).length,i=-1;if(t=n.classList){for(;++i<r;)if(!t.contains(e[i]))return!1}else for(t=n.getAttribute("class");++i<r;)if(!C(e[i]).test(t))return!1;return!0}for(t in e)this.each(L(t,e[t]));return this}return this.each(L(e,t))},vu.style=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t="");for(n in e)this.each(O(n,e[n],t));return this}if(2>r)return Qo.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(O(e,t,n))},vu.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(M(t,e[t]));return this}return this.each(M(e,t))},vu.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},vu.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},vu.append=function(e){return e=_(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},vu.insert=function(e,t){return e=_(e),t=S(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},vu.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},vu.data=function(e,t){function n(e,n){var r,i,s,u=e.length,c=n.length,h=Math.min(u,c),p=new Array(c),d=new Array(c),v=new Array(u);if(t){var m,g=new o,y=new o,b=[];for(r=-1;++r<u;)m=t.call(i=e[r],i.__data__,r),g.has(m)?v[r]=i:g.set(m,i),b.push(m);for(r=-1;++r<c;)m=t.call(n,s=n[r],r),(i=g.get(m))?(p[r]=i,i.__data__=s):y.has(m)||(d[r]=D(s)),y.set(m,s),g.remove(m);for(r=-1;++r<u;)g.has(b[r])&&(v[r]=e[r])}else{for(r=-1;++r<h;)i=e[r],s=n[r],i?(i.__data__=s,p[r]=i):d[r]=D(s);for(;c>r;++r)d[r]=D(n[r]);for(;u>r;++r)v[r]=e[r]}d.update=p,d.parentNode=p.parentNode=v.parentNode=e.parentNode,a.push(d),f.push(p),l.push(v)}var r,i,s=-1,u=this.length;if(!arguments.length){for(e=new Array(u=(r=this[0]).length);++s<u;)(i=r[s])&&(e[s]=i.__data__);return e}var a=j([]),f=E([]),l=E([]);if("function"==typeof e)for(;++s<u;)n(r=this[s],e.call(r,r.parentNode.__data__,s));else for(;++s<u;)n(r=this[s],e);return f.enter=function(){return a},f.exit=function(){return l},f},vu.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},vu.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=P(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]),t.parentNode=(n=this[s]).parentNode;for(var u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return E(i)},vu.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],i=r.length-1,s=r[i];--i>=0;)(n=r[i])&&(s&&s!==n.nextSibling&&s.parentNode.insertBefore(n,s),s=n);return this},vu.sort=function(e){e=H.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},vu.each=function(e){return B(this,function(t,n,r){e.call(t,t.__data__,n,r)})},vu.call=function(e){var t=$o(arguments);return e.apply(t[0]=this,t),this},vu.empty=function(){return!this.node()},vu.node=function(){for(var e=0,t=this.length;t>e;e++)for(var n=this[e],r=0,i=n.length;i>r;r++){var s=n[r];if(s)return s}return null},vu.size=function(){var e=0;return this.each(function(){++e}),e};var gu=[];Xo.selection.enter=j,Xo.selection.enter.prototype=gu,gu.append=vu.append,gu.empty=vu.empty,gu.node=vu.node,gu.call=vu.call,gu.size=vu.size,gu.select=function(e){for(var t,n,r,i,s,o=[],u=-1,a=this.length;++u<a;){r=(i=this[u]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var f=-1,l=i.length;++f<l;)(s=i[f])?(t.push(r[f]=n=e.call(i.parentNode,s.__data__,f,u)),n.__data__=s.__data__):t.push(null)}return E(o)},gu.insert=function(e,t){return arguments.length<2&&(t=F(this)),vu.insert.call(this,e,t)},vu.transition=function(){for(var e,t,n=Cf||++Mf,r=[],i=kf||{time:Date.now(),ease:wi,delay:0,duration:250},s=-1,o=this.length;++s<o;){r.push(e=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(t=u[a])&&jo(t,a,n,i),e.push(t)}return Po(r,n)},vu.interrupt=function(){return this.each(I)},Xo.select=function(e){var t=["string"==typeof e?cu(e,Jo):e];return t.parentNode=Ko,E([t])},Xo.selectAll=function(e){var t=$o("string"==typeof e?hu(e,Jo):e);return t.parentNode=Ko,E([t])};var yu=Xo.select(Ko);vu.on=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t=!1);for(n in e)this.each(q(n,e[n],t));return this}if(2>r)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(q(e,t,n))};var bu=Xo.map({mouseenter:"mouseover",mouseleave:"mouseout"});bu.forEach(function(e){"on"+e in Jo&&bu.remove(e)});var wu="onselectstart"in Jo?null:d(Ko.style,"userSelect"),Eu=0;Xo.mouse=function(e){return W(e,b())};var Su=/WebKit/.test(Qo.navigator.userAgent)?-1:0;Xo.touches=function(e,t){return arguments.length<2&&(t=b().touches),t?$o(t).map(function(t){var n=W(e,t);return n.identifier=t.identifier,n}):[]},Xo.behavior.drag=function(){function e(){this.on("mousedown.drag",i).on("touchstart.drag",s)}function t(e,t,i,s,o){return function(){function u(){var e,n,r=t(h,v);r&&(e=r[0]-b[0],n=r[1]-b[1],d|=e|n,b=r,p({type:"drag",x:r[0]+f[0],y:r[1]+f[1],dx:e,dy:n}))}function a(){t(h,v)&&(g.on(s+m,null).on(o+m,null),y(d&&Xo.event.target===c),p({type:"dragend"}))}var f,l=this,c=Xo.event.target,h=l.parentNode,p=n.of(l,arguments),d=0,v=e(),m=".drag"+(null==v?"":"-"+v),g=Xo.select(i()).on(s+m,u).on(o+m,a),y=z(),b=t(h,v);r?(f=r.apply(l,arguments),f=[f.x-b[0],f.y-b[1]]):f=[0,0],p({type:"dragstart"})}}var n=w(e,"drag","dragstart","dragend"),r=null,i=t(v,Xo.mouse,$,"mousemove","mouseup"),s=t(X,Xo.touch,V,"touchmove","touchend");return e.origin=function(t){return arguments.length?(r=t,e):r},Xo.rebind(e,n,"on")};var xu=Math.PI,Tu=2*xu,Nu=xu/2,Cu=1e-6,ku=Cu*Cu,Lu=xu/180,Au=180/xu,Ou=Math.SQRT2,Mu=2,_u=4;Xo.interpolateZoom=function(e,t){function n(e){var t=e*y;if(g){var n=Z(v),o=s/(Mu*h)*(n*et(Ou*t+v)-Y(v));return[r+o*f,i+o*l,s*n/Z(Ou*t+v)]}return[r+e*f,i+e*l,s*Math.exp(Ou*t)]}var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2],f=o-r,l=u-i,c=f*f+l*l,h=Math.sqrt(c),p=(a*a-s*s+_u*c)/(2*s*Mu*h),d=(a*a-s*s-_u*c)/(2*a*Mu*h),v=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(d*d+1)-d),g=m-v,y=(g||Math.log(a/s))/Ou;return n.duration=1e3*y,n},Xo.behavior.zoom=function(){function e(e){e.on(k,f).on(Hu+".zoom",c).on("dblclick.zoom",h).on(O,l)}function t(e){return[(e[0]-T.x)/T.k,(e[1]-T.y)/T.k]}function n(e){return[e[0]*T.k+T.x,e[1]*T.k+T.y]}function r(e){T.k=Math.max(C[0],Math.min(C[1],e))}function i(e,t){t=n(t),T.x+=e[0]-t[0],T.y+=e[1]-t[1]}function s(){E&&E.domain(b.range().map(function(e){return(e-T.x)/T.k}).map(b.invert)),x&&x.domain(S.range().map(function(e){return(e-T.y)/T.k}).map(S.invert))}function o(e){e({type:"zoomstart"})}function u(e){s(),e({type:"zoom",scale:T.k,translate:[T.x,T.y]})}function a(e){e({type:"zoomend"})}function f(){function e(){l=1,i(Xo.mouse(r),h),u(f)}function n(){c.on(L,null).on(A,null),p(l&&Xo.event.target===s),a(f)}var r=this,s=Xo.event.target,f=M.of(r,arguments),l=0,c=Xo.select(Qo).on(L,e).on(A,n),h=t(Xo.mouse(r)),p=z();I.call(r),o(f)}function l(){function e(){var e=Xo.touches(p);return h=T.k,e.forEach(function(e){e.identifier in v&&(v[e.identifier]=t(e))}),e}function n(){var t=Xo.event.target;Xo.select(t).on(w,s).on(E,c),S.push(t);for(var n=Xo.event.changedTouches,o=0,a=n.length;a>o;++o)v[n[o].identifier]=null;var f=e(),l=Date.now();if(1===f.length){if(500>l-g){var h=f[0],p=v[h.identifier];r(2*T.k),i(h,p),y(),u(d)}g=l}else if(f.length>1){var h=f[0],b=f[1],x=h[0]-b[0],N=h[1]-b[1];m=x*x+N*N}}function s(){for(var e,t,n,s,o=Xo.touches(p),a=0,f=o.length;f>a;++a,s=null)if(n=o[a],s=v[n.identifier]){if(t)break;e=n,t=s}if(s){var l=(l=n[0]-e[0])*l+(l=n[1]-e[1])*l,c=m&&Math.sqrt(l/m);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+s[0])/2,(t[1]+s[1])/2],r(c*h)}g=null,i(e,t),u(d)}function c(){if(Xo.event.touches.length){for(var t=Xo.event.changedTouches,n=0,r=t.length;r>n;++n)delete v[t[n].identifier];for(var i in v)return void e()}Xo.selectAll(S).on(b,null),x.on(k,f).on(O,l),N(),a(d)}var h,p=this,d=M.of(p,arguments),v={},m=0,b=".zoom-"+Xo.event.changedTouches[0].identifier,w="touchmove"+b,E="touchend"+b,S=[],x=Xo.select(p).on(k,null).on(O,n),N=z();I.call(p),n(),o(d)}function c(){var e=M.of(this,arguments);m?clearTimeout(m):(p=t(d=v||Xo.mouse(this)),I.call(this),o(e)),m=setTimeout(function(){m=null,a(e)},50),y(),r(Math.pow(2,.002*Du())*T.k),i(d,p),u(e)}function h(){var e=M.of(this,arguments),n=Xo.mouse(this),s=t(n),f=Math.log(T.k)/Math.LN2;o(e),r(Math.pow(2,Xo.event.shiftKey?Math.ceil(f)-1:Math.floor(f)+1)),i(n,s),u(e),a(e)}var p,d,v,m,g,b,E,S,x,T={x:0,y:0,k:1},N=[960,500],C=Pu,k="mousedown.zoom",L="mousemove.zoom",A="mouseup.zoom",O="touchstart.zoom",M=w(e,"zoomstart","zoom","zoomend");return e.event=function(e){e.each(function(){var e=M.of(this,arguments),t=T;Cf?Xo.select(this).transition().each("start.zoom",function(){T=this.__chart__||{x:0,y:0,k:1},o(e)}).tween("zoom:zoom",function(){var n=N[0],r=N[1],i=n/2,s=r/2,o=Xo.interpolateZoom([(i-T.x)/T.k,(s-T.y)/T.k,n/T.k],[(i-t.x)/t.k,(s-t.y)/t.k,n/t.k]);return function(t){var r=o(t),a=n/r[2];this.__chart__=T={x:i-r[0]*a,y:s-r[1]*a,k:a},u(e)}}).each("end.zoom",function(){a(e)}):(this.__chart__=T,o(e),u(e),a(e))})},e.translate=function(t){return arguments.length?(T={x:+t[0],y:+t[1],k:T.k},s(),e):[T.x,T.y]},e.scale=function(t){return arguments.length?(T={x:T.x,y:T.y,k:+t},s(),e):T.k},e.scaleExtent=function(t){return arguments.length?(C=null==t?Pu:[+t[0],+t[1]],e):C},e.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],e):v},e.size=function(t){return arguments.length?(N=t&&[+t[0],+t[1]],e):N},e.x=function(t){return arguments.length?(E=t,b=t.copy(),T={x:0,y:0,k:1},e):E},e.y=function(t){return arguments.length?(x=t,S=t.copy(),T={x:0,y:0,k:1},e):x},Xo.rebind(e,M,"on")};var Du,Pu=[0,1/0],Hu="onwheel"in Jo?(Du=function(){return-Xo.event.deltaY*(Xo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Jo?(Du=function(){return Xo.event.wheelDelta},"mousewheel"):(Du=function(){return-Xo.event.detail},"MozMousePixelScroll");Xo.color=nt,nt.prototype.toString=function(){return this.rgb()+""},Xo.hsl=rt;var Bu=rt.prototype=new nt;Bu.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new rt(this.h,this.s,this.l/e)},Bu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new rt(this.h,this.s,e*this.l)},Bu.rgb=function(){return it(this.h,this.s,this.l)},Xo.hcl=st;var ju=st.prototype=new nt;ju.brighter=function(e){return new st(this.h,this.c,Math.min(100,this.l+Fu*(arguments.length?e:1)))},ju.darker=function(e){return new st(this.h,this.c,Math.max(0,this.l-Fu*(arguments.length?e:1)))},ju.rgb=function(){return ot(this.h,this.c,this.l).rgb()},Xo.lab=ut;var Fu=18,Iu=.95047,qu=1,Ru=1.08883,Uu=ut.prototype=new nt;Uu.brighter=function(e){return new ut(Math.min(100,this.l+Fu*(arguments.length?e:1)),this.a,this.b)},Uu.darker=function(e){return new ut(Math.max(0,this.l-Fu*(arguments.length?e:1)),this.a,this.b)},Uu.rgb=function(){return at(this.l,this.a,this.b)},Xo.rgb=pt;var zu=pt.prototype=new nt;zu.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&i>t&&(t=i),n&&i>n&&(n=i),r&&i>r&&(r=i),new pt(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,r/e))):new pt(i,i,i)},zu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new pt(e*this.r,e*this.g,e*this.b)},zu.hsl=function(){return yt(this.r,this.g,this.b)},zu.toString=function(){return"#"+mt(this.r)+mt(this.g)+mt(this.b)};var Wu=Xo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Wu.forEach(function(e,t){Wu.set(e,dt(t))}),Xo.functor=St,Xo.xhr=Tt(xt),Xo.dsv=function(e,t){function n(e,n,s){arguments.length<3&&(s=n,n=null);var o=Nt(e,t,null==n?r:i(n),s);return o.row=function(e){return arguments.length?o.response(null==(n=e)?r:i(e)):n},o}function r(e){return n.parse(e.responseText)}function i(e){return function(t){return n.parse(t.responseText,e)}}function s(t){return t.map(o).join(e)}function o(e){return u.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var u=new RegExp('["'+e+"\n]"),a=e.charCodeAt(0);return n.parse=function(e,t){var r;return n.parseRows(e,function(e,n){if(r)return r(e,n-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");r=t?function(e,n){return t(i(e),n)}:i})},n.parseRows=function(e,t){function n(){if(l>=f)return o;if(i)return i=!1,s;var t=l;if(34===e.charCodeAt(t)){for(var n=t;n++<f;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}l=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&++l):10===r&&(i=!0),e.substring(t+1,n).replace(/""/g,'"')}for(;f>l;){var r=e.charCodeAt(l++),u=1;if(10===r)i=!0;else if(13===r)i=!0,10===e.charCodeAt(l)&&(++l,++u);else if(r!==a)continue;return e.substring(t,l-u)}return e.substring(t)}for(var r,i,s={},o={},u=[],f=e.length,l=0,c=0;(r=n())!==o;){for(var h=[];r!==s&&r!==o;)h.push(r),r=n();(!t||(h=t(h,c++)))&&u.push(h)}return u},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var r=new h,i=[];return t.forEach(function(e){for(var t in e)r.has(t)||i.push(r.add(t))}),[i.map(o).join(e)].concat(t.map(function(t){return i.map(function(e){return o(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(s).join("\n")},n},Xo.csv=Xo.dsv(",","text/csv"),Xo.tsv=Xo.dsv("	","text/tab-separated-values"),Xo.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=b().changedTouches),t)for(var r,i=0,s=t.length;s>i;++i)if((r=t[i]).identifier===n)return W(e,r)};var Xu,Vu,$u,Ju,Ku,Qu=Qo[d(Qo,"requestAnimationFrame")]||function(e){setTimeout(e,17)};Xo.timer=function(e,t,n){var r=arguments.length;2>r&&(t=0),3>r&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Vu?Vu.n=s:Xu=s,Vu=s,$u||(Ju=clearTimeout(Ju),$u=1,Qu(kt))},Xo.timer.flush=function(){Lt(),At()},Xo.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var Gu=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Mt);Xo.formatPrefix=function(e,t){var n=0;return e&&(0>e&&(e*=-1),t&&(e=Xo.round(e,Ot(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Gu[8+n/3]};var Yu=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Zu=Xo.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=Xo.round(e,Ot(e,t))).toFixed(Math.max(0,Math.min(20,Ot(e*(1+1e-15),t))))}}),ea=Xo.time={},ta=Date;Pt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){na.setUTCDate.apply(this._,arguments)},setDay:function(){na.setUTCDay.apply(this._,arguments)},setFullYear:function(){na.setUTCFullYear.apply(this._,arguments)},setHours:function(){na.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){na.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){na.setUTCMinutes.apply(this._,arguments)},setMonth:function(){na.setUTCMonth.apply(this._,arguments)},setSeconds:function(){na.setUTCSeconds.apply(this._,arguments)},setTime:function(){na.setTime.apply(this._,arguments)}};var na=Date.prototype;ea.year=Ht(function(e){return e=ea.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),ea.years=ea.year.range,ea.years.utc=ea.year.utc.range,ea.day=Ht(function(e){var t=new ta(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),ea.days=ea.day.range,ea.days.utc=ea.day.utc.range,ea.dayOfYear=function(e){var t=ea.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=ea[e]=Ht(function(e){return(e=ea.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=ea.year(e).getDay();return Math.floor((ea.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});ea[e+"s"]=n.range,ea[e+"s"].utc=n.utc.range,ea[e+"OfYear"]=function(e){var n=ea.year(e).getDay();return Math.floor((ea.dayOfYear(e)+(n+t)%7)/7)}}),ea.week=ea.sunday,ea.weeks=ea.sunday.range,ea.weeks.utc=ea.sunday.utc.range,ea.weekOfYear=ea.sundayOfYear;var ra={"-":"",_:" ",0:"0"},ia=/^\s*\d+/,sa=/^%/;Xo.locale=function(e){return{numberFormat:_t(e),timeFormat:jt(e)}};var oa=Xo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Xo.format=oa.numberFormat,Xo.geo={},sn.prototype={s:0,t:0,add:function(e){on(e,this.t,ua),on(ua.s,this.s,this),this.s?this.t+=ua.t:this.s=ua.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ua=new sn;Xo.geo.stream=function(e,t){e&&aa.hasOwnProperty(e.type)?aa[e.type](e,t):un(e,t)};var aa={Feature:function(e,t){un(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)un(n[r].geometry,t)}},fa={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){an(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)an(n[r],t,0)},Polygon:function(e,t){fn(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)fn(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)un(n[r],t)}};Xo.geo.area=function(e){return la=0,Xo.geo.stream(e,ha),la};var la,ca=new sn,ha={sphere:function(){la+=4*xu},point:v,lineStart:v,lineEnd:v,polygonStart:function(){ca.reset(),ha.lineStart=ln},polygonEnd:function(){var e=2*ca;la+=0>e?4*xu+e:e,ha.lineStart=ha.lineEnd=ha.point=v}};Xo.geo.bounds=function(){function e(e,t){b.push(w=[l=e,h=e]),c>t&&(c=t),t>p&&(p=t)}function t(t,n){var r=cn([t*Lu,n*Lu]);if(g){var i=pn(g,r),s=[i[1],-i[0],0],o=pn(s,i);mn(o),o=gn(o);var a=t-d,f=a>0?1:-1,v=o[0]*Au*f,m=su(a)>180;if(m^(v>f*d&&f*t>v)){var y=o[1]*Au;y>p&&(p=y)}else if(v=(v+360)%360-180,m^(v>f*d&&f*t>v)){var y=-o[1]*Au;c>y&&(c=y)}else c>n&&(c=n),n>p&&(p=n);m?d>t?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>d?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t)}else e(t,n);g=r,d=t}function n(){E.point=t}function r(){w[0]=l,w[1]=h,E.point=e,g=null}function i(e,n){if(g){var r=e-d;y+=su(r)>180?r+(r>0?360:-360):r}else v=e,m=n;ha.point(e,n),t(e,n)}function s(){ha.lineStart()}function o(){i(v,m),ha.lineEnd(),su(y)>Cu&&(l=-(h=180)),w[0]=l,w[1]=h,g=null}function u(e,t){return(t-=e)<0?t+360:t}function a(e,t){return e[0]-t[0]}function f(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var l,c,h,p,d,v,m,g,y,b,w,E={point:e,lineStart:n,lineEnd:r,polygonStart:function(){E.point=i,E.lineStart=s,E.lineEnd=o,y=0,ha.polygonStart()},polygonEnd:function(){ha.polygonEnd(),E.point=e,E.lineStart=n,E.lineEnd=r,0>ca?(l=-(h=180),c=-(p=90)):y>Cu?p=90:-Cu>y&&(c=-90),w[0]=l,w[1]=h}};return function(e){p=h=-(l=c=1/0),b=[],Xo.geo.stream(e,E);var t=b.length;if(t){b.sort(a);for(var n,r=1,i=b[0],s=[i];t>r;++r)n=b[r],f(n[0],i)||f(n[1],i)?(u(i[0],n[1])>u(i[0],i[1])&&(i[1]=n[1]),u(n[0],i[1])>u(i[0],i[1])&&(i[0]=n[0])):s.push(i=n);for(var o,n,d=-1/0,t=s.length-1,r=0,i=s[t];t>=r;i=n,++r)n=s[r],(o=u(i[1],n[0]))>d&&(d=o,l=n[0],h=i[1])}return b=w=null,1/0===l||1/0===c?[[0/0,0/0],[0/0,0/0]]:[[l,c],[h,p]]}}(),Xo.geo.centroid=function(e){pa=da=va=ma=ga=ya=ba=wa=Ea=Sa=xa=0,Xo.geo.stream(e,Ta);var t=Ea,n=Sa,r=xa,i=t*t+n*n+r*r;return ku>i&&(t=ya,n=ba,r=wa,Cu>da&&(t=va,n=ma,r=ga),i=t*t+n*n+r*r,ku>i)?[0/0,0/0]:[Math.atan2(n,t)*Au,G(r/Math.sqrt(i))*Au]};var pa,da,va,ma,ga,ya,ba,wa,Ea,Sa,xa,Ta={sphere:v,point:bn,lineStart:En,lineEnd:Sn,polygonStart:function(){Ta.lineStart=xn},polygonEnd:function(){Ta.lineStart=En}},Na=Ln(Tn,Dn,Hn,[-xu,-xu/2]),Ca=1e9;Xo.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i},extent:function(u){return arguments.length?(s=Fn(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]]}};return o.extent([[0,0],[960,500]])},(Xo.geo.conicEqualArea=function(){return qn(Rn)}).raw=Rn,Xo.geo.albers=function(){return Xo.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)},Xo.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return t=null,n(s,o),t||(r(s,o),t)||i(s,o),t}var t,n,r,i,s=Xo.geo.albers(),o=Xo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=Xo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=s.scale(),n=s.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&.234>i&&r>=-0.425&&-0.214>r?o:i>=.166&&.234>i&&r>=-0.214&&-0.115>r?u:s).invert(e)},e.stream=function(e){var t=s.stream(e),n=o.stream(e),r=u.stream(e);return{point:function(e,i){t.point(e,i),n.point(e,i),r.point(e,i)},sphere:function(){t.sphere(),n.sphere(),r.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},e.precision=function(t){return arguments.length?(s.precision(t),o.precision(t),u.precision(t),e):s.precision()},e.scale=function(t){return arguments.length?(s.scale(t),o.scale(.35*t),u.scale(t),e.translate(s.translate())):s.scale()},e.translate=function(t){if(!arguments.length)return s.translate();var f=s.scale(),l=+t[0],c=+t[1];return n=s.translate(t).clipExtent([[l-.455*f,c-.238*f],[l+.455*f,c+.238*f]]).stream(a).point,r=o.translate([l-.307*f,c+.201*f]).clipExtent([[l-.425*f+Cu,c+.12*f+Cu],[l-.214*f-Cu,c+.234*f-Cu]]).stream(a).point,i=u.translate([l-.205*f,c+.212*f]).clipExtent([[l-.214*f+Cu,c+.166*f+Cu],[l-.115*f-Cu,c+.234*f-Cu]]).stream(a).point,e},e.scale(1070)};var ka,La,Aa,Oa,Ma,_a,Da={point:v,lineStart:v,lineEnd:v,polygonStart:function(){La=0,Da.lineStart=Un},polygonEnd:function(){Da.lineStart=Da.lineEnd=Da.point=v,ka+=su(La/2)}},Pa={point:zn,lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},Ha={point:Vn,lineStart:$n,lineEnd:Jn,polygonStart:function(){Ha.lineStart=Kn},polygonEnd:function(){Ha.point=Vn,Ha.lineStart=$n,Ha.lineEnd=Jn}};Xo.geo.path=function(){function e(e){return e&&("function"==typeof u&&s.pointRadius(+u.apply(this,arguments)),o&&o.valid||(o=i(s)),Xo.geo.stream(e,o)),s.result()}function t(){return o=null,e}var n,r,i,s,o,u=4.5;return e.area=function(e){return ka=0,Xo.geo.stream(e,i(Da)),ka},e.centroid=function(e){return va=ma=ga=ya=ba=wa=Ea=Sa=xa=0,Xo.geo.stream(e,i(Ha)),xa?[Ea/xa,Sa/xa]:wa?[ya/wa,ba/wa]:ga?[va/ga,ma/ga]:[0/0,0/0]},e.bounds=function(e){return Ma=_a=-(Aa=Oa=1/0),Xo.geo.stream(e,i(Pa)),[[Aa,Oa],[Ma,_a]]},e.projection=function(e){return arguments.length?(i=(n=e)?e.stream||Yn(e):xt,t()):n},e.context=function(e){return arguments.length?(s=null==(r=e)?new Wn:new Qn(e),"function"!=typeof u&&s.pointRadius(u),t()):r},e.pointRadius=function(t){return arguments.length?(u="function"==typeof t?t:(s.pointRadius(+t),+t),e):u},e.projection(Xo.geo.albersUsa()).context(null)},Xo.geo.transform=function(e){return{stream:function(t){var n=new Zn(t);for(var r in e)n[r]=e[r];return n}}},Zn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Xo.geo.projection=tr,Xo.geo.projectionMutator=nr,(Xo.geo.equirectangular=function(){return tr(ir)}).raw=ir.invert=ir,Xo.geo.rotation=function(e){function t(t){return t=e(t[0]*Lu,t[1]*Lu),t[0]*=Au,t[1]*=Au,t}return e=or(e[0]%360*Lu,e[1]*Lu,e.length>2?e[2]*Lu:0),t.invert=function(t){return t=e.invert(t[0]*Lu,t[1]*Lu),t[0]*=Au,t[1]*=Au,t},t},sr.invert=ir,Xo.geo.circle=function(){function e(){var e="function"==typeof r?r.apply(this,arguments):r,t=or(-e[0]*Lu,-e[1]*Lu,0).invert,i=[];return n(null,null,1,{point:function(e,n){i.push(e=t(e,n)),e[0]*=Au,e[1]*=Au}}),{type:"Polygon",coordinates:[i]}}var t,n,r=[0,0],i=6;return e.origin=function(t){return arguments.length?(r=t,e):r},e.angle=function(r){return arguments.length?(n=lr((t=+r)*Lu,i*Lu),e):t},e.precision=function(r){return arguments.length?(n=lr(t*Lu,(i=+r)*Lu),e):i},e.angle(90)},Xo.geo.distance=function(e,t){var n,r=(t[0]-e[0])*Lu,i=e[1]*Lu,s=t[1]*Lu,o=Math.sin(r),u=Math.cos(r),a=Math.sin(i),f=Math.cos(i),l=Math.sin(s),c=Math.cos(s);return Math.atan2(Math.sqrt((n=c*o)*n+(n=f*l-a*c*u)*n),a*l+f*c*u)},Xo.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return Xo.range(Math.ceil(s/m)*m,i,m).map(h).concat(Xo.range(Math.ceil(f/g)*g,a,g).map(p)).concat(Xo.range(Math.ceil(r/d)*d,n,d).filter(function(e){return su(e%m)>Cu}).map(l)).concat(Xo.range(Math.ceil(u/v)*v,o,v).filter(function(e){return su(e%g)>Cu}).map(c))}var n,r,i,s,o,u,a,f,l,c,h,p,d=10,v=d,m=90,g=360,y=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(s).concat(p(a).slice(1),h(i).reverse().slice(1),p(f).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(s=+t[0][0],i=+t[1][0],f=+t[0][1],a=+t[1][1],s>i&&(t=s,s=i,i=t),f>a&&(t=f,f=a,a=t),e.precision(y)):[[s,f],[i,a]]},e.minorExtent=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],u=+t[0][1],o=+t[1][1],r>n&&(t=r,r=n,n=t),u>o&&(t=u,u=o,o=t),e.precision(y)):[[r,u],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],g=+t[1],e):[m,g]},e.minorStep=function(t){return arguments.length?(d=+t[0],v=+t[1],e):[d,v]},e.precision=function(t){return arguments.length?(y=+t,l=hr(u,o,90),c=pr(r,n,y),h=hr(f,a,90),p=pr(s,i,y),e):y},e.majorExtent([[-180,-90+Cu],[180,90-Cu]]).minorExtent([[-180,-80-Cu],[180,80+Cu]])},Xo.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),n||i.apply(this,arguments)]}}var t,n,r=dr,i=vr;return e.distance=function(){return Xo.geo.distance(t||r.apply(this,arguments),n||i.apply(this,arguments))},e.source=function(n){return arguments.length?(r=n,t="function"==typeof n?null:n,e):r},e.target=function(t){return arguments.length?(i=t,n="function"==typeof t?null:t,e):i},e.precision=function(){return arguments.length?e:0},e},Xo.geo.interpolate=function(e,t){return mr(e[0]*Lu,e[1]*Lu,t[0]*Lu,t[1]*Lu)},Xo.geo.length=function(e){return Ba=0,Xo.geo.stream(e,ja),Ba};var Ba,ja={sphere:v,point:v,lineStart:gr,lineEnd:v,polygonStart:v,polygonEnd:v},Fa=yr(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(Xo.geo.azimuthalEqualArea=function(){return tr(Fa)}).raw=Fa;var Ia=yr(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},xt);(Xo.geo.azimuthalEquidistant=function(){return tr(Ia)}).raw=Ia,(Xo.geo.conicConformal=function(){return qn(br)}).raw=br,(Xo.geo.conicEquidistant=function(){return qn(wr)}).raw=wr;var qa=yr(function(e){return 1/e},Math.atan);(Xo.geo.gnomonic=function(){return tr(qa)}).raw=qa,Er.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Nu]},(Xo.geo.mercator=function(){return Sr(Er)}).raw=Er;var Ra=yr(function(){return 1},Math.asin);(Xo.geo.orthographic=function(){return tr(Ra)}).raw=Ra;var Ua=yr(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(Xo.geo.stereographic=function(){return tr(Ua)}).raw=Ua,xr.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Nu]},(Xo.geo.transverseMercator=function(){var e=Sr(xr),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},n([0,0,90])}).raw=xr,Xo.geom={},Xo.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,i=St(n),s=St(r),o=e.length,u=[],a=[];for(t=0;o>t;t++)u.push([+i.call(this,e[t],t),+s.call(this,e[t],t),t]);for(u.sort(kr),t=0;o>t;t++)a.push([u[t][0],-u[t][1]]);var f=Cr(u),l=Cr(a),c=l[0]===f[0],h=l[l.length-1]===f[f.length-1],p=[];for(t=f.length-1;t>=0;--t)p.push(e[u[f[t]][2]]);for(t=+c;t<l.length-h;++t)p.push(e[u[l[t]][2]]);return p}var n=Tr,r=Nr;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t)},Xo.geom.polygon=function(e){return lu(e,za),e};var za=Xo.geom.polygon.prototype=[];za.area=function(){for(var e,t=-1,n=this.length,r=this[n-1],i=0;++t<n;)e=r,r=this[t],i+=e[1]*r[0]-e[0]*r[1];return.5*i},za.centroid=function(e){var t,n,r=-1,i=this.length,s=0,o=0,u=this[i-1];for(arguments.length||(e=-1/(6*this.area()));++r<i;)t=u,u=this[r],n=t[0]*u[1]-u[0]*t[1],s+=(t[0]+u[0])*n,o+=(t[1]+u[1])*n;return[s*e,o*e]},za.clip=function(e){for(var t,n,r,i,s,o,u=Or(e),a=-1,f=this.length-Or(this),l=this[f-1];++a<f;){for(t=e.slice(),e.length=0,i=this[a],s=t[(r=t.length-u)-1],n=-1;++n<r;)o=t[n],Lr(o,l,i)?(Lr(s,l,i)||e.push(Ar(s,o,l,i)),e.push(o)):Lr(s,l,i)&&e.push(Ar(s,o,l,i)),s=o;u&&e.push(e[0]),l=i}return e};var Wa,Xa,Va,$a,Ja,Ka=[],Qa=[];Fr.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(qr),t.length},Qr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Gr.prototype={insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ti(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(Zr(this,n),e=n,n=e.U),n.C=!1,r.C=!0,ei(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(ei(this,n),e=n,n=e.U),n.C=!1,r.C=!0,Zr(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,s=e.L,o=e.R;if(n=s?o?ti(o):s:o,i?i.L===e?i.L=n:i.R=n:this._=n,s&&o?(r=n.C,n.C=e.C,n.L=s,s.U=n,n!==o?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=o,o.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r){if(e&&e.C)return e.C=!1,void 0;do{if(e===this._)break;if(e===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,Zr(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ei(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,Zr(this,i),e=this._;break}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,ei(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Zr(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ei(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}},Xo.geom.voronoi=function(e){function t(e){var t=new Array(e.length),r=u[0][0],i=u[0][1],s=u[1][0],o=u[1][1];return ni(n(e),u).cells.forEach(function(n,u){var a=n.edges,f=n.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):f.x>=r&&f.x<=s&&f.y>=i&&f.y<=o?[[r,o],[s,o],[s,i],[r,i]]:[];l.point=e[u]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(s(e,t)/Cu)*Cu,y:Math.round(o(e,t)/Cu)*Cu,i:t}})}var r=Tr,i=Nr,s=r,o=i,u=Ga;return e?t(e):(t.links=function(e){return ni(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return ni(n(e)).cells.forEach(function(n,r){for(var i,s,o=n.site,u=n.edges.sort(qr),a=-1,f=u.length,l=u[f-1].edge,c=l.l===o?l.r:l.l;++a<f;)i=l,s=c,l=u[a].edge,c=l.l===o?l.r:l.l,r<s.i&&r<c.i&&ii(o,s,c)<0&&t.push([e[r],e[s.i],e[c.i]])}),t},t.x=function(e){return arguments.length?(s=St(r=e),t):r},t.y=function(e){return arguments.length?(o=St(i=e),t):i},t.clipExtent=function(e){return arguments.length?(u=null==e?Ga:e,t):u===Ga?null:u},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):u===Ga?null:u&&u[1]},t)};var Ga=[[-1e6,-1e6],[1e6,1e6]];Xo.geom.delaunay=function(e){return Xo.geom.voronoi().triangles(e)},Xo.geom.quadtree=function(e,t,n,r,i){function s(e){function s(e,t,n,r,i,s,o,u){if(!isNaN(n)&&!isNaN(r))if(e.leaf){var a=e.x,l=e.y;if(null!=a)if(su(a-n)+su(l-r)<.01)f(e,t,n,r,i,s,o,u);else{var c=e.point;e.x=e.y=e.point=null,f(e,c,a,l,i,s,o,u),f(e,t,n,r,i,s,o,u)}else e.x=n,e.y=r,e.point=t}else f(e,t,n,r,i,s,o,u)}function f(e,t,n,r,i,o,u,a){var f=.5*(i+u),l=.5*(o+a),c=n>=f,h=r>=l,p=(h<<1)+c;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]=ui()),c?i=f:u=f,h?o=l:a=l,s(e,t,n,r,i,o,u,a)}var l,c,h,p,d,v,m,g,y,b=St(u),w=St(a);if(null!=t)v=t,m=n,g=r,y=i;else if(g=y=-(v=m=1/0),c=[],h=[],d=e.length,o)for(p=0;d>p;++p)l=e[p],l.x<v&&(v=l.x),l.y<m&&(m=l.y),l.x>g&&(g=l.x),l.y>y&&(y=l.y),c.push(l.x),h.push(l.y);else for(p=0;d>p;++p){var E=+b(l=e[p],p),S=+w(l,p);v>E&&(v=E),m>S&&(m=S),E>g&&(g=E),S>y&&(y=S),c.push(E),h.push(S)}var x=g-v,T=y-m;x>T?y=m+x:g=v+T;var N=ui();if(N.add=function(e){s(N,e,+b(e,++p),+w(e,p),v,m,g,y)},N.visit=function(e){ai(e,N,v,m,g,y)},p=-1,null==t){for(;++p<d;)s(N,e[p],c[p],h[p],v,m,g,y);--p}else e.forEach(N.add);return c=h=e=l=null,N}var o,u=Tr,a=Nr;return(o=arguments.length)?(u=si,a=oi,3===o&&(i=n,r=t,n=t=0),s(e)):(s.x=function(e){return arguments.length?(u=e,s):u},s.y=function(e){return arguments.length?(a=e,s):a},s.extent=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),s):null==t?null:[[t,n],[r,i]]},s.size=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),s):null==t?null:[r-t,i-n]},s)},Xo.interpolateRgb=fi,Xo.interpolateObject=li,Xo.interpolateNumber=ci,Xo.interpolateString=hi;var Ya=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Za=new RegExp(Ya.source,"g");Xo.interpolate=pi,Xo.interpolators=[function(e,t){var n=typeof t;return("string"===n?Wu.has(t)||/^(#|rgb\(|hsl\()/.test(t)?fi:hi:t instanceof nt?fi:Array.isArray(t)?di:"object"===n&&isNaN(t)?li:ci)(e,t)}],Xo.interpolateArray=di;var ef=function(){return xt},tf=Xo.map({linear:ef,poly:Ei,quad:function(){return yi},cubic:function(){return bi},sin:function(){return Si},exp:function(){return xi},circle:function(){return Ti},elastic:Ni,back:Ci,bounce:function(){return ki}}),nf=Xo.map({"in":xt,out:mi,"in-out":gi,"out-in":function(e){return gi(mi(e))}});Xo.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=tf.get(n)||ef,r=nf.get(r)||xt,vi(r(n.apply(null,Vo.call(arguments,1))))},Xo.interpolateHcl=Li,Xo.interpolateHsl=Ai,Xo.interpolateLab=Oi,Xo.interpolateRound=Mi,Xo.transform=function(e){var t=Jo.createElementNS(Xo.ns.prefix.svg,"g");return(Xo.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new _i(n?n.matrix:rf)})(e)},_i.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var rf={a:1,b:0,c:0,d:1,e:0,f:0};Xo.interpolateTransform=Bi,Xo.layout={},Xo.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;)t.push(Ii(e[n]));return t}},Xo.layout.chord=function(){function e(){var e,f,c,h,p,d={},v=[],m=Xo.range(s),g=[];for(n=[],r=[],e=0,h=-1;++h<s;){for(f=0,p=-1;++p<s;)f+=i[h][p];v.push(f),g.push(Xo.range(s)),e+=f}for(o&&m.sort(function(e,t){return o(v[e],v[t])}),u&&g.forEach(function(e,t){e.sort(function(e,n){return u(i[t][e],i[t][n])})}),e=(Tu-l*s)/e,f=0,h=-1;++h<s;){for(c=f,p=-1;++p<s;){var y=m[h],b=g[y][p],w=i[y][b],E=f,S=f+=w*e;d[y+"-"+b]={index:y,subindex:b,startAngle:E,endAngle:S,value:w}}r[y]={index:y,startAngle:c,endAngle:f,value:(f-c)/e},f+=l}for(h=-1;++h<s;)for(p=h-1;++p<s;){var x=d[h+"-"+p],T=d[p+"-"+h];(x.value||T.value)&&n.push(x.value<T.value?{source:T,target:x}:{source:x,target:T})}a&&t()}function t(){n.sort(function(e,t){return a((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,r,i,s,o,u,a,f={},l=0;return f.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,f):i},f.padding=function(e){return arguments.length?(l=e,n=r=null,f):l},f.sortGroups=function(e){return arguments.length?(o=e,n=r=null,f):o},f.sortSubgroups=function(e){return arguments.length?(u=e,n=null,f):u},f.sortChords=function(e){return arguments.length?(a=e,n&&t(),f):a},f.chords=function(){return n||e(),n},f.groups=function(){return r||e(),r},f},Xo.layout.force=function(){function e(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=i-n,a=s*s+o*o;if(a>u*u/m){if(d>a){var f=t.charge/a;e.px-=s*f,e.py-=o*f}return!0}if(t.point&&a&&d>a){var f=t.pointCharge/a;e.px-=s*f,e.py-=o*f}}return!t.charge}}function t(e){e.px=Xo.event.x,e.py=Xo.event.y,u.resume()}var n,r,i,s,o,u={},a=Xo.dispatch("start","tick","end"),f=[1,1],l=.9,c=sf,h=of,p=-30,d=uf,v=.1,m=.64,g=[],y=[];return u.tick=function(){if((r*=.99)<.005)return a.end({type:"end",alpha:r=0}),!0;var t,n,u,c,h,d,m,b,w,E=g.length,S=y.length;for(n=0;S>n;++n)u=y[n],c=u.source,h=u.target,b=h.x-c.x,w=h.y-c.y,(d=b*b+w*w)&&(d=r*s[n]*((d=Math.sqrt(d))-i[n])/d,b*=d,w*=d,h.x-=b*(m=c.weight/(h.weight+c.weight)),h.y-=w*m,c.x+=b*(m=1-m),c.y+=w*m);if((m=r*v)&&(b=f[0]/2,w=f[1]/2,n=-1,m))for(;++n<E;)u=g[n],u.x+=(b-u.x)*m,u.y+=(w-u.y)*m;if(p)for(Vi(t=Xo.geom.quadtree(g),r,o),n=-1;++n<E;)(u=g[n]).fixed||t.visit(e(u));for(n=-1;++n<E;)u=g[n],u.fixed?(u.x=u.px,u.y=u.py):(u.x-=(u.px-(u.px=u.x))*l,u.y-=(u.py-(u.py=u.y))*l);a.tick({type:"tick",alpha:r})},u.nodes=function(e){return arguments.length?(g=e,u):g},u.links=function(e){return arguments.length?(y=e,u):y},u.size=function(e){return arguments.length?(f=e,u):f},u.linkDistance=function(e){return arguments.length?(c="function"==typeof e?e:+e,u):c},u.distance=u.linkDistance,u.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,u):h},u.friction=function(e){return arguments.length?(l=+e,u):l},u.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,u):p},u.chargeDistance=function(e){return arguments.length?(d=e*e,u):Math.sqrt(d)},u.gravity=function(e){return arguments.length?(v=+e,u):v},u.theta=function(e){return arguments.length?(m=e*e,u):Math.sqrt(m)},u.alpha=function(e){return arguments.length?(e=+e,r?r=e>0?e:0:e>0&&(a.start({type:"start",alpha:r=e}),Xo.timer(u.tick)),u):r},u.start=function(){function e(e,r){if(!n){for(n=new Array(a),u=0;a>u;++u)n[u]=[];for(u=0;f>u;++u){var i=y[u];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var s,o=n[t],u=-1,f=o.length;++u<f;)if(!isNaN(s=o[u][e]))return s;return Math.random()*r}var t,n,r,a=g.length,l=y.length,d=f[0],v=f[1];for(t=0;a>t;++t)(r=g[t]).index=t,r.weight=0;for(t=0;l>t;++t)r=y[t],"number"==typeof r.source&&(r.source=g[r.source]),"number"==typeof r.target&&(r.target=g[r.target]),++r.source.weight,++r.target.weight;for(t=0;a>t;++t)r=g[t],isNaN(r.x)&&(r.x=e("x",d)),isNaN(r.y)&&(r.y=e("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(i=[],"function"==typeof c)for(t=0;l>t;++t)i[t]=+c.call(this,y[t],t);else for(t=0;l>t;++t)i[t]=c;if(s=[],"function"==typeof h)for(t=0;l>t;++t)s[t]=+h.call(this,y[t],t);else for(t=0;l>t;++t)s[t]=h;if(o=[],"function"==typeof p)for(t=0;a>t;++t)o[t]=+p.call(this,g[t],t);else for(t=0;a>t;++t)o[t]=p;return u.resume()},u.resume=function(){return u.alpha(.1)},u.stop=function(){return u.alpha(0)},u.drag=function(){return n||(n=Xo.behavior.drag().origin(xt).on("dragstart.force",Ui).on("drag.force",t).on("dragend.force",zi)),arguments.length?(this.on("mouseover.force",Wi).on("mouseout.force",Xi).call(n),void 0):n},Xo.rebind(u,a,"on")};var sf=20,of=1,uf=1/0;Xo.layout.hierarchy=function(){function e(i){var s,o=[i],u=[];for(i.depth=0;null!=(s=o.pop());)if(u.push(s),(f=n.call(e,s,s.depth))&&(a=f.length)){for(var a,f,l;--a>=0;)o.push(l=f[a]),l.parent=s,l.depth=s.depth+1;r&&(s.value=0),s.children=f}else r&&(s.value=+r.call(e,s,s.depth)||0),delete s.children;return Ki(i,function(e){var n,i;t&&(n=e.children)&&n.sort(t),r&&(i=e.parent)&&(i.value+=e.value)}),u}var t=Yi,n=Qi,r=Gi;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(r=t,e):r},e.revalue=function(t){return r&&(Ji(t,function(e){e.children&&(e.value=0)}),Ki(t,function(t){var n;t.children||(t.value=+r.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},Xo.layout.partition=function(){function e(t,n,r,i){var s=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,s&&(o=s.length)){var o,u,a,f=-1;for(r=t.value?r/t.value:0;++f<o;)e(u=s[f],n,a=u.value*r,i),n+=a}}function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,s=-1;++s<i;)r=Math.max(r,t(n[s]));return 1+r}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o}var r=Xo.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},$i(n,r)},Xo.layout.pie=function(){function e(s){var o=s.map(function(n,r){return+t.call(e,n,r)}),u=+("function"==typeof r?r.apply(this,arguments):r),a=(("function"==typeof i?i.apply(this,arguments):i)-u)/Xo.sum(o),f=Xo.range(s.length);null!=n&&f.sort(n===af?function(e,t){return o[t]-o[e]}:function(e,t){return n(s[e],s[t])});var l=[];return f.forEach(function(e){var t;l[e]={data:s[e],value:t=o[e],startAngle:u,endAngle:u+=t*a}}),l}var t=Number,n=af,r=0,i=Tu;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var af={};Xo.layout.stack=function(){function e(u,a){var f=u.map(function(n,r){return t.call(e,n,r)}),l=f.map(function(t){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)]})}),c=n.call(e,l,a);f=Xo.permute(f,c),l=Xo.permute(l,c);var h,p,d,v=r.call(e,l,a),m=f.length,g=f[0].length;for(p=0;g>p;++p)for(i.call(e,f[0][p],d=v[p],l[0][p][1]),h=1;m>h;++h)i.call(e,f[h][p],d+=l[h-1][p][1],l[h][p][1]);return u}var t=xt,n=rs,r=is,i=ns,s=es,o=ts;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:ff.get(t)||rs,e):n},e.offset=function(t){return arguments.length?(r="function"==typeof t?t:lf.get(t)||is,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(i=t,e):i},e};var ff=Xo.map({"inside-out":function(e){var t,n,r=e.length,i=e.map(ss),s=e.map(os),o=Xo.range(r).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(t=0;r>t;++t)n=o[t],a>u?(u+=s[n],f.push(n)):(a+=s[n],l.push(n));return l.reverse().concat(f)},reverse:function(e){return Xo.range(e.length).reverse()},"default":rs}),lf=Xo.map({silhouette:function(e){var t,n,r,i=e.length,s=e[0].length,o=[],u=0,a=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];r>u&&(u=r),o.push(r)}for(n=0;s>n;++n)a[n]=(u-o[n])/2;return a},wiggle:function(e){var t,n,r,i,s,o,u,a,f,l=e.length,c=e[0],h=c.length,p=[];for(p[0]=a=f=0,n=1;h>n;++n){for(t=0,i=0;l>t;++t)i+=e[t][n][1];for(t=0,s=0,u=c[n][0]-c[n-1][0];l>t;++t){for(r=0,o=(e[t][n][1]-e[t][n-1][1])/(2*u);t>r;++r)o+=(e[r][n][1]-e[r][n-1][1])/u;s+=o*e[t][n][1]}p[n]=a-=i?s/i*u:0,f>a&&(f=a)}for(n=0;h>n;++n)p[n]-=f;return p},expand:function(e){var t,n,r,i=e.length,s=e[0].length,o=1/i,u=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];if(r)for(t=0;i>t;t++)e[t][n][1]/=r;else for(t=0;i>t;t++)e[t][n][1]=o}for(n=0;s>n;++n)u[n]=0;return u},zero:is});Xo.layout.histogram=function(){function e(e,s){for(var o,u,a=[],f=e.map(n,this),l=r.call(this,f,s),c=i.call(this,l,f,s),s=-1,h=f.length,p=c.length-1,d=t?1:1/h;++s<p;)o=a[s]=[],o.dx=c[s+1]-(o.x=c[s]),o.y=0;if(p>0)for(s=-1;++s<h;)u=f[s],u>=l[0]&&u<=l[1]&&(o=a[Xo.bisect(c,u,1,p)-1],o.y+=d,o.push(e[s]));return a}var t=!0,n=Number,r=ls,i=as;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=St(t),e):r},e.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return fs(e,t)}:St(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},Xo.layout.pack=function(){function e(e,s){var o=n.call(this,e,s),u=o[0],a=i[0],f=i[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(u.x=u.y=0,Ki(u,function(e){e.r=+l(e.value)}),Ki(u,vs),r){var c=r*(t?1:Math.max(2*u.r/a,2*u.r/f))/2;Ki(u,function(e){e.r+=c}),Ki(u,vs),Ki(u,function(e){e.r-=c})}return ys(u,a/2,f/2,t?1:1/Math.max(2*u.r/a,2*u.r/f)),o}var t,n=Xo.layout.hierarchy().sort(cs),r=0,i=[1,1];return e.size=function(t){return arguments.length?(i=t,e):i},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(r=+t,e):r},$i(e,n)},Xo.layout.tree=function(){function e(e,i){var l=o.call(this,e,i),c=l[0],h=t(c);if(Ki(h,n),h.parent.m=-h.z,Ji(h,r),f)Ji(c,s);else{var p=c,d=c,v=c;Ji(c,function(e){e.x<p.x&&(p=e),e.x>d.x&&(d=e),e.depth>v.depth&&(v=e)});var m=u(p,d)/2-p.x,g=a[0]/(d.x+u(d,p)/2+m),y=a[1]/(v.depth||1);Ji(c,function(e){e.x=(e.x+m)*g,e.y=e.depth*y})}return l}function t(e){for(var t,n={A:null,children:[e]},r=[n];null!=(t=r.pop());)for(var i,s=t.children,o=0,u=s.length;u>o;++o)r.push((s[o]=i={_:s[o],parent:t,children:(i=s[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,r=e.i?n[e.i-1]:null;if(t.length){Ts(e);var s=(t[0].z+t[t.length-1].z)/2;r?(e.z=r.z+u(e._,r._),e.m=e.z-s):e.z=s}else r&&(e.z=r.z+u(e._,r._));e.parent.A=i(e,r,e.parent.A||n[0])}function r(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function i(e,t,n){if(t){for(var r,i=e,s=e,o=t,a=i.parent.children[0],f=i.m,l=s.m,c=o.m,h=a.m;o=Ss(o),i=Es(i),o&&i;)a=Es(a),s=Ss(s),s.a=e,r=o.z+c-i.z-f+u(o._,i._),r>0&&(xs(Ns(o,e,n),e,r),f+=r,l+=r),c+=o.m,f+=i.m,h+=a.m,l+=s.m;o&&!Ss(s)&&(s.t=o,s.m+=c-l),i&&!Es(a)&&(a.t=i,a.m+=f-h,n=e)}return n}function s(e){e.x*=a[0],e.y=e.depth*a[1]}var o=Xo.layout.hierarchy().sort(null).value(null),u=ws,a=[1,1],f=null;return e.separation=function(t){return arguments.length?(u=t,e):u},e.size=function(t){return arguments.length?(f=null==(a=t)?s:null,e):f?null:a},e.nodeSize=function(t){return arguments.length?(f=null==(a=t)?null:s,e):f?a:null},$i(e,o)},Xo.layout.cluster=function(){function e(e,s){var o,u=t.call(this,e,s),a=u[0],f=0;Ki(a,function(e){var t=e.children;t&&t.length?(e.x=ks(t),e.y=Cs(t)):(e.x=o?f+=n(e,o):0,e.y=0,o=e)});var l=Ls(a),c=As(a),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return Ki(a,i?function(e){e.x=(e.x-a.x)*r[0],e.y=(a.y-e.y)*r[1]}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(a.y?e.y/a.y:1))*r[1]}),u}var t=Xo.layout.hierarchy().sort(null).value(null),n=ws,r=[1,1],i=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=null==(r=t),e):i?null:r},e.nodeSize=function(t){return arguments.length?(i=null!=(r=t),e):i?r:null},$i(e,t)},Xo.layout.treemap=function(){function e(e,t){for(var n,r,i=-1,s=e.length;++i<s;)r=(n=e[i]).value*(0>t?0:t),n.area=isNaN(r)||0>=r?0:r}function t(n){var s=n.children;if(s&&s.length){var o,u,a,f=c(n),l=[],h=s.slice(),d=1/0,v="slice"===p?f.dx:"dice"===p?f.dy:"slice-dice"===p?1&n.depth?f.dy:f.dx:Math.min(f.dx,f.dy);for(e(h,f.dx*f.dy/n.value),l.area=0;(a=h.length)>0;)l.push(o=h[a-1]),l.area+=o.area,"squarify"!==p||(u=r(l,v))<=d?(h.pop(),d=u):(l.area-=l.pop().area,i(l,v,f,!1),v=Math.min(f.dx,f.dy),l.length=l.area=0,d=1/0);l.length&&(i(l,v,f,!0),l.length=l.area=0),s.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var s,o=c(t),u=r.slice(),a=[];for(e(u,o.dx*o.dy/t.value),a.area=0;s=u.pop();)a.push(s),a.area+=s.area,null!=s.z&&(i(a,s.z?o.dx:o.dy,o,!u.length),a.length=a.area=0);r.forEach(n)}}function r(e,t){for(var n,r=e.area,i=0,s=1/0,o=-1,u=e.length;++o<u;)(n=e[o].area)&&(s>n&&(s=n),n>i&&(i=n));return r*=r,t*=t,r?Math.max(t*i*d/r,r/(t*s*d)):1/0}function i(e,t,n,r){var i,s=-1,o=e.length,u=n.x,f=n.y,l=t?a(e.area/t):0;if(t==n.dx){for((r||l>n.dy)&&(l=n.dy);++s<o;)i=e[s],i.x=u,i.y=f,i.dy=l,u+=i.dx=Math.min(n.x+n.dx-u,l?a(i.area/l):0);i.z=!0,i.dx+=n.x+n.dx-u,n.y+=l,n.dy-=l}else{for((r||l>n.dx)&&(l=n.dx);++s<o;)i=e[s],i.x=u,i.y=f,i.dx=l,f+=i.dy=Math.min(n.y+n.dy-f,l?a(i.area/l):0);i.z=!1,i.dy+=n.y+n.dy-f,n.x+=l,n.dx-=l}}function s(r){var i=o||u(r),s=i[0];return s.x=0,s.y=0,s.dx=f[0],s.dy=f[1],o&&u.revalue(s),e([s],s.dx*s.dy/s.value),(o?n:t)(s),h&&(o=i),i}var o,u=Xo.layout.hierarchy(),a=Math.round,f=[1,1],l=null,c=Os,h=!1,p="squarify",d=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(f=e,s):f},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return null==n?Os(t):Ms(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return Ms(t,e)}if(!arguments.length)return l;var r;return c=null==(l=e)?Os:"function"==(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,s},s.round=function(e){return arguments.length?(a=e?Math.round:Number,s):a!=Number},s.sticky=function(e){return arguments.length?(h=e,o=null,s):h},s.ratio=function(e){return arguments.length?(d=e,s):d},s.mode=function(e){return arguments.length?(p=e+"",s):p},$i(s,u)},Xo.random={normal:function(e,t){var n=arguments.length;return 2>n&&(t=1),1>n&&(e=0),function(){var n,r,i;do n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var e=Xo.random.normal.apply(Xo,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=Xo.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;e>n;n++)t+=Math.random();return t}}},Xo.scale={};var cf={floor:xt,ceil:xt};Xo.scale.linear=function(){return Fs([0,1],[0,1],pi,!1)};var hf={s:1,g:1,p:1,r:1,e:1};Xo.scale.log=function(){return Vs(Xo.scale.linear().domain([0,1]),10,!0,[1,10])};var pf=Xo.format(".0e"),df={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};Xo.scale.pow=function(){return $s(Xo.scale.linear(),1,[0,1])},Xo.scale.sqrt=function(){return Xo.scale.pow().exponent(.5)},Xo.scale.ordinal=function(){return Ks([],{t:"range",a:[[]]})},Xo.scale.category10=function(){return Xo.scale.ordinal().range(vf)},Xo.scale.category20=function(){return Xo.scale.ordinal().range(mf)},Xo.scale.category20b=function(){return Xo.scale.ordinal().range(gf)},Xo.scale.category20c=function(){return Xo.scale.ordinal().range(yf)};var vf=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(vt),mf=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(vt),gf=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(vt),yf=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(vt);Xo.scale.quantile=function(){return Qs([],[])},Xo.scale.quantize=function(){return Gs(0,1,[0,1])},Xo.scale.threshold=function(){return Ys([.5],[0,1])},Xo.scale.identity=function(){return Zs([0,1])},Xo.svg={},Xo.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+bf,u=i.apply(this,arguments)+bf,a=(o>u&&(a=o,o=u,u=a),u-o),f=xu>a?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=wf?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var t=eo,n=to,r=no,i=ro;return e.innerRadius=function(n){return arguments.length?(t=St(n),e):t},e.outerRadius=function(t){return arguments.length?(n=St(t),e):n},e.startAngle=function(t){return arguments.length?(r=St(t),e):r},e.endAngle=function(t){return arguments.length?(i=St(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+bf;return[Math.cos(s)*e,Math.sin(s)*e]},e};var bf=-Nu,wf=Tu-Cu;Xo.svg.line=function(){return io(xt)};var Ef=Xo.map({linear:so,"linear-closed":oo,step:uo,"step-before":ao,"step-after":fo,basis:mo,"basis-open":go,"basis-closed":yo,bundle:bo,cardinal:ho,"cardinal-open":lo,"cardinal-closed":co,monotone:No});Ef.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Sf=[0,2/3,1/3,0],xf=[0,1/3,2/3,0],Tf=[0,1/6,2/3,1/6];Xo.svg.line.radial=function(){var e=io(Co);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},ao.reverse=fo,fo.reverse=ao,Xo.svg.area=function(){return ko(xt)},Xo.svg.area.radial=function(){var e=ko(Co);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},Xo.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+bf,l=f.call(e,i,r)+bf;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>xu)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var s=dr,o=vr,u=Lo,a=no,f=ro;return e.radius=function(t){return arguments.length?(u=St(t),e):u},e.source=function(t){return arguments.length?(s=St(t),e):s},e.target=function(t){return arguments.length?(o=St(t),e):o},e.startAngle=function(t){return arguments.length?(a=St(t),e):a},e.endAngle=function(t){return arguments.length?(f=St(t),e):f},e},Xo.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var t=dr,n=vr,r=Ao;return e.source=function(n){return arguments.length?(t=St(n),e):t},e.target=function(t){return arguments.length?(n=St(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},Xo.svg.diagonal.radial=function(){var e=Xo.svg.diagonal(),t=Ao,n=e.projection;return e.projection=function(e){return arguments.length?n(Oo(t=e)):t},e},Xo.svg.symbol=function(){function e(e,r){return(Nf.get(t.call(this,e,r))||Do)(n.call(this,e,r))}var t=_o,n=Mo;return e.type=function(n){return arguments.length?(t=St(n),e):t},e.size=function(t){return arguments.length?(n=St(t),e):n},e};var Nf=Xo.map({circle:Do,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Af)),n=t*Af;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Lf),n=t*Lf/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Lf),n=t*Lf/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});Xo.svg.symbolTypes=Nf.keys();var Cf,kf,Lf=Math.sqrt(3),Af=Math.tan(30*Lu),Of=[],Mf=0;Of.call=vu.call,Of.empty=vu.empty,Of.node=vu.node,Of.size=vu.size,Xo.transition=function(e){return arguments.length?Cf?e.transition():e:yu.transition()},Xo.transition.prototype=Of,Of.select=function(e){var t,n,r,i=this.id,s=[];e=S(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]);for(var a=this[o],f=-1,l=a.length;++f<l;)(r=a[f])&&(n=e.call(r,r.__data__,f,o))?("__data__"in r&&(n.__data__=r.__data__),jo(n,f,i,r.__transition__[i]),t.push(n)):t.push(null)}return Po(s,i)},Of.selectAll=function(e){var t,n,r,i,s,o=this.id,u=[];e=x(e);for(var a=-1,f=this.length;++a<f;)for(var l=this[a],c=-1,h=l.length;++c<h;)if(r=l[c]){s=r.__transition__[o],n=e.call(r,r.__data__,c,a),u.push(t=[]);for(var p=-1,d=n.length;++p<d;)(i=n[p])&&jo(i,p,o,s),t.push(i)}return Po(u,o)},Of.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=P(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]);for(var n=this[s],u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return Po(i,this.id)},Of.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):B(this,null==t?function(t){t.__transition__[n].tween.remove(e)}:function(r){r.__transition__[n].tween.set(e,t)})},Of.attr=function(e,t){function n(){this.removeAttribute(u)}function r(){this.removeAttributeNS(u.space,u.local)}function i(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(u);return n!==e&&(t=o(n,e),function(e){this.setAttribute(u,t(e))})})}function s(e){return null==e?r:(e+="",function(){var t,n=this.getAttributeNS(u.space,u.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(u.space,u.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?Bi:pi,u=Xo.ns.qualify(e);return Ho(this,"attr."+e,t,u.local?s:i)},Of.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=Xo.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Of.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(t){return null==t?r:(t+="",function(){var r,i=Qo.getComputedStyle(this,null).getPropertyValue(e);return i!==t&&(r=pi(i,t),function(t){this.style.setProperty(e,r(t),n)})})}var s=arguments.length;if(3>s){if("string"!=typeof e){2>s&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return Ho(this,"style."+e,t,i)},Of.styleTween=function(e,t,n){function r(r,i){var s=t.call(this,r,i,Qo.getComputedStyle(this,null).getPropertyValue(e));return s&&function(t){this.style.setProperty(e,s(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},Of.text=function(e){return Ho(this,"text",e,Bo)},Of.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},Of.ease=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof e&&(e=Xo.ease.apply(Xo,arguments)),B(this,function(n){n.__transition__[t].ease=e}))},Of.delay=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:B(this,"function"==typeof e?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i)}:(e=+e,function(n){n.__transition__[t].delay=e}))},Of.duration=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:B(this,"function"==typeof e?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},Of.each=function(e,t){var n=this.id;if(arguments.length<2){var r=kf,i=Cf;Cf=n,B(this,function(t,r,i){kf=t.__transition__[n],e.call(t,t.__data__,r,i)}),kf=r,Cf=i}else B(this,function(r){var i=r.__transition__[n];(i.event||(i.event=Xo.dispatch("start","end"))).on(e,t)});return this},Of.transition=function(){for(var e,t,n,r,i=this.id,s=++Mf,o=[],u=0,a=this.length;a>u;u++){o.push(e=[]);for(var t=this[u],f=0,l=t.length;l>f;f++)(n=t[f])&&(r=Object.create(n.__transition__[i]),r.delay+=r.duration,jo(n,f,s,r)),e.push(n)}return Po(o,s)},Xo.svg.axis=function(){function e(e){e.each(function(){var e,f=Xo.select(this),l=this.__chart__||n,c=this.__chart__=n.copy(),h=null==a?c.ticks?c.ticks.apply(c,u):c.domain():a,p=null==t?c.tickFormat?c.tickFormat.apply(c,u):xt:t,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Cu),m=Xo.transition(d.exit()).style("opacity",Cu).remove(),g=Xo.transition(d.order()).style("opacity",1),y=Ds(c),b=f.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),Xo.transition(b));v.append("line"),v.append("text");var E=v.select("line"),S=g.select("line"),x=d.select("text").text(p),T=v.select("text"),N=g.select("text");switch(r){case"bottom":e=Fo,E.attr("y2",i),T.attr("y",Math.max(i,0)+o),S.attr("x2",0).attr("y2",i),N.attr("x",0).attr("y",Math.max(i,0)+o),x.attr("dy",".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+s+"V0H"+y[1]+"V"+s);break;case"top":e=Fo,E.attr("y2",-i),T.attr("y",-(Math.max(i,0)+o)),S.attr("x2",0).attr("y2",-i),N.attr("x",0).attr("y",-(Math.max(i,0)+o)),x.attr("dy","0em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+ -s+"V0H"+y[1]+"V"+ -s);break;case"left":e=Io,E.attr("x2",-i),T.attr("x",-(Math.max(i,0)+o)),S.attr("x2",-i).attr("y2",0),N.attr("x",-(Math.max(i,0)+o)).attr("y",0),x.attr("dy",".32em").style("text-anchor","end"),w.attr("d","M"+ -s+","+y[0]+"H0V"+y[1]+"H"+ -s);break;case"right":e=Io,E.attr("x2",i),T.attr("x",Math.max(i,0)+o),S.attr("x2",i).attr("y2",0),N.attr("x",Math.max(i,0)+o).attr("y",0),x.attr("dy",".32em").style("text-anchor","start"),w.attr("d","M"+s+","+y[0]+"H0V"+y[1]+"H"+s)}if(c.rangeBand){var C=c,k=C.rangeBand()/2;l=c=function(e){return C(e)+k}}else l.rangeBand?l=c:m.call(e,c);v.call(e,l),g.call(e,c)})}var t,n=Xo.scale.linear(),r=_f,i=6,s=6,o=3,u=[10],a=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(r=t in Df?t+"":_f,e):r},e.ticks=function(){return arguments.length?(u=arguments,e):u},e.tickValues=function(t){return arguments.length?(a=t,e):a},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(i=+t,s=+arguments[n-1],e):i},e.innerTickSize=function(t){return arguments.length?(i=+t,e):i},e.outerTickSize=function(t){return arguments.length?(s=+t,e):s},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var _f="bottom",Df={top:1,right:1,bottom:1,left:1};Xo.svg.brush=function(){function e(s){s.each(function(){var s=Xo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=s.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var u=s.selectAll(".resize").data(d,xt);u.exit().remove(),u.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Pf[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),u.style("display",e.empty()?"none":null);var l,c=Xo.transition(s),h=Xo.transition(o);a&&(l=Ds(a),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(c)),f&&(l=Ds(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(c)),t(c)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+l[+/e$/.test(e)]+","+c[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",l[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function r(e){e.select(".extent").attr("y",c[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",c[1]-c[0])}function i(){function i(){32==Xo.event.keyCode&&(L||(b=null,O[0]-=l[1],O[1]-=c[1],L=2),y())}function d(){32==Xo.event.keyCode&&2==L&&(O[0]+=l[1],O[1]+=c[1],L=0,y())}function v(){var e=Xo.mouse(E),i=!1;w&&(e[0]+=w[0],e[1]+=w[1]),L||(Xo.event.altKey?(b||(b=[(l[0]+l[1])/2,(c[0]+c[1])/2]),O[0]=l[+(e[0]<b[0])],O[1]=c[+(e[1]<b[1])]):b=null),C&&m(e,a,0)&&(n(T),i=!0),k&&m(e,f,1)&&(r(T),i=!0),i&&(t(T),x({type:"brush",mode:L?"move":"resize"}))}function m(e,t,n){var r,i,u=Ds(t),a=u[0],f=u[1],d=O[n],v=n?c:l,m=v[1]-v[0];return L&&(a-=d,f-=m+d),r=(n?p:h)?Math.max(a,Math.min(f,e[n])):e[n],L?i=(r+=d)+m:(b&&(d=Math.max(a,Math.min(f,2*b[n]-r))),r>d?(i=r,r=d):i=d),v[0]!=r||v[1]!=i?(n?o=null:s=null,v[0]=r,v[1]=i,!0):void 0}function g(){v(),T.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),Xo.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),x({type:"brushend"})}var b,w,E=this,S=Xo.select(Xo.event.target),x=u.of(E,arguments),T=Xo.select(E),N=S.datum(),C=!/^(n|s)$/.test(N)&&a,k=!/^(e|w)$/.test(N)&&f,L=S.classed("extent"),A=z(),O=Xo.mouse(E),M=Xo.select(Qo).on("keydown.brush",i).on("keyup.brush",d);if(Xo.event.changedTouches?M.on("touchmove.brush",v).on("touchend.brush",g):M.on("mousemove.brush",v).on("mouseup.brush",g),T.interrupt().selectAll("*").interrupt(),L)O[0]=l[0]-O[0],O[1]=c[0]-O[1];else if(N){var _=+/w$/.test(N),D=+/^n/.test(N);w=[l[1-_]-O[0],c[1-D]-O[1]],O[0]=l[_],O[1]=c[D]}else Xo.event.altKey&&(b=O.slice());T.style("pointer-events","none").selectAll(".resize").style("display",null),Xo.select("body").style("cursor",S.style("cursor")),x({type:"brushstart"}),v()}var s,o,u=w(e,"brushstart","brush","brushend"),a=null,f=null,l=[0,0],c=[0,0],h=!0,p=!0,d=Hf[0];return e.event=function(e){e.each(function(){var e=u.of(this,arguments),t={x:l,y:c,i:s,j:o},n=this.__chart__||t;this.__chart__=t,Cf?Xo.select(this).transition().each("start.brush",function(){s=n.i,o=n.j,l=n.x,c=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=di(l,t.x),r=di(c,t.y);return s=o=null,function(i){l=t.x=n(i),c=t.y=r(i),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){s=t.i,o=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(a=t,d=Hf[!a<<1|!f],e):a},e.y=function(t){return arguments.length?(f=t,d=Hf[!a<<1|!f],e):f},e.clamp=function(t){return arguments.length?(a&&f?(h=!!t[0],p=!!t[1]):a?h=!!t:f&&(p=!!t),e):a&&f?[h,p]:a?h:f?p:null},e.extent=function(t){var n,r,i,u,h;return arguments.length?(a&&(n=t[0],r=t[1],f&&(n=n[0],r=r[0]),s=[n,r],a.invert&&(n=a(n),r=a(r)),n>r&&(h=n,n=r,r=h),(n!=l[0]||r!=l[1])&&(l=[n,r])),f&&(i=t[0],u=t[1],a&&(i=i[1],u=u[1]),o=[i,u],f.invert&&(i=f(i),u=f(u)),i>u&&(h=i,i=u,u=h),(i!=c[0]||u!=c[1])&&(c=[i,u])),e):(a&&(s?(n=s[0],r=s[1]):(n=l[0],r=l[1],a.invert&&(n=a.invert(n),r=a.invert(r)),n>r&&(h=n,n=r,r=h))),f&&(o?(i=o[0],u=o[1]):(i=c[0],u=c[1],f.invert&&(i=f.invert(i),u=f.invert(u)),i>u&&(h=i,i=u,u=h))),a&&f?[[n,i],[r,u]]:a?[n,r]:f&&[i,u])},e.clear=function(){return e.empty()||(l=[0,0],c=[0,0],s=o=null),e},e.empty=function(){return!!a&&l[0]==l[1]||!!f&&c[0]==c[1]},Xo.rebind(e,u,"on")};var Pf={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Hf=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Bf=ea.format=oa.timeFormat,jf=Bf.utc,Ff=jf("%Y-%m-%dT%H:%M:%S.%LZ");Bf.iso=Date.prototype.toISOString&&+(new Date("2000-01-01T00:00:00.000Z"))?qo:Ff,qo.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},qo.toString=Ff.toString,ea.second=Ht(function(e){return new ta(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),ea.seconds=ea.second.range,ea.seconds.utc=ea.second.utc.range,ea.minute=Ht(function(e){return new ta(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),ea.minutes=ea.minute.range,ea.minutes.utc=ea.minute.utc.range,ea.hour=Ht(function(e){var t=e.getTimezoneOffset()/60;return new ta(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),ea.hours=ea.hour.range,ea.hours.utc=ea.hour.utc.range,ea.month=Ht(function(e){return e=ea.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),ea.months=ea.month.range,ea.months.utc=ea.month.utc.range;var If=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],qf=[[ea.second,1],[ea.second,5],[ea.second,15],[ea.second,30],[ea.minute,1],[ea.minute,5],[ea.minute,15],[ea.minute,30],[ea.hour,1],[ea.hour,3],[ea.hour,6],[ea.hour,12],[ea.day,1],[ea.day,2],[ea.week,1],[ea.month,1],[ea.month,3],[ea.year,1]],Rf=Bf.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",Tn]]),Uf={range:function(e,t,n){return Xo.range(Math.ceil(e/n)*n,+t,n).map(Uo)},floor:xt,ceil:xt};qf.year=ea.year,ea.scale=function(){return Ro(Xo.scale.linear(),qf,Rf)};var zf=qf.map(function(e){return[e[0].utc,e[1]]}),Wf=jf.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",Tn]]);zf.year=ea.year.utc,ea.scale.utc=function(){return Ro(Xo.scale.linear(),zf,Wf)},Xo.text=Tt(function(e){return e.responseText}),Xo.json=function(e,t){return Nt(e,"application/json",zo,t)},Xo.html=function(e,t){return Nt(e,"text/html",Wo,t)},Xo.xml=Tt(function(e){return e.responseXML}),"function"==typeof define&&define.amd?define("d3",Xo):"object"==typeof module&&module.exports&&(module.exports=Xo),this.d3=Xo}(),define("bootstrap",["templates","logger","utils/layout","utils/decorator","d3"],function(e,t,n,r,i){var s=t.get("bootstrap"),o={},u=function(e){i.keys(e).forEach(function(t){typeof e[t]=="function"&&!e[t].decorated&&(e[t]=r(e[t]))})};return o.init=function(t){t=Array.prototype.splice.call(t,0),s.info("Modules preparation."),t.forEach(function(e){e.prepare&&typeof e.prepare=="function"&&e.prepare()});var r={plugins:[]},i=t.filter(function(e){return e&&e.is_plugin});o.plugins=[],i.forEach(function(e){o.plugins[e.name]=e,u(e)}),s.info("Bootstrapping: "+i.length+" plugins found."),i.forEach(function(e){s.info("Initializing plugin: "+e.name),e.init()}),i.forEach(function(t){var n="templates/plugins/"+t.name+".hbs";if(e.hasOwnProperty(n)){var i=e[n],s=i(t.context);t.view=s}r.plugins.push(t)}),s.info("Initializing layout"),n.init_layout(r),s.info("Modules windup."),t.forEach(function(e){e.windup&&typeof e.windup=="function"&&e.windup()}),s.info("Bootstrapping finished.")},o}),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M=[].slice,_=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};(C=window.Dropbox)==null&&(window.Dropbox={}),(k=Dropbox.baseUrl)==null&&(Dropbox.baseUrl="https://www.dropbox.com"),(L=Dropbox.blockBaseUrl)==null&&(Dropbox.blockBaseUrl="https://dl.dropbox.com"),Dropbox.addListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,function(e){return e.preventDefault=function(){return this.returnValue=!1},n(e)})},Dropbox.removeListener=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},r=function(e){var t,n;return n=encodeURIComponent(Dropbox.VERSION),t=e.indexOf("?")===-1?"?":"&",""+e+t+"version="+n},s=function(e,t){var n,i,s,o,u,a,f,l,c;return a=encodeURIComponent(window.location.protocol+"//"+window.location.host),n=encodeURIComponent(Dropbox.appKey),o=encodeURIComponent(e.linkType||""),f=encodeURIComponent(e._trigger||"js"),u=Boolean(e.multiselect),i=encodeURIComponent(((c=e.extensions)!=null?typeof c.join=="function"?c.join(" "):void 0:void 0)||""),s=Boolean(e.folderselect),t=Boolean(t),l=""+Dropbox.baseUrl+"/chooser?origin="+a+"&app_key="+n+"&link_type="+o,l+="&trigger="+f+"&multiselect="+u+"&extensions="+i+"&folderselect="+s+"&iframe="+t,r(l)},x=function(e){var t,n,i;return n=encodeURIComponent(window.location.protocol+"//"+window.location.host),t=encodeURIComponent(Dropbox.appKey),i=""+Dropbox.baseUrl+"/saver?origin="+n+"&app_key="+t,r(i)},y=1,p=function(e,t){var n,i,s,o;n=encodeURIComponent(Dropbox.appKey),o=""+Dropbox.baseUrl+"/dropins/job_status?job="+t+"&app_key="+n,o=r(o),s=function(t){var n;t.status==="COMPLETE"?(typeof e.progress=="function"&&e.progress(1),typeof e.success=="function"&&e.success()):(n=t.status)==="PENDING"||n==="DOWNLOADING"?(t.progress!=null&&typeof e.progress=="function"&&e.progress(t.progress/100),setTimeout(i,1500)):t.status==="FAILED"&&typeof e.error=="function"&&e.error(t.error)};if("withCredentials"in new XMLHttpRequest)i=function(){var t;return t=new XMLHttpRequest,t.onload=function(){return s(JSON.parse(t.responseText))},t.onerror=function(){return typeof e.error=="function"?e.error():void 0},t.open("GET",o,!0),t.send()};else if(!Dropbox.disableJSONP)i=function(){var t,n,r;return t="DropboxJsonpCallback"+y++,n=!1,window[t]=function(e){return n=!0,s(e)},r=document.createElement("script"),r.src=""+o+"&callback="+t,r.onreadystatechange=function(){var t;if(r.readyState==="loaded")return n||typeof e.error=="function"&&e.error(),(t=r.parentNode)!=null?t.removeChild(r):void 0},document.getElementsByTagName("head")[0].appendChild(r)};else{if(typeof XDomainRequest=="undefined"||XDomainRequest===null||"https:"!==document.location.protocol)throw new Error("Unable to find suitable means of cross domain communication");i=function(){var t;return t=new XDomainRequest,t.onload=function(){return s(JSON.parse(t.responseText))},t.onerror=function(){return typeof e.error=="function"?e.error():void 0},t.open("get",o),t.send()}}return typeof e.progress=="function"&&e.progress(0),i()},d=function(e,t,n){var r,i,s;r=JSON.parse(e.data);switch(r.method){case"ready":n.files!=null&&(s=JSON.stringify({method:"files",params:n.files}),typeof v!="undefined"&&v!==null&&n._popup?i=v.contentWindow:i=e.source,i.postMessage(s,Dropbox.baseUrl)),typeof n.ready=="function"&&n.ready();break;case"files_selected":case"files_saved":typeof t=="function"&&t(),typeof n.success=="function"&&n.success(r.params);break;case"progress":typeof n.progress=="function"&&n.progress(r.params);break;case"close_dialog":typeof t=="function"&&t(),typeof n.cancel=="function"&&n.cancel();break;case"web_session_error":typeof t=="function"&&t(),typeof n.webSessionFailure=="function"&&n.webSessionFailure();break;case"web_session_unlinked":typeof t=="function"&&t(),typeof n.webSessionUnlinked=="function"&&n.webSessionUnlinked();break;case"resize":typeof n.resize=="function"&&n.resize(r.params);break;case"error":typeof t=="function"&&t(),typeof n.error=="function"&&n.error(r.params);break;case"job_id":typeof t=="function"&&t(),p(n,r.params);break;case"_debug_log":typeof console!="undefined"&&console!==null&&console.log(r.params.msg)}},v=null,u=function(){/\bTrident\b/.test(navigator.userAgent)&&(v=document.createElement("iframe"),v.setAttribute("id","dropbox_xcomm"),v.setAttribute("src",Dropbox.baseUrl+"/static/api/1/xcomm.html"),v.style.display="none",document.getElementsByTagName("body")[0].appendChild(v))},Dropbox.createChooserWidget=function(e){var t;return t=a(s(e,!0)),t._handler=function(n){n.source===t.contentWindow&&n.origin===Dropbox.baseUrl&&d(n,null,e)},Dropbox.addListener(window,"message",t._handler),t},Dropbox.cleanupWidget=function(e){if(!e._handler)throw new Error("Invalid widget!");Dropbox.removeListener(window,"message",e._handler),delete e._handler},S=function(e,t){var n,r;return n=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-e)/2,r=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-t)/2,"width="+e+",height="+t+",left="+n+",top="+r};if(Dropbox._dropinsjs_loaded){typeof console!="undefined"&&console!==null&&typeof console.warn=="function"&&console.warn("dropins.js included more than once");return}Dropbox._dropinsjs_loaded=!0,(A=Dropbox.appKey)==null&&(Dropbox.appKey=(O=document.getElementById("dropboxjs"))!=null?O.getAttribute("data-app-key"):void 0),N=function(e){return e},e="https://www.dropbox.com/developers/dropins/chooser/js",n=["text","documents","images","video","audio"],Dropbox.init=function(e){e.translation_function!=null&&(N=e.translation_function),Dropbox.appKey=e.appKey},a=function(e){var t;return t=document.createElement("iframe"),t.src=e,t.style.display="block",t.style.backgroundColor="white",t.style.border="none",t},E=function(e){var t,n,r,i,s,o,u,a;if(typeof e[0]=="string")i=e.shift(),typeof e[0]=="string"?n=e.shift():n=h(i),r={files:[{url:i,filename:n}]};else{r=e.shift();if(r==null)throw new Error("Missing arguments. See documentation.");if(((u=r.files)!=null?!u.length:!void 0)&&typeof r.files!="function")throw new Error("Missing files. See documentation.");a=r.files;for(s=0,o=a.length;s<o;s++)t=a[s],t.filename||(t.filename=h(t.url))}return r},Dropbox.save=function(){var e,t,n,r,i,s,o;e=1<=arguments.length?M.call(arguments,0):[],r=E(e);if(!Dropbox.isBrowserSupported()){alert(N("Your browser does not support the Dropbox Saver"));return}r._popup=!0;if(typeof r.files!="object"||!r.files.length)throw new Error("Opening the saver failed. The object passed in must have a 'files' property that contains a list of objects.  See documentation.");o=r.files;for(i=0,s=o.length;i<s;i++){n=o[i];if(typeof n.url!="string")throw new Error("File urls to download incorrectly configured.  Each file must have a url. See documentation.")}return t=S(352,237),w(x(r),t,r)},w=function(e,t,n){var r,i,s,o,u;r=function(){o.closed||o.close(),Dropbox.removeListener(window,"message",i),clearInterval(u)},i=function(e){(e.source===o||e.source===(v!=null?v.contentWindow:void 0))&&d(e,r,n)},s=function(){o.closed&&(r(),typeof n.cancel=="function"&&n.cancel())},o=window.open(e,"dropbox",""+t+",resizable=yes,location=yes");if(!o)throw new Error("Failed to open a popup window. Dropbox.choose and Dropbox.save should only be called from within a user-triggered event handler such as a tap or click event.");return o.focus(),u=setInterval(s,100),Dropbox.addListener(window,"message",i),o},T=function(t){var r,i,s,o,u;t.success==null&&typeof console!="undefined"&&console!==null&&typeof console.warn=="function"&&console.warn("You must provide a success callback to the Chooser to see the files that the user selects"),i=function(){return typeof console!="undefined"&&console!==null&&typeof console.warn=="function"&&console.warn("The provided list of extensions or file types is not valid. See Chooser documentation: "+e),typeof console!="undefined"&&console!==null&&typeof console.warn=="function"&&console.warn("Available file types are: "+n.join(", ")),delete t.extensions};if(t.extensions!=null)if(Object.prototype.toString.call(t.extensions)==="[object Array]"){u=t.extensions;for(s=0,o=u.length;s<o;s++)r=u[s],!r.match(/^\.[\.\w$#&+@!()\-'`_~]+$/)&&_.call(n,r)<0&&i()}else i();return t},i=function(e){var t,n,r,i,o,u,f,l;if(!Dropbox.isBrowserSupported()){alert(N("Your browser does not support the Dropbox Chooser"));return}l=660,i=440,e.iframe?(f=a(s(e,!0)),f.style.width=l+"px",f.style.height=i+"px",u=document.createElement("div"),u.style.position="fixed",u.style.left=u.style.right=u.style.top=u.style.bottom="0px",u.style.zIndex="1000",t=document.createElement("div"),t.style.position="absolute",t.style.left=t.style.right=t.style.top=t.style.bottom="0px",t.style.backgroundColor="rgb(160, 160, 160)",t.style.opacity="0.2",t.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity=20)",o=document.createElement("div"),o.style.position="relative",o.style.width=l+"px",o.style.margin="125px auto 0px auto",o.style.border="1px solid #ACACAC",o.style.boxShadow="rgba(0, 0, 0, .2) 0px 4px 16px",o.appendChild(f),u.appendChild(t),u.appendChild(o),document.body.appendChild(u),r=function(t){t.source===f.contentWindow&&d(t,function(){document.body.removeChild(u),Dropbox.removeListener(window,"message",r)},e)},Dropbox.addListener(window,"message",r)):(n=S(l,i),w(s(e),n,e))},Dropbox.choose=function(e){e==null&&(e={}),e=T(e),i(e)},Dropbox.isBrowserSupported=function(){var e;return e=g(),Dropbox.isBrowserSupported=function(){return e},e},g=function(){var e,t,n,r;r=[/Windows Phone/,/BB10;/,/CriOS/];for(t=0,n=r.length;t<n;t++){e=r[t];if(e.test(navigator.userAgent))return!1}return typeof JSON=="undefined"||JSON===null||window.postMessage==null?!1:!0},c=function(e){return e.replace(/\/+$/g,"").split("/").pop()},h=function(e){var t;return t=document.createElement("a"),t.href=e,c(t.pathname)},o=function(e,t){var n;return t!=null?t.innerHTML="":(t=document.createElement("a"),t.href="#"),t.className+=" dropbox-dropin-btn",Dropbox.isBrowserSupported()?t.className+=" dropbox-dropin-default":t.className+=" dropbox-dropin-disabled",n=document.createElement("span"),n.className="dropin-btn-status",t.appendChild(n),e=document.createTextNode(e),t.appendChild(e),t},Dropbox.createChooseButton=function(e){var t;return e==null&&(e={}),e=T(e),t=o(N("Choose from Dropbox")),Dropbox.addListener(t,"click",function(n){n.preventDefault(),i({success:function(n){t.className="dropbox-dropin-btn dropbox-dropin-success",typeof e.success=="function"&&e.success(n)},cancel:e.cancel,linkType:e.linkType,multiselect:e.multiselect,extensions:e.extensions,iframe:e.iframe,_trigger:"button"})}),t},Dropbox.createSaveButton=function(){var e,t,n;return e=1<=arguments.length?M.call(arguments,0):[],n=E(e),t=e.shift(),t=o(N("Save to Dropbox"),t),Dropbox.addListener(t,"click",function(e){var r;e.preventDefault();if(!(t.className.indexOf("dropbox-dropin-error")>=0||t.className.indexOf("dropbox-dropin-default")>=0||t.className.indexOf("dropbox-dropin-disabled")>=0))return;r=(typeof n.files=="function"?n.files():void 0)||n.files;if(r!=null?!r.length:!void 0){t.className="dropbox-dropin-btn dropbox-dropin-error",typeof n.error=="function"&&n.error("Missing files");return}Dropbox.save({files:r,success:function(){t.className="dropbox-dropin-btn dropbox-dropin-success",typeof n.success=="function"&&n.success()},progress:function(e){t.className="dropbox-dropin-btn dropbox-dropin-progress",typeof n.progress=="function"&&n.progress(e)},cancel:function(){typeof n.cancel=="function"&&n.cancel()},error:function(e){t.className="dropbox-dropin-btn dropbox-dropin-error",typeof n.error=="function"&&n.error(e)}})}),t},b=function(e,t){return"background: "+e+";\nbackground: -moz-linear-gradient(top, "+e+" 0%, "+t+" 100%);\nbackground: -webkit-linear-gradient(top, "+e+" 0%, "+t+" 100%);\nbackground: linear-gradient(to bottom, "+e+" 0%, "+t+" 100%);\nfilter: progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+t+"',GradientType=0);"},f=document.createElement("style"),f.type="text/css",l='@-webkit-keyframes rotate {\n  from  { -webkit-transform: rotate(0deg); }\n  to   { -webkit-transform: rotate(360deg); }\n}\n\n@keyframes rotate {\n  from  { transform: rotate(0deg); }\n  to   { transform: rotate(360deg); }\n}\n\n.dropbox-dropin-btn, .dropbox-dropin-btn:link, .dropbox-dropin-btn:hover {\n  display: inline-block;\n  height: 14px;\n  font-family: "Lucida Grande", "Segoe UI", "Tahoma", "Helvetica Neue", "Helvetica", sans-serif;\n  font-size: 11px;\n  font-weight: 600;\n  color: #636363;\n  text-decoration: none;\n  padding: 1px 7px 5px 3px;\n  border: 1px solid #ebebeb;\n  border-radius: 2px;\n  border-bottom-color: #d4d4d4;\n  '+b("#fcfcfc","#f5f5f5")+"\n}\n\n.dropbox-dropin-default:hover, .dropbox-dropin-error:hover {\n  border-color: #dedede;\n  border-bottom-color: #cacaca;\n  "+b("#fdfdfd","#f5f5f5")+"\n}\n\n.dropbox-dropin-default:active, .dropbox-dropin-error:active {\n  border-color: #d1d1d1;\n  box-shadow: inset 0 1px 1px rgba(0,0,0,0.1);\n}\n\n.dropbox-dropin-btn .dropin-btn-status {\n  display: inline-block;\n  width: 15px;\n  height: 14px;\n  vertical-align: bottom;\n  margin: 0 5px 0 2px;\n  background: transparent url('"+Dropbox.baseUrl+"/static/images/widgets/dbx-saver-status.png') no-repeat;\n  position: relative;\n  top: 2px;\n}\n\n.dropbox-dropin-default .dropin-btn-status {\n  background-position: 0px 0px;\n}\n\n.dropbox-dropin-progress .dropin-btn-status {\n  width: 18px;\n  margin: 0 4px 0 0;\n  background: url('"+Dropbox.baseUrl+"/static/images/widgets/dbx-progress.png') no-repeat center center;\n  -webkit-animation-name: rotate;\n  -webkit-animation-duration: 1.7s;\n  -webkit-animation-iteration-count: infinite;\n  -webkit-animation-timing-function: linear;\n  animation-name: rotate;\n  animation-duration: 1.7s;\n  animation-iteration-count: infinite;\n  animation-timing-function: linear;\n}\n\n.dropbox-dropin-success .dropin-btn-status {\n  background-position: -15px 0px;\n}\n\n.dropbox-dropin-disabled {\n  background: #e0e0e0;\n  border: 1px #dadada solid;\n  border-bottom: 1px solid #ccc;\n  box-shadow: none;\n}\n\n.dropbox-dropin-disabled .dropin-btn-status {\n  background-position: -30px 0px;\n}\n\n.dropbox-dropin-error .dropin-btn-status {\n  background-position: -45px 0px;\n}\n\n@media only screen and (-webkit-min-device-pixel-ratio: 1.4) {\n  .dropbox-dropin-btn .dropin-btn-status {\n    background-image: url('"+Dropbox.baseUrl+"/static/images/widgets/dbx-saver-status-2x.png');\n    background-size: 60px 14px;\n    -webkit-background-size: 60px 14px;\n  }\n\n  .dropbox-dropin-progress .dropin-btn-status {\n    background: url('"+Dropbox.baseUrl+"/static/images/widgets/dbx-progress-2x.png') no-repeat center center;\n    background-size: 20px 20px;\n    -webkit-background-size: 20px 20px;\n  }\n}\n\n.dropbox-saver:hover, .dropbox-chooser:hover {\n  text-decoration: none;\n  cursor: pointer;\n}\n\n.dropbox-chooser, .dropbox-dropin-btn {\n  line-height: 11px !important;\n  text-decoration: none !important;\n  box-sizing: content-box !important;\n  -webkit-box-sizing: content-box !important;\n  -moz-box-sizing: content-box !important;\n}\n",f.styleSheet?f.styleSheet.cssText=l:f.textContent=l,document.getElementsByTagName("head")[0].appendChild(f),setTimeout(u,0),t=function(){return document.removeEventListener?document.removeEventListener("DOMContentLoaded",t,!1):document.detachEvent&&document.detachEvent("onreadystatechange",t),m()},document.readyState==="complete"?setTimeout(t,0):document.addEventListener?document.addEventListener("DOMContentLoaded",t,!1):document.attachEvent("onreadystatechange",t),Dropbox.VERSION="2",m=function(){var e,t,n,r;r=document.getElementsByTagName("a");for(t=0,n=r.length;t<n;t++)e=r[t],_.call((e.getAttribute("class")||"").split(" "),"dropbox-saver")>=0&&function(e){Dropbox.createSaveButton({files:function(){return[{url:e.getAttribute("data-url")||e.href,filename:e.getAttribute("data-filename")||c(e.pathname)}]}},e)}(e)}}.call(this),define("dropbox",function(e){return function(){var t,n;return t||e.Dropbox}}(this)),define("utils/helper",["require","modules/data","d3"],function(e){var t=e("modules/data"),n=e("d3"),r={};r.format_time=function(e){var t=Math.floor(e/60),n=Math.floor(e%60),r=Math.round(60*(e%1));r==60&&(n++,r=0);var i=function(e){return e=e.toString(),e.length==1?"0"+e:e},s=t?i(t)+":":"";return s+=i(n)+":"+i(r),s};var i=n.time.format("%Y-%m-%d %H:%M");return r.format_date=function(e){return i(e)},r.lines_to_minutes=function(e){return e/t.config.print().lines_per_page},r.version_generator=function(e){e=e||"0";var t=e.split(".").concat([0,0,0,0,0,0,0,0,0,0]),n=function(e){t[e-1]++;for(var n=e;n<t.length;n++)t[n]=0},r=function(){var e=t.concat();e.reverse();while(e.length>1&&e[0]===0)e.shift();return e.reverse(),e.join(".")},i=function(e){return arguments.length===0?r():(n(e),r())};return i},r.double_id=function(e,t){return Math.min(e,t)+"_"+Math.max(e,t)},r.pairs=function(e){var t=e.map(function(t,n){return e.slice(n+1).map(function(t){return[e[n],t]})}).reduce(function(e,t){return e.concat(t)},[]);return t.each=function(e){t.forEach(function(t){e(t[0],t[1])})},t},r}),define("utils/converters/finaldraft",["require","jquery"],function(e){var t=e("jquery"),n={},r=function(e,n){var r=t(e).attr("Type"),i=t(e).attr("Alignment"),s=t(e).attr("StartsNewPage"),o=t(e).find("Text").map(function(){var e=t(this).html();return e}).get().join("");o=t("<div/>").html(o).text(),o=o.replace(//g,"'").replace(//g,'"').replace(//g,'"').replace(//g,"'"),s==="Yes"&&(o+="\n====\n"+o);if(r==="Character"||r==="Scene Heading"||r==="Transition")o=o.toUpperCase();return r==="Character"&&n&&(o+=" ^"),r==="Transition"&&(o="> "+o),i==="Center"&&(o="> "+o.split("\n").join(" ")+" <"),r==="Scene Heading"&&!/^((?:\*{0,3}_?)?(?:(?:int|ext|est|i\/e)[. ]).+)|^(?:\.(?!\.+))(.+)/i.test(o)&&(o="."+o),r!=="Parenthetical"&&r!=="Dialogue"&&(o="\n"+o),r!=="Center"&&(o+="\n"),o.replace(/\n/g,"")===""?"":o};return n.to_fountain=function(e){var n="";try{var i=t.parseXML(e),s=t(i),o=["Title: ","Credit: ","Author: "],u=!1;s.find("FinalDraft TitlePage Content > Paragraph").each(function(){if(o.length===0)return;var e=t(this).find("Text").html().trim();e===""?u=!1:(u||(n+=o.shift(),u=!0),n+=e+"\n")}),s.find("FinalDraft > Content > Paragraph").each(function(){var e=t(this).find("DualDialogue");if(e.size()){var i=!1;e.find("Paragraph").each(function(){n+=r(this,i),i=!0})}else n+=r(this)})}catch(a){n=e}return n},n}),define("plugins/open",["require","utils/pluginmanager","logger","templates","dropbox","modules/data","utils/helper","jquery","utils/converters/finaldraft","utils/layout"],function(e){var t=e("utils/pluginmanager"),n=e("logger"),r=e("templates"),i=e("dropbox"),s=e("modules/data"),o=e("utils/helper"),u=e("jquery"),a=e("utils/converters/finaldraft"),f=e("utils/layout"),l=n.get("open"),c=t.create_plugin("open","open");c.class="active";var h,p=function(e){s.script(e),f.show_main()};c.open_last_used=function(e){return d&&p(h||""),e},c.open_file=function(e){var t=new FileReader;t.onload=function(){var e=this.result;/<\?xml/.test(e)&&(e=a.to_fountain(e)),p(e)},t.readAsText(e)},c.open_file_dialog=function(){},c.create_new=function(){p("")},c.open_sample=function(e){var t="templates/samples/"+e+".fountain",n=r[t]();p(n)},c.is_dropbox_available=function(){return i.isBrowserSupported()&&window.location.protocol!=="file:"},c.open_from_dropbox=function(){i.choose({success:function(e){u.ajax({url:e[0].link}).done(function(e){p(e)})},linkType:"direct",multiselect:!1,extensions:[".fountain",".spmd",".txt",".fdx"]})},c.init=function(){l.info("Init: script handlers"),s.parse.add(function(){s.data("last-used-title","No title"),s.parsed.title_page.forEach(function(e){if(e.type==="title"){var t=e.text;t=t.split("\n")[0].replace(/\*/g,"").replace(/_/g,"").replace(/\n/g," / "),s.data("last-used-title",t)}}),s.data("last-used-script",s.script()),s.data("last-used-date",o.format_date(new Date))})},c.context={last_used:{}};var d=!1;return s.data("last-used-date")&&(l.info("Last used exists. Loading: ",s.data("last-used-title"),s.data("last-used-date")),c.context.last_used.script=s.data("last-used-script"),c.context.last_used.date=s.data("last-used-date"),c.context.last_used.title=s.data("last-used-title"),h=s.data("last-used-script"),d=!0),c});var saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if(typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i=!e.externalHost&&"download"in r,s=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)},o=e.webkitRequestFileSystem,u=e.requestFileSystem||o||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},f="application/octet-stream",l=0,c=[],h=function(){var e=c.length;while(e--){var t=c[e];typeof t=="string"?n().revokeObjectURL(t):t.remove()}c.length=0},p=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i=="function")try{i.call(e,n||e)}catch(s){a(s)}}},d=function(t,a){var h=this,d=t.type,v=!1,m,g,y=function(){var e=n().createObjectURL(t);return c.push(e),e},b=function(){p(h,"writestart progress write writeend".split(" "))},w=function(){if(v||!m)m=y(t);g?g.location.href=m:window.open(m,"_blank"),h.readyState=h.DONE,b()},E=function(e){return function(){if(h.readyState!==h.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1},x;h.readyState=h.INIT,a||(a="download");if(i){m=y(t),r.href=m,r.download=a,s(r),h.readyState=h.DONE,b();return}e.chrome&&d&&d!==f&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,f),v=!0),o&&a!=="download"&&(a+=".download");if(d===f||o)g=e;if(!u){w();return}l+=t.size,u(e.TEMPORARY,l,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(a,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL(),c.push(e),h.readyState=h.DONE,p(h,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),w)}),w)};e.getFile(a,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():w()}))}),w)}),w)},v=d.prototype,m=function(e,t){return new d(e,t)};return v.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,e.addEventListener("unload",h,!1),m.unload=function(){h(),e.removeEventListener("unload",h,!1)},m}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define("saveAs",[],function(){return saveAs});var jsPDF=function(){function n(r,i,s,o){typeof r=="undefined"?r="p":r=r.toString().toLowerCase(),typeof i=="undefined"&&(i="mm"),typeof s=="undefined"&&(s="a4"),typeof o=="undefined"&&typeof zpipe=="undefined"&&(o=!1);var u=s.toString().toLowerCase(),a="0.9.0rc2",f=[],l=0,c=o,h="1.3",p={a3:[841.89,1190.55],a4:[595.28,841.89],a5:[420.94,595.28],letter:[612,792],legal:[612,1008]},d="0 g",v="0 G",m=0,g=[],y=2,b=!1,w=[],E={},S={},x=16,T,N=.200025,C,k,L,A={title:"",subject:"",author:"",keywords:"",creator:""},O=0,M=0,_={},D=new t(_),P,H,B=function(e){return e.toFixed(2)},j=function(e){return e.toFixed(3)},F=function(e){var t=e.toFixed(0);return e<10?"0"+t:t},I=function(e){var t=e.toFixed(0);return t.length<10?(new Array(11-t.length)).join("0")+t:t},q=function(e){b?g[m].push(e):(f.push(e),l+=e.length+1)},R=function(){return y++,w[y]=l,q(y+" 0 obj"),y},U=function(e){q("stream"),q(e),q("endstream")},z,W,X,V,$=function(){z=k*L,W=C*L;var e,t,n,r,i,s,o;for(e=1;e<=m;e++){R(),q("<</Type /Page"),q("/Parent 1 0 R"),q("/Resources 2 0 R"),q("/Contents "+(y+1)+" 0 R>>"),q("endobj"),t=g[e].join("\n"),R();if(c){n=[];for(i=0;i<t.length;++i)n[i]=t.charCodeAt(i);o=adler32cs.from(t),s=new Deflater(6),s.append(new Uint8Array(n)),t=s.flush(),n=[new Uint8Array([120,156]),new Uint8Array(t),new Uint8Array([o&255,o>>8&255,o>>16&255,o>>24&255])],t="";for(i in n)n.hasOwnProperty(i)&&(t+=String.fromCharCode.apply(null,n[i]));q("<</Length "+t.length+" /Filter [/FlateDecode]>>")}else q("<</Length "+t.length+">>");U(t),q("endobj")}w[1]=l,q("1 0 obj"),q("<</Type /Pages"),X="/Kids [";for(i=0;i<m;i++)X+=3+2*i+" 0 R ";q(X+"]"),q("/Count "+m),q("/MediaBox [0 0 "+B(z)+" "+B(W)+"]"),q(">>"),q("endobj")},J=function(e){e.objectNumber=R(),q("<</BaseFont/"+e.PostScriptName+"/Type/Font"),typeof e.encoding=="string"&&q("/Encoding/"+e.encoding),q("/Subtype/Type1>>"),q("endobj")},K=function(){var e;for(e in E)E.hasOwnProperty(e)&&J(E[e])},Q=function(){D.publish("putXobjectDict")},G=function(){q("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),q("/Font <<");var e;for(e in E)E.hasOwnProperty(e)&&q("/"+e+" "+E[e].objectNumber+" 0 R");q(">>"),q("/XObject <<"),Q(),q(">>")},Y=function(){K(),D.publish("putResources"),w[2]=l,q("2 0 obj"),q("<<"),G(),q(">>"),q("endobj"),D.publish("postPutResources")},Z=function(e,t,n){var r;S[t]===r&&(S[t]={}),S[t][n]=e},et={},tt=function(t,n,r,i){var s="F"+(e(E)+1).toString(10),o=E[s]={id:s,PostScriptName:t,fontName:n,fontStyle:r,encoding:i,metadata:{}};return Z(s,n,r),D.publish("addFont",o),s},nt=function(){var e="helvetica",t="times",n="courier",r="normal",i="bold",s="italic",o="bolditalic",u="StandardEncoding",a=[["Helvetica",e,r],["Helvetica-Bold",e,i],["Helvetica-Oblique",e,s],["Helvetica-BoldOblique",e,o],["Courier",n,r],["Courier-Bold",n,i],["Courier-Oblique",n,s],["Courier-BoldOblique",n,o],["Times-Roman",t,r],["Times-Bold",t,i],["Times-Italic",t,s],["Times-BoldItalic",t,o]],f,l,c,h;for(f=0,l=a.length;f<l;f++)c=tt(a[f][0],a[f][1],a[f][2],u),h=a[f][0].split("-"),Z(c,h[0],h[1]||"");D.publish("addFonts",{fonts:E,dictionary:S})},rt=function(e,t){var n,r,i,s,o,u,a,f,l,c;t===i&&(t={}),s=t.sourceEncoding?s:"Unicode",u=t.outputEncoding;if((t.autoencode||u)&&E[T].metadata&&E[T].metadata[s]&&E[T].metadata[s].encoding){o=E[T].metadata[s].encoding,!u&&E[T].encoding&&(u=E[T].encoding),!u&&o.codePages&&(u=o.codePages[0]),typeof u=="string"&&(u=o[u]);if(u){f=!1,a=[];for(n=0,r=e.length;n<r;n++)l=u[e.charCodeAt(n)],l?a.push(String.fromCharCode(l)):a.push(e[n]),a[n].charCodeAt(0)>>8&&(f=!0);e=a.join("")}}n=e.length;while(f===i&&n!==0)e.charCodeAt(n-1)>>8&&(f=!0),n--;if(!f)return e;a=t.noBOM?[]:[254,255];for(n=0,r=e.length;n<r;n++){l=e.charCodeAt(n),c=l>>8;if(c>>8)throw new Error("Character at position "+n.toString(10)+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");a.push(c),a.push(l-(c<<8))}return String.fromCharCode.apply(i,a)},it=function(e,t){return rt(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},st=function(){q("/Producer (jsPDF "+a+")"),A.title&&q("/Title ("+it(A.title)+")"),A.subject&&q("/Subject ("+it(A.subject)+")"),A.author&&q("/Author ("+it(A.author)+")"),A.keywords&&q("/Keywords ("+it(A.keywords)+")"),A.creator&&q("/Creator ("+it(A.creator)+")");var e=new Date;q("/CreationDate (D:"+[e.getFullYear(),F(e.getMonth()+1),F(e.getDate()),F(e.getHours()),F(e.getMinutes()),F(e.getSeconds())].join("")+")")},ot=function(){q("/Type /Catalog"),q("/Pages 1 0 R"),q("/OpenAction [3 0 R /FitH null]"),q("/PageLayout /OneColumn"),D.publish("putCatalog")},ut=function(){q("/Size "+(y+1)),q("/Root "+y+" 0 R"),q("/Info "+(y-1)+" 0 R")},at=function(){m++,b=!0,g[m]=[]},ft=function(){at(),q(B(N*L)+" w"),q(v),O!==0&&q(O.toString(10)+" J"),M!==0&&q(M.toString(10)+" j"),D.publish("addPage",{pageNumber:m})},lt=function(e,t){var n,r;e===r&&(e=E[T].fontName),t===r&&(t=E[T].fontStyle);try{n=S[e][t]}catch(i){n=r}if(!n)throw new Error("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts.");return n},ct=function(){b=!1,f=[],w=[],q("%PDF-"+h),$(),Y(),R(),q("<<"),st(),q(">>"),q("endobj"),R(),q("<<"),ot(),q(">>"),q("endobj");var e=l,t;q("xref"),q("0 "+(y+1)),q("0000000000 65535 f ");for(t=1;t<=y;t++)q(I(w[t])+" 00000 n ");return q("trailer"),q("<<"),ut(),q(">>"),q("startxref"),q(e),q("%%EOF"),b=!0,f.join("\n")},ht=function(e){var t="S";if(e==="F")t="f";else if(e==="FD"||e==="DF")t="B";return t},pt=function(e,t){var n,r,i,s,o,u;switch(e){case n:return ct();case"save":if(navigator.getUserMedia){if(window.URL===undefined)return _.output("dataurlnewwindow");if(window.URL.createObjectURL===undefined)return _.output("dataurlnewwindow")}r=ct(),i=r.length,s=new Uint8Array(new ArrayBuffer(i));for(o=0;o<i;o++)s[o]=r.charCodeAt(o);u=new Blob([s],{type:"application/pdf"}),saveAs(u,t);break;case"datauristring":case"dataurlstring":return"data:application/pdf;base64,"+btoa(ct());case"datauri":case"dataurl":document.location.href="data:application/pdf;base64,"+btoa(ct());break;case"dataurlnewwindow":window.open("data:application/pdf;base64,"+btoa(ct()));break;default:throw new Error('Output type "'+e+'" is not supported.')}};if(i==="pt")L=1;else if(i==="mm")L=72/25.4;else if(i==="cm")L=72/2.54;else{if(i!=="in")throw"Invalid unit: "+i;L=72}if(p.hasOwnProperty(u))C=p[u][1]/L,k=p[u][0]/L;else try{C=s[1],k=s[0]}catch(dt){throw"Invalid format: "+s}if(r==="p"||r==="portrait")r="p",k>C&&(P=k,k=C,C=P);else{if(r!=="l"&&r!=="landscape")throw"Invalid orientation: "+r;r="l",C>k&&(P=k,k=C,C=P)}_.internal={pdfEscape:it,getStyle:ht,getFont:function(){return E[lt.apply(_,arguments)]},getFontSize:function(){return x},btoa:btoa,write:function(e,t,n,r){q(arguments.length===1?e:Array.prototype.join.call(arguments," "))},getCoordinateString:function(e){return B(e*L)},getVerticalCoordinateString:function(e){return B((C-e)*L)},collections:{},newObject:R,putStream:U,events:D,scaleFactor:L,pageSize:{width:k,height:C},output:function(e,t){return pt(e,t)}},_.addPage=function(){return ft(),this},_.text=function(e,t,n,r){var i,s,o,u,a,f,l;typeof e=="number"&&(s=n,o=e,u=t,e=s,t=o,n=u),typeof e=="string"&&e.match(/[\n\r]/)&&(e=e.split(/\r\n|\r|\n/g)),typeof r=="undefined"?r={noBOM:!0,autoencode:!0}:(r.noBOM===i&&(r.noBOM=!0),r.autoencode===i&&(r.autoencode=!0));if(typeof e=="string")f=it(e,r);else{if(!(e instanceof Array))throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');a=e.concat();for(l=a.length-1;l!==-1;l--)a[l]=it(a[l],r);f=a.join(") Tj\nT* (")}return q("BT\n/"+T+" "+x+" Tf\n"+x+" TL\n"+d+"\n"+B(t*L)+" "+B((C-n)*L)+" Td\n("+f+") Tj\nET"),this},_.line=function(e,t,n,r){return q(B(e*L)+" "+B((C-t)*L)+" m "+B(n*L)+" "+B((C-r)*L)+" l S"),this},_.lines=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;typeof e=="number"&&(o=n,u=e,a=t,e=o,t=u,n=a),i=ht(i),r=r===s?[1,1]:r,q(j(t*L)+" "+j((C-n)*L)+" m "),f=r[0],l=r[1],h=e.length,y=t,b=n;for(c=0;c<h;c++)p=e[c],p.length===2?(y=p[0]*f+y,b=p[1]*l+b,q(j(y*L)+" "+j((C-b)*L)+" l")):(d=p[0]*f+y,v=p[1]*l+b,m=p[2]*f+y,g=p[3]*l+b,y=p[4]*f+y,b=p[5]*l+b,q(j(d*L)+" "+j((C-v)*L)+" "+j(m*L)+" "+j((C-g)*L)+" "+j(y*L)+" "+j((C-b)*L)+" c"));return q(i),this},_.rect=function(e,t,n,r,i){var s=ht(i);return q([B(e*L),B((C-t)*L),B(n*L),B(-r*L),"re",s].join(" ")),this},_.triangle=function(e,t,n,r,i,s,o){return this.lines([[n-e,r-t],[i-n,s-r],[e-i,t-s]],e,t,[1,1],o),this},_.roundedRect=function(e,t,n,r,i,s,o){var u=4/3*(Math.SQRT2-1);return this.lines([[n-2*i,0],[i*u,0,i,s-s*u,i,s],[0,r-2*s],[0,s*u,-(i*u),s,-i,s],[-n+2*i,0],[-(i*u),0,-i,-(s*u),-i,-s],[0,-r+2*s],[0,-(s*u),i*u,-s,i,-s]],e+i,t,[1,1],o),this},_.ellipse=function(e,t,n,r,i){var s=ht(i),o=4/3*(Math.SQRT2-1)*n,u=4/3*(Math.SQRT2-1)*r;return q([B((e+n)*L),B((C-t)*L),"m",B((e+n)*L),B((C-(t-u))*L),B((e+o)*L),B((C-(t-r))*L),B(e*L),B((C-(t-r))*L),"c"].join(" ")),q([B((e-o)*L),B((C-(t-r))*L),B((e-n)*L),B((C-(t-u))*L),B((e-n)*L),B((C-t)*L),"c"].join(" ")),q([B((e-n)*L),B((C-(t+u))*L),B((e-o)*L),B((C-(t+r))*L),B(e*L),B((C-(t+r))*L),"c"].join(" ")),q([B((e+o)*L),B((C-(t+r))*L),B((e+n)*L),B((C-(t+u))*L),B((e+n)*L),B((C-t)*L),"c",s].join(" ")),this},_.circle=function(e,t,n,r){return this.ellipse(e,t,n,n,r)},_.setProperties=function(e){var t;for(t in A)A.hasOwnProperty(t)&&e[t]&&(A[t]=e[t]);return this},_.setFontSize=function(e){return x=e,this},_.setFont=function(e,t){return T=lt(e,t),this},_.setFontStyle=_.setFontType=function(e){var t;return T=lt(t,e),this},_.getFontList=function(){var e={},t,n,r;for(t in S)if(S.hasOwnProperty(t)){e[t]=r=[];for(n in S[t])S[t].hasOwnProperty(n)&&r.push(n)}return e},_.setLineWidth=function(e){return q((e*L).toFixed(2)+" w"),this},_.setDrawColor=function(e,t,n,r){var i;return t===undefined||r===undefined&&e===t===n?typeof e=="string"?i=e+" G":i=B(e/255)+" G":r===undefined?typeof e=="string"?i=[e,t,n,"RG"].join(" "):i=[B(e/255),B(t/255),B(n/255),"RG"].join(" "):typeof e=="string"?i=[e,t,n,r,"K"].join(" "):i=[B(e),B(t),B(n),B(r),"K"].join(" "),q(i),this},_.setFillColor=function(e,t,n,r){var i;return t===undefined||r===undefined&&e===t===n?typeof e=="string"?i=e+" g":i=B(e/255)+" g":r===undefined?typeof e=="string"?i=[e,t,n,"rg"].join(" "):i=[B(e/255),B(t/255),B(n/255),"rg"].join(" "):typeof e=="string"?i=[e,t,n,r,"k"].join(" "):i=[B(e),B(t),B(n),B(r),"k"].join(" "),q(i),this},_.setTextColor=function(e,t,n){return e===0&&t===0&&n===0||typeof t=="undefined"?d=j(e/255)+" g":d=[j(e/255),j(t/255),j(n/255),"rg"].join(" "),this},_.CapJoinStyles={0:0,butt:0,but:0,bevel:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,milter:2},_.setLineCap=function(e){var t=this.CapJoinStyles[e];if(t===undefined)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return O=t,q(t.toString(10)+" J"),this},_.setLineJoin=function(e){var t=this.CapJoinStyles[e];if(t===undefined)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return M=t,q(t.toString(10)+" j"),this},_.output=pt,_.save=function(e){_.output("save",e)};for(H in n.API)n.API.hasOwnProperty(H)&&(H==="events"&&n.API.events.length?function(e,t){var n,r,i;for(i=t.length-1;i!==-1;i--)n=t[i][0],r=t[i][1],e.subscribe.apply(e,[n].concat(typeof r=="function"?[r]:r))}(D,n.API.events):_[H]=n.API[H]);return nt(),T="F1",ft(),D.publish("initialized"),_}typeof btoa=="undefined"&&(window.btoa=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=t.split(""),r,i,s,o,u,a,f,l,c=0,h=0,p="",d=[],v;do r=e.charCodeAt(c++),i=e.charCodeAt(c++),s=e.charCodeAt(c++),l=r<<16|i<<8|s,o=l>>18&63,u=l>>12&63,a=l>>6&63,f=l&63,d[h++]=n[o]+n[u]+n[a]+n[f];while(c<e.length);return p=d.join(""),v=e.length%3,(v?p.slice(0,v-3):p)+"===".slice(v||3)}),typeof atob=="undefined"&&(window.atob=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;e+="";do s=t.indexOf(e.charAt(l++)),o=t.indexOf(e.charAt(l++)),u=t.indexOf(e.charAt(l++)),a=t.indexOf(e.charAt(l++)),f=s<<18|o<<12|u<<6|a,n=f>>16&255,r=f>>8&255,i=f&255,u===64?p[c++]=String.fromCharCode(n):a===64?p[c++]=String.fromCharCode(n,r):p[c++]=String.fromCharCode(n,r,i);while(l<e.length);return h=p.join(""),h});var e=typeof Object.keys=="function"?function(e){return Object.keys(e).length}:function(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t},t=function(e){this.topics={},this.context=e,this.publish=function(e,t){if(this.topics[e]){var n=this.topics[e],r=[],i,s,o,u,a=function(){};t=Array.prototype.slice.call(arguments,1);for(s=0,o=n.length;s<o;s++)u=n[s],i=u[0],u[1]&&(u[0]=a,r.push(s)),i.apply(this.context,t);for(s=0,o=r.length;s<o;s++)n.splice(r[s],1)}},this.subscribe=function(e,t,n){return this.topics[e]?this.topics[e].push([t,n]):this.topics[e]=[[t,n]],{topic:e,callback:t}},this.unsubscribe=function(e){if(this.topics[e.topic]){var t=this.topics[e.topic],n,r;for(n=0,r=t.length;n<r;n++)t[n][0]===e.callback&&t.splice(n,1)}}};return n.API={events:[]},n}();define("jspdf",function(e){return function(){var t,n;return t||e.jsPDF}}(this)),define("utils/typewriter",["require","jspdf","utils/helper"],function(e){var t=e("jspdf"),n=e("utils/helper"),r={},i=function(e){return e.substr(1).match(/([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/).slice(1).map(function(e){return parseInt(e,16)})};return r.get_pdf=function(e,r){var s=e.title_page,o=e.lines,u=new t("p","in",r.print().paper_size||"a4");u.setFont("courier").setFontSize(12);var a=function(e,t){var n=(r.print().page_width-e.length*r.print().font_width)/2;u.text(n,t,e)},f=function(e){for(var t=0;t<s.length;t++)if(s[t].type===e)return s[t]};e.title_page.forEach(function(e){e.text=e.text.replace(/\*/g,"").replace(/_/g,"")});var l=r.print().title_page.top_start,c=function(){l+=r.print().line_spacing*r.print().font_height},h=function(e,t){t=t||{};if(e===undefined){c();return}var n=f(e);n&&n.text.split("\n").forEach(function(e){t.capitalize&&(e=e.toUpperCase()),a(e,l),c()})};if(r.print_title_page){h("title",{capitalize:!0}),h(),h(),h("credit"),h(),h("author"),h(),h(),h(),h(),h("source");var p=f("draft date");u.text(r.print().title_page.draft_date.x,r.print().title_page.draft_date.y,p?p.text.trim():"");var d=f("contact");u.text(r.print().title_page.contact.x,r.print().title_page.contact.y,d?d.text.trim():"");var v="",m=f("notes"),g=f("copyright");v=m?m.text.trim()+"\n":"",v+=g?g.text.trim():"",u.text(r.print().title_page.notes.x,r.print().title_page.notes.y,v);var y=f("date");u.text(r.print().title_page.date.x,r.print().title_page.date.y,y?y.text.trim():""),u.addPage()}var b=1,w=1,E=0,S=n.version_generator(),x;return o.forEach(function(e){if(e.type=="page_break"){b=1,u.addPage(),w++;if(r.show_page_numbers){var t=w.toFixed()+".";u.text(r.print().action.feed+r.print().action.max*r.print().font_width-t.length*r.print().font_width,r.print().page_number_top_margin,t)}}else{x=e.text.replace(/\*/g,"").replace(/_/g,""),x=x.trim();var n=r.print()[e.type]&&r.print()[e.type].color||"#000000";u.setTextColor.apply(u,i(n));if(e.type==="centered")a(x,r.print().top_margin+r.print().font_height*b++);else{var s=(r.print()[e.type]||{}).feed||r.print().action.feed;e.type=="transition"&&(s=r.print().action.feed+r.print().action.max*.1-e.text.length*.1),e.type=="scene_heading"&&r.embolden_scene_headers?u.setFontType("bold"):u.setFontType("normal"),e.type==="section"?(E=e.token.level,s+=E*r.print().section.level_indent,r.number_sections&&(x=S(e.token.level)+". "+x)):e.type==="synopsis"&&(s+=r.print().synopsis.padding||0,r.print().synopsis.feed_with_last_section&&(s+=E*r.print().section.level_indent)),r.print()[e.type]&&r.print()[e.type].italic&&u.setFontType("italic");if(e.token&&e.token.dual){if(e.right_column){var o=b;e.right_column.forEach(function(e){var t=(r.print()[e.type]||{}).feed||r.print().action.feed,n=e.text.replace(/\*/g,"").replace(/_/g,"");t-=(t-r.print().left_margin)/2,t+=(r.print().page_width-r.print().right_margin-r.print().left_margin)/2,u.text(t,r.print().top_margin+r.print().font_height*o++,n)})}s-=(s-r.print().left_margin)/2}u.text(s,r.print().top_margin+r.print().font_height*b++,x),u.setTextColor(0),u.setFontType("normal")}}}),u},r}),define("plugins/preview",["require","utils/pluginmanager","utils/typewriter","modules/data"],function(e){var t=e("utils/pluginmanager"),n=e("utils/typewriter"),r=e("modules/data"),i=t.create_plugin("preview","view");return i.get_pdf=function(){return n.get_pdf(r.parsed,r.config)},i.activate=function(){var e=i.get_pdf();i.data.pdf=e},i}),define("plugins/save",["require","utils/pluginmanager","saveAs","plugins/preview","dropbox","modules/data"],function(e){var t=e("utils/pluginmanager"),n=e("saveAs"),r=e("plugins/preview"),i=e("dropbox"),s=e("modules/data"),o=t.create_plugin("save","save");return o.data={filename:"screenplay"},o.save_as_fountain=function(){var e=new Blob([s.script()],{type:"text/plain;charset=utf-8"});n(e,o.data.filename+".fountain")},o.save_as_pdf=function(){r.get_pdf().output("save",o.data.filename+".pdf")},o.dropbox_fountain=function(){var e=window.btoa(s.script()),t="data:text/plain;base64,"+e;i.save(t,o.data.filename+".fountain")},o.dropbox_pdf=function(){var e=r.get_pdf().output("datauristring");i.save(e,o.data.filename+".pdf")},o.is_dropbox_available=function(){return i.isBrowserSupported()&&window.location.protocol!=="file:"},o.activate=function(){o.data.filename="screenplay";var e=s.get_title_page_token("title");e&&(o.data.filename=e.text.replace(/[^a-zA-Z0-9]/g," ").split("\n").join(" ").replace(/\s+/g," ").trim())},o}),function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define("libs/codemirror/addon/selection/active-line",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function r(e){for(var r=0;r<e.state.activeLines.length;r++)e.removeLineClass(e.state.activeLines[r],"wrap",t),e.removeLineClass(e.state.activeLines[r],"background",n)}function i(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function s(e,s){var o=[];for(var u=0;u<s.length;u++){var a=s[u];if(!a.empty())continue;var f=e.getLineHandleVisualStart(a.head.line);o[o.length-1]!=f&&o.push(f)}if(i(e.state.activeLines,o))return;e.operation(function(){r(e);for(var i=0;i<o.length;i++)e.addLineClass(o[i],"wrap",t),e.addLineClass(o[i],"background",n);e.state.activeLines=o})}function o(e,t){s(e,t.ranges)}var t="CodeMirror-activeline",n="CodeMirror-activeline-background";e.defineOption("styleActiveLine",!1,function(t,n,i){var u=i&&i!=e.Init;n&&!u?(t.state.activeLines=[],s(t,t.listSelections()),t.on("beforeSelectionChange",o)):!n&&u&&(t.off("beforeSelectionChange",o),r(t),delete t.state.activeLines)})}),function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define("libs/codemirror/addon/hint/show-hint",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function r(e,t){this.cm=e,this.options=this.buildOptions(t),this.widget=this.onClose=null}function i(e){return typeof e=="string"?e:e.text}function s(e,t){function s(e,r){var s;typeof r!="string"?s=function(e){return r(e,t)}:n.hasOwnProperty(r)?s=n[r]:s=r,i[e]=s}var n={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(-t.menuSize()+1,!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Home:function(){t.setFocus(0)},End:function(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=e.options.customKeys,i=r?{}:n;if(r)for(var o in r)r.hasOwnProperty(o)&&s(o,r[o]);var u=e.options.extraKeys;if(u)for(var o in u)u.hasOwnProperty(o)&&s(o,u[o]);return i}function o(e,t){while(t&&t!=e){if(t.nodeName.toUpperCase()==="LI"&&t.parentNode==e)return t;t=t.parentNode}}function u(r,u){this.completion=r,this.data=u;var a=this,f=r.cm,l=this.hints=document.createElement("ul");l.className="CodeMirror-hints",this.selectedHint=u.selectedHint||0;var c=u.list;for(var h=0;h<c.length;++h){var p=l.appendChild(document.createElement("li")),d=c[h],v=t+(h!=this.selectedHint?"":" "+n);d.className!=null&&(v=d.className+" "+v),p.className=v,d.render?d.render(p,u,d):p.appendChild(document.createTextNode(d.displayText||i(d))),p.hintId=h}var m=f.cursorCoords(r.options.alignWithWord?u.from:null),g=m.left,y=m.bottom,b=!0;l.style.left=g+"px",l.style.top=y+"px";var w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),E=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(r.options.container||document.body).appendChild(l);var S=l.getBoundingClientRect(),x=S.bottom-E;if(x>0){var T=S.bottom-S.top,N=m.top-(m.bottom-S.top);if(N-T>0)l.style.top=(y=m.top-T)+"px",b=!1;else if(T>E){l.style.height=E-5+"px",l.style.top=(y=m.bottom-S.top)+"px";var C=f.getCursor();u.from.ch!=C.ch&&(m=f.cursorCoords(C),l.style.left=(g=m.left)+"px",S=l.getBoundingClientRect())}}var k=S.left-w;k>0&&(S.right-S.left>w&&(l.style.width=w-5+"px",k-=S.right-S.left-w),l.style.left=(g=m.left-k)+"px"),f.addKeyMap(this.keyMap=s(r,{moveFocus:function(e,t){a.changeActive(a.selectedHint+e,t)},setFocus:function(e){a.changeActive(e)},menuSize:function(){return a.screenAmount()},length:c.length,close:function(){r.close()},pick:function(){a.pick()},data:u}));if(r.options.closeOnUnfocus){var L;f.on("blur",this.onBlur=function(){L=setTimeout(function(){r.close()},100)}),f.on("focus",this.onFocus=function(){clearTimeout(L)})}var A=f.getScrollInfo();return f.on("scroll",this.onScroll=function(){var e=f.getScrollInfo(),t=f.getWrapperElement().getBoundingClientRect(),n=y+A.top-e.top,i=n-(window.pageYOffset||(document.documentElement||document.body).scrollTop);b||(i+=l.offsetHeight);if(i<=t.top||i>=t.bottom)return r.close();l.style.top=n+"px",l.style.left=g+A.left-e.left+"px"}),e.on(l,"dblclick",function(e){var t=o(l,e.target||e.srcElement);t&&t.hintId!=null&&(a.changeActive(t.hintId),a.pick())}),e.on(l,"click",function(e){var t=o(l,e.target||e.srcElement);t&&t.hintId!=null&&(a.changeActive(t.hintId),r.options.completeOnSingleClick&&a.pick())}),e.on(l,"mousedown",function(){setTimeout(function(){f.focus()},20)}),e.signal(u,"select",c[0],l.firstChild),!0}var t="CodeMirror-hint",n="CodeMirror-hint-active";e.showHint=function(e,t,n){if(!t)return e.showHint(n);n&&n.async&&(t.async=!0);var r={hint:t};if(n)for(var i in n)r[i]=n[i];return e.showHint(r)},e.defineExtension("showHint",function(t){if(this.listSelections().length>1||this.somethingSelected())return;this.state.completionActive&&this.state.completionActive.close();var n=this.state.completionActive=new r(this,t),i=n.options.hint;if(!i)return;e.signal(this,"startCompletion",this);if(!i.async)return n.showHints(i(this,n.options));i(this,function(e){n.showHints(e)},n.options)}),r.prototype={close:function(){if(!this.active())return;this.cm.state.completionActive=null,this.widget&&this.widget.close(),this.onClose&&this.onClose(),e.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(t,n){var r=t.list[n];r.hint?r.hint(this.cm,t,r):this.cm.replaceRange(i(r),r.from||t.from,r.to||t.to,"complete"),e.signal(t,"pick",r),this.close()},showHints:function(e){if(!e||!e.list.length||!this.active())return this.close();this.options.completeSingle&&e.list.length==1?this.pick(e,0):this.showWidget(e)},showWidget:function(t){function c(){if(i)return;i=!0,r.close(),r.cm.off("cursorActivity",v),t&&e.signal(t,"close")}function h(){if(i)return;e.signal(t,"update");var n=r.options.hint;n.async?n(r.cm,p,r.options):p(n(r.cm,r.options))}function p(e){t=e;if(i)return;if(!t||!t.list.length)return c();r.widget&&r.widget.close(),r.widget=new u(r,t)}function d(){n&&(l(n),n=0)}function v(){d();var e=r.cm.getCursor(),t=r.cm.getLine(e.line);e.line!=o.line||t.length-e.ch!=a-o.ch||e.ch<o.ch||r.cm.somethingSelected()||e.ch&&s.test(t.charAt(e.ch-1))?r.close():(n=f(h),r.widget&&r.widget.close())}this.widget=new u(this,t),e.signal(t,"shown");var n=0,r=this,i,s=this.options.closeCharacters,o=this.cm.getCursor(),a=this.cm.getLine(o.line).length,f=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},l=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",v),this.onClose=c},buildOptions:function(e){var t=this.cm.options.hintOptions,n={};for(var r in a)n[r]=a[r];if(t)for(var r in t)t[r]!==undefined&&(n[r]=t[r]);if(e)for(var r in e)e[r]!==undefined&&(n[r]=e[r]);return n}},u.prototype={close:function(){if(this.completion.widget!=this)return;this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(t,r){t>=this.data.list.length?t=r?this.data.list.length-1:0:t<0&&(t=r?0:this.data.list.length-1);if(this.selectedHint==t)return;var i=this.hints.childNodes[this.selectedHint];i.className=i.className.replace(" "+n,""),i=this.hints.childNodes[this.selectedHint=t],i.className+=" "+n,i.offsetTop<this.hints.scrollTop?this.hints.scrollTop=i.offsetTop-3:i.offsetTop+i.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=i.offsetTop+i.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],i)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",function(t,n){var r=t.getHelpers(t.getCursor(),"hint"),i;if(r.length)for(var s=0;s<r.length;s++){var o=r[s](t,n);if(o&&o.list.length)return o}else if(i=t.getHelper(t.getCursor(),"hintWords")){if(i)return e.hint.fromList(t,{words:i})}else if(e.hint.anyword)return e.hint.anyword(t,n)}),e.registerHelper("hint","fromList",function(t,n){var r=t.getCursor(),i=t.getTokenAt(r),s=[];for(var o=0;o<n.words.length;o++){var u=n.words[o];u.slice(0,i.string.length)==i.string&&s.push(u)}if(s.length)return{list:s,from:e.Pos(r.line,i.start),to:e.Pos(r.line,i.end)}}),e.commands.autocomplete=e.showHint;var a={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)}),function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define("libs/codemirror/addon/hint/anyword-hint",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){var t=/[\w$]+/,n=500;e.registerHelper("hint","anyword",function(r,i){var s=i&&i.word||t,o=i&&i.range||n,u=r.getCursor(),a=r.getLine(u.line),f=u.ch,l=f;while(l<a.length&&s.test(a.charAt(l)))++l;while(f&&s.test(a.charAt(f-1)))--f;var c=f!=l&&a.slice(f,l),h=[],p={},d=new RegExp(s.source,"g");for(var v=-1;v<=1;v+=2){var m=u.line,g=Math.min(Math.max(m+v*o,r.firstLine()),r.lastLine())+v;for(;m!=g;m+=v){var y=r.getLine(m),b;while(b=d.exec(y)){if(m==u.line&&b[0]===c)continue;(!c||b[0].lastIndexOf(c,0)==0)&&!Object.prototype.hasOwnProperty.call(p,b[0])&&(p[b[0]]=!0,h.push(b[0]))}}}return{list:h,from:e.Pos(u.line,f),to:e.Pos(u.line,l)}})}),define("utils/fountain/cmmode",["require","libs/codemirror/lib/codemirror"],function(e){var t=e("libs/codemirror/lib/codemirror");t.defineMode("fountain",function(){var e,t={tokenizer:function(e){return e.match(/^((INT.\/.EXT\.)|(I\/E)|(INT\.)|(EXT\.)).*$/,!0)?"scene-header":(e.next(),null)}};return{startState:function(){return{tokenize:t.tokenizer,mode:"fountain",last:null,depth:0}},token:function(t,n){var r=n.tokenize(t,n);return n.last=e,r},electricChars:""}}),t.defineMIME("text/fountain","fountain")}),define("plugins/editor",["require","utils/pluginmanager","modules/data","libs/codemirror/lib/codemirror","libs/codemirror/addon/selection/active-line","libs/codemirror/addon/hint/show-hint","libs/codemirror/addon/hint/anyword-hint","utils/fountain/cmmode"],function(e){var t=e("utils/pluginmanager"),n=e("modules/data"),r=e("libs/codemirror/lib/codemirror");e("libs/codemirror/addon/selection/active-line"),e("libs/codemirror/addon/hint/show-hint"),e("libs/codemirror/addon/hint/anyword-hint"),e("utils/fountain/cmmode");var i=t.create_plugin("editor","edit"),s;i.data={},i.create_editor=function(e){s=r.fromTextArea(e,{mode:"fountain",lineNumbers:!1,lineWrapping:!0,styleActiveLine:!0,extraKeys:{"Ctrl-Space":"autocomplete"}}),s.on("change",function(){n.script(s.getValue())})},i.set_size=function(e,t){s.setSize(e,t),s.refresh()};var o=function(){i.data.cursor=s.getCursor(),i.data.scroll_info=s.getScrollInfo()};return i.goto=function(e){i.data.cursor={ch:0,line:e,xRel:0},i.data.scroll_info=null,t.switch_to(i)},i.activate=function(){setTimeout(function(){s.setValue(n.script()||""),s.focus(),s.refresh(),i.data.cursor&&s.setCursor(i.data.cursor);if(i.data.scroll_info)s.scrollTo(i.data.scroll_info.left,i.data.scroll_info.top);else if(i.data.cursor){var e=s.getScrollInfo();e.top>0&&s.scrollTo(0,e.top+e.clientHeight-s.defaultTextHeight()*2)}},300)},i.deactivate=function(){o()},i}),define("utils/fountain/query",[],function(){var e=function(e,t,n){var r={flat:!e,key_name:e||"___",base:t,processors:[],result:[],config:n||{},lock:!1};return r.not=function(e){return function(t){return!e(t)}},r.prepare=function(e){return r.prepare_handler=e,r},r.enter=function(e,t){var n={condition:e,action:t};return r.processors.push(n),r},r.exit=function(e){return r.exit_handler=e,r},r.end=function(e){return r.end_handler=e,r},r.select=function(e){var n;for(var i=0;i<r.result.length;i++)r.result[i][r.key_name]===e&&(n=r.result[i]);if(n===undefined){var s={};s[r.key_name]=e;for(var o in t)s[o]=t[o];return r.result.push(s),r.last_selection=s,s}return r.last_selection=n,n},r.count=function(e,t,n,i){return r.enter(t,function(t,s){var o=s.select(n);o.hasOwnProperty(e)||(o[e]=0),o[e]++,i&&(r.lock=!0)}),r},r.run=function(e,t){var n=t||r.config;r.index=-1,r.source=e,r.result=[],r.last_selection=undefined,r.prepare_handler&&r.prepare_handler(r),e.forEach(function(e){r.index++,r.processors.forEach(function(t){!r.lock&&(t.condition===!0||t.condition(e))&&t.action(e,r)}),r.lock=!1});if(n.sort_by){var i=n.sort_by;r.result.sort(function(e,t){return n.asc?e[i]-t[i]:t[i]-e[i]})}return r.exit_handler&&r.result.forEach(function(e){r.exit_handler(e,r)}),r.end_handler&&r.end_handler(r.result,r),r.flat&&r.result.length?r.result[0]:r.result},r};return e}),define("modules/queries",["require","utils/helper","modules/data","utils/fountain/query","utils/fountain/helpers"],function(e){var t=e("utils/helper"),n=e("modules/data"),r=e("utils/fountain/query"),i=e("utils/fountain/helpers"),s=i.fq,o={},u=function(){var e=r("label",{value:0});return e.prepare(function(e){e.recognized_scenes=0}),e.count("value",s.has_scene_time("DAY"),"DAY",!0).count("value",s.has_scene_time("NIGHT"),"NIGHT",!0).count("value",s.has_scene_time("DUSK"),"DUSK",!0).count("value",s.has_scene_time("DAWN"),"DAWN",!0),e.enter(s.is("scene_heading"),function(e,t){n.config.stats_keep_last_scene_time&&t.last_selection&&t.last_selection.value++}),e.exit(function(e,t){t.recognized_scenes+=e.value}),e.end(function(e,t){var n=r().count("scenes",s.is("scene_heading")).run(t.source).scenes;e.push({label:"OTHER",value:n-t.recognized_scenes})}),e},a=function(){var e=r("token",{length:0});return e.prepare(function(e){e.current_header=undefined}),e.enter(s.is("scene_heading"),function(e,t){t.current_header=t.select(e),t.current_header.header=e.text}),e.enter(!0,function(e,t){t.current_header&&(t.current_header.length+=e.lines.length,t.current_header.token.has_scene_time("DAY")?t.current_header.type="day":t.current_header.token.has_scene_time("NIGHT")?t.current_header.type="night":t.current_header.type=t.last_header_type||"other",t.last_header_type=n.config.stats_keep_last_scene_time?t.current_header.type:undefined)}),e},f=function(){var e=r(null,{last_page_lines:0,scenes:0,pages:0,action_lines:0,dialogue_lines:0});return e.count("action_lines",s.is("action","scene_heading")),e.count("dialogue_lines",s.is_dialogue()),e.count("pages",s.is("page_break")),e.enter(s.is("scene_heading"),function(e,t){t.select().scenes++}),e.enter(!0,function(e,t){var n=t.select();e.is("page_break")?n.last_page_lines=0:n.last_page_lines++}),e.exit(function(e){var t=e.action_lines+e.dialogue_lines;e.pages=e.pages+e.last_page_lines/n.config.print().lines_per_page,e.action_time=e.action_lines/t*e.pages,e.dialogue_time=e.dialogue_lines/t*e.pages}),e.end(function(e){e.length===0&&e.push({pages:0,scenes:0,action_time:0,dialogue_time:0,characters:[],locations:[]})}),e},l=function(){var e={};return e.run=function(e,t,n){var i=r("name",{nof_scenes:0,lines:0});return i.enter(s.is("scene_heading"),function(e,t){t.current_scene=e}),i.enter(s.is("character"),function(e,t){var n=t.select(e.name());t.current_character=n,n.scenes=n.scenes||[],n.scenes.indexOf(t.current_scene)===-1&&n.scenes.push(t.current_scene),n.nof_scenes=n.scenes.length}),i.enter(s.is_dialogue(),function(e,t){t.current_character.lines+=e.lines.length}),i.exit(function(e){e.time=e.lines/t.dialogue_lines*t.dialogue_time}),i.run(e,n)},e},c=function(){var e=r("name",{count:0},{sort_by:"count"});return e.enter(s.is("scene_heading"),function(e,t){t.select(e.location()).count++}),e},h=function(){var e={};return e.run=function(e,n,i){i=i||10;var u=o.characters.run(e,n,{sort_by:"nof_scenes"}).splice(0,i);u.sort(function(e,t){return e.name>t.name?1:-1});var a={};u.forEach(function(e,t){a[e.name]=t});var f=r("scene");f.enter(s.is("scene_heading"),function(e,t){t.current_scene=e}),f.enter(s.is("character"),function(e,t){var n=t.select(t.current_scene);n.characters=n.characters||[],n.characters.indexOf(e.name())===-1&&a[e.name()]!==undefined&&n.characters.push(e.name())});var l=f.run(e),c=r("link_id",{scenes:0});c.enter(!0,function(e,n){var r=t.pairs(e.characters);r.each(function(e,r){e=a[e],r=a[r];var i=n.select(t.double_id(e,r));i.from=e,i.to=r,i.scenes++})});var h={characters:u,links:c.run(l)};return h},e},p=function(){var e=r("page_number",{action_lines:0,dialogue_lines:0,total_lines:0,first_line:null});return e.prepare(function(e){e.current_page=1}),e.enter(s.is("page_break"),function(e,t){t.current_page++}),e.enter(e.not(s.is("page_break")),function(e,t){var n=t.select(t.current_page);n.first_line=n.first_line||e}),e.enter(s.is("scene_heading","action"),function(e,t){var n=t.select(t.current_page);n.action_lines++,n.total_lines++}),e.enter(s.is_dialogue(),function(e,t){var n=t.select(t.current_page);n.dialogue_lines++,n.total_lines++}),e.exit(function(e){e.dialogue_time=e.dialogue_lines/e.total_lines,e.action_time=e.action_lines/e.total_lines}),e},d=function(){var e={};return e.run=function(e){var t=r("scene_number");t.prepare(function(e){e.current_scene_number=0,e.current_scene=null,e.total_lines=0}),t.enter(s.is("scene_heading"),function(e,t){t.current_scene_number++,t.current_scene=e;var n=t.select(t.current_scene_number);n.blocks=[],n.lines=0,n.scene_heading=e.text}),t.enter(s.is("action","dialogue"),function(e,t){if(t.current_scene_number){var n=t.select(t.current_scene_number),r=e.lines.length;n.blocks.push({token:e,lines:r}),n.lines+=r,t.total_lines+=r}}),t.exit(function(e){e.avg_lines_per_block=e.lines/e.blocks.length,e.blocks.forEach(function(t){t.line_tempo_change=(e.avg_lines_per_block-t.lines)/t.lines})}),t.end(function(e,t){e=e.filter(function(e){return e.lines>0}),t.avg_lines_per_scene=t.total_lines/e.length,e.forEach(function(e){e.line_tempo_change=(t.avg_lines_per_scene-e.lines)/e.lines})});var n=t.run(e),i=n.length/10,o=[{line:"",scene:"",tempo:0}],u=0,a=-Infinity,f=Infinity;return n.forEach(function(e){e.blocks.forEach(function(t){u*=.9,t.token.lines.forEach(function(n){u*=.9,u+=i*e.line_tempo_change+t.line_tempo_change,o.push({scene:e.scene_heading,line:n.text,line_no:n.token.line,tempo:parseFloat(u.toFixed(2))}),u<f&&(f=u),u>a&&(a=u)})})}),o.push({line:"",scene:"",tempo:0}),o},e};return o.windup=function(){o.days_and_nights=u(),o.scene_length=a(),o.characters=l(),o.locations=c(),o.dialogue_breakdown=h(),o.basics=f(),o.page_balance=p(),o.tempo=d()},o}),define("plugins/facts",["require","utils/pluginmanager","modules/data","modules/queries","utils/fountain/helpers"],function(e){var t=e("utils/pluginmanager"),n=e("modules/data"),r=e("modules/queries"),i=e("utils/fountain/helpers"),s=t.create_plugin("facts","facts"),o=function(){var e=r.basics.run(n.parsed.lines);s.data.facts=e;var t=s.data.facts;t.title=i.first_text("title",n.parsed.title_page,""),t.characters=r.characters.run(n.parsed.tokens,e,{sort_by:"lines"}),t.locations=r.locations.run(n.parsed.tokens)};return s.activate=function(){o()},s}),define("plugins/stats",["require","utils/pluginmanager","logger","plugins/editor","modules/data","modules/queries"],function(e){var t=e("utils/pluginmanager"),n=e("logger"),r=e("plugins/editor"),i=e("modules/data"),s=e("modules/queries"),o=n.get("stats"),u=t.create_plugin("stats","stats");return u.goto=function(e){r.goto(e)},u.activate=function(){u.data.days_and_nights=s.days_and_nights.run(i.parsed.tokens),u.data.scenes=s.scene_length.run(i.parsed.tokens);var e=s.basics.run(i.parsed.lines);u.data.who_with_who=s.dialogue_breakdown.run(i.parsed.tokens,e,i.config.stats_who_with_who_max),u.data.page_balance=s.page_balance.run(i.parsed.lines),u.data.tempo=s.tempo.run(i.parsed.tokens)},u.deactivate=function(){o.info("stats:deactivate")},u}),define("plugins/settings",["require","utils/pluginmanager","modules/data","utils/layout","plugins/open"],function(e){var t=e("utils/pluginmanager"),n=e("modules/data"),r=e("utils/layout"),i=e("plugins/open"),s=t.create_plugin("settings","setup");return s.get_config=function(){return n.config},s.save=function(){n.save_config(),n.script(n.script())},s.get_default_config=function(){return n.default_config},s.reset=function(){n.reset_config(),n.script(n.script())},s.windup=function(){n.config.load_last_opened&&(i.open_last_used(!0),r.show_main())},s}),define("modules/monitor",["require","logger","plugins/open","plugins/save","plugins/editor","plugins/preview","plugins/facts","plugins/stats","plugins/settings"],function(e){var t=e("logger"),n=e("plugins/open"),r=e("plugins/save"),i=e("plugins/editor"),s=e("plugins/preview"),o=e("plugins/facts"),u=e("plugins/stats"),a=e("plugins/settings"),f={},l=t.get("monitor"),c=function(e,t,n){l.info("Event sent",e,t,n||""),ga("send","event",e,t,n)},h=function(e,t,n){return function(){c(e,t,n)}};return f.windup=function(){n.activate.add(h("navigation","open")),r.activate.add(h("navigation","save")),i.activate.add(h("navigation","edit")),s.activate.add(h("navigation","preview")),o.activate.add(h("navigation","facts")),u.activate.add(h("navigation","stats")),a.activate.add(h("navigation","settings")),n.open_sample.add(function(e,t){c("feature","open-sample",t[0])}),n.create_new.add(h("feature","open-new")),n.open_file_dialog.add(h("feature","open-file-dialog")),n.open_file.add(h("feature","open-file-opened")),n.open_from_dropbox.add(h("feature","open-dropbox")),n.open_last_used.add(function(e){c("feature","open-last-used",e?"startup":"manual")}),r.save_as_fountain.add(h("feature","save-fountain")),r.save_as_pdf.add(h("feature","save-pdf")),r.dropbox_fountain.add(h("feature","save-fountain-dropbox")),r.dropbox_pdf.add(h("feature","save-pdf-dropbox")),u.goto.add(h("feature","stats-scene-length-goto")),a.save.add(h("feature","settings-save")),a.save.add(function(){var e=a.get_config();c("settings","page-size-set",e.print().paper_size)}),a.reset.add(h("feature","settings-reset"))},f}),define("utils/charts/spider",["require","d3","jquery"],function(e){var t=e("d3"),n=e("jquery"),r={};return r.render=function(e,r,i,s){n(e).empty();if(r.length<=1){n(e).append('<p class="error">Sorry, there is not enough data to display the chart. Add at least two speaking characters to your script.</p>');return}var o=Math.max.apply(null,r.map(function(e){return e[s.label].length})),u=7.2*o,a=Math.max.apply(null,i.map(function(e){return e.scenes})),f=t.scale.linear().domain([1,a]).range([1,Math.min(a,6)]);i.forEach(function(e){e.value=f(e.scenes)});var l=350+u*2,c=300,h=t.select(e).append("svg").attr("width",Math.min(l,n(".plugin-contents").width()-40)).attr("viewBox","0 0 "+l.toString()+" "+c.toString()),p=12,d=250,v="translate("+(d/2+u+p+2)+","+(d/2+p)+")",m=t.svg.arc().outerRadius(d).innerRadius(0),g=t.layout.pie().value(function(){return 1}),y=g(r).map(function(e){return m.centroid(e)});h.selectAll("g").data(i).enter().append("path").attr("fill","none").attr("stroke","#444444").attr("stroke-width",function(e){return e.value}).attr("d",function(e){return t.svg.line().interpolate("bundle")([y[e.from],[0,0],y[e.to]])}).attr("transform",v).attr("class",function(e){return"who-"+e.from+" who-"+e.to}),h.selectAll("g").data(r).enter().append("text").attr("transform",v).text(function(e){return e[s.label]}).attr("class",function(e,t){return"who-"+t}).attr("font-size",12).attr("font-family","Courier New").attr("x",function(e,t){return y[t][0]>0?y[t][0]+p+2:y[t][0]-p-2-e[s.label].length*7.2}).attr("y",function(e,t){return y[t][1]+3}),h.selectAll("g").data(y).enter().append("circle").attr("transform",v).attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}).attr("class",function(e,t){return"who-"+t}).attr("r",p).attr("fill","#222222").on("mouseover",function(e,t){var n,r=h.selectAll("path.who-"+t);r.size()?n=r[0].reduce(function(e,t){return e.concat(t.getAttribute("class").split(" "))},[]).map(function(e){return"circle."+e+",text."+e}).join(","):n=".who-"+t,h.selectAll("*").transition().style("opacity",.1),r.transition().style("opacity",1),h.selectAll(n).transition().style("opacity",1);var s;for(var o=0;o<i.length;o++){if(i[o].from==t)s=i[o].to;else{if(i[o].to!=t)continue;s=i[o].from}var u=i[o].scenes.toString();h.append("text").text(u).attr("font-size",12).attr("class","temp-number").attr("font-family","Courier New").attr("transform",v).attr("fill","#ffffff").attr("x",y[s][0]-u.length*3).attr("y",y[s][1]+3)}}).on("mouseout",function(){h.selectAll("*").transition().style("opacity","1.0"),h.selectAll(".temp-number").remove()})},r}),define("utils/charts/bar",["require","d3","jquery","utils/layout"],function(e){var t=e("d3"),n=e("jquery"),r=e("utils/layout"),i={};return i.render=function(e,i,s){n(e).empty();if(i.length<1){n(e).append('<p class="error">Sorry, there is not enough data to display the chart. Add at least one scene to your script.</p>');return}var o=0;i.forEach(function(e){e[s.value]>o&&(o=e[s.value])}),i.forEach(function(e){e.value=e.length/(o*1.1)});var u=n(".content").width()-(r.small?30:100),a=u/i.length,f=t.select(e).append("svg:svg").attr("width","100%").attr("height","200");n(e+" svg").attr("viewBox","0 0 200px "+u+"px");var l=f.selectAll("g").data(i).enter().append("rect");l.attr("width",a).attr("height",function(e){return e.value*200}).attr("y",function(e){return 200-e.value*200}).attr("x",function(e,t){return t*a}).attr("fill",s.color).attr("stroke","#000000").style("cursor","pointer").on("click",function(e){s.bar_click&&s.bar_click(e)}).on("mouseover",function(e){r.show_tooltip(s.tooltip(e))}).on("mousemove",function(){r.move_tooltip(t.event.pageX,t.event.pageY)}).on("mouseout",function(){r.hide_tooltip()}),f.append("svg:path").attr("d","M 0 0 L 0 200").attr("stroke","#000000"),f.append("svg:path").attr("d","M 0 200 L 600 200").attr("stroke","#000000")},i}),define("utils/charts/pie",["require","d3","jquery","utils/layout"],function(e){var t=e("d3"),n=e("jquery"),r=e("utils/layout"),i={};return i.render=function(e,i,s){n(e).empty();var o=i.reduce(function(e,t){return e+t[s.value]},0);if(o===0||isNaN(o)){n(e).append('<p class="error">Sorry, there is not enough data to display the chart. Add at least one scene to your script.</p>');return}var u=t.select(e).append("svg:svg").data([i]).attr("width",200).attr("height",200).style("margin-left","auto").style("margin-right","auto").append("svg:g").attr("transform","translate(100,100)"),a=t.svg.arc().outerRadius(100),f=t.layout.pie().value(function(e){return e[s.value]}),l=u.selectAll("g").data(f).enter().append("svg:g");l.append("svg:path").attr("fill",function(e){return s.color(e)}).attr("d",a).on("mouseover",function(e){r.show_tooltip(s.tooltip(e))}).on("mousemove",function(){r.move_tooltip(t.event.pageX,t.event.pageY)}).on("mouseout",function(){r.hide_tooltip()}),u.append("svg:circle").attr("fill","none").attr("stroke","#000000").attr("stroke-width","1").attr("cx","0").attr("cy","0").attr("r","100")},i}),define("utils/charts/page_balance",["require","d3","jquery","utils/layout","utils/helper"],function(e){var t=e("d3"),n=e("jquery"),r=e("utils/layout"),i=e("utils/helper"),s={},o=25,u=30;return s.render=function(e,s,a){n(e).empty();if(s.length<1){n(e).append('<p class="error">Sorry, there is not enough data to display the chart. Add at least one scene to your script.</p>');return}var f=t.select(e),l=f.selectAll("svg").data(s).enter().append("svg").attr("width",o).attr("height",u).style("margin",5).on("mouseover",function(e){var t=i.format_time(e.action_time),n=i.format_time(e.dialogue_time),s=' (<div style="width:10px;height:8px;background-color:#eeeeee;display:inline-block"></div>)',o=' (<div style="width:10px;height:8px;background-color:#777777;display:inline-block"></div>)';r.show_tooltip("Page #"+e.page_number+"<br />Action: "+t+s+"<br />Dialogue: "+n+o)}).style("cursor","pointer").on("mousemove",function(){r.move_tooltip(t.event.pageX,t.event.pageY)}).on("mouseout",function(){r.hide_tooltip()}).on("click",function(e){a.page_click&&a.page_click(e)});l.append("rect").attr("x",0).attr("y",0).attr("width",o).attr("height",function(e){return e.action_time*u}).attr("stroke","none").attr("fill","#eeeeee"),l.append("rect").attr("x",0).attr("y",function(e){return e.action_time*u}).attr("width",o).attr("height",function(e){return e.dialogue_time*u}).attr("stroke","none").attr("fill","#777777"),l.append("rect").attr("x",0).attr("y",0).attr("width",o).attr("height",u).attr("stroke","#000000").attr("fill","none"),n(e).append(n('<div style="clear:both" />'))},s}),define("utils/charts/line",["require","d3","jquery","utils/layout"],function(e){var t=e("d3"),n=e("jquery"),r=e("utils/layout"),i={};return i.render=function(e,i,s){n(e).empty();if(i.length<1){n(e).append('<p class="error">Sorry, there is not enough data to display the chart. Add at least one scene to your script.</p>');return}var o=Infinity,u=-Infinity;i.forEach(function(e){var t=e[s.value];t<o&&(o=t),t>u&&(u=t)});var a=n(".content").width()-(r.small?30:100),f=100,l=5,c=t.scale.linear().domain([o,u]).range([f-l,l]),h=t.scale.linear().domain([0,i.length-1]).range([0,a]),p=t.svg.line().x(function(e,t){return h(t)}).y(function(e){return c(e[s.value])}).interpolate("basis"),d=t.select(e).append("svg:svg").attr("width","100%").attr("height",f);n(e+" svg").attr("viewBox","0 0 "+a+"px "+f+"px"),d.append("path").attr("d","M 0 "+c(0)+" l "+a+" 0").attr("fill","none").attr("stroke","#777777"),d.append("path").attr("d",p(i)).attr("fill","none").attr("stroke","#111111"),d.append("rect").attr("width",a).attr("height",f).attr("stroke","#111111").attr("fill","none");var v=a/i.length,m=v/2,g=d.append("g"),y=function(e,t){g.append("path").attr("class","linetip").attr("fill","none").attr("stroke","#777777").attr("d","M "+(h(t)+m)+" 0 l 0 "+f)},b=function(){g.selectAll(".linetip").remove()};d.selectAll("rect").data(i).enter().append("rect").attr("fill-opacity",0).attr("width",v).attr("height",f).attr("x",function(e,t){return h(t)}).attr("y",0).style("cursor","pointer").on("click",function(e){s.click&&s.click(e)}).on("mouseover",function(e,t){var n=s.tooltip(e,t);n&&(y(e,t),r.show_tooltip(n))}).on("mousemove",function(e,n){b();var i=s.tooltip(e,n);i&&(r.move_tooltip(t.event.pageX,t.event.pageY),y(e,n))}).on("mouseout",function(){b(),r.hide_tooltip()})},i}),define("modules/charts",["utils/charts/spider","utils/charts/bar","utils/charts/pie","utils/charts/page_balance","utils/charts/line"],function(e,t,n,r,i){var s={};return s.prepare=function(){s.spider_chart=e,s.bar_chart=t,s.pie_chart=n,s.page_balance_chart=r,s.line_chart=i},s}),define("plugins/info",["require","utils/pluginmanager"],function(e){var t=e("utils/pluginmanager"),n=t.create_plugin("info","info");return n.class="active",n}),require.config({baseUrl:"js",paths:{templates:"../templates/compiled",jquery:"libs/jquery-1.11.1.min",handlebars:"libs/handlebars",logger:"libs/logger",saveAs:"libs/FileSaver",jspdf:"libs/jspdf",d3:"libs/d3.min",modernizr:"libs/modernizr",dropbox:"libs/dropins"},shim:{handlebars:{exports:"Handlebars"},logger:{exports:"Logger"},saveAs:{exports:"saveAs"},jspdf:{exports:"jsPDF"},modernizr:{exports:"Modernizr"},dropbox:{exports:"Dropbox"}}}),require(["bootstrap","modules/monitor","modules/data","modules/queries","modules/charts","plugins/info","plugins/open","plugins/settings","plugins/editor","plugins/save","plugins/preview","plugins/facts","plugins/stats"],function(e){e.init(arguments)}),define("afterwriting-bootstrap",function(){});;/* CodeMirror - Minified & Bundled
   Generated on 21/8/2014 with http://codemirror.net/doc/compress.html
   Version: HEAD

   CodeMirror Library:
   - codemirror.js
 */

!function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define('libs/codemirror/lib/codemirror',[],a);this.CodeMirror=a()}}(function(){"use strict";function w(a,b){if(!(this instanceof w))return new w(a,b);this.options=b=b||{},Pg(je,b,!1),K(b);var c=b.value;"string"==typeof c&&(c=new Kf(c,b.mode)),this.doc=c;var f=this.display=new x(a,c);f.wrapper.CodeMirror=this,G(this),E(this),b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),b.autofocus&&!o&&ad(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Fg},d&&11>e&&setTimeout(Qg(_c,this,!0),20),dd(this),hh();var g=this;Kc(this,function(){g.curOp.forceUpdate=!0,Of(g,c),b.autofocus&&!o||ah()==f.input?setTimeout(Qg(Hd,g),20):Id(g);for(var a in ke)ke.hasOwnProperty(a)&&ke[a](g,b[a],me);Q(g);for(var d=0;d<qe.length;++d)qe[d](g)})}function x(a,b){var c=this,g=c.input=Xg("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");f?g.style.width="1000px":g.setAttribute("wrap","off"),n&&(g.style.border="1px solid black"),g.setAttribute("autocorrect","off"),g.setAttribute("autocapitalize","off"),g.setAttribute("spellcheck","false"),c.inputDiv=Xg("div",[g],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarH=Xg("div",[Xg("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),c.scrollbarV=Xg("div",[Xg("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),c.scrollbarFiller=Xg("div",null,"CodeMirror-scrollbar-filler"),c.gutterFiller=Xg("div",null,"CodeMirror-gutter-filler"),c.lineDiv=Xg("div",null,"CodeMirror-code"),c.selectionDiv=Xg("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=Xg("div",null,"CodeMirror-cursors"),c.measure=Xg("div",null,"CodeMirror-measure"),c.lineMeasure=Xg("div",null,"CodeMirror-measure"),c.lineSpace=Xg("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none"),c.mover=Xg("div",[Xg("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=Xg("div",[c.mover],"CodeMirror-sizer"),c.heightForcer=Xg("div",null,null,"position: absolute; height: "+Ag+"px; width: 1px;"),c.gutters=Xg("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=Xg("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=Xg("div",[c.inputDiv,c.scrollbarH,c.scrollbarV,c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),d&&8>e&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),n&&(g.style.width="0px"),f||(c.scroller.draggable=!0),k&&(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"),d&&8>e&&(c.scrollbarH.style.minHeight=c.scrollbarV.style.minWidth="18px"),a.appendChild?a.appendChild(c.wrapper):a(c.wrapper),c.viewFrom=c.viewTo=b.first,c.view=[],c.externalMeasured=null,c.viewOffset=0,c.lastSizeC=0,c.updateLineNumbers=null,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new Fg,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1,c.selForContextMenu=null}function y(a){a.doc.mode=w.getMode(a.options,a.doc.modeOption),z(a)}function z(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),a.doc.frontier=a.doc.first,Ub(a,100),a.state.modeGen++,a.curOp&&Qc(a)}function A(a){a.options.lineWrapping?(dh(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth=""):(ch(a.display.wrapper,"CodeMirror-wrap"),J(a)),C(a),Qc(a),lc(a),setTimeout(function(){N(a)},100)}function B(a){var b=xc(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/yc(a.display)-3);return function(e){if(ef(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function C(a){var b=a.doc,c=B(a);b.iter(function(a){var b=c(a);b!=a.height&&Sf(a,b)})}function D(a){var b=ve[a.options.keyMap],c=b.style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(c?" cm-keymap-"+c:"")}function E(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),lc(a)}function F(a){G(a),Qc(a),setTimeout(function(){P(a)},20)}function G(a){var b=a.display.gutters,c=a.options.gutters;Zg(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(Xg("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none",H(a)}function H(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px",a.display.scrollbarH.style.left=a.options.fixedGutter?b+"px":0}function I(a){if(0==a.height)return 0;for(var c,b=a.text.length,d=a;c=Ze(d);){var e=c.find(0,!0);d=e.from.line,b+=e.from.ch-e.to.ch}for(d=a;c=$e(d);){var e=c.find(0,!0);b-=d.text.length-e.from.ch,d=e.to.line,b+=d.text.length-e.to.ch}return b}function J(a){var b=a.display,c=a.doc;b.maxLine=Pf(c,c.first),b.maxLineLength=I(b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var c=I(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function K(a){var b=Mg(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function L(a){return a.display.scroller.clientHeight-a.display.wrapper.clientHeight<Ag-3}function M(a){var b=a.display.scroller;return{clientHeight:b.clientHeight,barHeight:a.display.scrollbarV.clientHeight,scrollWidth:b.scrollWidth,clientWidth:b.clientWidth,hScrollbarTakesSpace:L(a),barWidth:a.display.scrollbarH.clientWidth,docHeight:Math.round(a.doc.height+Zb(a.display))}}function N(a,b){b||(b=M(a));var c=a.display,d=lh(c.measure),e=b.docHeight+Ag,f=b.scrollWidth>b.clientWidth;f&&b.scrollWidth<=b.clientWidth+1&&d>0&&!b.hScrollbarTakesSpace&&(f=!1);var g=e>b.clientHeight;if(g?(c.scrollbarV.style.display="block",c.scrollbarV.style.bottom=f?d+"px":"0",c.scrollbarV.firstChild.style.height=Math.max(0,e-b.clientHeight+(b.barHeight||c.scrollbarV.clientHeight))+"px"):(c.scrollbarV.style.display="",c.scrollbarV.firstChild.style.height="0"),f?(c.scrollbarH.style.display="block",c.scrollbarH.style.right=g?d+"px":"0",c.scrollbarH.firstChild.style.width=b.scrollWidth-b.clientWidth+(b.barWidth||c.scrollbarH.clientWidth)+"px"):(c.scrollbarH.style.display="",c.scrollbarH.firstChild.style.width="0"),f&&g?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=c.scrollbarFiller.style.width=d+"px"):c.scrollbarFiller.style.display="",f&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d+"px",c.gutterFiller.style.width=c.gutters.offsetWidth+"px"):c.gutterFiller.style.display="",!a.state.checkedOverlayScrollbar&&b.clientHeight>0){if(0===d){var h=p&&!l?"12px":"18px";c.scrollbarV.style.minWidth=c.scrollbarH.style.minHeight=h;var i=function(b){og(b)!=c.scrollbarV&&og(b)!=c.scrollbarH&&Lc(a,hd)(b)};qg(c.scrollbarV,"mousedown",i),qg(c.scrollbarH,"mousedown",i)}a.state.checkedOverlayScrollbar=!0}}function O(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-Yb(a));var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,f=Uf(b,d),g=Uf(b,e);if(c&&c.ensure){var h=c.ensure.from.line,i=c.ensure.to.line;if(f>h)return{from:h,to:Uf(b,Vf(Pf(b,h))+a.wrapper.clientHeight)};if(Math.min(i,b.lastLine())>=g)return{from:Uf(b,Vf(Pf(b,i))-a.wrapper.clientHeight),to:i}}return{from:f,to:Math.max(g,f+1)}}function P(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=S(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var i=0;i<h.length;i++)h[i].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function Q(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=R(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(Xg("div",[Xg("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g),d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",H(a),!0}return!1}function R(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function S(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function T(a,b,c){var d=a.display;this.viewport=b,this.visible=O(d,a.doc,b),this.editorIsHidden=!d.wrapper.offsetWidth,this.wrapperHeight=d.wrapper.clientHeight,this.oldViewFrom=d.viewFrom,this.oldViewTo=d.viewTo,this.oldScrollerWidth=d.scroller.clientWidth,this.force=c,this.dims=_(a)}function U(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Sc(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&0==Wc(a))return!1;Q(a)&&(Sc(a),b.dims=_(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&f-c.viewFrom<20&&(f=Math.max(d.first,c.viewFrom)),c.viewTo>g&&c.viewTo-g<20&&(g=Math.min(e,c.viewTo)),v&&(f=cf(a.doc,f),g=df(a.doc,g));var h=f!=c.viewFrom||g!=c.viewTo||c.lastSizeC!=b.wrapperHeight;Vc(a,f,g),c.viewOffset=Vf(Pf(a.doc,c.viewFrom)),a.display.mover.style.top=c.viewOffset+"px";var i=Wc(a);if(!h&&0==i&&!b.force&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;var j=ah();return i>4&&(c.lineDiv.style.display="none"),ab(a,c.updateLineNumbers,b.dims),i>4&&(c.lineDiv.style.display=""),j&&ah()!=j&&j.offsetHeight&&j.focus(),Zg(c.cursorDiv),Zg(c.selectionDiv),h&&(c.lastSizeC=b.wrapperHeight,Ub(a,400)),c.updateLineNumbers=null,!0}function V(a,b){for(var c=b.force,d=b.viewport,e=!0;;e=!1){if(e&&a.options.lineWrapping&&b.oldScrollerWidth!=a.display.scroller.clientWidth)c=!0;else if(c=!1,d&&null!=d.top&&(d={top:Math.min(a.doc.height+Zb(a.display)-Ag-a.display.scroller.clientHeight,d.top)}),b.visible=O(a.display,a.doc,d),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!U(a,b))break;Z(a);var f=M(a);Qb(a),X(a,f),N(a,f)}ug(a,"update",a),(a.display.viewFrom!=b.oldViewFrom||a.display.viewTo!=b.oldViewTo)&&ug(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo)}function W(a,b){var c=new T(a,b);if(U(a,c)){Z(a),V(a,c);var d=M(a);Qb(a),X(a,d),N(a,d)}}function X(a,b){a.display.sizer.style.minHeight=a.display.heightForcer.style.top=b.docHeight+"px",a.display.gutters.style.height=Math.max(b.docHeight,b.clientHeight-Ag)+"px"}function Y(a,b){a.display.sizer.offsetWidth+a.display.gutters.offsetWidth<a.display.scroller.clientWidth-1&&(a.display.sizer.style.minHeight=a.display.heightForcer.style.top="0px",a.display.gutters.style.height=b.docHeight+"px")}function Z(a){for(var b=a.display,c=b.lineDiv.offsetTop,f=0;f<b.view.length;f++){var h,g=b.view[f];if(!g.hidden){if(d&&8>e){var i=g.node.offsetTop+g.node.offsetHeight;h=i-c,c=i}else{var j=g.node.getBoundingClientRect();h=j.bottom-j.top}var k=g.line.height-h;if(2>h&&(h=xc(b)),(k>.001||-.001>k)&&(Sf(g.line,h),$(g.line),g.rest))for(var l=0;l<g.rest.length;l++)$(g.rest[l])}}}function $(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function _(a){for(var b=a.display,c={},d={},e=b.gutters.firstChild,f=0;e;e=e.nextSibling,++f)c[a.options.gutters[f]]=e.offsetLeft,d[a.options.gutters[f]]=e.offsetWidth;return{fixedPos:S(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function ab(a,b,c){function i(b){var c=b.nextSibling;return f&&p&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b),c}for(var d=a.display,e=a.options.lineNumbers,g=d.lineDiv,h=g.firstChild,j=d.view,k=d.viewFrom,l=0;l<j.length;l++){var m=j[l];if(m.hidden);else if(m.node){for(;h!=m.node;)h=i(h);var o=e&&null!=b&&k>=b&&m.lineNumber;m.changes&&(Mg(m.changes,"gutter")>-1&&(o=!1),bb(a,m,k,c)),o&&(Zg(m.lineNumber),m.lineNumber.appendChild(document.createTextNode(R(a.options,k)))),h=m.node.nextSibling}else{var n=jb(a,m,k,c);g.insertBefore(n,h)}k+=m.size}for(;h;)h=i(h)}function bb(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];"text"==f?fb(a,b):"gutter"==f?hb(a,b,c,d):"class"==f?gb(b):"widget"==f&&ib(b,d)}b.changes=null}function cb(a){return a.node==a.text&&(a.node=Xg("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),d&&8>e&&(a.node.style.zIndex=2)),a.node}function db(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;if(b&&(b+=" CodeMirror-linebackground"),a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=cb(a);a.background=c.insertBefore(Xg("div",null,b),c.firstChild)}}function eb(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):yf(a,b)}function fb(a,b){var c=b.text.className,d=eb(a,b);b.text==b.node&&(b.node=d.pre),b.text.parentNode.replaceChild(d.pre,b.text),b.text=d.pre,d.bgClass!=b.bgClass||d.textClass!=b.textClass?(b.bgClass=d.bgClass,b.textClass=d.textClass,gb(b)):c&&(b.text.className=c)}function gb(a){db(a),a.line.wrapClass?cb(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");var b=a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass;a.text.className=b||""}function hb(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);var e=b.line.gutterMarkers;if(a.options.lineNumbers||e){var f=cb(b),g=b.gutter=f.insertBefore(Xg("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),b.text);if(!a.options.lineNumbers||e&&e["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(Xg("div",R(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),e)for(var h=0;h<a.options.gutters.length;++h){var i=a.options.gutters[h],j=e.hasOwnProperty(i)&&e[i];j&&g.appendChild(Xg("div",[j],"CodeMirror-gutter-elt","left: "+d.gutterLeft[i]+"px; width: "+d.gutterWidth[i]+"px"))}}}function ib(a,b){a.alignable&&(a.alignable=null);for(var d,c=a.node.firstChild;c;c=d){var d=c.nextSibling;"CodeMirror-linewidget"==c.className&&a.node.removeChild(c)}kb(a,b)}function jb(a,b,c,d){var e=eb(a,b);return b.text=b.node=e.pre,e.bgClass&&(b.bgClass=e.bgClass),e.textClass&&(b.textClass=e.textClass),gb(b),hb(a,b,c,d),kb(b,d),b.node}function kb(a,b){if(lb(a.line,a,b,!0),a.rest)for(var c=0;c<a.rest.length;c++)lb(a.rest[c],a,b,!1)}function lb(a,b,c,d){if(a.widgets)for(var e=cb(b),f=0,g=a.widgets;f<g.length;++f){var h=g[f],i=Xg("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||(i.ignoreEvents=!0),mb(h,i,b,c),d&&h.above?e.insertBefore(i,b.gutter||b.text):e.appendChild(i),ug(h,"redraw")}}function mb(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function pb(a){return nb(a.line,a.ch)}function qb(a,b){return ob(a,b)<0?b:a}function rb(a,b){return ob(a,b)<0?a:b}function sb(a,b){this.ranges=a,this.primIndex=b}function tb(a,b){this.anchor=a,this.head=b}function ub(a,b){var c=a[b];a.sort(function(a,b){return ob(a.from(),b.from())}),b=Mg(a,c);for(var d=1;d<a.length;d++){var e=a[d],f=a[d-1];if(ob(f.to(),e.from())>=0){var g=rb(f.from(),e.from()),h=qb(f.to(),e.to()),i=f.empty()?e.from()==e.head:f.from()==f.head;b>=d&&--b,a.splice(--d,2,new tb(i?h:g,i?g:h))}}return new sb(a,b)}function vb(a,b){return new sb([new tb(a,b||a)],0)}function wb(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function xb(a,b){if(b.line<a.first)return nb(a.first,0);var c=a.first+a.size-1;return b.line>c?nb(c,Pf(a,c).text.length):yb(b,Pf(a,b.line).text.length)}function yb(a,b){var c=a.ch;return null==c||c>b?nb(a.line,b):0>c?nb(a.line,0):a}function zb(a,b){return b>=a.first&&b<a.first+a.size}function Ab(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=xb(a,b[d]);return c}function Bb(a,b,c,d){if(a.cm&&a.cm.display.shift||a.extend){var e=b.anchor;if(d){var f=ob(c,e)<0;f!=ob(d,e)<0?(e=c,c=d):f!=ob(c,d)<0&&(c=d)}return new tb(e,c)}return new tb(d||c,c)}function Cb(a,b,c,d){Ib(a,new sb([Bb(a,a.sel.primary(),b,c)],0),d)}function Db(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=Bb(a,a.sel.ranges[e],b[e],null);var f=ub(d,a.sel.primIndex);Ib(a,f,c)}function Eb(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c,Ib(a,ub(e,a.sel.primIndex),d)}function Fb(a,b,c,d){Ib(a,vb(b,c),d)}function Gb(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new tb(xb(a,b[c].anchor),xb(a,b[c].head))}};return sg(a,"beforeSelectionChange",a,c),a.cm&&sg(a.cm,"beforeSelectionChange",a.cm,c),c.ranges!=b.ranges?ub(c.ranges,c.ranges.length-1):b}function Hb(a,b,c){var d=a.history.done,e=Kg(d);e&&e.ranges?(d[d.length-1]=b,Jb(a,b,c)):Ib(a,b,c)}function Ib(a,b,c){Jb(a,b,c),bg(a,a.sel,a.cm?a.cm.curOp.id:0/0,c)}function Jb(a,b,c){(yg(a,"beforeSelectionChange")||a.cm&&yg(a.cm,"beforeSelectionChange"))&&(b=Gb(a,b));var d=c&&c.bias||(ob(b.primary().head,a.sel.primary().head)<0?-1:1);Kb(a,Mb(a,b,d,!0)),c&&c.scroll===!1||!a.cm||be(a.cm)}function Kb(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,xg(a.cm)),ug(a,"cursorActivity",a))}function Lb(a){Kb(a,Mb(a,a.sel,null,!1),Cg)}function Mb(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=Nb(a,g.anchor,c,d),i=Nb(a,g.head,c,d);(e||h!=g.anchor||i!=g.head)&&(e||(e=b.ranges.slice(0,f)),e[f]=new tb(h,i))}return e?ub(e,b.primIndex):b}function Nb(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=Pf(a,f.line);if(h.markedSpans)for(var i=0;i<h.markedSpans.length;++i){var j=h.markedSpans[i],k=j.marker;if((null==j.from||(k.inclusiveLeft?j.from<=f.ch:j.from<f.ch))&&(null==j.to||(k.inclusiveRight?j.to>=f.ch:j.to>f.ch))){if(d&&(sg(k,"beforeCursorEnter"),k.explicitlyCleared)){if(h.markedSpans){--i;continue}break}if(!k.atomic)continue;var l=k.find(0>g?-1:1);if(0==ob(l,f)&&(l.ch+=g,l.ch<0?l=l.line>a.first?xb(a,nb(l.line-1)):null:l.ch>h.text.length&&(l=l.line<a.first+a.size-1?nb(l.line+1,0):null),!l)){if(e)return d?(a.cantEdit=!0,nb(a.first,0)):Nb(a,b,c,!0);e=!0,l=b,g=-g}f=l;continue a}}return f}}function Ob(a){for(var b=a.display,c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++){var h=c.sel.ranges[g],i=h.empty();(i||a.options.showCursorWhenSelecting)&&Rb(a,h,e),i||Sb(a,h,f)}if(a.options.moveInputWithCursor){var j=rc(a,c.sel.primary().head,"div"),k=b.wrapper.getBoundingClientRect(),l=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,j.top+l.top-k.top)),d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,j.left+l.left-k.left))}return d}function Pb(a,b){$g(a.display.cursorDiv,b.cursors),$g(a.display.selectionDiv,b.selection),null!=b.teTop&&(a.display.inputDiv.style.top=b.teTop+"px",a.display.inputDiv.style.left=b.teLeft+"px")}function Qb(a){Pb(a,Ob(a))}function Rb(a,b,c){var d=rc(a,b.head,"div",null,null,!a.options.singleCursorHeightPerLine),e=c.appendChild(Xg("div","\xa0","CodeMirror-cursor"));if(e.style.left=d.left+"px",e.style.top=d.top+"px",e.style.height=Math.max(0,d.bottom-d.top)*a.options.cursorHeight+"px",d.other){var f=c.appendChild(Xg("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));f.style.display="",f.style.left=d.other.left+"px",f.style.top=d.other.top+"px",f.style.height=.85*(d.other.bottom-d.other.top)+"px"}}function Sb(a,b,c){function j(a,b,c,d){0>b&&(b=0),b=Math.round(b),d=Math.round(d),f.appendChild(Xg("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?i-a:c)+"px; height: "+(d-b)+"px"))}function k(b,c,d){function m(c,d){return qc(a,nb(b,c),"div",f,d)}var k,l,f=Pf(e,b),g=f.text.length;return wh(Wf(f),c||0,null==d?g:d,function(a,b,e){var n,o,p,f=m(a,"left");if(a==b)n=f,o=p=f.left;else{if(n=m(b-1,"right"),"rtl"==e){var q=f;f=n,n=q}o=f.left,p=n.right}null==c&&0==a&&(o=h),n.top-f.top>3&&(j(o,f.top,null,f.bottom),o=h,f.bottom<n.top&&j(o,f.bottom,null,n.top)),null==d&&b==g&&(p=i),(!k||f.top<k.top||f.top==k.top&&f.left<k.left)&&(k=f),(!l||n.bottom>l.bottom||n.bottom==l.bottom&&n.right>l.right)&&(l=n),h+1>o&&(o=h),j(o,n.top,p-o,n.bottom)}),{start:k,end:l}}var d=a.display,e=a.doc,f=document.createDocumentFragment(),g=$b(a.display),h=g.left,i=d.lineSpace.offsetWidth-g.right,l=b.from(),m=b.to();if(l.line==m.line)k(l.line,l.ch,m.ch);else{var n=Pf(e,l.line),o=Pf(e,m.line),p=af(n)==af(o),q=k(l.line,l.ch,p?n.text.length+1:null).end,r=k(m.line,p?0:null,m.ch).start;p&&(q.top<r.top-2?(j(q.right,q.top,null,q.bottom),j(h,r.top,r.left,r.bottom)):j(q.right,q.top,r.left-q.right,q.bottom)),q.bottom<r.top&&j(h,q.bottom,null,r.top)}c.appendChild(f)}function Tb(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):a.options.cursorBlinkRate<0&&(b.cursorDiv.style.visibility="hidden")}}function Ub(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Qg(Vb,a))}function Vb(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=se(b.mode,Xb(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=sf(a,f,d,!0);f.styles=h.styles;var i=f.styleClasses,j=h.classes;j?f.styleClasses=j:i&&(f.styleClasses=null);for(var k=!g||g.length!=f.styles.length||i!=j&&(!i||!j||i.bgClass!=j.bgClass||i.textClass!=j.textClass),l=0;!k&&l<g.length;++l)k=g[l]!=f.styles[l];k&&e.push(b.frontier),f.stateAfter=se(b.mode,d)}else uf(a,f.text,d),f.stateAfter=0==b.frontier%5?se(b.mode,d):null;return++b.frontier,+new Date>c?(Ub(a,a.options.workDelay),!0):void 0}),e.length&&Kc(a,function(){for(var b=0;b<e.length;b++)Rc(a,e[b],"text")})}}function Wb(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(h<=f.first)return f.first;var i=Pf(f,h-1);if(i.stateAfter&&(!c||h<=f.frontier))return h;var j=Gg(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function Xb(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=Wb(a,b,c),g=f>d.first&&Pf(d,f-1).stateAfter;return g=g?se(d.mode,g):te(d.mode),d.iter(f,b,function(c){uf(a,c.text,g);var h=f==b-1||0==f%5||f>=e.viewFrom&&f<e.viewTo;c.stateAfter=h?se(d.mode,g):null,++f}),c&&(d.frontier=f),g}function Yb(a){return a.lineSpace.offsetTop}function Zb(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function $b(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=$g(a.measure,Xg("pre","x")),c=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,d={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};return isNaN(d.left)||isNaN(d.right)||(a.cachedPaddingH=d),d}function _b(a,b,c){var d=a.options.lineWrapping,e=d&&a.display.scroller.clientWidth;if(!b.measure.heights||d&&b.measure.width!=e){var f=b.measure.heights=[];if(d){b.measure.width=e;for(var g=b.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){var i=g[h],j=g[h+1];Math.abs(i.bottom-j.bottom)>2&&f.push((i.bottom+j.top)/2-c.top)}}f.push(c.bottom-c.top)}}function ac(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(var d=0;d<a.rest.length;d++)if(Tf(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function bc(a,b){b=af(b);var c=Tf(b),d=a.display.externalMeasured=new Oc(a.doc,b,c);d.lineN=c;var e=d.built=yf(a,d);return d.text=e.pre,$g(a.display.lineMeasure,e.pre),d}function cc(a,b,c,d){return fc(a,ec(a,b),c,d)}function dc(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Tc(a,b)];var c=a.display.externalMeasured;return c&&b>=c.lineN&&b<c.lineN+c.size?c:void 0}function ec(a,b){var c=Tf(b),d=dc(a,c);d&&!d.text?d=null:d&&d.changes&&bb(a,d,c,_(a)),d||(d=bc(a,b));var e=ac(d,b,c);return{line:b,view:d,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function fc(a,b,c,d,e){b.before&&(c=-1);var g,f=c+(d||"");return b.cache.hasOwnProperty(f)?g=b.cache[f]:(b.rect||(b.rect=b.view.text.getBoundingClientRect()),b.hasHeights||(_b(a,b.view,b.rect),b.hasHeights=!0),g=hc(a,b,c,d),g.bogus||(b.cache[f]=g)),{left:g.left,right:g.right,top:e?g.rtop:g.top,bottom:e?g.rbottom:g.bottom}}function hc(a,b,c,f){for(var h,i,j,k,g=b.map,l=0;l<g.length;l+=3){var m=g[l],n=g[l+1];if(m>c?(i=0,j=1,k="left"):n>c?(i=c-m,j=i+1):(l==g.length-3||c==n&&g[l+3]>c)&&(j=n-m,i=j-1,c>=n&&(k="right")),null!=i){if(h=g[l+2],m==n&&f==(h.insertLeft?"left":"right")&&(k=f),"left"==f&&0==i)for(;l&&g[l-2]==g[l-3]&&g[l-1].insertLeft;)h=g[(l-=3)+2],k="left";if("right"==f&&i==n-m)for(;l<g.length-3&&g[l+3]==g[l+4]&&!g[l+5].insertLeft;)h=g[(l+=3)+2],k="right";break}}var o;if(3==h.nodeType)for(;;){for(;i&&Wg(b.line.text.charAt(m+i));)--i;for(;n>m+j&&Wg(b.line.text.charAt(m+j));)++j;if(d&&9>e&&0==i&&j==n-m)o=h.parentNode.getBoundingClientRect();else if(d&&a.options.lineWrapping){var p=Yg(h,i,j).getClientRects();o=p.length?p["right"==f?p.length-1:0]:gc}else o=Yg(h,i,j).getBoundingClientRect()||gc;if(o.left||o.right||0==i)break;j=i,i-=1,k="right"}else{i>0&&(k=f="right");var p;o=a.options.lineWrapping&&(p=h.getClientRects()).length>1?p["right"==f?p.length-1:0]:h.getBoundingClientRect()}if(d&&9>e&&!i&&(!o||!o.left&&!o.right)){var q=h.parentNode.getClientRects()[0];o=q?{left:q.left,right:q.left+yc(a.display),top:q.top,bottom:q.bottom}:gc}d&&11>e&&(o=ic(a.display.measure,o));for(var r=o.top-b.rect.top,s=o.bottom-b.rect.top,t=(r+s)/2,u=b.view.measure.heights,l=0;l<u.length-1&&!(t<u[l]);l++);var v=l?u[l-1]:0,w=u[l],x={left:("right"==k?o.right:o.left)-b.rect.left,right:("left"==k?o.left:o.right)-b.rect.left,top:v,bottom:w};return o.left||o.right||(x.bogus=!0),a.options.singleCursorHeightPerLine||(x.rtop=r,x.rbottom=s),x}function ic(a,b){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!uh(a))return b;var c=screen.logicalXDPI/screen.deviceXDPI,d=screen.logicalYDPI/screen.deviceYDPI;return{left:b.left*c,right:b.right*c,top:b.top*d,bottom:b.bottom*d}}function jc(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function kc(a){a.display.externalMeasure=null,Zg(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)jc(a.display.view[b])}function lc(a){kc(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function mc(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function nc(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function oc(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=jf(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=Vf(b);if("local"==d?g+=Yb(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=a.display.lineSpace.getBoundingClientRect();g+=h.top+("window"==d?0:nc());var i=h.left+("window"==d?0:mc());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function pc(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=mc(),e-=nc();else if("local"==c||!c){var f=a.display.sizer.getBoundingClientRect();d+=f.left,e+=f.top}var g=a.display.lineSpace.getBoundingClientRect();return{left:d-g.left,top:e-g.top}}function qc(a,b,c,d,e){return d||(d=Pf(a.doc,b.line)),oc(a,d,cc(a,d,b.ch,e),c)}function rc(a,b,c,d,e,f){function g(b,g){var h=fc(a,e,b,g?"right":"left",f);return g?h.left=h.right:h.right=h.left,oc(a,d,h,c)}function h(a,b){var c=i[b],d=c.level%2;return a==xh(c)&&b&&c.level<i[b-1].level?(c=i[--b],a=yh(c)-(c.level%2?0:1),d=!0):a==yh(c)&&b<i.length-1&&c.level<i[b+1].level&&(c=i[++b],a=xh(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||Pf(a.doc,b.line),e||(e=ec(a,d));var i=Wf(d),j=b.ch;if(!i)return g(j);var k=Gh(i,j),l=h(j,k);return null!=Fh&&(l.other=h(j,Fh)),l}function sc(a,b){var c=0,b=xb(a.doc,b);a.options.lineWrapping||(c=yc(a.display)*b.ch);var d=Pf(a.doc,b.line),e=Vf(d)+Yb(a.display);return{left:c,right:c,top:e,bottom:e+d.height}}function tc(a,b,c,d){var e=nb(a,b);return e.xRel=d,c&&(e.outside=!0),e}function uc(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return tc(d.first,0,!0,-1);var e=Uf(d,c),f=d.first+d.size-1;if(e>f)return tc(d.first+d.size-1,Pf(d,f).text.length,!0,1);0>b&&(b=0);for(var g=Pf(d,e);;){var h=vc(a,g,e,b,c),i=$e(g),j=i&&i.find(0,!0);if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=Tf(g=j.to.line)}}function vc(a,b,c,d,e){function j(d){var e=rc(a,nb(c,d),"line",b,i);return g=!0,f>e.bottom?e.left-h:f<e.top?e.left+h:(g=!1,e.left)}var f=e-Vf(b),g=!1,h=2*a.display.wrapper.clientWidth,i=ec(a,b),k=Wf(b),l=b.text.length,m=zh(b),n=Ah(b),o=j(m),p=g,q=j(n),r=g;if(d>q)return tc(c,n,r,1);for(;;){if(k?n==m||n==Ih(b,m,1):1>=n-m){for(var s=o>d||q-d>=d-o?m:n,t=d-(s==m?o:q);Wg(b.text.charAt(s));)++s;var u=tc(c,s,s==m?p:r,-1>t?-1:t>1?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=Ih(b,w,1)}var y=j(w);y>d?(n=w,q=y,(r=g)&&(q+=1e3),l=v):(m=w,o=y,p=g,l-=v)}}function xc(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==wc){wc=Xg("pre");for(var b=0;49>b;++b)wc.appendChild(document.createTextNode("x")),wc.appendChild(Xg("br"));wc.appendChild(document.createTextNode("x"))}$g(a.measure,wc);var c=wc.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),Zg(a.measure),c||1}function yc(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=Xg("span","xxxxxxxxxx"),c=Xg("pre",[b]);$g(a.measure,c);var d=b.getBoundingClientRect(),e=(d.right-d.left)/10;return e>2&&(a.cachedCharWidth=e),e||10}function Bc(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++Ac},zc?zc.ops.push(a.curOp):a.curOp.ownsGroup=zc={ops:[a.curOp],delayedCallbacks:[]}}function Cc(a){var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c]();for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++](e.cm)}}while(c<b.length)}function Dc(a){var b=a.curOp,c=b.ownsGroup;if(c)try{Cc(c)}finally{zc=null;for(var d=0;d<c.ops.length;d++)c.ops[d].cm.curOp=null;Ec(c)}}function Ec(a){for(var b=a.ops,c=0;c<b.length;c++)Fc(b[c]);for(var c=0;c<b.length;c++)Gc(b[c]);for(var c=0;c<b.length;c++)Hc(b[c]);for(var c=0;c<b.length;c++)Ic(b[c]);for(var c=0;c<b.length;c++)Jc(b[c])}function Fc(a){var b=a.cm,c=b.display;
a.updateMaxLine&&J(b),a.mustUpdate=a.viewChanged||a.forceUpdate||null!=a.scrollTop||a.scrollToPos&&(a.scrollToPos.from.line<c.viewFrom||a.scrollToPos.to.line>=c.viewTo)||c.maxLineChanged&&b.options.lineWrapping,a.update=a.mustUpdate&&new T(b,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function Gc(a){a.updatedDisplay=a.mustUpdate&&U(a.cm,a.update)}function Hc(a){var b=a.cm,c=b.display;a.updatedDisplay&&Z(b),a.barMeasure=M(b),c.maxLineChanged&&!b.options.lineWrapping&&(a.adjustWidthTo=cc(b,c.maxLine,c.maxLine.text.length).left+3,a.maxScrollLeft=Math.max(0,c.sizer.offsetLeft+a.adjustWidthTo+Ag-c.scroller.clientWidth)),(a.updatedDisplay||a.selectionChanged)&&(a.newSelectionNodes=Ob(b))}function Ic(a){var b=a.cm;null!=a.adjustWidthTo&&(b.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<b.doc.scrollLeft&&td(b,Math.min(b.display.scroller.scrollLeft,a.maxScrollLeft),!0),b.display.maxLineChanged=!1),a.newSelectionNodes&&Pb(b,a.newSelectionNodes),a.updatedDisplay&&X(b,a.barMeasure),(a.updatedDisplay||a.startHeight!=b.doc.height)&&N(b,a.barMeasure),a.selectionChanged&&Tb(b),b.state.focused&&a.updateInput&&_c(b,a.typing)}function Jc(a){var b=a.cm,c=b.display,d=b.doc;if(null!=a.adjustWidthTo&&Math.abs(a.barMeasure.scrollWidth-b.display.scroller.scrollWidth)>1&&N(b),a.updatedDisplay&&V(b,a.update),null==c.wheelStartX||null==a.scrollTop&&null==a.scrollLeft&&!a.scrollToPos||(c.wheelStartX=c.wheelStartY=null),null!=a.scrollTop&&c.scroller.scrollTop!=a.scrollTop){var e=Math.max(0,Math.min(c.scroller.scrollHeight-c.scroller.clientHeight,a.scrollTop));c.scroller.scrollTop=c.scrollbarV.scrollTop=d.scrollTop=e}if(null!=a.scrollLeft&&c.scroller.scrollLeft!=a.scrollLeft){var g=Math.max(0,Math.min(c.scroller.scrollWidth-c.scroller.clientWidth,a.scrollLeft));c.scroller.scrollLeft=c.scrollbarH.scrollLeft=d.scrollLeft=g,P(b)}if(a.scrollToPos){var h=Zd(b,xb(d,a.scrollToPos.from),xb(d,a.scrollToPos.to),a.scrollToPos.margin);a.scrollToPos.isCursor&&b.state.focused&&Yd(b,h)}var i=a.maybeHiddenMarkers,j=a.maybeUnhiddenMarkers;if(i)for(var k=0;k<i.length;++k)i[k].lines.length||sg(i[k],"hide");if(j)for(var k=0;k<j.length;++k)j[k].lines.length&&sg(j[k],"unhide");c.wrapper.offsetHeight&&(d.scrollTop=b.display.scroller.scrollTop),a.updatedDisplay&&f&&(b.options.lineWrapping&&Y(b,a.barMeasure),a.barMeasure.scrollWidth>a.barMeasure.clientWidth&&a.barMeasure.scrollWidth<a.barMeasure.clientWidth+1&&!L(b)&&N(b)),a.changeObjs&&sg(b,"changes",b,a.changeObjs)}function Kc(a,b){if(a.curOp)return b();Bc(a);try{return b()}finally{Dc(a)}}function Lc(a,b){return function(){if(a.curOp)return b.apply(a,arguments);Bc(a);try{return b.apply(a,arguments)}finally{Dc(a)}}}function Mc(a){return function(){if(this.curOp)return a.apply(this,arguments);Bc(this);try{return a.apply(this,arguments)}finally{Dc(this)}}}function Nc(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);Bc(b);try{return a.apply(this,arguments)}finally{Dc(b)}}}function Oc(a,b,c){this.line=b,this.rest=bf(b),this.size=this.rest?Tf(Kg(this.rest))-c+1:1,this.node=this.text=null,this.hidden=ef(a,b)}function Pc(a,b,c){for(var e,d=[],f=b;c>f;f=e){var g=new Oc(a.doc,Pf(a.doc,f),f);e=f+g.size,d.push(g)}return d}function Qc(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),d||(d=0);var e=a.display;if(d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b),a.curOp.viewChanged=!0,b>=e.viewTo)v&&cf(a.doc,b)<e.viewTo&&Sc(a);else if(c<=e.viewFrom)v&&df(a.doc,c+d)>e.viewFrom?Sc(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)Sc(a);else if(b<=e.viewFrom){var f=Uc(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):Sc(a)}else if(c>=e.viewTo){var f=Uc(a,b,b,-1);f?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):Sc(a)}else{var g=Uc(a,b,b,-1),h=Uc(a,c,c+d,1);g&&h?(e.view=e.view.slice(0,g.index).concat(Pc(a,g.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):Sc(a)}var i=e.externalMeasured;i&&(c<i.lineN?i.lineN+=d:b<i.lineN+i.size&&(e.externalMeasured=null))}function Rc(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;if(e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null),!(b<d.viewFrom||b>=d.viewTo)){var f=d.view[Tc(a,b)];if(null!=f.node){var g=f.changes||(f.changes=[]);-1==Mg(g,c)&&g.push(c)}}}function Sc(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function Tc(a,b){if(b>=a.display.viewTo)return null;if(b-=a.display.viewFrom,0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Uc(a,b,c,d){var f,e=Tc(a,b),g=a.display.view;if(!v||c==a.doc.first+a.doc.size)return{index:e,lineN:c};for(var h=0,i=a.display.viewFrom;e>h;h++)i+=g[h].size;if(i!=b){if(d>0){if(e==g.length-1)return null;f=i+g[e].size-b,e++}else f=i-b;b+=f,c+=f}for(;cf(a.doc,c)!=c;){if(e==(0>d?0:g.length-1))return null;c+=d*g[e-(0>d?1:0)].size,e+=d}return{index:e,lineN:c}}function Vc(a,b,c){var d=a.display,e=d.view;0==e.length||b>=d.viewTo||c<=d.viewFrom?(d.view=Pc(a,b,c),d.viewFrom=b):(d.viewFrom>b?d.view=Pc(a,b,d.viewFrom).concat(d.view):d.viewFrom<b&&(d.view=d.view.slice(Tc(a,b))),d.viewFrom=b,d.viewTo<c?d.view=d.view.concat(Pc(a,d.viewTo,c)):d.viewTo>c&&(d.view=d.view.slice(0,Tc(a,c)))),d.viewTo=c}function Wc(a){for(var b=a.display.view,c=0,d=0;d<b.length;d++){var e=b[d];e.hidden||e.node&&!e.changes||++c}return c}function Xc(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){$c(a),a.state.focused&&Xc(a)})}function Yc(a){function c(){var d=$c(a);d||b?(a.display.pollingFast=!1,Xc(a)):(b=!0,a.display.poll.set(60,c))}var b=!1;a.display.pollingFast=!0,a.display.poll.set(20,c)}function $c(a){var b=a.display.input,c=a.display.prevInput,f=a.doc;if(!a.state.focused||rh(b)&&!c||cd(a)||a.options.disableInput)return!1;a.state.pasteIncoming&&a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var g=b.value;if(g==c&&!a.somethingSelected())return!1;if(d&&e>=9&&a.display.inputHasSelection===g||p&&/[\uf700-\uf7ff]/.test(g))return _c(a),!1;var h=!a.curOp;h&&Bc(a),a.display.shift=!1,8203!=g.charCodeAt(0)||f.sel!=a.display.selForContextMenu||c||(c="\u200b");for(var i=0,j=Math.min(c.length,g.length);j>i&&c.charCodeAt(i)==g.charCodeAt(i);)++i;var k=g.slice(i),l=qh(k),m=null;a.state.pasteIncoming&&f.sel.ranges.length>1&&(Zc&&Zc.join("\n")==k?m=0==f.sel.ranges.length%Zc.length&&Ng(Zc,qh):l.length==f.sel.ranges.length&&(m=Ng(l,function(a){return[a]})));for(var n=f.sel.ranges.length-1;n>=0;n--){var o=f.sel.ranges[n],q=o.from(),r=o.to();i<c.length?q=nb(q.line,q.ch-(c.length-i)):a.state.overwrite&&o.empty()&&!a.state.pasteIncoming&&(r=nb(r.line,Math.min(Pf(f,r.line).text.length,r.ch+Kg(l).length)));var s=a.curOp.updateInput,t={from:q,to:r,text:m?m[n%m.length]:l,origin:a.state.pasteIncoming?"paste":a.state.cutIncoming?"cut":"+input"};if(Rd(a.doc,t),ug(a,"inputRead",a,t),k&&!a.state.pasteIncoming&&a.options.electricChars&&a.options.smartIndent&&o.head.ch<100&&(!n||f.sel.ranges[n-1].head.line!=o.head.line)){var u=a.getModeAt(o.head);if(u.electricChars){for(var v=0;v<u.electricChars.length;v++)if(k.indexOf(u.electricChars.charAt(v))>-1){de(a,o.head.line,"smart");break}}else if(u.electricInput){var w=Ld(t);u.electricInput.test(Pf(f,w.line).text.slice(0,w.ch))&&de(a,o.head.line,"smart")}}}return be(a),a.curOp.updateInput=s,a.curOp.typing=!0,g.length>1e3||g.indexOf("\n")>-1?b.value=a.display.prevInput="":a.display.prevInput=g,h&&Dc(a),a.state.pasteIncoming=a.state.cutIncoming=!1,!0}function _c(a,b){var c,f,g=a.doc;if(a.somethingSelected()){a.display.prevInput="";var h=g.sel.primary();c=sh&&(h.to().line-h.from().line>100||(f=a.getSelection()).length>1e3);var i=c?"-":f||a.getSelection();a.display.input.value=i,a.state.focused&&Lg(a.display.input),d&&e>=9&&(a.display.inputHasSelection=i)}else b||(a.display.prevInput=a.display.input.value="",d&&e>=9&&(a.display.inputHasSelection=null));a.display.inaccurateSelection=c}function ad(a){"nocursor"==a.options.readOnly||o&&ah()==a.display.input||a.display.input.focus()}function bd(a){a.state.focused||(ad(a),Hd(a))}function cd(a){return a.options.readOnly||a.doc.cantEdit}function dd(a){function c(){a.state.focused&&setTimeout(Qg(ad,a),0)}function g(b){wg(a,b)||ng(b)}function h(c){if(a.somethingSelected())Zc=a.getSelections(),b.inaccurateSelection&&(b.prevInput="",b.inaccurateSelection=!1,b.input.value=Zc.join("\n"),Lg(b.input));else{for(var d=[],e=[],f=0;f<a.doc.sel.ranges.length;f++){var g=a.doc.sel.ranges[f].head.line,h={anchor:nb(g,0),head:nb(g+1,0)};e.push(h),d.push(a.getRange(h.anchor,h.head))}"cut"==c.type?a.setSelections(e,null,Cg):(b.prevInput="",b.input.value=d.join("\n"),Lg(b.input)),Zc=d}"cut"==c.type&&(a.state.cutIncoming=!0)}var b=a.display;qg(b.scroller,"mousedown",Lc(a,hd)),d&&11>e?qg(b.scroller,"dblclick",Lc(a,function(b){if(!wg(a,b)){var c=gd(a,b);if(c&&!od(a,b)&&!fd(a.display,b)){kg(b);var d=ie(a,c);Cb(a.doc,d.anchor,d.head)}}})):qg(b.scroller,"dblclick",function(b){wg(a,b)||kg(b)}),qg(b.lineSpace,"selectstart",function(a){fd(b,a)||kg(a)}),t||qg(b.scroller,"contextmenu",function(b){Jd(a,b)}),qg(b.scroller,"scroll",function(){b.scroller.clientHeight&&(sd(a,b.scroller.scrollTop),td(a,b.scroller.scrollLeft,!0),sg(a,"scroll",a))}),qg(b.scrollbarV,"scroll",function(){b.scroller.clientHeight&&sd(a,b.scrollbarV.scrollTop)}),qg(b.scrollbarH,"scroll",function(){b.scroller.clientHeight&&td(a,b.scrollbarH.scrollLeft)}),qg(b.scroller,"mousewheel",function(b){wd(a,b)}),qg(b.scroller,"DOMMouseScroll",function(b){wd(a,b)}),qg(b.scrollbarH,"mousedown",c),qg(b.scrollbarV,"mousedown",c),qg(b.wrapper,"scroll",function(){b.wrapper.scrollTop=b.wrapper.scrollLeft=0}),qg(b.input,"keyup",function(b){Fd.call(a,b)}),qg(b.input,"input",function(){d&&e>=9&&a.display.inputHasSelection&&(a.display.inputHasSelection=null),Yc(a)}),qg(b.input,"keydown",Lc(a,Dd)),qg(b.input,"keypress",Lc(a,Gd)),qg(b.input,"focus",Qg(Hd,a)),qg(b.input,"blur",Qg(Id,a)),a.options.dragDrop&&(qg(b.scroller,"dragstart",function(b){rd(a,b)}),qg(b.scroller,"dragenter",g),qg(b.scroller,"dragover",g),qg(b.scroller,"drop",Lc(a,qd))),qg(b.scroller,"paste",function(c){fd(b,c)||(a.state.pasteIncoming=!0,ad(a),Yc(a))}),qg(b.input,"paste",function(){if(f&&!a.state.fakedLastChar&&!(new Date-a.state.lastMiddleDown<200)){var c=b.input.selectionStart,d=b.input.selectionEnd;b.input.value+="$",b.input.selectionEnd=d,b.input.selectionStart=c,a.state.fakedLastChar=!0}a.state.pasteIncoming=!0,Yc(a)}),qg(b.input,"cut",h),qg(b.input,"copy",h),k&&qg(b.sizer,"mouseup",function(){ah()==b.input&&b.input.blur(),ad(a)})}function ed(a){var b=a.display;b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,a.setSize()}function fd(a,b){for(var c=og(b);c!=a.wrapper;c=c.parentNode)if(!c||c.ignoreEvents||c.parentNode==a.sizer&&c!=a.mover)return!0}function gd(a,b,c,d){var e=a.display;if(!c){var f=og(b);if(f==e.scrollbarH||f==e.scrollbarV||f==e.scrollbarFiller||f==e.gutterFiller)return null}var g,h,i=e.lineSpace.getBoundingClientRect();try{g=b.clientX-i.left,h=b.clientY-i.top}catch(b){return null}var k,j=uc(a,g,h);if(d&&1==j.xRel&&(k=Pf(a.doc,j.line).text).length==j.ch){var l=Gg(k,k.length,a.options.tabSize)-k.length;j=nb(j.line,Math.max(0,Math.round((g-$b(a.display).left)/yc(a.display))-l))}return j}function hd(a){if(!wg(this,a)){var b=this,c=b.display;if(c.shift=a.shiftKey,fd(c,a))return f||(c.scroller.draggable=!1,setTimeout(function(){c.scroller.draggable=!0},100)),void 0;if(!od(b,a)){var d=gd(b,a);switch(window.focus(),pg(a)){case 1:d?kd(b,a,d):og(a)==c.scroller&&kg(a);break;case 2:f&&(b.state.lastMiddleDown=+new Date),d&&Cb(b.doc,d),setTimeout(Qg(ad,b),20),kg(a);break;case 3:t&&Jd(b,a)}}}}function kd(a,b,c){setTimeout(Qg(bd,a),0);var e,d=+new Date;jd&&jd.time>d-400&&0==ob(jd.pos,c)?e="triple":id&&id.time>d-400&&0==ob(id.pos,c)?(e="double",jd={time:d,pos:c}):(e="single",id={time:d,pos:c});var f=a.doc.sel,g=p?b.metaKey:b.ctrlKey;a.options.dragDrop&&jh&&!cd(a)&&"single"==e&&f.contains(c)>-1&&f.somethingSelected()?ld(a,b,c,g):md(a,b,c,e,g)}function ld(a,b,c,g){var h=a.display,i=Lc(a,function(j){f&&(h.scroller.draggable=!1),a.state.draggingText=!1,rg(document,"mouseup",i),rg(h.scroller,"drop",i),Math.abs(b.clientX-j.clientX)+Math.abs(b.clientY-j.clientY)<10&&(kg(j),g||Cb(a.doc,c),ad(a),d&&9==e&&setTimeout(function(){document.body.focus(),ad(a)},20))});f&&(h.scroller.draggable=!0),a.state.draggingText=i,h.scroller.dragDrop&&h.scroller.dragDrop(),qg(document,"mouseup",i),qg(h.scroller,"drop",i)}function md(a,b,c,d,e){function n(b){if(0!=ob(m,b))if(m=b,"rect"==d){for(var e=[],f=a.options.tabSize,k=Gg(Pf(g,c.line).text,c.ch,f),l=Gg(Pf(g,b.line).text,b.ch,f),n=Math.min(k,l),o=Math.max(k,l),p=Math.min(c.line,b.line),q=Math.min(a.lastLine(),Math.max(c.line,b.line));q>=p;p++){var r=Pf(g,p).text,s=Hg(r,n,f);n==o?e.push(new tb(nb(p,s),nb(p,s))):r.length>s&&e.push(new tb(nb(p,s),nb(p,Hg(r,o,f))))}e.length||e.push(new tb(c,c)),Ib(g,ub(j.ranges.slice(0,i).concat(e),i),{origin:"*mouse",scroll:!1}),a.scrollIntoView(b)}else{var t=h,u=t.anchor,v=b;if("single"!=d){if("double"==d)var w=ie(a,b);else var w=new tb(nb(b.line,0),xb(g,nb(b.line+1,0)));ob(w.anchor,u)>0?(v=w.head,u=rb(t.from(),w.anchor)):(v=w.anchor,u=qb(t.to(),w.head))}var e=j.ranges.slice(0);e[i]=new tb(xb(g,u),v),Ib(g,ub(e,i),Dg)}}function q(b){var c=++p,e=gd(a,b,!0,"rect"==d);if(e)if(0!=ob(e,m)){bd(a),n(e);var h=O(f,g);(e.line>=h.to||e.line<h.from)&&setTimeout(Lc(a,function(){p==c&&q(b)}),150)}else{var i=b.clientY<o.top?-20:b.clientY>o.bottom?20:0;i&&setTimeout(Lc(a,function(){p==c&&(f.scroller.scrollTop+=i,q(b))}),50)}}function r(b){p=1/0,kg(b),ad(a),rg(document,"mousemove",s),rg(document,"mouseup",t),g.history.lastSelOrigin=null}var f=a.display,g=a.doc;kg(b);var h,i,j=g.sel;if(e&&!b.shiftKey?(i=g.sel.contains(c),h=i>-1?g.sel.ranges[i]:new tb(c,c)):h=g.sel.primary(),b.altKey)d="rect",e||(h=new tb(c,c)),c=gd(a,b,!0,!0),i=-1;else if("double"==d){var k=ie(a,c);h=a.display.shift||g.extend?Bb(g,h,k.anchor,k.head):k}else if("triple"==d){var l=new tb(nb(c.line,0),xb(g,nb(c.line+1,0)));h=a.display.shift||g.extend?Bb(g,h,l.anchor,l.head):l}else h=Bb(g,h,c);e?i>-1?Eb(g,i,h,Dg):(i=g.sel.ranges.length,Ib(g,ub(g.sel.ranges.concat([h]),i),{scroll:!1,origin:"*mouse"})):(i=0,Ib(g,new sb([h],0),Dg),j=g.sel);var m=c,o=f.wrapper.getBoundingClientRect(),p=0,s=Lc(a,function(a){pg(a)?q(a):r(a)}),t=Lc(a,r);qg(document,"mousemove",s),qg(document,"mouseup",t)}function nd(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(b){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&kg(b);var h=a.display,i=h.lineDiv.getBoundingClientRect();if(g>i.bottom||!yg(a,c))return mg(b);g-=i.top-h.viewOffset;for(var j=0;j<a.options.gutters.length;++j){var k=h.gutters.childNodes[j];if(k&&k.getBoundingClientRect().right>=f){var l=Uf(a.doc,g),m=a.options.gutters[j];return e(a,c,a,l,m,b),mg(b)}}}function od(a,b){return nd(a,b,"gutterClick",!0,ug)}function qd(a){var b=this;if(!wg(b,a)&&!fd(b.display,a)){kg(a),d&&(pd=+new Date);var c=gd(b,a,!0),e=a.dataTransfer.files;if(c&&!cd(b))if(e&&e.length&&window.FileReader&&window.File)for(var f=e.length,g=Array(f),h=0,i=function(a,d){var e=new FileReader;e.onload=Lc(b,function(){if(g[d]=e.result,++h==f){c=xb(b.doc,c);var a={from:c,to:c,text:qh(g.join("\n")),origin:"paste"};Rd(b.doc,a),Hb(b.doc,vb(c,Ld(a)))}}),e.readAsText(a)},j=0;f>j;++j)i(e[j],j);else{if(b.state.draggingText&&b.doc.sel.contains(c)>-1)return b.state.draggingText(a),setTimeout(Qg(ad,b),20),void 0;try{var g=a.dataTransfer.getData("Text");if(g){if(b.state.draggingText&&!(p?a.metaKey:a.ctrlKey))var k=b.listSelections();if(Jb(b.doc,vb(c,c)),k)for(var j=0;j<k.length;++j)Xd(b.doc,"",k[j].anchor,k[j].head,"drag");b.replaceSelection(g,"around","paste"),ad(b)}}catch(a){}}}}function rd(a,b){if(d&&(!a.state.draggingText||+new Date-pd<100))return ng(b),void 0;if(!wg(a,b)&&!fd(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!j)){var c=Xg("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",i&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop),b.dataTransfer.setDragImage(c,0,0),i&&c.parentNode.removeChild(c)}}function sd(b,c){Math.abs(b.doc.scrollTop-c)<2||(b.doc.scrollTop=c,a||W(b,{top:c}),b.display.scroller.scrollTop!=c&&(b.display.scroller.scrollTop=c),b.display.scrollbarV.scrollTop!=c&&(b.display.scrollbarV.scrollTop=c),a&&W(b),Ub(b,100))}function td(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,P(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function wd(b,c){var d=c.wheelDeltaX,e=c.wheelDeltaY;null==d&&c.detail&&c.axis==c.HORIZONTAL_AXIS&&(d=c.detail),null==e&&c.detail&&c.axis==c.VERTICAL_AXIS?e=c.detail:null==e&&(e=c.wheelDelta);var g=b.display,h=g.scroller;if(d&&h.scrollWidth>h.clientWidth||e&&h.scrollHeight>h.clientHeight){if(e&&p&&f)a:for(var j=c.target,k=g.view;j!=h;j=j.parentNode)for(var l=0;l<k.length;l++)if(k[l].node==j){b.display.currentWheelTarget=j;break a}if(d&&!a&&!i&&null!=vd)return e&&sd(b,Math.max(0,Math.min(h.scrollTop+e*vd,h.scrollHeight-h.clientHeight))),td(b,Math.max(0,Math.min(h.scrollLeft+d*vd,h.scrollWidth-h.clientWidth))),kg(c),g.wheelStartX=null,void 0;if(e&&null!=vd){var m=e*vd,n=b.doc.scrollTop,o=n+g.wrapper.clientHeight;0>m?n=Math.max(0,n+m-50):o=Math.min(b.doc.height,o+m+50),W(b,{top:n,bottom:o})}20>ud&&(null==g.wheelStartX?(g.wheelStartX=h.scrollLeft,g.wheelStartY=h.scrollTop,g.wheelDX=d,g.wheelDY=e,setTimeout(function(){if(null!=g.wheelStartX){var a=h.scrollLeft-g.wheelStartX,b=h.scrollTop-g.wheelStartY,c=b&&g.wheelDY&&b/g.wheelDY||a&&g.wheelDX&&a/g.wheelDX;g.wheelStartX=g.wheelStartY=null,c&&(vd=(vd*ud+c)/(ud+1),++ud)}},200)):(g.wheelDX+=d,g.wheelDY+=e))}}function xd(a,b,c){if("string"==typeof b&&(b=ue[b],!b))return!1;a.display.pollingFast&&$c(a)&&(a.display.pollingFast=!1);var d=a.display.shift,e=!1;try{cd(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=Bg}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function yd(a){var b=a.state.keyMaps.slice(0);return a.options.extraKeys&&b.push(a.options.extraKeys),b.push(a.options.keyMap),b}function Ad(a,b){var c=we(a.options.keyMap),d=c.auto;clearTimeout(zd),d&&!ye(b)&&(zd=setTimeout(function(){we(a.options.keyMap)==c&&(a.options.keyMap=d.call?d.call(null,a):d,D(a))},50));var e=ze(b,!0),f=!1;if(!e)return!1;var g=yd(a);return f=b.shiftKey?xe("Shift-"+e,g,function(b){return xd(a,b,!0)})||xe(e,g,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?xd(a,b):void 0}):xe(e,g,function(b){return xd(a,b)}),f&&(kg(b),Tb(a),ug(a,"keyHandled",a,e,b)),f}function Bd(a,b,c){var d=xe("'"+c+"'",yd(a),function(b){return xd(a,b,!0)});return d&&(kg(b),Tb(a),ug(a,"keyHandled",a,"'"+c+"'",b)),d}function Dd(a){var b=this;if(bd(b),!wg(b,a)){d&&11>e&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.display.shift=16==c||a.shiftKey;var f=Ad(b,a);i&&(Cd=f?c:null,!f&&88==c&&!sh&&(p?a.metaKey:a.ctrlKey)&&b.replaceSelection("",null,"cut")),18!=c||/\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className)||Ed(b)}}function Ed(a){function c(a){18!=a.keyCode&&a.altKey||(ch(b,"CodeMirror-crosshair"),rg(document,"keyup",c),rg(document,"mouseover",c))}var b=a.display.lineDiv;dh(b,"CodeMirror-crosshair"),qg(document,"keyup",c),qg(document,"mouseover",c)}function Fd(a){16==a.keyCode&&(this.doc.sel.shift=!1),wg(this,a)}function Gd(a){var b=this;if(!(wg(b,a)||a.ctrlKey&&!a.altKey||p&&a.metaKey)){var c=a.keyCode,f=a.charCode;if(i&&c==Cd)return Cd=null,kg(a),void 0;if(!(i&&(!a.which||a.which<10)||k)||!Ad(b,a)){var g=String.fromCharCode(null==f?c:f);Bd(b,a,g)||(d&&e>=9&&(b.display.inputHasSelection=null),Yc(b))}}}function Hd(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(sg(a,"focus",a),a.state.focused=!0,dh(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(_c(a),f&&setTimeout(Qg(_c,a,!0),0))),Xc(a),Tb(a))}function Id(a){a.state.focused&&(sg(a,"blur",a),a.state.focused=!1,ch(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150)}function Jd(a,b){function m(){if(null!=c.input.selectionStart){var b=a.somethingSelected(),d=c.input.value="\u200b"+(b?c.input.value:"");c.prevInput=b?"":"\u200b",c.input.selectionStart=1,c.input.selectionEnd=d.length,c.selForContextMenu=a.doc.sel}}function n(){if(c.inputDiv.style.position="relative",c.input.style.cssText=k,d&&9>e&&(c.scrollbarV.scrollTop=c.scroller.scrollTop=h),Xc(a),null!=c.input.selectionStart){(!d||d&&9>e)&&m();var b=0,f=function(){c.selForContextMenu==a.doc.sel&&0==c.input.selectionStart?Lc(a,ue.selectAll)(a):b++<10?c.detectingSelectAll=setTimeout(f,500):_c(a)};c.detectingSelectAll=setTimeout(f,200)}}if(!wg(a,b,"contextmenu")){var c=a.display;if(!fd(c,b)&&!Kd(a,b)){var g=gd(a,b),h=c.scroller.scrollTop;if(g&&!i){var j=a.options.resetSelectionOnContextMenu;j&&-1==a.doc.sel.contains(g)&&Lc(a,Ib)(a.doc,vb(g),Cg);var k=c.input.style.cssText;if(c.inputDiv.style.position="absolute",c.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: "+(d?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",f)var l=window.scrollY;if(ad(a),f&&window.scrollTo(null,l),_c(a),a.somethingSelected()||(c.input.value=c.prevInput=" "),c.selForContextMenu=a.doc.sel,clearTimeout(c.detectingSelectAll),d&&e>=9&&m(),t){ng(b);var o=function(){rg(window,"mouseup",o),setTimeout(n,20)};qg(window,"mouseup",o)}else setTimeout(n,50)}}}}function Kd(a,b){return yg(a,"gutterContextMenu")?nd(a,b,"gutterContextMenu",!1,sg):!1}function Md(a,b){if(ob(a,b.from)<0)return a;if(ob(a,b.to)<=0)return Ld(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;return a.line==b.to.line&&(d+=Ld(b).ch-b.to.ch),nb(c,d)}function Nd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new tb(Md(e.anchor,b),Md(e.head,b)))}return ub(c,a.sel.primIndex)}function Od(a,b,c){return a.line==b.line?nb(c.line,a.ch-b.ch+c.ch):nb(c.line+(a.line-b.line),a.ch)}function Pd(a,b,c){for(var d=[],e=nb(a.first,0),f=e,g=0;g<b.length;g++){var h=b[g],i=Od(h.from,e,f),j=Od(Ld(h),e,f);if(e=h.to,f=j,"around"==c){var k=a.sel.ranges[g],l=ob(k.head,k.anchor)<0;d[g]=new tb(l?j:i,l?i:j)}else d[g]=new tb(i,i)}return new sb(d,a.sel.primIndex)}function Qd(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=xb(a,b)),c&&(this.to=xb(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),sg(a,"beforeChange",a,d),a.cm&&sg(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function Rd(a,b,c){if(a.cm){if(!a.cm.curOp)return Lc(a.cm,Rd)(a,b,c);if(a.cm.state.suppressEdits)return}if(!(yg(a,"beforeChange")||a.cm&&yg(a.cm,"beforeChange"))||(b=Qd(a,b,!0))){var d=u&&!c&&Se(a,b.from,b.to);if(d)for(var e=d.length-1;e>=0;--e)Sd(a,{from:d[e].from,to:d[e].to,text:e?[""]:b.text});else Sd(a,b)}}function Sd(a,b){if(1!=b.text.length||""!=b.text[0]||0!=ob(b.from,b.to)){var c=Nd(a,b);_f(a,b,c,a.cm?a.cm.curOp.id:0/0),Vd(a,b,c,Pe(a,b));var d=[];Nf(a,function(a,c){c||-1!=Mg(d,a.history)||(jg(a.history,b),d.push(a.history)),Vd(a,b,null,Pe(a,b))})}}function Td(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var e,d=a.history,f=a.sel,g="undo"==b?d.done:d.undone,h="undo"==b?d.undone:d.done,i=0;i<g.length&&(e=g[i],c?!e.ranges||e.equals(a.sel):e.ranges);i++);if(i!=g.length){for(d.lastOrigin=d.lastSelOrigin=null;e=g.pop(),e.ranges;){if(cg(e,h),c&&!e.equals(a.sel))return Ib(a,e,{clearRedo:!1}),void 0;f=e}var j=[];cg(f,h),h.push({changes:j,generation:d.generation}),d.generation=e.generation||++d.maxGeneration;for(var k=yg(a,"beforeChange")||a.cm&&yg(a.cm,"beforeChange"),i=e.changes.length-1;i>=0;--i){var l=e.changes[i];if(l.origin=b,k&&!Qd(a,l,!1))return g.length=0,void 0;j.push(Yf(a,l));var m=i?Nd(a,l):Kg(g);Vd(a,l,m,Re(a,l)),!i&&a.cm&&a.cm.scrollIntoView({from:l.from,to:Ld(l)});var n=[];Nf(a,function(a,b){b||-1!=Mg(n,a.history)||(jg(a.history,l),n.push(a.history)),Vd(a,l,null,Re(a,l))})}}}}function Ud(a,b){if(0!=b&&(a.first+=b,a.sel=new sb(Ng(a.sel.ranges,function(a){return new tb(nb(a.anchor.line+b,a.anchor.ch),nb(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){Qc(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Rc(a.cm,d,"gutter")}}function Vd(a,b,c,d){if(a.cm&&!a.cm.curOp)return Lc(a.cm,Vd)(a,b,c,d);if(b.to.line<a.first)return Ud(a,b.text.length-1-(b.to.line-b.from.line)),void 0;if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Ud(a,e),b={from:nb(a.first,0),to:nb(b.to.line+e,b.to.ch),text:[Kg(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:nb(f,Pf(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=Qf(a,b.from,b.to),c||(c=Nd(a,b)),a.cm?Wd(a.cm,b,d):Gf(a,b,d),Jb(a,c,Cg)}}function Wd(a,b,c){var d=a.doc,e=a.display,f=b.from,g=b.to,h=!1,i=f.line;a.options.lineWrapping||(i=Tf(af(Pf(d,f.line))),d.iter(i,g.line+1,function(a){return a==e.maxLine?(h=!0,!0):void 0})),d.sel.contains(b.from,b.to)>-1&&xg(a),Gf(d,b,c,B(a)),a.options.lineWrapping||(d.iter(i,f.line+b.text.length,function(a){var b=I(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,h=!1)}),h&&(a.curOp.updateMaxLine=!0)),d.frontier=Math.min(d.frontier,f.line),Ub(a,400);var j=b.text.length-(g.line-f.line)-1;f.line!=g.line||1!=b.text.length||Ff(a.doc,b)?Qc(a,f.line,g.line+1,j):Rc(a,f.line,"text");var k=yg(a,"changes"),l=yg(a,"change");if(l||k){var m={from:f,to:g,text:b.text,removed:b.removed,origin:b.origin};l&&ug(a,"change",a,m),k&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(m)}a.display.selForContextMenu=null}function Xd(a,b,c,d,e){if(d||(d=c),ob(d,c)<0){var f=d;d=c,c=f}"string"==typeof b&&(b=qh(b)),Rd(a,{from:c,to:d,text:b,origin:e})}function Yd(a,b){var c=a.display,d=c.sizer.getBoundingClientRect(),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!m){var f=Xg("div","\u200b",null,"position: absolute; top: "+(b.top-c.viewOffset-Yb(a.display))+"px; height: "+(b.bottom-b.top+Ag)+"px; left: "+b.left+"px; width: 2px;");a.display.lineSpace.appendChild(f),f.scrollIntoView(e),a.display.lineSpace.removeChild(f)}}function Zd(a,b,c,d){for(null==d&&(d=0);;){var e=!1,f=rc(a,b),g=c&&c!=b?rc(a,c):f,h=_d(a,Math.min(f.left,g.left),Math.min(f.top,g.top)-d,Math.max(f.left,g.left),Math.max(f.bottom,g.bottom)+d),i=a.doc.scrollTop,j=a.doc.scrollLeft;if(null!=h.scrollTop&&(sd(a,h.scrollTop),Math.abs(a.doc.scrollTop-i)>1&&(e=!0)),null!=h.scrollLeft&&(td(a,h.scrollLeft),Math.abs(a.doc.scrollLeft-j)>1&&(e=!0)),!e)return f}}function $d(a,b,c,d,e){var f=_d(a,b,c,d,e);null!=f.scrollTop&&sd(a,f.scrollTop),null!=f.scrollLeft&&td(a,f.scrollLeft)}function _d(a,b,c,d,e){var f=a.display,g=xc(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,i=f.scroller.clientHeight-Ag,j={};e-c>i&&(e=c+i);var k=a.doc.height+Zb(f),l=g>c,m=e>k-g;if(h>c)j.scrollTop=l?0:c;else if(e>h+i){var n=Math.min(c,(m?k:e)-i);n!=h&&(j.scrollTop=n)}var o=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft,p=f.scroller.clientWidth-Ag-f.gutters.offsetWidth,q=d-b>p;return q&&(d=c+i),10>b?j.scrollLeft=0:o>b?j.scrollLeft=Math.max(0,b-(q?0:10)):d>p+o-3&&(j.scrollLeft=d+(q?0:10)-p),j}function ae(a,b,c){(null!=b||null!=c)&&ce(a),null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b),null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function be(a){ce(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?nb(b.line,b.ch-1):b,d=nb(b.line,b.ch+1)),a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function ce(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=sc(a,b.from),d=sc(a,b.to),e=_d(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(e.scrollLeft,e.scrollTop)}}function de(a,b,c,d){var f,e=a.doc;null==c&&(c="add"),"smart"==c&&(e.mode.indent?f=Xb(a,b):c="prev");var g=a.options.tabSize,h=Pf(e,b),i=Gg(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var k,j=h.text.match(/^\s*/)[0];if(d||/\S/.test(h.text)){if("smart"==c&&(k=e.mode.indent(f,h.text.slice(j.length),h.text),k==Bg||k>150)){if(!d)return;c="prev"}}else k=0,c="not";"prev"==c?k=b>e.first?Gg(Pf(e,b-1).text,null,g):0:"add"==c?k=i+a.options.indentUnit:"subtract"==c?k=i-a.options.indentUnit:"number"==typeof c&&(k=i+c),k=Math.max(0,k);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(k/g);n;--n)m+=g,l+="	";if(k>m&&(l+=Jg(k-m)),l!=j)Xd(e,l,nb(b,0),nb(b,j.length),"+input");else for(var n=0;n<e.sel.ranges.length;n++){var o=e.sel.ranges[n];if(o.head.line==b&&o.head.ch<j.length){var m=nb(b,j.length);Eb(e,n,new tb(m,m));break}}h.stateAfter=null}function ee(a,b,c,d){var e=b,f=b;return"number"==typeof b?f=Pf(a,wb(a,b)):e=Tf(b),null==e?null:(d(f,e)&&a.cm&&Rc(a.cm,e,c),f)}function fe(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&ob(f.from,Kg(d).to)<=0;){var g=d.pop();if(ob(g.from,f.from)<0){f.from=g.from;break}}d.push(f)}Kc(a,function(){for(var b=d.length-1;b>=0;b--)Xd(a.doc,"",d[b].from,d[b].to,"+delete");be(a)})}function ge(a,b,c,d,e){function k(){var b=f+c;return b<a.first||b>=a.first+a.size?j=!1:(f=b,i=Pf(a,b))}function l(a){var b=(e?Ih:Jh)(i,g,c,!0);if(null==b){if(a||!k())return j=!1;g=e?(0>c?Ah:zh)(i):0>c?i.text.length:0}else g=b;return!0}var f=b.line,g=b.ch,h=c,i=Pf(a,f),j=!0;if("char"==d)l();else if("column"==d)l(!0);else if("word"==d||"group"==d)for(var m=null,n="group"==d,o=a.cm&&a.cm.getHelper(b,"wordChars"),p=!0;!(0>c)||l(!p);p=!1){var q=i.text.charAt(g)||"\n",r=Tg(q,o)?"w":n&&"\n"==q?"n":!n||/\s/.test(q)?null:"p";if(!n||p||r||(r="s"),m&&m!=r){0>c&&(c=1,l());break}if(r&&(m=r),c>0&&!l(!p))break}var s=Nb(a,nb(f,g),h,!0);return j||(s.hitSide=!0),s}function he(a,b,c,d){var g,e=a.doc,f=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);g=b.top+c*(h-(0>c?1.5:.5)*xc(a.display))}else"line"==d&&(g=c>0?b.bottom+3:b.top-3);for(;;){var i=uc(a,f,g);if(!i.outside)break;if(0>c?0>=g:g>=e.height){i.hitSide=!0;break}g+=5*c}return i}function ie(a,b){var c=a.doc,d=Pf(c,b.line).text,e=b.ch,f=b.ch;if(d){var g=a.getHelper(b,"wordChars");(b.xRel<0||f==d.length)&&e?--e:++f;for(var h=d.charAt(e),i=Tg(h,g)?function(a){return Tg(a,g)}:/\s/.test(h)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Tg(a)};e>0&&i(d.charAt(e-1));)--e;for(;f<d.length&&i(d.charAt(f));)++f}return new tb(nb(b.line,e),nb(b.line,f))}function le(a,b,c,d){w.defaults[a]=b,c&&(ke[a]=d?function(a,b,d){d!=me&&c(a,b,d)}:c)}function we(a){return"string"==typeof a?ve[a]:a}function De(a,b,c,d,e){if(d&&d.shared)return Fe(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return Lc(a.cm,De)(a,b,c,d,e);var f=new Be(a,e),g=ob(b,c);if(d&&Pg(d,f,!1),g>0||0==g&&f.clearWhenEmpty!==!1)return f;if(f.replacedWith&&(f.collapsed=!0,f.widgetNode=Xg("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||(f.widgetNode.ignoreEvents=!0),d.insertLeft&&(f.widgetNode.insertLeft=!0)),f.collapsed){if(_e(a,b.line,b,c,f)||b.line!=c.line&&_e(a,c.line,b,c,f))throw new Error("Inserting collapsed marker partially overlapping an existing one");v=!0}f.addToHistory&&_f(a,{from:b,to:c,origin:"markText"},a.sel,0/0);
var j,h=b.line,i=a.cm;if(a.iter(h,c.line+1,function(a){i&&f.collapsed&&!i.options.lineWrapping&&af(a)==i.display.maxLine&&(j=!0),f.collapsed&&h!=b.line&&Sf(a,0),Me(a,new Je(f,h==b.line?b.ch:null,h==c.line?c.ch:null)),++h}),f.collapsed&&a.iter(b.line,c.line+1,function(b){ef(a,b)&&Sf(b,0)}),f.clearOnEnter&&qg(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(u=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed&&(f.id=++Ce,f.atomic=!0),i){if(j&&(i.curOp.updateMaxLine=!0),f.collapsed)Qc(i,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle)for(var k=b.line;k<=c.line;k++)Rc(i,k,"text");f.atomic&&Lb(i.doc),ug(i,"markerAdded",i,f)}return f}function Fe(a,b,c,d,e){d=Pg(d),d.shared=!1;var f=[De(a,b,c,d,e)],g=f[0],h=d.widgetNode;return Nf(a,function(a){h&&(d.widgetNode=h.cloneNode(!0)),f.push(De(a,xb(a,b),xb(a,c),d,e));for(var i=0;i<a.linked.length;++i)if(a.linked[i].isParent)return;g=Kg(f)}),new Ee(f,g)}function Ge(a){return a.findMarks(nb(a.first,0),a.clipPos(nb(a.lastLine())),function(a){return a.parent})}function He(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.find(),f=a.clipPos(e.from),g=a.clipPos(e.to);if(ob(f,g)){var h=De(a,f,g,d.primary,d.primary.type);d.markers.push(h),h.parent=d}}}function Ie(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];Nf(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==Mg(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function Je(a,b,c){this.marker=a,this.from=b,this.to=c}function Ke(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Le(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function Me(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function Ne(a,b,c){if(a)for(var e,d=0;d<a.length;++d){var f=a[d],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||f.from==b&&"bookmark"==g.type&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(e||(e=[])).push(new Je(g,f.from,i?null:f.to))}}return e}function Oe(a,b,c){if(a)for(var e,d=0;d<a.length;++d){var f=a[d],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||f.from==b&&"bookmark"==g.type&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(e||(e=[])).push(new Je(g,i?null:f.from-b,null==f.to?null:f.to-b))}}return e}function Pe(a,b){var c=zb(a,b.from.line)&&Pf(a,b.from.line).markedSpans,d=zb(a,b.to.line)&&Pf(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==ob(b.from,b.to),h=Ne(c,e,g),i=Oe(d,f,g),j=1==b.text.length,k=Kg(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=Ke(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=Ke(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}h&&(h=Qe(h)),i&&i!=h&&(i=Qe(i));var o=[h];if(!j){var q,p=b.text.length-2;if(p>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(q||(q=[])).push(new Je(h[l].marker,null,null));for(var l=0;p>l;++l)o.push(q);o.push(i)}return o}function Qe(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&c.marker.clearWhenEmpty!==!1&&a.splice(b--,1)}return a.length?a:null}function Re(a,b){var c=fg(a,b),d=Pe(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Se(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=Mg(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(0),i=0;i<e.length;++i){var j=e[i];if(!(ob(j.to,h.from)<0||ob(j.from,h.to)>0)){var k=[i,1],l=ob(j.from,h.from),m=ob(j.to,h.to);(0>l||!g.inclusiveLeft&&!l)&&k.push({from:j.from,to:h.from}),(m>0||!g.inclusiveRight&&!m)&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function Te(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Ue(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Ve(a){return a.inclusiveLeft?-1:0}function We(a){return a.inclusiveRight?1:0}function Xe(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var d=a.find(),e=b.find(),f=ob(d.from,e.from)||Ve(a)-Ve(b);if(f)return-f;var g=ob(d.to,e.to)||We(a)-We(b);return g?g:b.id-a.id}function Ye(a,b){var d,c=v&&a.markedSpans;if(c)for(var e,f=0;f<c.length;++f)e=c[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!d||Xe(d,e.marker)<0)&&(d=e.marker);return d}function Ze(a){return Ye(a,!0)}function $e(a){return Ye(a,!1)}function _e(a,b,c,d,e){var f=Pf(a,b),g=v&&f.markedSpans;if(g)for(var h=0;h<g.length;++h){var i=g[h];if(i.marker.collapsed){var j=i.marker.find(0),k=ob(j.from,c)||Ve(i.marker)-Ve(e),l=ob(j.to,d)||We(i.marker)-We(e);if(!(k>=0&&0>=l||0>=k&&l>=0)&&(0>=k&&(ob(j.to,c)>0||i.marker.inclusiveRight&&e.inclusiveLeft)||k>=0&&(ob(j.from,d)<0||i.marker.inclusiveLeft&&e.inclusiveRight)))return!0}}}function af(a){for(var b;b=Ze(a);)a=b.find(-1,!0).line;return a}function bf(a){for(var b,c;b=$e(a);)a=b.find(1,!0).line,(c||(c=[])).push(a);return c}function cf(a,b){var c=Pf(a,b),d=af(c);return c==d?b:Tf(d)}function df(a,b){if(b>a.lastLine())return b;var d,c=Pf(a,b);if(!ef(a,c))return b;for(;d=$e(c);)c=d.find(1,!0).line;return Tf(c)+1}function ef(a,b){var c=v&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&ff(a,b,d))return!0}}function ff(a,b,c){if(null==c.to){var d=c.marker.find(1,!0);return ff(a,d.line,Ke(d.line.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,f=0;f<b.markedSpans.length;++f)if(e=b.markedSpans[f],e.marker.collapsed&&!e.marker.widgetNode&&e.from==c.to&&(null==e.to||e.to!=c.from)&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&ff(a,b,e))return!0}function hf(a,b,c){Vf(b)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&ae(a,null,c)}function jf(a){if(null!=a.height)return a.height;if(!_g(document.body,a.node)){var b="position: relative;";a.coverGutter&&(b+="margin-left: -"+a.cm.getGutterElement().offsetWidth+"px;"),$g(a.cm.display.measure,Xg("div",[a.node],null,b))}return a.height=a.node.offsetHeight}function kf(a,b,c,d){var e=new gf(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),ee(a.doc,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,!ef(a.doc,b)){var d=Vf(b)<a.doc.scrollTop;Sf(b,b.height+jf(e)),d&&ae(a,null,e.height),a.curOp.forceUpdate=!0}return!0}),e}function mf(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),Te(a),Ue(a,c);var e=d?d(a):1;e!=a.height&&Sf(a,e)}function nf(a){a.parent=null,Te(a)}function of(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return a}function pf(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var c=w.innerMode(a,b);return c.mode.blankLine?c.mode.blankLine(c.state):void 0}}function qf(a,b,c){for(var d=0;10>d;d++){var e=a.token(b,c);if(b.pos>b.start)return e}throw new Error("Mode "+a.name+" failed to advance stream.")}function rf(a,b,c,d,e,f,g){var h=c.flattenSpans;null==h&&(h=a.options.flattenSpans);var l,i=0,j=null,k=new Ae(b,a.options.tabSize);for(""==b&&of(pf(c,d),f);!k.eol();){if(k.pos>a.options.maxHighlightLength?(h=!1,g&&uf(a,b,d,k.pos),k.pos=b.length,l=null):l=of(qf(c,k,d),f),a.options.addModeClass){var m=w.innerMode(c,d).mode.name;m&&(l="m-"+(l?m+" "+l:m))}h&&j==l||(i<k.start&&e(k.start,j),i=k.start,j=l),k.start=k.pos}for(;i<k.pos;){var n=Math.min(k.pos,i+5e4);e(n,j),i=n}}function sf(a,b,c,d){var e=[a.state.modeGen],f={};rf(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(var g=0;g<a.state.overlays.length;++g){var h=a.state.overlays[g],i=1,j=0;rf(a,b.text,h.mode,!0,function(a,b){for(var c=i;a>j;){var d=e[i];d>a&&e.splice(i,1,a,e[i+1],d),i+=2,j=Math.min(a,d)}if(b)if(h.opaque)e.splice(c,i-c,a,"cm-overlay "+b),i=c+2;else for(;i>c;c+=2){var f=e[c+1];e[c+1]=(f?f+" ":"")+"cm-overlay "+b}},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function tf(a,b){if(!b.styles||b.styles[0]!=a.state.modeGen){var c=sf(a,b,b.stateAfter=Xb(a,Tf(b)));b.styles=c.styles,c.classes?b.styleClasses=c.classes:b.styleClasses&&(b.styleClasses=null)}return b.styles}function uf(a,b,c,d){var e=a.doc.mode,f=new Ae(b,a.options.tabSize);for(f.start=f.pos=d||0,""==b&&pf(e,c);!f.eol()&&f.pos<=a.options.maxHighlightLength;)qf(e,f,c),f.start=f.pos}function xf(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?wf:vf;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function yf(a,b){var c=Xg("span",null,null,f?"padding-right: .1px":null),e={pre:Xg("pre",[c]),content:c,col:0,pos:0,cm:a};b.measure={};for(var g=0;g<=(b.rest?b.rest.length:0);g++){var i,h=g?b.rest[g-1]:b.line;e.pos=0,e.addToken=Af,(d||f)&&a.getOption("lineWrapping")&&(e.addToken=Bf(e.addToken)),ph(a.display.measure)&&(i=Wf(h))&&(e.addToken=Cf(e.addToken,i)),e.map=[],Ef(h,e,tf(a,h)),h.styleClasses&&(h.styleClasses.bgClass&&(e.bgClass=eh(h.styleClasses.bgClass,e.bgClass||"")),h.styleClasses.textClass&&(e.textClass=eh(h.styleClasses.textClass,e.textClass||""))),0==e.map.length&&e.map.push(0,0,e.content.appendChild(nh(a.display.measure))),0==g?(b.measure.map=e.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(e.map),(b.measure.caches||(b.measure.caches=[])).push({}))}return sg(a,"renderLine",a,b.line,e.pre),e.pre.className&&(e.textClass=eh(e.pre.className,e.textClass||"")),e}function zf(a){var b=Xg("span","\u2022","cm-invalidchar");return b.title="\\u"+a.charCodeAt(0).toString(16),b}function Af(a,b,c,f,g,h){if(b){var i=a.cm.options.specialChars,j=!1;if(i.test(b))for(var k=document.createDocumentFragment(),l=0;;){i.lastIndex=l;var m=i.exec(b),n=m?m.index-l:b.length-l;if(n){var o=document.createTextNode(b.slice(l,l+n));d&&9>e?k.appendChild(Xg("span",[o])):k.appendChild(o),a.map.push(a.pos,a.pos+n,o),a.col+=n,a.pos+=n}if(!m)break;if(l+=n+1,"	"==m[0]){var p=a.cm.options.tabSize,q=p-a.col%p,o=k.appendChild(Xg("span",Jg(q),"cm-tab"));a.col+=q}else{var o=a.cm.options.specialCharPlaceholder(m[0]);d&&9>e?k.appendChild(Xg("span",[o])):k.appendChild(o),a.col+=1}a.map.push(a.pos,a.pos+1,o),a.pos++}else{a.col+=b.length;var k=document.createTextNode(b);a.map.push(a.pos,a.pos+b.length,k),d&&9>e&&(j=!0),a.pos+=b.length}if(c||f||g||j){var r=c||"";f&&(r+=f),g&&(r+=g);var s=Xg("span",[k],r);return h&&(s.title=h),a.content.appendChild(s)}a.content.appendChild(k)}}function Bf(a){function b(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\xa0";return b+=" "}return function(c,d,e,f,g,h){a(c,d.replace(/ {3,}/g,b),e,f,g,h)}}function Cf(a,b){return function(c,d,e,f,g,h){e=e?e+" cm-force-border":"cm-force-border";for(var i=c.pos,j=i+d.length;;){for(var k=0;k<b.length;k++){var l=b[k];if(l.to>i&&l.from<=i)break}if(l.to>=j)return a(c,d,e,f,g,h);a(c,d.slice(0,l.to-i),e,f,null,h),f=null,d=d.slice(l.to-i),i=l.to}}}function Df(a,b,c,d){var e=!d&&c.widgetNode;e&&(a.map.push(a.pos,a.pos+b,e),a.content.appendChild(e)),a.pos+=b}function Ef(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var k,m,n,o,p,q,h=e.length,i=0,g=1,j="",l=0;;){if(l==i){m=n=o=p="",q=null,l=1/0;for(var r=[],s=0;s<d.length;++s){var t=d[s],u=t.marker;t.from<=i&&(null==t.to||t.to>i)?(null!=t.to&&l>t.to&&(l=t.to,n=""),u.className&&(m+=" "+u.className),u.startStyle&&t.from==i&&(o+=" "+u.startStyle),u.endStyle&&t.to==l&&(n+=" "+u.endStyle),u.title&&!p&&(p=u.title),u.collapsed&&(!q||Xe(q.marker,u)<0)&&(q=t)):t.from>i&&l>t.from&&(l=t.from),"bookmark"==u.type&&t.from==i&&u.widgetNode&&r.push(u)}if(q&&(q.from||0)==i&&(Df(b,(null==q.to?h+1:q.to)-i,q.marker,null==q.from),null==q.to))return;if(!q&&r.length)for(var s=0;s<r.length;++s)Df(b,0,r[s])}if(i>=h)break;for(var v=Math.min(h,l);;){if(j){var w=i+j.length;if(!q){var x=w>v?j.slice(0,v-i):j;b.addToken(b,x,k?k+m:m,o,i+x.length==l?n:"",p)}if(w>=v){j=j.slice(v-i),i=v;break}i=w,o=""}j=e.slice(f,f=c[g++]),k=xf(c[g++],b.cm.options)}}else for(var g=1;g<c.length;g+=2)b.addToken(b,e.slice(f,f=c[g]),xf(c[g+1],b.cm.options))}function Ff(a,b){return 0==b.from.ch&&0==b.to.ch&&""==Kg(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Gf(a,b,c,d){function e(a){return c?c[a]:null}function f(a,c,e){mf(a,c,e,d),ug(a,"change",a,b)}var g=b.from,h=b.to,i=b.text,j=Pf(a,g.line),k=Pf(a,h.line),l=Kg(i),m=e(i.length-1),n=h.line-g.line;if(Ff(a,b)){for(var o=0,p=[];o<i.length-1;++o)p.push(new lf(i[o],e(o),d));f(k,k.text,m),n&&a.remove(g.line,n),p.length&&a.insert(g.line,p)}else if(j==k)if(1==i.length)f(j,j.text.slice(0,g.ch)+l+j.text.slice(h.ch),m);else{for(var p=[],o=1;o<i.length-1;++o)p.push(new lf(i[o],e(o),d));p.push(new lf(l+j.text.slice(h.ch),m,d)),f(j,j.text.slice(0,g.ch)+i[0],e(0)),a.insert(g.line+1,p)}else if(1==i.length)f(j,j.text.slice(0,g.ch)+i[0]+k.text.slice(h.ch),e(0)),a.remove(g.line+1,n);else{f(j,j.text.slice(0,g.ch)+i[0],e(0)),f(k,l+k.text.slice(h.ch),m);for(var o=1,p=[];o<i.length-1;++o)p.push(new lf(i[o],e(o),d));n>1&&a.remove(g.line+1,n-1),a.insert(g.line+1,p)}ug(a,"change",a,b)}function Hf(a){this.lines=a,this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function If(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize(),c+=e.height,e.parent=this}this.size=b,this.height=c,this.parent=null}function Nf(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function Of(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,C(a),y(a),a.options.lineWrapping||J(a),a.options.mode=b.modeOption,Qc(a)}function Pf(a,b){if(b-=a.first,0>b||b>=a.size)throw new Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(f>b){c=e;break}b-=f}return c.lines[b]}function Qf(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function Rf(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function Sf(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function Tf(a){if(null==a.parent)return null;for(var b=a.parent,c=Mg(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function Uf(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(f>b){a=e;continue a}b-=f,c+=e.chunkSize()}return c}while(!a.lines);for(var d=0;d<a.lines.length;++d){var g=a.lines[d],h=g.height;if(h>b)break;b-=h}return c+d}function Vf(a){a=af(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;b+=e.height}for(var f=c.parent;f;c=f,f=c.parent)for(var d=0;d<f.children.length;++d){var g=f.children[d];if(g==c)break;b+=g.height}return b}function Wf(a){var b=a.order;return null==b&&(b=a.order=Kh(a.text)),b}function Xf(a){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a||1}function Yf(a,b){var c={from:pb(b.from),to:Ld(b),text:Qf(a,b.from,b.to)};return dg(a,c,b.from.line,b.to.line+1),Nf(a,function(a){dg(a,c,b.from.line,b.to.line+1)},!0),c}function Zf(a){for(;a.length;){var b=Kg(a);if(!b.ranges)break;a.pop()}}function $f(a,b){return b?(Zf(a.done),Kg(a.done)):a.done.length&&!Kg(a.done).ranges?Kg(a.done):a.done.length>1&&!a.done[a.done.length-2].ranges?(a.done.pop(),Kg(a.done)):void 0}function _f(a,b,c,d){var e=a.history;e.undone.length=0;var g,f=+new Date;if((e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))&&(g=$f(e,e.lastOp==d))){var h=Kg(g.changes);0==ob(b.from,b.to)&&0==ob(b.from,h.to)?h.to=Ld(b):g.changes.push(Yf(a,b))}else{var i=Kg(e.done);for(i&&i.ranges||cg(a.sel,e.done),g={changes:[Yf(a,b)],generation:e.generation},e.done.push(g);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift()}e.done.push(c),e.generation=++e.maxGeneration,e.lastModTime=e.lastSelTime=f,e.lastOp=e.lastSelOp=d,e.lastOrigin=e.lastSelOrigin=b.origin,h||sg(a,"historyAdded")}function ag(a,b,c,d){var e=b.charAt(0);return"*"==e||"+"==e&&c.ranges.length==d.ranges.length&&c.somethingSelected()==d.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function bg(a,b,c,d){var e=a.history,f=d&&d.origin;c==e.lastSelOp||f&&e.lastSelOrigin==f&&(e.lastModTime==e.lastSelTime&&e.lastOrigin==f||ag(a,f,Kg(e.done),b))?e.done[e.done.length-1]=b:cg(b,e.done),e.lastSelTime=+new Date,e.lastSelOrigin=f,e.lastSelOp=c,d&&d.clearRedo!==!1&&Zf(e.undone)}function cg(a,b){var c=Kg(b);c&&c.ranges&&c.equals(a)||b.push(a)}function dg(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function eg(a){if(!a)return null;for(var c,b=0;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function fg(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(eg(c[d]));return e}function gg(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?sb.prototype.deepCopy.call(f):f);else{var g=f.changes,h=[];e.push({changes:h});for(var i=0;i<g.length;++i){var k,j=g[i];if(h.push({from:j.from,to:j.to,text:j.text}),b)for(var l in j)(k=l.match(/^spans_(\d+)$/))&&Mg(b,Number(k[1]))>-1&&(Kg(h)[l]=j[l],delete j[l])}}}return e}function hg(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function ig(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;h<f.ranges.length;h++)hg(f.ranges[h].anchor,b,c,d),hg(f.ranges[h].head,b,c,d)}else{for(var h=0;h<f.changes.length;++h){var i=f.changes[h];if(c<i.from.line)i.from=nb(i.from.line+d,i.from.ch),i.to=nb(i.to.line+d,i.to.ch);else if(b<=i.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function jg(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;ig(a.done,c,d,e),ig(a.undone,c,d,e)}function mg(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function og(a){return a.target||a.srcElement}function pg(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),p&&a.ctrlKey&&1==b&&(b=3),b}function ug(a,b){function f(a){return function(){a.apply(null,d)}}var c=a._handlers&&a._handlers[b];if(c){var e,d=Array.prototype.slice.call(arguments,2);zc?e=zc.delayedCallbacks:tg?e=tg:(e=tg=[],setTimeout(vg,0));for(var g=0;g<c.length;++g)e.push(f(c[g]))}}function vg(){var a=tg;tg=null;for(var b=0;b<a.length;++b)a[b]()}function wg(a,b,c){return sg(a,c||b.type,a,b),mg(b)||b.codemirrorIgnore}function xg(a){var b=a._handlers&&a._handlers.cursorActivity;if(b)for(var c=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),d=0;d<b.length;++d)-1==Mg(c,b[d])&&c.push(b[d])}function yg(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function zg(a){a.prototype.on=function(a,b){qg(this,a,b)},a.prototype.off=function(a,b){rg(this,a,b)}}function Fg(){this.id=null}function Hg(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("	",d);-1==f&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);if(e+=f-d,e+=c-e%c,d=f+1,e>=b)return d}}function Jg(a){for(;Ig.length<=a;)Ig.push(Kg(Ig)+" ");return Ig[a]}function Kg(a){return a[a.length-1]}function Mg(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function Ng(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function Og(a,b){var c;if(Object.create)c=Object.create(a);else{var d=function(){};d.prototype=a,c=new d}return b&&Pg(b,c),c}function Pg(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||c===!1&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Qg(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Tg(a,b){return b?b.source.indexOf("\\w")>-1&&Sg(a)?!0:b.test(a):Sg(a)}function Ug(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Wg(a){return a.charCodeAt(0)>=768&&Vg.test(a)}function Xg(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function Zg(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function $g(a,b){return Zg(a).appendChild(b)}function _g(a,b){if(a.contains)return a.contains(b);for(;b=b.parentNode;)if(b==a)return!0}function ah(){return document.activeElement}function bh(a){return new RegExp("\\b"+a+"\\b\\s*")}function ch(a,b){var c=bh(b);c.test(a.className)&&(a.className=a.className.replace(c,""))}function dh(a,b){bh(b).test(a.className)||(a.className+=" "+b)}function eh(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!bh(c[d]).test(b)&&(b+=" "+c[d]);return b}function fh(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function hh(){gh||(ih(),gh=!0)}function ih(){var a;qg(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null,kh=null,fh(ed)},100))}),qg(window,"blur",function(){fh(Id)})}function lh(a){if(null!=kh)return kh;var b=Xg("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return $g(a,b),b.offsetWidth&&(kh=b.offsetHeight-b.clientHeight),kh||0}function nh(a){if(null==mh){var b=Xg("span","\u200b");$g(a,Xg("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(mh=b.offsetWidth<=1&&b.offsetHeight>2&&!(d&&8>e))}return mh?Xg("span","\u200b"):Xg("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px")}function ph(a){if(null!=oh)return oh;var b=$g(a,document.createTextNode("A\u062eA")),c=Yg(b,0,1).getBoundingClientRect();if(c.left==c.right)return!1;var d=Yg(b,1,2).getBoundingClientRect();return oh=d.right-c.right<3}function uh(a){if(null!=th)return th;var b=$g(a,Xg("span","x")),c=b.getBoundingClientRect(),d=Yg(b,0,1).getBoundingClientRect();return th=Math.abs(c.left-d.left)>1}function wh(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];(g.from<c&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function xh(a){return a.level%2?a.to:a.from}function yh(a){return a.level%2?a.from:a.to}function zh(a){var b=Wf(a);return b?xh(b[0]):0}function Ah(a){var b=Wf(a);return b?yh(Kg(b)):a.text.length}function Bh(a,b){var c=Pf(a.doc,b),d=af(c);d!=c&&(b=Tf(d));var e=Wf(d),f=e?e[0].level%2?Ah(d):zh(d):0;return nb(b,f)}function Ch(a,b){for(var c,d=Pf(a.doc,b);c=$e(d);)d=c.find(1,!0).line,b=null;var e=Wf(d),f=e?e[0].level%2?zh(d):Ah(d):d.text.length;return nb(null==b?Tf(d):b,f)}function Dh(a,b){var c=Bh(a,b.line),d=Pf(a.doc,c.line),e=Wf(d);if(!e||0==e[0].level){var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&b.ch<=f&&b.ch;return nb(c.line,g?0:f)}return c}function Eh(a,b,c){var d=a[0].level;return b==d?!0:c==d?!1:c>b}function Gh(a,b){Fh=null;for(var d,c=0;c<a.length;++c){var e=a[c];if(e.from<b&&e.to>b)return c;if(e.from==b||e.to==b){if(null!=d)return Eh(a,e.level,a[d].level)?(e.from!=e.to&&(Fh=d),c):(e.from!=e.to&&(Fh=c),d);d=c}}return d}function Hh(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&Wg(a.text.charAt(b)));return b}function Ih(a,b,c,d){var e=Wf(a);if(!e)return Jh(a,b,c,d);for(var f=Gh(e,b),g=e[f],h=Hh(a,b,g.level%2?-c:c,d);;){if(h>g.from&&h<g.to)return h;if(h==g.from||h==g.to)return Gh(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?Hh(a,g.to,-1,d):Hh(a,g.from,1,d)}}function Jh(a,b,c,d){var e=b+c;if(d)for(;e>0&&Wg(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var a=/gecko\/\d/i.test(navigator.userAgent),b=/MSIE \d/.test(navigator.userAgent),c=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),d=b||c,e=d&&(b?document.documentMode||6:c[1]),f=/WebKit\//.test(navigator.userAgent),g=f&&/Qt\/\d+\.\d+/.test(navigator.userAgent),h=/Chrome\//.test(navigator.userAgent),i=/Opera\//.test(navigator.userAgent),j=/Apple Computer/.test(navigator.vendor),k=/KHTML\//.test(navigator.userAgent),l=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),m=/PhantomJS/.test(navigator.userAgent),n=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),o=n||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),p=n||/Mac/.test(navigator.platform),q=/win/i.test(navigator.platform),r=i&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);r&&(r=Number(r[1])),r&&r>=15&&(i=!1,f=!0);var s=p&&(g||i&&(null==r||12.11>r)),t=a||d&&e>=9,u=!1,v=!1,nb=w.Pos=function(a,b){return this instanceof nb?(this.line=a,this.ch=b,void 0):new nb(a,b)},ob=w.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch};sb.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=ob(c.anchor,d.anchor)||0!=ob(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new tb(pb(this.ranges[b].anchor),pb(this.ranges[b].head));return new sb(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(ob(b,d.from())>=0&&ob(a,d.to())<=0)return c}return-1}},tb.prototype={from:function(){return rb(this.anchor,this.head)},to:function(){return qb(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var wc,id,jd,gc={left:0,right:0,top:0,bottom:0},zc=null,Ac=0,Zc=null,pd=0,ud=0,vd=null;d?vd=-.53:a?vd=15:h?vd=-.7:j&&(vd=-1/3);var zd,Cd=null,Ld=w.changeEnd=function(a){return a.text?nb(a.from.line+a.text.length-1,Kg(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};w.prototype={constructor:w,focus:function(){window.focus(),ad(this),Yc(this)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,ke.hasOwnProperty(a)&&Lc(this,ke[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||"string"!=typeof b[c]&&b[c].name==a)return b.splice(c,1),!0},addOverlay:Mc(function(a,b){var c=a.token?a:w.getMode(this.options,a);if(c.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,modeSpec:a,opaque:b&&b.opaque}),this.state.modeGen++,Qc(this)}),removeOverlay:Mc(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,Qc(this),void 0}}),indentLine:Mc(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),zb(this.doc,a)&&de(this,a,b,c)}),indentSelection:Mc(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(de(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&be(this));else{var f=e.from(),g=e.to(),h=Math.max(c,f.line);c=Math.min(this.lastLine(),g.line-(g.ch?0:1))+1;for(var i=h;c>i;++i)de(this,i,a);var j=this.doc.sel.ranges;0==f.ch&&b.length==j.length&&j[d].from().ch>0&&Eb(this.doc,d,new tb(f,j[d].to()),Cg)}}}),getTokenAt:function(a,b){var c=this.doc;a=xb(c,a);for(var d=Xb(this,a.line,b),e=this.doc.mode,f=Pf(c,a.line),g=new Ae(f.text,this.options.tabSize);g.pos<a.ch&&!g.eol();){g.start=g.pos;var h=qf(e,g,d)}return{start:g.start,end:g.pos,string:g.current(),type:h||null,state:d}},getTokenTypeAt:function(a){a=xb(this.doc,a);var f,b=tf(this,Pf(this.doc,a.line)),c=0,d=(b.length-1)/2,e=a.ch;if(0==e)f=b[2];else for(;;){var g=c+d>>1;if((g?b[2*g-1]:0)>=e)d=g;else{if(!(b[2*g+1]<e)){f=b[2*g+2];break}c=g+1}}var h=f?f.indexOf("cm-overlay "):-1;return 0>h?f:0==h?null:f.slice(0,h-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?w.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!re.hasOwnProperty(b))return re;var d=re[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;f<e[b].length;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(var f=0;f<d._global.length;f++){var h=d._global[f];h.pred(e,this)&&-1==Mg(c,h.val)&&c.push(h.val)}return c},getStateAfter:function(a,b){var c=this.doc;return a=wb(c,null==a?c.first+c.size-1:a),Xb(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel.primary();return c=null==a?d.head:"object"==typeof a?xb(this.doc,a):a?d.from():d.to(),rc(this,c,b||"page")},charCoords:function(a,b){return qc(this,xb(this.doc,a),b||"page")},coordsChar:function(a,b){return a=pc(this,a,b||"page"),uc(this,a.left,a.top)},lineAtHeight:function(a,b){return a=pc(this,{top:a,left:0},b||"page").top,Uf(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0);var e=Pf(this.doc,a);return oc(this,e,{top:0,left:0},b||"page").top+(c?this.doc.height-Vf(e):0)},defaultTextHeight:function(){return xc(this.display)},defaultCharWidth:function(){return yc(this.display)},setGutterMarker:Mc(function(a,b,c){return ee(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&Ug(d)&&(a.gutterMarkers=null),!0})}),clearGutter:Mc(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Rc(b,d,"gutter"),Ug(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineWidget:Mc(function(a,b,c){return kf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!zb(this.doc,a))return null;var b=a;if(a=Pf(this.doc,a),!a)return null}else{var b=Tf(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=rc(this,xb(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&$d(this,h,g,h+b.offsetWidth,g+b.offsetHeight)
},triggerOnKeyDown:Mc(Dd),triggerOnKeyPress:Mc(Gd),triggerOnKeyUp:Fd,execCommand:function(a){return ue.hasOwnProperty(a)?ue[a](this):void 0},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=xb(this.doc,a);b>f&&(g=ge(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:Mc(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?ge(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},Eg)}),deleteH:Mc(function(a,b){var c=this.doc.sel,d=this.doc;c.somethingSelected()?d.replaceSelection("",null,"+delete"):fe(this,function(c){var e=ge(d,c.head,a,b,!1);return 0>a?{from:e,to:c.head}:{from:c.head,to:e}})}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=xb(this.doc,a);b>g;++g){var i=rc(this,h,"div");if(null==f?f=i.left:i.left=f,h=he(this,i,e,c),h.hitSide)break}return h},moveV:Mc(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();if(d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var h=rc(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn),e.push(h.left);var i=he(c,h,a,b);return"page"==b&&g==d.sel.primary()&&ae(c,null,qc(c,i,"div").top-h.top),i},Eg),e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),toggleOverwrite:function(a){(null==a||a!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?dh(this.display.cursorDiv,"CodeMirror-overwrite"):ch(this.display.cursorDiv,"CodeMirror-overwrite"),sg(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return ah()==this.display.input},scrollTo:Mc(function(a,b){(null!=a||null!=b)&&ce(this),null!=a&&(this.curOp.scrollLeft=a),null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller,b=Ag;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:Mc(function(a,b){if(null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:nb(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),a.margin=b||0,null!=a.from.line)ce(this),this.curOp.scrollToPos=a;else{var c=_d(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:Mc(function(a,b){function d(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var c=this;null!=a&&(c.display.wrapper.style.width=d(a)),null!=b&&(c.display.wrapper.style.height=d(b)),c.options.lineWrapping&&kc(this);var e=c.display.viewFrom;c.doc.iter(e,c.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Rc(c,e,"widget");break}++e}),c.curOp.forceUpdate=!0,sg(c,"refresh",this)}),operation:function(a){return Kc(this,a)},refresh:Mc(function(){var a=this.display.cachedTextHeight;Qc(this),this.curOp.forceUpdate=!0,lc(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),H(this),(null==a||Math.abs(a-xc(this.display))>.5)&&C(this),sg(this,"refresh",this)}),swapDoc:Mc(function(a){var b=this.doc;return b.cm=null,Of(this,a),lc(this),_c(this),this.scrollTo(a.scrollLeft,a.scrollTop),ug(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},zg(w);var je=w.defaults={},ke=w.optionHandlers={},me=w.Init={toString:function(){return"CodeMirror.Init"}};le("value","",function(a,b){a.setValue(b)},!0),le("mode",null,function(a,b){a.doc.modeOption=b,y(a)},!0),le("indentUnit",2,y,!0),le("indentWithTabs",!1),le("smartIndent",!0),le("tabSize",4,function(a){z(a),lc(a),Qc(a)},!0),le("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b){a.options.specialChars=new RegExp(b.source+(b.test("	")?"":"|	"),"g"),a.refresh()},!0),le("specialCharPlaceholder",zf,function(a){a.refresh()},!0),le("electricChars",!0),le("rtlMoveVisually",!q),le("wholeLineUpdateBefore",!0),le("theme","default",function(a){E(a),F(a)},!0),le("keyMap","default",D),le("extraKeys",null),le("lineWrapping",!1,A,!0),le("gutters",[],function(a){K(a.options),F(a)},!0),le("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?S(a.display)+"px":"0",a.refresh()},!0),le("coverGutterNextToScrollbar",!1,N,!0),le("lineNumbers",!1,function(a){K(a.options),F(a)},!0),le("firstLineNumber",1,F,!0),le("lineNumberFormatter",function(a){return a},F,!0),le("showCursorWhenSelecting",!1,Qb,!0),le("resetSelectionOnContextMenu",!0),le("readOnly",!1,function(a,b){"nocursor"==b?(Id(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||_c(a))}),le("disableInput",!1,function(a,b){b||_c(a)},!0),le("dragDrop",!0),le("cursorBlinkRate",530),le("cursorScrollMargin",0),le("cursorHeight",1,Qb,!0),le("singleCursorHeightPerLine",!0,Qb,!0),le("workTime",100),le("workDelay",100),le("flattenSpans",!0,z,!0),le("addModeClass",!1,z,!0),le("pollInterval",100),le("undoDepth",200,function(a,b){a.doc.history.undoDepth=b}),le("historyEventDelay",1250),le("viewportMargin",10,function(a){a.refresh()},!0),le("maxHighlightLength",1e4,z,!0),le("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)}),le("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),le("autofocus",null);var ne=w.modes={},oe=w.mimeModes={};w.defineMode=function(a,b){if(w.defaults.mode||"null"==a||(w.defaults.mode=a),arguments.length>2){b.dependencies=[];for(var c=2;c<arguments.length;++c)b.dependencies.push(arguments[c])}ne[a]=b},w.defineMIME=function(a,b){oe[a]=b},w.resolveMode=function(a){if("string"==typeof a&&oe.hasOwnProperty(a))a=oe[a];else if(a&&"string"==typeof a.name&&oe.hasOwnProperty(a.name)){var b=oe[a.name];"string"==typeof b&&(b={name:b}),a=Og(b,a),a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return w.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}},w.getMode=function(a,b){var b=w.resolveMode(b),c=ne[b.name];if(!c)return w.getMode(a,"text/plain");var d=c(a,b);if(pe.hasOwnProperty(b.name)){var e=pe[b.name];for(var f in e)e.hasOwnProperty(f)&&(d.hasOwnProperty(f)&&(d["_"+f]=d[f]),d[f]=e[f])}if(d.name=b.name,b.helperType&&(d.helperType=b.helperType),b.modeProps)for(var f in b.modeProps)d[f]=b.modeProps[f];return d},w.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),w.defineMIME("text/plain","null");var pe=w.modeExtensions={};w.extendMode=function(a,b){var c=pe.hasOwnProperty(a)?pe[a]:pe[a]={};Pg(b,c)},w.defineExtension=function(a,b){w.prototype[a]=b},w.defineDocExtension=function(a,b){Kf.prototype[a]=b},w.defineOption=le;var qe=[];w.defineInitHook=function(a){qe.push(a)};var re=w.helpers={};w.registerHelper=function(a,b,c){re.hasOwnProperty(a)||(re[a]=w[a]={_global:[]}),re[a][b]=c},w.registerGlobalHelper=function(a,b,c,d){w.registerHelper(a,b,d),re[a]._global.push({pred:c,val:d})};var se=w.copyState=function(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c},te=w.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};w.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state,a=c.mode}return c||{mode:a,state:b}};var ue=w.commands={selectAll:function(a){a.setSelection(nb(a.firstLine(),0),nb(a.lastLine()),Cg)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Cg)},killLine:function(a){fe(a,function(b){if(b.empty()){var c=Pf(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:nb(b.head.line+1,0)}:{from:b.head,to:nb(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){fe(a,function(b){return{from:nb(b.from().line,0),to:xb(a.doc,nb(b.to().line+1,0))}})},delLineLeft:function(a){fe(a,function(a){return{from:nb(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){fe(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return{from:d,to:b.from()}})},delWrappedLineRight:function(a){fe(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:d}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(nb(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(nb(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return Bh(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return Dh(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){return Ch(a,b.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div")},Eg)},goLineLeft:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:c},"div")},Eg)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return d.ch<a.getLine(d.line).search(/\S/)?Dh(a,b.head):d},Eg)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),g=Gg(a.getLine(f.line),f.ch,d);b.push(new Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){Kc(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=Pf(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new nb(e.line,e.ch-1)),e.ch>0)e=new nb(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),nb(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=Pf(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+"\n"+g.charAt(g.length-1),nb(e.line-1,g.length-1),nb(e.line,1),"+transpose")}c.push(new tb(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){Kc(a,function(){for(var b=a.listSelections().length,c=0;b>c;c++){var d=a.listSelections()[c];a.replaceRange("\n",d.anchor,d.head,"+input"),a.indentLine(d.from().line+1,null,!0),be(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},ve=w.keyMap={};ve.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},ve.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},ve.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},ve.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},ve["default"]=p?ve.macDefault:ve.pcDefault;var xe=w.lookupKey=function(a,b,c){function d(b){b=we(b);var e=b[a];if(e===!1)return"stop";if(null!=e&&c(e))return!0;if(b.nofallthrough)return"stop";var f=b.fallthrough;if(null==f)return!1;if("[object Array]"!=Object.prototype.toString.call(f))return d(f);for(var g=0;g<f.length;++g){var h=d(f[g]);if(h)return h}return!1}for(var e=0;e<b.length;++e){var f=d(b[e]);if(f)return"stop"!=f}},ye=w.isModifierKey=function(a){var b=vh[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b},ze=w.keyName=function(a,b){if(i&&34==a.keyCode&&a["char"])return!1;var c=vh[a.keyCode];return null==c||a.altGraphKey?!1:(a.altKey&&(c="Alt-"+c),(s?a.metaKey:a.ctrlKey)&&(c="Ctrl-"+c),(s?a.ctrlKey:a.metaKey)&&(c="Cmd-"+c),!b&&a.shiftKey&&(c="Shift-"+c),c)};w.fromTextArea=function(a,b){function d(){a.value=i.getValue()}if(b||(b={}),b.value=a.value,!b.tabindex&&a.tabindex&&(b.tabindex=a.tabindex),!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder),null==b.autofocus){var c=ah();b.autofocus=c==a||null!=a.getAttribute("autofocus")&&c==document.body}if(a.form&&(qg(a.form,"submit",d),!b.leaveSubmitMethodAlone)){var e=a.form,f=e.submit;try{var g=e.submit=function(){d(),e.submit=f,e.submit(),e.submit=g}}catch(h){}}a.style.display="none";var i=w(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return i.save=d,i.getTextArea=function(){return a},i.toTextArea=function(){d(),a.parentNode.removeChild(i.getWrapperElement()),a.style.display="",a.form&&(rg(a.form,"submit",d),"function"==typeof a.form.submit&&(a.form.submit=f))},i};var Ae=w.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Ae.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Gg(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Gg(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Gg(this.string,null,this.tabSize)-(this.lineStart?Gg(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"!=typeof a){var f=this.string.slice(this.pos).match(a);return f&&f.index>0?null:(f&&b!==!1&&(this.pos+=f[0].length),f)}var d=function(a){return c?a.toLowerCase():a},e=this.string.substr(this.pos,a.length);return d(e)==d(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Be=w.TextMarker=function(a,b){this.lines=[],this.type=b,this.doc=a};zg(Be),Be.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&Bc(a),yg(this,"clear")){var c=this.find();c&&ug(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Ke(g.markedSpans,this);a&&!this.collapsed?Rc(a,Tf(g),"text"):a&&(null!=h.to&&(e=Tf(g)),null!=h.from&&(d=Tf(g))),g.markedSpans=Le(g.markedSpans,h),null==h.from&&this.collapsed&&!ef(this.doc,g)&&a&&Sf(g,xc(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var i=af(this.lines[f]),j=I(i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&this.collapsed&&Qc(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Lb(a.doc)),a&&ug(a,"markerCleared",a,this),b&&Dc(a),this.parent&&this.parent.clear()}},Be.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=Ke(f.markedSpans,this);if(null!=g.from&&(c=nb(b?f:Tf(f),g.from),-1==a))return c;if(null!=g.to&&(d=nb(b?f:Tf(f),g.to),1==a))return d}return c&&{from:c,to:d}},Be.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&Kc(c,function(){var d=a.line,e=Tf(a.line),f=dc(c,e);if(f&&(jc(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0),c.curOp.updateMaxLine=!0,!ef(b.doc,d)&&null!=b.height){var g=b.height;b.height=null;var h=jf(b)-g;h&&Sf(d,d.height+h)}})},Be.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=Mg(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},Be.prototype.detachLine=function(a){if(this.lines.splice(Mg(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}};var Ce=0,Ee=w.SharedTextMarker=function(a,b){this.markers=a,this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};zg(Ee),Ee.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();ug(this,"clear")}},Ee.prototype.find=function(a,b){return this.primary.find(a,b)};var gf=w.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};zg(gf),gf.prototype.clear=function(){var a=this.cm,b=this.line.widgets,c=this.line,d=Tf(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=jf(this);Kc(a,function(){hf(a,c,-f),Rc(a,d,"widget"),Sf(c,Math.max(0,c.height-f))})}},gf.prototype.changed=function(){var a=this.height,b=this.cm,c=this.line;this.height=null;var d=jf(this)-a;d&&Kc(b,function(){b.curOp.forceUpdate=!0,hf(b,c,d),Sf(c,c.height+d)})};var lf=w.Line=function(a,b,c){this.text=a,Ue(this,b),this.height=c?c(this):1};zg(lf),lf.prototype.lineNo=function(){return Tf(this)};var vf={},wf={};Hf.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,nf(e),ug(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0;d<b.length;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},If.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25&&(this.children.length>1||!(this.children[0]instanceof Hf))){var h=[];this.collapse(h),this.children=[new Hf(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>=a){if(e.insertInner(a,b,c),e.lines&&e.lines.length>50){for(;e.lines.length>50;){var g=e.lines.splice(e.lines.length-25,25),h=new Hf(g);e.height-=h.height,this.children.splice(d+1,0,h),h.parent=this}this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new If(b);if(a.parent){a.size-=c.size,a.height-=c.height;var e=Mg(a.parent.children,a);a.parent.children.splice(e+1,0,c)}else{var d=new If(a.children);d.parent=a,a.children=[d,c],a=d}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>a){var g=Math.min(b,f-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=f}}};var Jf=0,Kf=w.Doc=function(a,b,c){if(!(this instanceof Kf))return new Kf(a,b,c);null==c&&(c=0),If.call(this,[new Hf([new lf("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=c;var d=nb(c,0);this.sel=vb(d),this.history=new Xf(null),this.id=++Jf,this.modeOption=b,"string"==typeof a&&(a=qh(a)),Gf(this,{from:d,to:d,text:a}),Ib(this,vb(d),Cg)};Kf.prototype=Og(If.prototype,{constructor:Kf,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Rf(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:Nc(function(a){var b=nb(this.first,0),c=this.first+this.size-1;Rd(this,{from:b,to:nb(c,Pf(this,c).text.length),text:qh(a),origin:"setValue"},!0),Ib(this,vb(b))}),replaceRange:function(a,b,c,d){b=xb(this,b),c=c?xb(this,c):b,Xd(this,a,b,c,d)},getRange:function(a,b,c){var d=Qf(this,xb(this,a),xb(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},getLineHandle:function(a){return zb(this,a)?Pf(this,a):void 0},getLineNumber:function(a){return Tf(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=Pf(this,a)),af(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return xb(this,a)},getCursor:function(a){var c,b=this.sel.primary();return c=null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||a===!1?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Nc(function(a,b,c){Fb(this,xb(this,"number"==typeof a?nb(a,b||0):a),null,c)}),setSelection:Nc(function(a,b,c){Fb(this,xb(this,a),xb(this,b||a),c)}),extendSelection:Nc(function(a,b,c){Cb(this,xb(this,a),b&&xb(this,b),c)}),extendSelections:Nc(function(a,b){Db(this,Ab(this,a,b))}),extendSelectionsBy:Nc(function(a,b){Db(this,Ng(this.sel.ranges,a),b)}),setSelections:Nc(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new tb(xb(this,a[d].anchor),xb(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex)),Ib(this,ub(e,b),c)}}),addSelection:Nc(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new tb(xb(this,a),xb(this,b||a))),Ib(this,ub(d,d.length-1),c)}),getSelection:function(a){for(var c,b=this.sel.ranges,d=0;d<b.length;d++){var e=Qf(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return a===!1?c:c.join(a||"\n")},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=Qf(this,c[d].from(),c[d].to());a!==!1&&(e=e.join(a||"\n")),b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:Nc(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:qh(a[f]),origin:c}}for(var h=b&&"end"!=b&&Pd(this,d,b),f=d.length-1;f>=0;f--)Rd(this,d[f]);h?Hb(this,h):this.cm&&be(this.cm)}),undo:Nc(function(){Td(this,"undo")}),redo:Nc(function(){Td(this,"redo")}),undoSelection:Nc(function(){Td(this,"undo",!0)}),redoSelection:Nc(function(){Td(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(var d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Xf(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:gg(this.history.done),undone:gg(this.history.undone)}},setHistory:function(a){var b=this.history=new Xf(this.history.maxGeneration);b.done=gg(a.done.slice(0),null,!0),b.undone=gg(a.undone.slice(0),null,!0)},addLineClass:Nc(function(a,b,c){return ee(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[d]){if(new RegExp("(?:^|\\s)"+c+"(?:$|\\s)").test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:Nc(function(a,b,c){return ee(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(new RegExp("(?:^|\\s+)"+c+"(?:$|\\s+)"));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),markText:function(a,b,c){return De(this,xb(this,a),xb(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared};return a=xb(this,a),De(this,a,a,c,"bookmark")},findMarksAt:function(a){a=xb(this,a);var b=[],c=Pf(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=xb(this,a),b=xb(this,b);var d=[],e=a.line;return this.iter(a.line,b.line+1,function(f){var g=f.markedSpans;if(g)for(var h=0;h<g.length;h++){var i=g[h];e==a.line&&a.ch>i.to||null==i.from&&e!=a.line||e==b.line&&i.from>b.ch||c&&!c(i.marker)||d.push(i.marker.parent||i.marker)}++e}),d},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,++c,void 0)}),xb(this,nb(c,b))},indexFromPos:function(a){a=xb(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new Kf(Rf(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel=this.sel,b.extend=!1,a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new Kf(Rf(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],He(d,Ge(this)),d},unlinkDoc:function(a){if(a instanceof w&&(a=a.doc),this.linked)for(var b=0;b<this.linked.length;++b){var c=this.linked[b];if(c.doc==a){this.linked.splice(b,1),a.unlinkDoc(this),Ie(Ge(this));break}}if(a.history==this.history){var d=[a.id];Nf(a,function(a){d.push(a.id)},!0),a.history=new Xf(null),a.history.done=gg(this.history.done,d),a.history.undone=gg(this.history.undone,d)}},iterLinkedDocs:function(a){Nf(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Kf.prototype.eachLine=Kf.prototype.iter;var Lf="iter insert remove copy getEditor".split(" ");for(var Mf in Kf.prototype)Kf.prototype.hasOwnProperty(Mf)&&Mg(Lf,Mf)<0&&(w.prototype[Mf]=function(a){return function(){return a.apply(this.doc,arguments)}}(Kf.prototype[Mf]));zg(Kf);var kg=w.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},lg=w.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},ng=w.e_stop=function(a){kg(a),lg(a)},qg=w.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}},rg=w.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}}},sg=w.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},tg=null,Ag=30,Bg=w.Pass={toString:function(){return"CodeMirror.Pass"}},Cg={scroll:!1},Dg={origin:"*mouse"},Eg={origin:"+move"};Fg.prototype.set=function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)};var Gg=w.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;;){var h=a.indexOf("	",f);if(0>h||h>=b)return g+(b-f);g+=h-f,g+=c-g%c,f=h+1}},Ig=[""],Lg=function(a){a.select()};n?Lg=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:d&&(Lg=function(a){try{a.select()}catch(b){}}),[].indexOf&&(Mg=function(a,b){return a.indexOf(b)}),[].map&&(Ng=function(a,b){return a.map(b)});var Yg,Rg=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Sg=w.isWordChar=function(a){return/\w/.test(a)||a>"\x80"&&(a.toUpperCase()!=a.toLowerCase()||Rg.test(a))},Vg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
Yg=document.createRange?function(a,b,c){var d=document.createRange();return d.setEnd(a,c),d.setStart(a,b),d}:function(a,b,c){var d=document.body.createTextRange();return d.moveToElementText(a.parentNode),d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d},d&&11>e&&(ah=function(){try{return document.activeElement}catch(a){return document.body}});var kh,mh,oh,gh=!1,jh=function(){if(d&&9>e)return!1;var a=Xg("div");return"draggable"in a||"dragDrop"in a}(),qh=w.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},rh=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},sh=function(){var a=Xg("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),th=null,vh={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};w.keyNames=vh,function(){for(var a=0;10>a;a++)vh[a+48]=vh[a+96]=String(a);for(var a=65;90>=a;a++)vh[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)vh[a+111]=vh[a+63235]="F"+a}();var Fh,Kh=function(){function c(c){return 247>=c?a.charAt(c):c>=1424&&1524>=c?"R":c>=1536&&1773>=c?b.charAt(c-1536):c>=1774&&2220>=c?"r":c>=8192&&8203>=c?"w":8204==c?"b":"L"}function j(a,b,c){this.level=a,this.from=b,this.to=c}var a="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",b="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",d=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,f=/[LRr]/,g=/[Lb1n]/,h=/[1n]/,i="L";return function(a){if(!d.test(a))return!1;for(var m,b=a.length,k=[],l=0;b>l;++l)k.push(m=c(a.charCodeAt(l)));for(var l=0,n=i;b>l;++l){var m=k[l];"m"==m?k[l]=n:n=m}for(var l=0,o=i;b>l;++l){var m=k[l];"1"==m&&"r"==o?k[l]="n":f.test(m)&&(o=m,"r"==m&&(k[l]="R"))}for(var l=1,n=k[0];b-1>l;++l){var m=k[l];"+"==m&&"1"==n&&"1"==k[l+1]?k[l]="1":","!=m||n!=k[l+1]||"1"!=n&&"n"!=n||(k[l]=n),n=m}for(var l=0;b>l;++l){var m=k[l];if(","==m)k[l]="N";else if("%"==m){for(var p=l+1;b>p&&"%"==k[p];++p);for(var q=l&&"!"==k[l-1]||b>p&&"1"==k[p]?"1":"N",r=l;p>r;++r)k[r]=q;l=p-1}}for(var l=0,o=i;b>l;++l){var m=k[l];"L"==o&&"1"==m?k[l]="L":f.test(m)&&(o=m)}for(var l=0;b>l;++l)if(e.test(k[l])){for(var p=l+1;b>p&&e.test(k[p]);++p);for(var s="L"==(l?k[l-1]:i),t="L"==(b>p?k[p]:i),q=s||t?"L":"R",r=l;p>r;++r)k[r]=q;l=p-1}for(var v,u=[],l=0;b>l;)if(g.test(k[l])){var w=l;for(++l;b>l&&g.test(k[l]);++l);u.push(new j(0,w,l))}else{var x=l,y=u.length;for(++l;b>l&&"L"!=k[l];++l);for(var r=x;l>r;)if(h.test(k[r])){r>x&&u.splice(y,0,new j(1,x,r));var z=r;for(++r;l>r&&h.test(k[r]);++r);u.splice(y,0,new j(2,z,r)),x=r}else++r;l>x&&u.splice(y,0,new j(1,x,l))}return 1==u[0].level&&(v=a.match(/^\s+/))&&(u[0].from=v[0].length,u.unshift(new j(0,0,v[0].length))),1==Kg(u).level&&(v=a.match(/\s+$/))&&(Kg(u).to-=v[0].length,u.push(new j(0,b-v[0].length,b))),u[0].level!=Kg(u).level&&u.push(new j(u[0].level,b,b)),u}}();return w.version="4.5.1",w});